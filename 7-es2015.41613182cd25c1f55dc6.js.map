{"version":3,"sources":["webpack:///src/lib/catalog/src/components/asset-detail/asset-detail.component.html","webpack:///src/lib/catalog/src/components/asset-detail/asset-detail.component.ts","webpack:///src/lib/catalog/src/components/asset-list/asset-list.component.ts","webpack:///src/lib/catalog/src/components/asset-list/asset-list.component.html","webpack:///src/lib/catalog/src/components/collection-contents/collection-contents.component.html","webpack:///src/lib/catalog/src/components/collection-contents/collection-contents.component.ts","webpack:///src/lib/catalog/src/components/collection-detail/collection-detail.component.html","webpack:///src/lib/catalog/src/components/collection-detail/collection-detail.component.ts","webpack:///src/lib/catalog/src/components/collection-tree/array-to-tree.ts","webpack:///src/lib/catalog/src/components/collection-tree/collection-tree.component.html","webpack:///src/lib/catalog/src/components/collection-tree/collection-tree.component.ts","webpack:///src/lib/catalog/src/components/collection-list/collection-list.component.html","webpack:///src/lib/catalog/src/components/collection-list/collection-list.component.ts","webpack:///src/lib/catalog/src/components/facet-detail/facet-detail.component.html","webpack:///src/lib/catalog/src/components/facet-detail/facet-detail.component.ts","webpack:///src/lib/catalog/src/components/facet-list/facet-list.component.html","webpack:///src/lib/catalog/src/components/facet-list/facet-list.component.ts","webpack:///node_modules/rxjs/_esm2015/internal/operators/withLatestFrom.js","webpack:///src/lib/catalog/src/providers/product-detail/replace-last.ts","webpack:///src/lib/catalog/src/providers/product-detail/product-detail.service.ts","webpack:///src/lib/catalog/src/components/apply-facet-dialog/apply-facet-dialog.component.html","webpack:///src/lib/catalog/src/components/apply-facet-dialog/apply-facet-dialog.component.ts","webpack:///src/lib/catalog/src/components/assign-products-to-channel-dialog/assign-products-to-channel-dialog.component.html","webpack:///src/lib/catalog/src/components/assign-products-to-channel-dialog/assign-products-to-channel-dialog.component.ts","webpack:///src/lib/catalog/src/components/product-detail/product-detail.component.html","webpack:///src/lib/catalog/src/components/product-detail/product-detail.component.ts","webpack:///src/lib/catalog/src/components/product-search-input/product-search-input.component.html","webpack:///src/lib/catalog/src/components/product-search-input/product-search-input.component.ts","webpack:///src/lib/catalog/src/components/product-list/product-list.component.html","webpack:///src/lib/catalog/src/components/product-list/product-list.component.ts","webpack:///src/lib/catalog/src/components/confirm-variant-deletion-dialog/confirm-variant-deletion-dialog.component.html","webpack:///src/lib/catalog/src/components/confirm-variant-deletion-dialog/confirm-variant-deletion-dialog.component.ts","webpack:///src/lib/catalog/src/components/option-value-input/option-value-input.component.html","webpack:///src/lib/catalog/src/components/option-value-input/option-value-input.component.ts","webpack:///src/lib/catalog/src/components/product-variants-editor/product-variants-editor.component.html","webpack:///src/lib/catalog/src/components/product-variants-editor/product-variants-editor.component.ts","webpack:///src/lib/catalog/src/providers/routing/asset-resolver.ts","webpack:///src/lib/catalog/src/providers/routing/collection-resolver.ts","webpack:///src/lib/catalog/src/providers/routing/facet-resolver.ts","webpack:///src/lib/catalog/src/providers/routing/product-resolver.ts","webpack:///src/lib/catalog/src/providers/routing/product-variants-resolver.ts","webpack:///src/lib/catalog/src/catalog.routes.ts","webpack:///src/lib/catalog/src/components/collection-tree/collection-tree-node.component.html","webpack:///src/lib/catalog/src/components/collection-tree/collection-tree-node.component.ts","webpack:///src/lib/catalog/src/components/generate-product-variants/generate-product-variants.component.html","webpack:///src/lib/catalog/src/components/generate-product-variants/generate-product-variants.component.ts","webpack:///src/lib/catalog/src/components/product-assets/product-assets.component.html","webpack:///src/lib/catalog/src/components/product-assets/product-assets.component.ts","webpack:///src/lib/catalog/src/components/update-product-option-dialog/update-product-option-dialog.component.html","webpack:///src/lib/catalog/src/components/update-product-option-dialog/update-product-option-dialog.component.ts","webpack:///src/lib/catalog/src/components/variant-price-detail/variant-price-detail.component.html","webpack:///src/lib/catalog/src/components/variant-price-detail/variant-price-detail.component.ts","webpack:///src/lib/catalog/src/components/product-variants-list/product-variants-list.component.html","webpack:///src/lib/catalog/src/components/product-variants-list/product-variants-list.component.ts","webpack:///src/lib/catalog/src/components/product-variants-table/product-variants-table.component.html","webpack:///src/lib/catalog/src/components/product-variants-table/product-variants-table.component.ts","webpack:///src/lib/catalog/src/catalog.module.ts"],"names":["router","route","serverConfigService","notificationService","dataService","formBuilder","super","detailForm","this","customFields","getCustomFieldConfig","name","tags","group","reduce","hash","field","init","destroy","event","get","setValue","markAsDirty","product","updateAsset","id","value","subscribe","success","entity","err","error","languageCode","length","customFieldsGroup","fieldDef","key","control","patchValue","onAssetChange","modalService","searchTerm$","BehaviorSubject","undefined","filterByTags$","uploading","setQueryFn","args","getAssetList","data","assets","skip","take","searchTerm","map","t","options","filter","contains","sort","createdAt","DESC","tagsOperator","AND","ngOnInit","paginationConfig$","combineLatest","itemsPerPage$","currentPage$","totalItems$","pipe","itemsPerPage","currentPage","totalItems","debounceTime","takeUntil","destroy$","refresh","allTags$","getTagList","mapStream","items","files","createAssets","finalize","successCount","result","__typename","message","count","showModalAndDelete","a","switchMap","response","DELETED","r","assetIds","dialog","title","translationVars","body","buttons","type","label","returnValue","res","deleteAssets","filesSelected","setItemsPerPage","setPageNumber","filterTermControl","collectionIdChange$","refresh$","Subject","contentsCurrentPage$","paramMap","qpm","page","startWith","distinctUntilChanged","contentsItemsPerPage$","perPage","filterTerm$","valueChanges","tap","setContentsPageNumber","collection$","filterTerm","collection","getCollectionContents","mapSingle","of","contents$","productVariants","contentsTotalItems$","changes","next","collectionId","currentValue","complete","setParam","navigate","snapshot","params","relativeTo","queryParamsHandling","setContentsItemsPerPage","changeDetector","assetChanges","filters","allFilters","updatePermission","UpdateCatalog","UpdateCollection","required","slug","description","visible","array","getCollectionFilters","single$","collectionFilters","find","f","code","Object","values","nameValue","entity$","languageCode$","slugControl","currentTranslation","currentSlugIsEmpty","pristine","normalizeString","collectionFilter","filtersArray","findIndex","o","argsHash","output","arg","push","index","removeAt","splice","dirty","mergeMap","category","input","getUpdatedCollection","parentId","createCollection","markAsPristine","markForCheck","updateCollection","contentsComponent","canDeactivate","featuredAsset","isPrivate","forEach","addFilter","form","updatedCategory","translatable","updatedFields","customFieldConfig","defaultTranslation","featuredAssetId","mapOperationsToInputs","operations","formValueOperations","i","arguments","j","setLanguage","arrayToTree","nodes","currentState","topLevelNodes","mappedArr","currentStateMap","tree","nodeMap","Map","visit","node","set","children","n","hasOwnProperty","mappedElem","expanded","parent","expandAll","rearrange","deleteCollection","collections","collectionTree","item","newParentId","container","Error","emit","currentIndex","queryResult","getCollections","refetchOnChannelChange","items$","shareReplay","activeCollectionId$","pm","activeCollectionTitle$","match","c","availableLanguages$","getAvailableLanguages","contentLanguage$","client","uiState","contentLanguage","completed$","moveCollection","hasChildren","contents","setContentLanguage","ref","refetch","onRearrange","UpdateFacet","customValueFields","facet","currentCode","codeControl","valuesFormArray","insert","facetForm","newFacet","getUpdatedFacet","createFacet","getAllFacets","mapTo","facetGroup","updateOperations","updateFacet","valuesArray","newValues","controls","facetId","translations","createFacetValues","getFacet","updatedValues","getUpdatedFacetValues","updateFacetValues","forkJoin","facetValueId","deleted","deleteFacetValues","currentValuesFormArray","valueTranslation","valueControl","at","customValueFieldsGroup","addControl","fieldValue","facetFormGroup","dirtyValues","v","formRow","toString","dirtyValueValues","notNullOrUndefined","initialLimit","displayLimit","getFacets","facets","deleteFacet","withLatestFrom","source","project","pop","observables","lift","WithLatestFromOperator","subscriber","OuterSubscriber","destination","toRespond","len","Array","observable","add","subscribeToResult","_outerValue","innerValue","outerIndex","found","indexOf","_tryProject","apply","replaceLast","target","search","replace","lastIndex","lastIndexOf","substr","settings","getTaxCategories","taxCategories","createVariantsConfig","createProduct$","createProduct","nonEmptyOptionGroups","groups","g","createOptionGroups$","createProductOptionGroups","optionGroups","optionGroup","addOptionGroupToProduct","productId","optionGroupId","variants","optionIds","optionValues","optionName","option","og","flat","createProductVariants","createProductOptionGroup","variantData","join","price","sku","stockOnHand","stock","updateOptions","autoUpdate","productInput","variantsInput","updateVariantsInput","updateProduct","productOldName","productNewName","variant","currentVariantName","variantInput","existingVariantInput","variantTranslation","updateProductVariants","updateProductVariantNames$","oldOptionName","newOptionName","variantsToUpdate","includes","variantName","updateProductOption","deleteProductVariant","getProduct","throwError","ApplyFacetDialogComponent","selectedValues","setTimeout","selector","focus","resolveWith","priceFactorControl","selectedChannelIdControl","productVariantIds","activeChannelId$","userStatus","activeChannelId","allChannels$","getChannels","channels","currentChannel","availableChannels","ids","selectChannel","variantsPreview$","from","getTopVariants","factor","pricePreview","channelIds","selectedChannel","isProductVariantMode","assignVariantsToChannel","channelId","priceFactor","channel","assignProductsToChannel","productIds","toPromise","slice","filterInput","productDetailService","location","variantAssetChanges","selectedVariantIds","variantDisplayMode","customVariantFields","customOptionGroupFields","customOptionFields","enabled","autoUpdateVariantNames","facetValueIds","product$","variants$","term","lcTerm","toLocaleLowerCase","taxCategories$","activeTab$","facets$","productFacetValues$","facetValues","allFacetValues$","formFacetValueIdChanges$","getProductFormGroup","val","formChangeFacetValues$","productFacetValues","allFacetValues","combined","fv","facetValues$","merge","productChannels$","p","channelPriceIncludesTax$","getActiveChannel","activeChannel","pricesIncludeTax","tabName","replaceState","createUrlTree","tab","channelCode","DEFAULT_CHANNEL_CODE","fromComponent","size","locals","currentChannelIds","removeProductsFromChannel","removeVariantsFromChannel","keys","variantId","displayFacetValueModal","productGroup","currentFacetValueIds","unique","existingFacetValueIds","variantFormGroup","every","closable","newProduct","getUpdatedProduct","createProductWithVariants","console","priceIncludesTax","assetsChanged","variantsArray","variantAssetsChanged","getUpdatedProductVariants","updateSlugAfterSave","cfCurrentTranslation","cfProduct","variantsFormArray","priceWithTax","taxCategoryId","taxCategory","useGlobalOutOfStockThreshold","outOfStockThreshold","trackInventory","productFormGroup","updatedProduct","dirtyVariants","dirtyVariantValues","formValue","results","firstResult","emitEvent","searchTermChange","facetValueChange","lastTerm","lastFacetValueIds","filterFacetResults","isFacetValueItem","facetValue","toLowerCase","startsWith","selectComponent","select","currentTerm","selectedItems","unselect","isArray","searchTermItem","itemsList","markedIndex","provide","useValue","onSelectChange","jobQueueService","groupByProduct","searchProducts","facetValueOperator","result$","queryParamMap","productSearchInput","setSearchTerm","fvids$","getAll","setFacetValues","delay","__","setQueryParam","q","fvids","reindex","info","addJob","job","state","COMPLETED","time","Intl","NumberFormat","format","duration","indexedItemCount","deleteProduct","setFacetValueIds","rebuildSearchIndex","ConfirmVariantDeletionDialogComponent","OPTION_VALUE_INPUT_VALUE_ACCESSOR","useExisting","multi","groupName","disabled","isFocussed","lastSelected","fn","onChangeFn","onTouchFn","isDisabled","obj","textArea","nativeElement","locked","addOptionValue","preventDefault","removeLastOption","parseInputIntoOptions","split","s","trim","handleKey","handleBlur","GeneratedVariant","config","formValueChanged","generatedVariants","initOptionsAndVariants","currencyCode","variantInfo","existing","isNew","previousVariants","generatedVariantFactory","isDefault","existingVariant","prototypeVariant","prototype","getVariantPrototype","productVariantId","generateAllCombinations","optionsAreEqual","optionsAreSubset","pick","reFetchProduct","newOptionGroups","checkUniqueSkus","confirmDeletionOfObsoleteVariants","createdOptionGroups","addOptionGroupsToProduct","addNewOptionsToGroups","groupsIds","fetchOptionGroups","createNewProductVariants","deleteObsoleteVariants","withDuplicateSkus","gv","obsoleteVariants","getObsoleteVariants","newOptions","createdGroup","cog","productOptionGroupId","allGroupIds","addOptionToGroup","getProductOptionGroup","productOptionGroup","deleteOperations","getProductVariantsOptions","generateVariants","b","toOptionString","x","save","addOption","updatedAt","IMAGE","fileSize","mimeType","width","height","preview","focalPoint","getAsset","asset","getCollection","catalogRoutes","path","component","breadcrumb","resolve","productBreadcrumb","productVariantEditorBreadcrumb","facetBreadcrumb","collectionBreadcrumb","assetBreadcrumb","breadcrumbKey","getName","link","root","depth","parentName","permissions$","permissions","hasUpdatePermission$","perms","hasDeletePermission$","DeleteCatalog","DeleteCollection","expandAllChange","previousValue","parentPath","concat","child","onMove","previousIndex","onDrop","onDelete","drop","variantsChange","variantFormValues","sum","copyFromDefault","onFormChange","optionValueInputComponent","stopPropagation","variantsToCreate","prop","viewportRuler","collectionDetailComponent","compact","change","updateCollectionPermissions","updateProductPermissions","UpdateProduct","emitChangeEvent","previousContainer","updateVariantName","codeInputTouched","productOption","activeLanguage","customFieldsForm","updateCode","priceChange$","taxCategoryIdChange$","taxRates$","getTaxRates","taxRates","activeChannel$","taxRate$","defaultTaxZone","applicableRate","taxRate","zone","grossPrice$","Math","round","selectFacetValueClick","assignToChannel","removeFromChannel","assetChange","selectionChange","pagination","formGroupMap","GlobalFlag","getGlobalSettings","globalSettings","globalTrackInventory","globalOutOfStockThreshold","subscription","formArray","buildFormGroupMap","unsubscribe","formGroup","FALSE","INHERIT","effectiveOutOfStockThreshold","stockAllocated","areAllSelected","formFacetValueIds","getFacetValueIds","variantFacetValueIds","newValue","clear","controlGroup","pendingAssetChanges","CatalogModule","forChild"],"mappings":"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","file":"x","sourcesContent":["<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"asset-detail\"></vdr-action-bar-items>\r\n        <button\r\n            *vdrIfPermissions=\"['UpdateCatalog', 'UpdateAsset']\"\r\n            class=\"btn btn-primary\"\r\n            (click)=\"save()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n        >\r\n            {{ 'common.update' | translate }}\r\n        </button>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n<vdr-asset-preview\r\n    [asset]=\"entity$ | async\"\r\n    [editable]=\"true\"\r\n    [customFields]=\"customFields\"\r\n    [customFieldsForm]=\"detailForm.get('customFields')\"\r\n    (assetChange)=\"onAssetChange($event)\"\r\n></vdr-asset-preview>\r\n","import { ChangeDetectionStrategy, Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormControl, FormGroup } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    Asset,\r\n    BaseDetailComponent,\r\n    CustomFieldConfig,\r\n    GetAsset,\r\n    LanguageCode,\r\n} from '@vendure/admin-ui/core';\r\nimport { DataService, NotificationService, ServerConfigService } from '@vendure/admin-ui/core';\r\n\r\n@Component({\r\n    selector: 'vdr-asset-detail',\r\n    templateUrl: './asset-detail.component.html',\r\n    styleUrls: ['./asset-detail.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class AssetDetailComponent extends BaseDetailComponent<GetAsset.Asset> implements OnInit, OnDestroy {\r\n    detailForm = new FormGroup({});\r\n    customFields: CustomFieldConfig[];\r\n\r\n    constructor(\r\n        router: Router,\r\n        route: ActivatedRoute,\r\n        serverConfigService: ServerConfigService,\r\n        private notificationService: NotificationService,\r\n        protected dataService: DataService,\r\n        private formBuilder: FormBuilder,\r\n    ) {\r\n        super(route, router, serverConfigService, dataService);\r\n        this.customFields = this.getCustomFieldConfig('Asset');\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.detailForm = new FormGroup({\r\n            name: new FormControl(''),\r\n            tags: new FormControl([]),\r\n            customFields: this.formBuilder.group(\r\n                this.customFields.reduce((hash, field) => ({ ...hash, [field.name]: '' }), {}),\r\n            ),\r\n        });\r\n        this.init();\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy();\r\n    }\r\n\r\n    onAssetChange(event: { id: string; name: string; tags: string[] }) {\r\n        this.detailForm.get('name')?.setValue(event.name);\r\n        this.detailForm.get('tags')?.setValue(event.tags);\r\n        this.detailForm.markAsDirty();\r\n    }\r\n\r\n    save() {\r\n        this.dataService.product\r\n            .updateAsset({\r\n                id: this.id,\r\n                name: this.detailForm.value.name,\r\n                tags: this.detailForm.value.tags,\r\n                customFields: this.detailForm.value.customFields,\r\n            })\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-update-success'), { entity: 'Asset' });\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-update-error'), {\r\n                        entity: 'Asset',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    protected setFormValues(entity: GetAsset.Asset, languageCode: LanguageCode): void {\r\n        this.detailForm.get('name')?.setValue(entity.name);\r\n        this.detailForm.get('tags')?.setValue(entity.tags);\r\n        if (this.customFields.length) {\r\n            const customFieldsGroup = this.detailForm.get('customFields') as FormGroup;\r\n\r\n            for (const fieldDef of this.customFields) {\r\n                const key = fieldDef.name;\r\n                const value = (entity as any).customFields[key];\r\n                const control = customFieldsGroup.get(key);\r\n                if (control) {\r\n                    control.patchValue(value);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { FormControl } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    Asset,\r\n    BaseListComponent,\r\n    DataService,\r\n    DeletionResult,\r\n    GetAssetList,\r\n    LogicalOperator,\r\n    ModalService,\r\n    NotificationService,\r\n    SortOrder,\r\n    TagFragment,\r\n} from '@vendure/admin-ui/core';\r\nimport { PaginationInstance } from 'ngx-pagination';\r\nimport { BehaviorSubject, combineLatest, EMPTY, Observable } from 'rxjs';\r\nimport { debounceTime, finalize, map, switchMap, takeUntil } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'vdr-asset-list',\r\n    templateUrl: './asset-list.component.html',\r\n    styleUrls: ['./asset-list.component.scss'],\r\n})\r\nexport class AssetListComponent\r\n    extends BaseListComponent<GetAssetList.Query, GetAssetList.Items, GetAssetList.Variables>\r\n    implements OnInit {\r\n    searchTerm$ = new BehaviorSubject<string | undefined>(undefined);\r\n    filterByTags$ = new BehaviorSubject<TagFragment[] | undefined>(undefined);\r\n    uploading = false;\r\n    allTags$: Observable<TagFragment[]>;\r\n    paginationConfig$: Observable<PaginationInstance>;\r\n\r\n    constructor(\r\n        private notificationService: NotificationService,\r\n        private modalService: ModalService,\r\n        private dataService: DataService,\r\n        router: Router,\r\n        route: ActivatedRoute,\r\n    ) {\r\n        super(router, route);\r\n        super.setQueryFn(\r\n            (...args: any[]) => this.dataService.product.getAssetList(...args),\r\n            data => data.assets,\r\n            (skip, take) => {\r\n                const searchTerm = this.searchTerm$.value;\r\n                const tags = this.filterByTags$.value?.map(t => t.value);\r\n                return {\r\n                    options: {\r\n                        skip,\r\n                        take,\r\n                        ...(searchTerm\r\n                            ? {\r\n                                  filter: {\r\n                                      name: { contains: searchTerm },\r\n                                  },\r\n                              }\r\n                            : {}),\r\n                        sort: {\r\n                            createdAt: SortOrder.DESC,\r\n                        },\r\n                        tags,\r\n                        tagsOperator: LogicalOperator.AND,\r\n                    },\r\n                };\r\n            },\r\n            { take: 25, skip: 0 },\r\n        );\r\n    }\r\n\r\n    ngOnInit() {\r\n        super.ngOnInit();\r\n        this.paginationConfig$ = combineLatest(this.itemsPerPage$, this.currentPage$, this.totalItems$).pipe(\r\n            map(([itemsPerPage, currentPage, totalItems]) => ({ itemsPerPage, currentPage, totalItems })),\r\n        );\r\n        this.searchTerm$.pipe(debounceTime(250), takeUntil(this.destroy$)).subscribe(() => this.refresh());\r\n\r\n        this.filterByTags$.pipe(takeUntil(this.destroy$)).subscribe(() => this.refresh());\r\n        this.allTags$ = this.dataService.product.getTagList().mapStream(data => data.tags.items);\r\n    }\r\n\r\n    filesSelected(files: File[]) {\r\n        if (files.length) {\r\n            this.uploading = true;\r\n            this.dataService.product\r\n                .createAssets(files)\r\n                .pipe(finalize(() => (this.uploading = false)))\r\n                .subscribe(({ createAssets }) => {\r\n                    let successCount = 0;\r\n                    for (const result of createAssets) {\r\n                        switch (result.__typename) {\r\n                            case 'Asset':\r\n                                successCount++;\r\n                                break;\r\n                            case 'MimeTypeError':\r\n                                this.notificationService.error(result.message);\r\n                                break;\r\n                        }\r\n                    }\r\n                    if (0 < successCount) {\r\n                        super.refresh();\r\n                        this.notificationService.success(_('asset.notify-create-assets-success'), {\r\n                            count: successCount,\r\n                        });\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    deleteAssets(assets: Asset[]) {\r\n        this.showModalAndDelete(assets.map(a => a.id))\r\n            .pipe(\r\n                switchMap(response => {\r\n                    if (response.result === DeletionResult.DELETED) {\r\n                        return [true];\r\n                    } else {\r\n                        return this.showModalAndDelete(\r\n                            assets.map(a => a.id),\r\n                            response.message || '',\r\n                        ).pipe(map(r => r.result === DeletionResult.DELETED));\r\n                    }\r\n                }),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-delete-success'), {\r\n                        entity: 'Assets',\r\n                    });\r\n                    this.refresh();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-delete-error'), {\r\n                        entity: 'Assets',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    private showModalAndDelete(assetIds: string[], message?: string) {\r\n        return this.modalService\r\n            .dialog({\r\n                title: _('catalog.confirm-delete-assets'),\r\n                translationVars: {\r\n                    count: assetIds.length,\r\n                },\r\n                body: message,\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('common.delete'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(res => (res ? this.dataService.product.deleteAssets(assetIds, !!message) : EMPTY)),\r\n                map(res => res.deleteAssets),\r\n            );\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left [grow]=\"true\">\r\n        <vdr-asset-search-input\r\n            class=\"pr4 mt1\"\r\n            [tags]=\"allTags$ | async\"\r\n            (searchTermChange)=\"searchTerm$.next($event)\"\r\n            (tagsChange)=\"filterByTags$.next($event)\"\r\n        ></vdr-asset-search-input>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"asset-list\"></vdr-action-bar-items>\r\n        <vdr-asset-file-input\r\n            (selectFiles)=\"filesSelected($event)\"\r\n            [uploading]=\"uploading\"\r\n            dropZoneTarget=\".content-area\"\r\n        ></vdr-asset-file-input>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-asset-gallery\r\n    [assets]=\"(items$ | async)! | paginate: (paginationConfig$ | async) || {}\"\r\n    [multiSelect]=\"true\"\r\n    [canDelete]=\"['DeleteCatalog', 'DeleteAsset'] | hasPermission\"\r\n    (deleteAssets)=\"deleteAssets($event)\"\r\n></vdr-asset-gallery>\r\n\r\n<div class=\"paging-controls\">\r\n    <vdr-items-per-page-controls\r\n        [itemsPerPage]=\"itemsPerPage$ | async\"\r\n        (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n    ></vdr-items-per-page-controls>\r\n\r\n    <vdr-pagination-controls\r\n        [currentPage]=\"currentPage$ | async\"\r\n        [itemsPerPage]=\"itemsPerPage$ | async\"\r\n        [totalItems]=\"totalItems$ | async\"\r\n        (pageChange)=\"setPageNumber($event)\"\r\n    ></vdr-pagination-controls>\r\n</div>\r\n","<div class=\"contents-header\">\r\n    <div class=\"header-title-row\">\r\n        <ng-container\r\n            *ngTemplateOutlet=\"headerTemplate; context: { $implicit: contentsTotalItems$ | async }\"\r\n        ></ng-container>\r\n    </div>\r\n    <input\r\n        type=\"text\"\r\n        [placeholder]=\"'catalog.filter-by-name' | translate\"\r\n        [formControl]=\"filterTermControl\"\r\n    />\r\n</div>\r\n<vdr-data-table\r\n    [items]=\"contents$ | async\"\r\n    [itemsPerPage]=\"contentsItemsPerPage$ | async\"\r\n    [totalItems]=\"contentsTotalItems$ | async\"\r\n    [currentPage]=\"contentsCurrentPage$ | async\"\r\n    (pageChange)=\"setContentsPageNumber($event)\"\r\n    (itemsPerPageChange)=\"setContentsItemsPerPage($event)\"\r\n>\r\n    <ng-template let-variant=\"item\">\r\n        <td class=\"left align-middle\">{{ variant.name }}</td>\r\n        <td class=\"right align-middle\">\r\n            <vdr-table-row-action\r\n                iconShape=\"edit\"\r\n                [label]=\"'common.edit' | translate\"\r\n                [linkTo]=\"['/catalog/products', variant.productId, { tab: 'variants' }]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n","import {\r\n    ChangeDetectionStrategy,\r\n    Component,\r\n    ContentChild,\r\n    Input,\r\n    OnChanges,\r\n    OnDestroy,\r\n    OnInit,\r\n    SimpleChanges,\r\n    TemplateRef,\r\n} from '@angular/core';\r\nimport { FormControl } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { BehaviorSubject, combineLatest, Observable, of, Subject } from 'rxjs';\r\nimport {\r\n    debounceTime,\r\n    distinctUntilChanged,\r\n    map,\r\n    startWith,\r\n    switchMap,\r\n    takeUntil,\r\n    tap,\r\n} from 'rxjs/operators';\r\n\r\nimport { GetCollectionContents } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\n\r\n@Component({\r\n    selector: 'vdr-collection-contents',\r\n    templateUrl: './collection-contents.component.html',\r\n    styleUrls: ['./collection-contents.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class CollectionContentsComponent implements OnInit, OnChanges, OnDestroy {\r\n    @Input() collectionId: string;\r\n    @ContentChild(TemplateRef, { static: true }) headerTemplate: TemplateRef<any>;\r\n\r\n    contents$: Observable<GetCollectionContents.Items[]>;\r\n    contentsTotalItems$: Observable<number>;\r\n    contentsItemsPerPage$: Observable<number>;\r\n    contentsCurrentPage$: Observable<number>;\r\n    filterTermControl = new FormControl('');\r\n    private collectionIdChange$ = new BehaviorSubject<string>('');\r\n    private refresh$ = new BehaviorSubject<boolean>(true);\r\n    private destroy$ = new Subject<void>();\r\n\r\n    constructor(private route: ActivatedRoute, private router: Router, private dataService: DataService) {}\r\n\r\n    ngOnInit() {\r\n        this.contentsCurrentPage$ = this.route.paramMap.pipe(\r\n            map(qpm => qpm.get('contentsPage')),\r\n            map(page => (!page ? 1 : +page)),\r\n            startWith(1),\r\n            distinctUntilChanged(),\r\n        );\r\n\r\n        this.contentsItemsPerPage$ = this.route.paramMap.pipe(\r\n            map(qpm => qpm.get('contentsPerPage')),\r\n            map(perPage => (!perPage ? 10 : +perPage)),\r\n            startWith(10),\r\n            distinctUntilChanged(),\r\n        );\r\n\r\n        const filterTerm$ = this.filterTermControl.valueChanges.pipe(\r\n            debounceTime(250),\r\n            tap(() => this.setContentsPageNumber(1)),\r\n            startWith(''),\r\n        );\r\n\r\n        const collection$ = combineLatest(\r\n            this.collectionIdChange$,\r\n            this.contentsCurrentPage$,\r\n            this.contentsItemsPerPage$,\r\n            filterTerm$,\r\n            this.refresh$,\r\n        ).pipe(\r\n            takeUntil(this.destroy$),\r\n            switchMap(([id, currentPage, itemsPerPage, filterTerm]) => {\r\n                const take = itemsPerPage;\r\n                const skip = (currentPage - 1) * itemsPerPage;\r\n                if (id) {\r\n                    return this.dataService.collection\r\n                        .getCollectionContents(id, take, skip, filterTerm)\r\n                        .mapSingle(data => data.collection);\r\n                } else {\r\n                    return of(null);\r\n                }\r\n            }),\r\n        );\r\n\r\n        this.contents$ = collection$.pipe(map(result => (result ? result.productVariants.items : [])));\r\n        this.contentsTotalItems$ = collection$.pipe(\r\n            map(result => (result ? result.productVariants.totalItems : 0)),\r\n        );\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges): void {\r\n        if ('collectionId' in changes) {\r\n            this.collectionIdChange$.next(changes.collectionId.currentValue);\r\n        }\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy$.next();\r\n        this.destroy$.complete();\r\n    }\r\n\r\n    setContentsPageNumber(page: number) {\r\n        this.setParam('contentsPage', page);\r\n    }\r\n\r\n    setContentsItemsPerPage(perPage: number) {\r\n        this.setParam('contentsPerPage', perPage);\r\n    }\r\n\r\n    refresh() {\r\n        this.refresh$.next(true);\r\n    }\r\n\r\n    private setParam(key: string, value: any) {\r\n        this.router.navigate(['./', { ...this.route.snapshot.params, [key]: value }], {\r\n            relativeTo: this.route,\r\n            queryParamsHandling: 'merge',\r\n        });\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n        <vdr-language-selector\r\n            [disabled]=\"isNew$ | async\"\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"collection-detail\"></vdr-action-bar-items>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            *ngIf=\"isNew$ | async; else updateButton\"\r\n            (click)=\"create()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n        >\r\n            {{ 'common.create' | translate }}\r\n        </button>\r\n        <ng-template #updateButton>\r\n            <button\r\n                *vdrIfPermissions=\"updatePermission\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"(detailForm.invalid || detailForm.pristine) && !assetsChanged()\"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </ng-template>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<form class=\"form\" [formGroup]=\"detailForm\" *ngIf=\"entity$ | async as category\">\r\n    <div class=\"clr-row\">\r\n        <div class=\"clr-col\">\r\n            <vdr-form-field [label]=\"'catalog.visibility' | translate\" for=\"visibility\">\r\n                <clr-toggle-wrapper>\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        clrToggle\r\n                        formControlName=\"visible\"\r\n                        id=\"visibility\"\r\n                        [vdrDisabled]=\"!(updatePermission | hasPermission)\"\r\n                    />\r\n                    <label class=\"visible-toggle\">\r\n                        <ng-container *ngIf=\"detailForm.value.visible; else private\">{{ 'catalog.public' | translate }}</ng-container>\r\n                        <ng-template #private>{{ 'catalog.private' | translate }}</ng-template>\r\n                    </label>\r\n                </clr-toggle-wrapper>\r\n            </vdr-form-field>\r\n            <vdr-form-field [label]=\"'common.name' | translate\" for=\"name\">\r\n                <input\r\n                    id=\"name\"\r\n                    type=\"text\"\r\n                    formControlName=\"name\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                    (input)=\"updateSlug($event.target.value)\"\r\n                />\r\n            </vdr-form-field>\r\n            <vdr-form-field\r\n                [label]=\"'catalog.slug' | translate\"\r\n                for=\"slug\"\r\n                [errors]=\"{ pattern: ('catalog.slug-pattern-error' | translate) }\"\r\n            >\r\n                <input\r\n                    id=\"slug\"\r\n                    type=\"text\"\r\n                    formControlName=\"slug\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                    pattern=\"[a-z0-9_-]+\"\r\n                />\r\n            </vdr-form-field>\r\n            <vdr-rich-text-editor\r\n                formControlName=\"description\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                [label]=\"'common.description' | translate\"\r\n            ></vdr-rich-text-editor>\r\n\r\n            <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n                <label>{{ 'common.custom-fields' | translate }}</label>\r\n                <ng-container *ngFor=\"let customField of customFields\">\r\n                    <vdr-custom-field-control\r\n                        *ngIf=\"customFieldIsSet(customField.name)\"\r\n                        entityName=\"Collection\"\r\n                        [customFieldsFormGroup]=\"detailForm.get(['customFields'])\"\r\n                        [customField]=\"customField\"\r\n                    ></vdr-custom-field-control>\r\n                </ng-container>\r\n            </section>\r\n        </div>\r\n        <div class=\"clr-col-md-auto\">\r\n            <vdr-product-assets\r\n                [assets]=\"category.assets\"\r\n                [featuredAsset]=\"category.featuredAsset\"\r\n                (change)=\"assetChanges = $event\"\r\n            ></vdr-product-assets>\r\n        </div>\r\n    </div>\r\n    <div class=\"clr-row\" formArrayName=\"filters\">\r\n        <div class=\"clr-col\">\r\n            <label>{{ 'catalog.filters' | translate }}</label>\r\n            <ng-container *ngFor=\"let filter of filters; index as i\">\r\n                <vdr-configurable-input\r\n                    (remove)=\"removeFilter($event)\"\r\n                    [operation]=\"filter\"\r\n                    [operationDefinition]=\"getFilterDefinition(filter)\"\r\n                    [formControlName]=\"i\"\r\n                    [readonly]=\"!(updatePermission | hasPermission)\"\r\n                ></vdr-configurable-input>\r\n            </ng-container>\r\n\r\n            <div *vdrIfPermissions=\"updatePermission\">\r\n                <vdr-dropdown>\r\n                    <button class=\"btn btn-outline\" vdrDropdownTrigger>\r\n                        <clr-icon shape=\"plus\"></clr-icon>\r\n                        {{ 'marketing.add-condition' | translate }}\r\n                    </button>\r\n                    <vdr-dropdown-menu vdrPosition=\"bottom-left\">\r\n                        <button\r\n                            *ngFor=\"let filter of allFilters\"\r\n                            type=\"button\"\r\n                            vdrDropdownItem\r\n                            (click)=\"addFilter(filter)\"\r\n                        >\r\n                            {{ filter.description }}\r\n                        </button>\r\n                    </vdr-dropdown-menu>\r\n                </vdr-dropdown>\r\n            </div>\r\n        </div>\r\n        <div class=\"clr-col\">\r\n            <vdr-collection-contents [collectionId]=\"id\" #collectionContents>\r\n                <ng-template let-count>\r\n                    <div class=\"contents-title\">\r\n                        {{ 'catalog.collection-contents' | translate }} ({{\r\n                            'common.results-count' | translate: { count: count }\r\n                        }})\r\n                    </div>\r\n                </ng-template>\r\n            </vdr-collection-contents>\r\n        </div>\r\n    </div>\r\n</form>\r\n","import {\r\n    ChangeDetectionStrategy,\r\n    ChangeDetectorRef,\r\n    Component,\r\n    OnDestroy,\r\n    OnInit,\r\n    ViewChild,\r\n} from '@angular/core';\r\nimport { FormArray, FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    Asset,\r\n    BaseDetailComponent,\r\n    Collection,\r\n    ConfigurableOperation,\r\n    ConfigurableOperationDefinition,\r\n    ConfigurableOperationInput,\r\n    CreateCollectionInput,\r\n    createUpdatedTranslatable,\r\n    CustomFieldConfig,\r\n    DataService,\r\n    encodeConfigArgValue,\r\n    findTranslation,\r\n    getConfigArgValue,\r\n    LanguageCode,\r\n    ModalService,\r\n    NotificationService,\r\n    Permission,\r\n    ServerConfigService,\r\n    UpdateCollectionInput,\r\n} from '@vendure/admin-ui/core';\r\nimport { normalizeString } from '@vendure/common/lib/normalize-string';\r\nimport { combineLatest } from 'rxjs';\r\nimport { mergeMap, take } from 'rxjs/operators';\r\n\r\nimport { CollectionContentsComponent } from '../collection-contents/collection-contents.component';\r\n\r\n@Component({\r\n    selector: 'vdr-collection-detail',\r\n    templateUrl: './collection-detail.component.html',\r\n    styleUrls: ['./collection-detail.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class CollectionDetailComponent\r\n    extends BaseDetailComponent<Collection.Fragment>\r\n    implements OnInit, OnDestroy {\r\n    customFields: CustomFieldConfig[];\r\n    detailForm: FormGroup;\r\n    assetChanges: { assets?: Asset[]; featuredAsset?: Asset } = {};\r\n    filters: ConfigurableOperation[] = [];\r\n    allFilters: ConfigurableOperationDefinition[] = [];\r\n    readonly updatePermission = [Permission.UpdateCatalog, Permission.UpdateCollection];\r\n    @ViewChild('collectionContents') contentsComponent: CollectionContentsComponent;\r\n\r\n    constructor(\r\n        router: Router,\r\n        route: ActivatedRoute,\r\n        serverConfigService: ServerConfigService,\r\n        private changeDetector: ChangeDetectorRef,\r\n        protected dataService: DataService,\r\n        private formBuilder: FormBuilder,\r\n        private notificationService: NotificationService,\r\n        private modalService: ModalService,\r\n    ) {\r\n        super(route, router, serverConfigService, dataService);\r\n        this.customFields = this.getCustomFieldConfig('Collection');\r\n        this.detailForm = this.formBuilder.group({\r\n            name: ['', Validators.required],\r\n            slug: '',\r\n            description: '',\r\n            visible: false,\r\n            filters: this.formBuilder.array([]),\r\n            customFields: this.formBuilder.group(\r\n                this.customFields.reduce((hash, field) => ({ ...hash, [field.name]: '' }), {}),\r\n            ),\r\n        });\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.init();\r\n        this.dataService.collection.getCollectionFilters().single$.subscribe(res => {\r\n            this.allFilters = res.collectionFilters;\r\n        });\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy();\r\n    }\r\n\r\n    getFilterDefinition(filter: ConfigurableOperation): ConfigurableOperationDefinition | undefined {\r\n        return this.allFilters.find(f => f.code === filter.code);\r\n    }\r\n\r\n    customFieldIsSet(name: string): boolean {\r\n        return !!this.detailForm.get(['customFields', name]);\r\n    }\r\n\r\n    assetsChanged(): boolean {\r\n        return !!Object.values(this.assetChanges).length;\r\n    }\r\n\r\n    /**\r\n     * If creating a new Collection, automatically generate the slug based on the collection name.\r\n     */\r\n    updateSlug(nameValue: string) {\r\n        combineLatest(this.entity$, this.languageCode$)\r\n            .pipe(take(1))\r\n            .subscribe(([entity, languageCode]) => {\r\n                const slugControl = this.detailForm.get(['slug']);\r\n                const currentTranslation = findTranslation(entity, languageCode);\r\n                const currentSlugIsEmpty = !currentTranslation || !currentTranslation.slug;\r\n                if (slugControl && slugControl.pristine && currentSlugIsEmpty) {\r\n                    slugControl.setValue(normalizeString(`${nameValue}`, '-'));\r\n                }\r\n            });\r\n    }\r\n\r\n    addFilter(collectionFilter: ConfigurableOperation) {\r\n        const filtersArray = this.detailForm.get('filters') as FormArray;\r\n        const index = filtersArray.value.findIndex(o => o.code === collectionFilter.code);\r\n        if (index === -1) {\r\n            const argsHash = collectionFilter.args.reduce(\r\n                (output, arg) => ({\r\n                    ...output,\r\n                    [arg.name]: getConfigArgValue(arg.value),\r\n                }),\r\n                {},\r\n            );\r\n            filtersArray.push(\r\n                this.formBuilder.control({\r\n                    code: collectionFilter.code,\r\n                    args: argsHash,\r\n                }),\r\n            );\r\n            this.filters.push({\r\n                code: collectionFilter.code,\r\n                args: collectionFilter.args.map(a => ({ name: a.name, value: getConfigArgValue(a.value) })),\r\n            });\r\n        }\r\n    }\r\n\r\n    removeFilter(collectionFilter: ConfigurableOperation) {\r\n        const filtersArray = this.detailForm.get('filters') as FormArray;\r\n        const index = filtersArray.value.findIndex(o => o.code === collectionFilter.code);\r\n        if (index !== -1) {\r\n            filtersArray.removeAt(index);\r\n            this.filters.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    create() {\r\n        if (!this.detailForm.dirty) {\r\n            return;\r\n        }\r\n        combineLatest(this.entity$, this.languageCode$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([category, languageCode]) => {\r\n                    const input = this.getUpdatedCollection(\r\n                        category,\r\n                        this.detailForm,\r\n                        languageCode,\r\n                    ) as CreateCollectionInput;\r\n                    const parentId = this.route.snapshot.paramMap.get('parentId');\r\n                    if (parentId) {\r\n                        input.parentId = parentId;\r\n                    }\r\n                    return this.dataService.collection.createCollection(input);\r\n                }),\r\n            )\r\n            .subscribe(\r\n                data => {\r\n                    this.notificationService.success(_('common.notify-create-success'), {\r\n                        entity: 'Collection',\r\n                    });\r\n                    this.assetChanges = {};\r\n                    this.detailForm.markAsPristine();\r\n                    this.changeDetector.markForCheck();\r\n                    this.router.navigate(['../', data.createCollection.id], { relativeTo: this.route });\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-create-error'), {\r\n                        entity: 'Collection',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    save() {\r\n        combineLatest(this.entity$, this.languageCode$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([category, languageCode]) => {\r\n                    const input = this.getUpdatedCollection(\r\n                        category,\r\n                        this.detailForm,\r\n                        languageCode,\r\n                    ) as UpdateCollectionInput;\r\n                    return this.dataService.collection.updateCollection(input);\r\n                }),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.assetChanges = {};\r\n                    this.detailForm.markAsPristine();\r\n                    this.changeDetector.markForCheck();\r\n                    this.notificationService.success(_('common.notify-update-success'), {\r\n                        entity: 'Collection',\r\n                    });\r\n                    this.contentsComponent.refresh();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-update-error'), {\r\n                        entity: 'Collection',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    canDeactivate(): boolean {\r\n        return super.canDeactivate() && !this.assetChanges.assets && !this.assetChanges.featuredAsset;\r\n    }\r\n\r\n    /**\r\n     * Sets the values of the form on changes to the category or current language.\r\n     */\r\n    protected setFormValues(entity: Collection.Fragment, languageCode: LanguageCode) {\r\n        const currentTranslation = findTranslation(entity, languageCode);\r\n\r\n        this.detailForm.patchValue({\r\n            name: currentTranslation ? currentTranslation.name : '',\r\n            slug: currentTranslation ? currentTranslation.slug : '',\r\n            description: currentTranslation ? currentTranslation.description : '',\r\n            visible: !entity.isPrivate,\r\n        });\r\n\r\n        entity.filters.forEach(f => this.addFilter(f));\r\n\r\n        if (this.customFields.length) {\r\n            const customFieldsGroup = this.detailForm.get(['customFields']) as FormGroup;\r\n\r\n            for (const fieldDef of this.customFields) {\r\n                const key = fieldDef.name;\r\n                const value =\r\n                    fieldDef.type === 'localeString'\r\n                        ? (currentTranslation as any).customFields[key]\r\n                        : (entity as any).customFields[key];\r\n                const control = customFieldsGroup.get(key);\r\n                if (control) {\r\n                    control.patchValue(value);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Given a category and the value of the form, this method creates an updated copy of the category which\r\n     * can then be persisted to the API.\r\n     */\r\n    private getUpdatedCollection(\r\n        category: Collection.Fragment,\r\n        form: FormGroup,\r\n        languageCode: LanguageCode,\r\n    ): CreateCollectionInput | UpdateCollectionInput {\r\n        const updatedCategory = createUpdatedTranslatable({\r\n            translatable: category,\r\n            updatedFields: form.value,\r\n            customFieldConfig: this.customFields,\r\n            languageCode,\r\n            defaultTranslation: {\r\n                languageCode,\r\n                name: category.name || '',\r\n                slug: category.slug || '',\r\n                description: category.description || '',\r\n            },\r\n        });\r\n        return {\r\n            ...updatedCategory,\r\n            assetIds: this.assetChanges.assets?.map(a => a.id),\r\n            featuredAssetId: this.assetChanges.featuredAsset?.id,\r\n            isPrivate: !form.value.visible,\r\n            filters: this.mapOperationsToInputs(this.filters, this.detailForm.value.filters),\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Maps an array of conditions or actions to the input format expected by the GraphQL API.\r\n     */\r\n    private mapOperationsToInputs(\r\n        operations: ConfigurableOperation[],\r\n        formValueOperations: any,\r\n    ): ConfigurableOperationInput[] {\r\n        return operations.map((o, i) => {\r\n            return {\r\n                code: o.code,\r\n                arguments: Object.values(formValueOperations[i].args).map((value: any, j) => ({\r\n                    name: o.args[j].name,\r\n                    value: encodeConfigArgValue(value),\r\n                })),\r\n            };\r\n        });\r\n    }\r\n}\r\n","export type HasParent = { id: string; parent?: { id: string } | null };\r\nexport type TreeNode<T extends HasParent> = T & { children: Array<TreeNode<T>>; expanded: boolean };\r\nexport type RootNode<T extends HasParent> = { id?: string; children: Array<TreeNode<T>> };\r\n\r\n/**\r\n * Builds a tree from an array of nodes which have a parent.\r\n * Based on https://stackoverflow.com/a/31247960/772859, modified to preserve ordering.\r\n */\r\nexport function arrayToTree<T extends HasParent>(nodes: T[], currentState?: RootNode<T>): RootNode<T> {\r\n    const topLevelNodes: Array<TreeNode<T>> = [];\r\n    const mappedArr: { [id: string]: TreeNode<T> } = {};\r\n    const currentStateMap = treeToMap(currentState);\r\n\r\n    // First map the nodes of the array to an object -> create a hash table.\r\n    for (const node of nodes) {\r\n        mappedArr[node.id] = { ...(node as any), children: [] };\r\n    }\r\n\r\n    for (const id of nodes.map(n => n.id)) {\r\n        if (mappedArr.hasOwnProperty(id)) {\r\n            const mappedElem = mappedArr[id];\r\n            mappedElem.expanded = currentStateMap.get(id)?.expanded ?? false;\r\n            const parent = mappedElem.parent;\r\n            if (!parent) {\r\n                continue;\r\n            }\r\n            // If the element is not at the root level, add it to its parent array of children.\r\n            const parentIsRoot = !mappedArr[parent.id];\r\n            if (!parentIsRoot) {\r\n                if (mappedArr[parent.id]) {\r\n                    mappedArr[parent.id].children.push(mappedElem);\r\n                } else {\r\n                    mappedArr[parent.id] = { children: [mappedElem] } as any;\r\n                }\r\n            } else {\r\n                topLevelNodes.push(mappedElem);\r\n            }\r\n        }\r\n    }\r\n    // tslint:disable-next-line:no-non-null-assertion\r\n    const rootId = topLevelNodes.length ? topLevelNodes[0].parent!.id : undefined;\r\n    return { id: rootId, children: topLevelNodes };\r\n}\r\n\r\n/**\r\n * Converts an existing tree (as generated by the arrayToTree function) into a flat\r\n * Map. This is used to persist certain states (e.g. `expanded`) when re-building the\r\n * tree.\r\n */\r\nfunction treeToMap<T extends HasParent>(tree?: RootNode<T>): Map<string, TreeNode<T>> {\r\n    const nodeMap = new Map<string, TreeNode<T>>();\r\n    function visit(node: TreeNode<T>) {\r\n        nodeMap.set(node.id, node);\r\n        node.children.forEach(visit);\r\n    }\r\n    if (tree) {\r\n        visit(tree as TreeNode<T>);\r\n    }\r\n    return nodeMap;\r\n}\r\n","<vdr-collection-tree-node\r\n    *ngIf=\"collectionTree\"\r\n    cdkDropListGroup\r\n    [expandAll]=\"expandAll\"\r\n    [collectionTree]=\"collectionTree\"\r\n    [activeCollectionId]=\"activeCollectionId\"\r\n></vdr-collection-tree-node>\r\n","import { CdkDragDrop } from '@angular/cdk/drag-drop';\r\nimport {\r\n    ChangeDetectionStrategy,\r\n    Component,\r\n    EventEmitter,\r\n    Input,\r\n    OnChanges,\r\n    Output,\r\n    SimpleChanges,\r\n} from '@angular/core';\r\nimport { Collection } from '@vendure/admin-ui/core';\r\n\r\nimport { arrayToTree, HasParent, RootNode } from './array-to-tree';\r\n\r\nexport type RearrangeEvent = { collectionId: string; parentId: string; index: number };\r\nexport type CollectionPartial = Pick<Collection.Fragment, 'id' | 'parent' | 'name'>;\r\n\r\n@Component({\r\n    selector: 'vdr-collection-tree',\r\n    templateUrl: 'collection-tree.component.html',\r\n    styleUrls: ['./collection-tree.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class CollectionTreeComponent implements OnChanges {\r\n    @Input() collections: CollectionPartial[];\r\n    @Input() activeCollectionId: string;\r\n    @Input() expandAll = false;\r\n    @Output() rearrange = new EventEmitter<RearrangeEvent>();\r\n    @Output() deleteCollection = new EventEmitter<string>();\r\n    collectionTree: RootNode<CollectionPartial>;\r\n\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        if ('collections' in changes && this.collections) {\r\n            this.collectionTree = arrayToTree(this.collections, this.collectionTree);\r\n        }\r\n    }\r\n\r\n    onDrop(event: CdkDragDrop<CollectionPartial | RootNode<CollectionPartial>>) {\r\n        const item = event.item.data as CollectionPartial;\r\n        const newParent = event.container.data;\r\n        const newParentId = newParent.id;\r\n        if (newParentId == null) {\r\n            throw new Error(`Could not determine the ID of the root Collection`);\r\n        }\r\n        this.rearrange.emit({\r\n            collectionId: item.id,\r\n            parentId: newParentId,\r\n            index: event.currentIndex,\r\n        });\r\n    }\r\n\r\n    onMove(event: RearrangeEvent) {\r\n        this.rearrange.emit(event);\r\n    }\r\n\r\n    onDelete(id: string) {\r\n        this.deleteCollection.emit(id);\r\n    }\r\n\r\n    private isRootNode<T extends HasParent>(node: T | RootNode<T>): node is RootNode<T> {\r\n        return !node.hasOwnProperty('parent');\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <div class=\"flex center wrap\">\r\n            <vdr-language-selector\r\n                class=\"mt2\"\r\n                [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n                [currentLanguageCode]=\"contentLanguage$ | async\"\r\n                (languageCodeChange)=\"setLanguage($event)\"\r\n            ></vdr-language-selector>\r\n            <clr-checkbox-wrapper\r\n                class=\"expand-all-toggle ml3\"\r\n                [ngClass]=\"(availableLanguages$ | async)?.length === 1 ? 'mt3' : 'mt1'\"\r\n            >\r\n                <input type=\"checkbox\" clrCheckbox [(ngModel)]=\"expandAll\" />\r\n                <label>{{ 'catalog.expand-all-collections' | translate }}</label>\r\n            </clr-checkbox-wrapper>\r\n        </div>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"collection-list\"></vdr-action-bar-items>\r\n        <a\r\n            class=\"btn btn-primary\"\r\n            *vdrIfPermissions=\"['CreateCatalog', 'CreateCollection']\"\r\n            [routerLink]=\"['./create']\"\r\n        >\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            {{ 'catalog.create-new-collection' | translate }}\r\n        </a>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n<div class=\"collection-wrapper\">\r\n    <vdr-collection-tree\r\n        [collections]=\"items$ | async\"\r\n        [activeCollectionId]=\"activeCollectionId$ | async\"\r\n        [expandAll]=\"expandAll\"\r\n        (rearrange)=\"onRearrange($event)\"\r\n        (deleteCollection)=\"deleteCollection($event)\"\r\n    ></vdr-collection-tree>\r\n\r\n    <div class=\"collection-contents\" [class.expanded]=\"activeCollectionId$ | async\">\r\n        <vdr-collection-contents [collectionId]=\"activeCollectionId$ | async\">\r\n            <ng-template let-count>\r\n                <div class=\"collection-title\">\r\n                    {{ activeCollectionTitle$ | async }} ({{\r\n                        'common.results-count' | translate: { count: count }\r\n                    }})\r\n                </div>\r\n                <button type=\"button\" class=\"close-button\" (click)=\"closeContents()\">\r\n                    <clr-icon shape=\"close\"></clr-icon>\r\n                </button>\r\n            </ng-template>\r\n        </vdr-collection-contents>\r\n    </div>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    DataService,\r\n    GetCollectionList,\r\n    LanguageCode,\r\n    ModalService,\r\n    NotificationService,\r\n    QueryResult,\r\n    ServerConfigService,\r\n} from '@vendure/admin-ui/core';\r\nimport { combineLatest, EMPTY, Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map, shareReplay, switchMap, take, tap } from 'rxjs/operators';\r\n\r\nimport { RearrangeEvent } from '../collection-tree/collection-tree.component';\r\n\r\n@Component({\r\n    selector: 'vdr-collection-list',\r\n    templateUrl: './collection-list.component.html',\r\n    styleUrls: ['./collection-list.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class CollectionListComponent implements OnInit, OnDestroy {\r\n    activeCollectionId$: Observable<string | null>;\r\n    activeCollectionTitle$: Observable<string>;\r\n    items$: Observable<GetCollectionList.Items[]>;\r\n    availableLanguages$: Observable<LanguageCode[]>;\r\n    contentLanguage$: Observable<LanguageCode>;\r\n    expandAll = false;\r\n    private queryResult: QueryResult<any>;\r\n\r\n    constructor(\r\n        private dataService: DataService,\r\n        private notificationService: NotificationService,\r\n        private modalService: ModalService,\r\n        private router: Router,\r\n        private route: ActivatedRoute,\r\n        private serverConfigService: ServerConfigService,\r\n    ) {}\r\n\r\n    ngOnInit() {\r\n        this.queryResult = this.dataService.collection.getCollections(1000, 0).refetchOnChannelChange();\r\n        this.items$ = this.queryResult.mapStream(data => data.collections.items).pipe(shareReplay(1));\r\n        this.activeCollectionId$ = this.route.paramMap.pipe(\r\n            map(pm => pm.get('contents')),\r\n            distinctUntilChanged(),\r\n        );\r\n\r\n        this.activeCollectionTitle$ = combineLatest(this.activeCollectionId$, this.items$).pipe(\r\n            map(([id, collections]) => {\r\n                if (id) {\r\n                    const match = collections.find(c => c.id === id);\r\n                    return match ? match.name : '';\r\n                }\r\n                return '';\r\n            }),\r\n        );\r\n        this.availableLanguages$ = this.serverConfigService.getAvailableLanguages();\r\n        this.contentLanguage$ = this.dataService.client\r\n            .uiState()\r\n            .mapStream(({ uiState }) => uiState.contentLanguage)\r\n            .pipe(tap(() => this.refresh()));\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.queryResult.completed$.next();\r\n    }\r\n\r\n    onRearrange(event: RearrangeEvent) {\r\n        this.dataService.collection.moveCollection([event]).subscribe({\r\n            next: () => {\r\n                this.notificationService.success(_('common.notify-saved-changes'));\r\n                this.refresh();\r\n            },\r\n            error: err => {\r\n                this.notificationService.error(_('common.notify-save-changes-error'));\r\n            },\r\n        });\r\n    }\r\n\r\n    deleteCollection(id: string) {\r\n        this.items$\r\n            .pipe(\r\n                take(1),\r\n                map(items => -1 < items.findIndex(i => i.parent && i.parent.id === id)),\r\n                switchMap(hasChildren => {\r\n                    return this.modalService.dialog({\r\n                        title: _('catalog.confirm-delete-collection'),\r\n                        body: hasChildren\r\n                            ? _('catalog.confirm-delete-collection-and-children-body')\r\n                            : undefined,\r\n                        buttons: [\r\n                            { type: 'secondary', label: _('common.cancel') },\r\n                            { type: 'danger', label: _('common.delete'), returnValue: true },\r\n                        ],\r\n                    });\r\n                }),\r\n                switchMap(response => (response ? this.dataService.collection.deleteCollection(id) : EMPTY)),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-delete-success'), {\r\n                        entity: 'Collection',\r\n                    });\r\n                    this.refresh();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-delete-error'), {\r\n                        entity: 'Collection',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    closeContents() {\r\n        const params = { ...this.route.snapshot.params };\r\n        delete params.contents;\r\n        this.router.navigate(['./', params], { relativeTo: this.route, queryParamsHandling: 'preserve' });\r\n    }\r\n\r\n    setLanguage(code: LanguageCode) {\r\n        this.dataService.client.setContentLanguage(code).subscribe();\r\n    }\r\n\r\n    private refresh() {\r\n        this.queryResult.ref.refetch();\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n        <vdr-language-selector\r\n            [disabled]=\"isNew$ | async\"\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"facet-detail\"></vdr-action-bar-items>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            *ngIf=\"isNew$ | async; else updateButton\"\r\n            (click)=\"create()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n        >\r\n            {{ 'common.create' | translate }}\r\n        </button>\r\n        <ng-template #updateButton>\r\n            <button\r\n                *vdrIfPermissions=\"updatePermission\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"detailForm.invalid || detailForm.pristine\"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </ng-template>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<form class=\"form\" [formGroup]=\"detailForm\" *ngIf=\"entity$ | async as facet\">\r\n    <section class=\"form-block\" formGroupName=\"facet\">\r\n        <vdr-form-field [label]=\"'catalog.visibility' | translate\" for=\"visibility\">\r\n            <clr-toggle-wrapper>\r\n                <input\r\n                    type=\"checkbox\"\r\n                    clrToggle\r\n                    [vdrDisabled]=\"!(updatePermission | hasPermission)\"\r\n                    formControlName=\"visible\"\r\n                    id=\"visibility\"\r\n                />\r\n                <label class=\"visible-toggle\">\r\n                    <ng-container *ngIf=\"detailForm.value.facet.visible; else private\">{{ 'catalog.public' | translate }}</ng-container>\r\n                    <ng-template #private>{{ 'catalog.private' | translate }}</ng-template>\r\n                </label>\r\n            </clr-toggle-wrapper>\r\n        </vdr-form-field>\r\n        <vdr-form-field [label]=\"'common.name' | translate\" for=\"name\">\r\n            <input\r\n                id=\"name\"\r\n                type=\"text\"\r\n                formControlName=\"name\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                (input)=\"updateCode(facet.code, $event.target.value)\"\r\n            />\r\n        </vdr-form-field>\r\n        <vdr-form-field\r\n            [label]=\"'common.code' | translate\"\r\n            for=\"code\"\r\n            [readOnlyToggle]=\"updatePermission | hasPermission\"\r\n        >\r\n            <input\r\n                id=\"code\"\r\n                type=\"text\"\r\n                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                formControlName=\"code\"\r\n            />\r\n        </vdr-form-field>\r\n\r\n        <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n            <label>{{ 'common.custom-fields' | translate }}</label>\r\n            <ng-container *ngFor=\"let customField of customFields\">\r\n                <vdr-custom-field-control\r\n                    *ngIf=\"customFieldIsSet(customField.name)\"\r\n                    entityName=\"Facet\"\r\n                    [customFieldsFormGroup]=\"detailForm.get(['facet', 'customFields'])\"\r\n                    [customField]=\"customField\"\r\n                ></vdr-custom-field-control>\r\n            </ng-container>\r\n        </section>\r\n    </section>\r\n\r\n    <section class=\"form-block\" *ngIf=\"!(isNew$ | async)\">\r\n        <label>{{ 'catalog.facet-values' | translate }}</label>\r\n\r\n        <table class=\"facet-values-list table\" formArrayName=\"values\" *ngIf=\"0 < getValuesFormArray().length\">\r\n            <thead>\r\n                <tr>\r\n                    <th></th>\r\n                    <th>{{ 'common.name' | translate }}</th>\r\n                    <th>{{ 'common.code' | translate }}</th>\r\n                    <ng-container *ngFor=\"let customField of customValueFields\">\r\n                        <th>{{ customField.name }}</th>\r\n                    </ng-container>\r\n                    <th></th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                <tr\r\n                    class=\"facet-value\"\r\n                    *ngFor=\"let value of values; let i = index\"\r\n                    [formGroupName]=\"i\"\r\n                >\r\n                    <td class=\"align-middle\">\r\n                        <vdr-entity-info [entity]=\"value\"></vdr-entity-info>\r\n                    </td>\r\n                    <td class=\"align-middle\">\r\n                        <input\r\n                            type=\"text\"\r\n                            formControlName=\"name\"\r\n                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                            (input)=\"updateValueCode(facet.values[i]?.code, $event.target.value, i)\"\r\n                        />\r\n                    </td>\r\n                    <td class=\"align-middle\"><input type=\"text\" formControlName=\"code\" readonly /></td>\r\n                    <ng-container *ngFor=\"let customField of customValueFields\">\r\n                        <td class=\"align-middle\">\r\n                            <vdr-custom-field-control\r\n                                *ngIf=\"customValueFieldIsSet(i, customField.name)\"\r\n                                entityName=\"FacetValue\"\r\n                                [showLabel]=\"false\"\r\n                                [customFieldsFormGroup]=\"detailForm.get(['values', i, 'customFields'])\"\r\n                                [customField]=\"customField\"\r\n                            ></vdr-custom-field-control>\r\n                        </td>\r\n                    </ng-container>\r\n                    <td class=\"align-middle\">\r\n                        <vdr-dropdown>\r\n                            <button type=\"button\" class=\"btn btn-link btn-sm\" vdrDropdownTrigger>\r\n                                {{ 'common.actions' | translate }}\r\n                                <clr-icon shape=\"caret down\"></clr-icon>\r\n                            </button>\r\n                            <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    class=\"delete-button\"\r\n                                    (click)=\"deleteFacetValue(facet.values[i]?.id, i)\"\r\n                                    [disabled]=\"!(updatePermission | hasPermission)\"\r\n                                    vdrDropdownItem\r\n                                >\r\n                                    <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                                    {{ 'common.delete' | translate }}\r\n                                </button>\r\n                            </vdr-dropdown-menu>\r\n                        </vdr-dropdown>\r\n                    </td>\r\n                </tr>\r\n            </tbody>\r\n        </table>\r\n\r\n        <div>\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn btn-secondary\"\r\n                *vdrIfPermissions=\"['CreateCatalog', 'CreateFacet']\"\r\n                (click)=\"addFacetValue()\"\r\n            >\r\n                <clr-icon shape=\"add\"></clr-icon>\r\n                {{ 'catalog.add-facet-value' | translate }}\r\n            </button>\r\n        </div>\r\n    </section>\r\n</form>\r\n","import { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormArray, FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    BaseDetailComponent,\r\n    CreateFacetInput,\r\n    CreateFacetValueInput,\r\n    createUpdatedTranslatable,\r\n    CustomFieldConfig,\r\n    DataService,\r\n    DeletionResult,\r\n    FacetWithValues,\r\n    findTranslation,\r\n    LanguageCode,\r\n    ModalService,\r\n    NotificationService,\r\n    Permission,\r\n    ServerConfigService,\r\n    UpdateFacetInput,\r\n    UpdateFacetValueInput,\r\n} from '@vendure/admin-ui/core';\r\nimport { normalizeString } from '@vendure/common/lib/normalize-string';\r\nimport { notNullOrUndefined } from '@vendure/common/lib/shared-utils';\r\nimport { combineLatest, EMPTY, forkJoin, Observable } from 'rxjs';\r\nimport { map, mapTo, mergeMap, switchMap, take } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'vdr-facet-detail',\r\n    templateUrl: './facet-detail.component.html',\r\n    styleUrls: ['./facet-detail.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class FacetDetailComponent\r\n    extends BaseDetailComponent<FacetWithValues.Fragment>\r\n    implements OnInit, OnDestroy {\r\n    customFields: CustomFieldConfig[];\r\n    customValueFields: CustomFieldConfig[];\r\n    detailForm: FormGroup;\r\n    values: Array<FacetWithValues.Values | { name: string; code: string }>;\r\n    readonly updatePermission = [Permission.UpdateCatalog, Permission.UpdateFacet];\r\n\r\n    constructor(\r\n        router: Router,\r\n        route: ActivatedRoute,\r\n        serverConfigService: ServerConfigService,\r\n        private changeDetector: ChangeDetectorRef,\r\n        protected dataService: DataService,\r\n        private formBuilder: FormBuilder,\r\n        private notificationService: NotificationService,\r\n        private modalService: ModalService,\r\n    ) {\r\n        super(route, router, serverConfigService, dataService);\r\n        this.customFields = this.getCustomFieldConfig('Facet');\r\n        this.customValueFields = this.getCustomFieldConfig('FacetValue');\r\n        this.detailForm = this.formBuilder.group({\r\n            facet: this.formBuilder.group({\r\n                code: ['', Validators.required],\r\n                name: '',\r\n                visible: true,\r\n                customFields: this.formBuilder.group(\r\n                    this.customFields.reduce((hash, field) => ({ ...hash, [field.name]: '' }), {}),\r\n                ),\r\n            }),\r\n            values: this.formBuilder.array([]),\r\n        });\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.init();\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy();\r\n    }\r\n\r\n    updateCode(currentCode: string, nameValue: string) {\r\n        if (!currentCode) {\r\n            const codeControl = this.detailForm.get(['facet', 'code']);\r\n            if (codeControl && codeControl.pristine) {\r\n                codeControl.setValue(normalizeString(nameValue, '-'));\r\n            }\r\n        }\r\n    }\r\n\r\n    updateValueCode(currentCode: string, nameValue: string, index: number) {\r\n        if (!currentCode) {\r\n            const codeControl = this.detailForm.get(['values', index, 'code']);\r\n            if (codeControl && codeControl.pristine) {\r\n                codeControl.setValue(normalizeString(nameValue, '-'));\r\n            }\r\n        }\r\n    }\r\n\r\n    customFieldIsSet(name: string): boolean {\r\n        return !!this.detailForm.get(['facet', 'customFields', name]);\r\n    }\r\n\r\n    customValueFieldIsSet(index: number, name: string): boolean {\r\n        return !!this.detailForm.get(['values', index, 'customFields', name]);\r\n    }\r\n\r\n    getValuesFormArray(): FormArray {\r\n        return this.detailForm.get('values') as FormArray;\r\n    }\r\n\r\n    addFacetValue() {\r\n        const valuesFormArray = this.detailForm.get('values') as FormArray | null;\r\n        if (valuesFormArray) {\r\n            valuesFormArray.insert(\r\n                valuesFormArray.length,\r\n                this.formBuilder.group({\r\n                    id: '',\r\n                    name: ['', Validators.required],\r\n                    code: '',\r\n                }),\r\n            );\r\n            this.values.push({ name: '', code: '' });\r\n        }\r\n    }\r\n\r\n    create() {\r\n        const facetForm = this.detailForm.get('facet');\r\n        if (!facetForm || !facetForm.dirty) {\r\n            return;\r\n        }\r\n        combineLatest(this.entity$, this.languageCode$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([facet, languageCode]) => {\r\n                    const newFacet = this.getUpdatedFacet(\r\n                        facet,\r\n                        facetForm as FormGroup,\r\n                        languageCode,\r\n                    ) as CreateFacetInput;\r\n                    return this.dataService.facet.createFacet(newFacet);\r\n                }),\r\n                switchMap(data => this.dataService.facet.getAllFacets().single$.pipe(mapTo(data))),\r\n            )\r\n            .subscribe(\r\n                data => {\r\n                    this.notificationService.success(_('common.notify-create-success'), { entity: 'Facet' });\r\n                    this.detailForm.markAsPristine();\r\n                    this.changeDetector.markForCheck();\r\n                    this.router.navigate(['../', data.createFacet.id], { relativeTo: this.route });\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-create-error'), {\r\n                        entity: 'Facet',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    save() {\r\n        combineLatest(this.entity$, this.languageCode$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([facet, languageCode]) => {\r\n                    const facetGroup = this.detailForm.get('facet');\r\n                    const updateOperations: Array<Observable<any>> = [];\r\n\r\n                    if (facetGroup && facetGroup.dirty) {\r\n                        const newFacet = this.getUpdatedFacet(\r\n                            facet,\r\n                            facetGroup as FormGroup,\r\n                            languageCode,\r\n                        ) as UpdateFacetInput;\r\n                        if (newFacet) {\r\n                            updateOperations.push(this.dataService.facet.updateFacet(newFacet));\r\n                        }\r\n                    }\r\n                    const valuesArray = this.detailForm.get('values');\r\n                    if (valuesArray && valuesArray.dirty) {\r\n                        const newValues: CreateFacetValueInput[] = (valuesArray as FormArray).controls\r\n                            .filter(c => !c.value.id)\r\n                            .map(c => ({\r\n                                facetId: facet.id,\r\n                                code: c.value.code,\r\n                                translations: [{ name: c.value.name, languageCode }],\r\n                            }));\r\n                        if (newValues.length) {\r\n                            updateOperations.push(\r\n                                this.dataService.facet\r\n                                    .createFacetValues(newValues)\r\n                                    .pipe(switchMap(() => this.dataService.facet.getFacet(this.id).single$)),\r\n                            );\r\n                        }\r\n                        const updatedValues = this.getUpdatedFacetValues(\r\n                            facet,\r\n                            valuesArray as FormArray,\r\n                            languageCode,\r\n                        );\r\n                        if (updatedValues.length) {\r\n                            updateOperations.push(this.dataService.facet.updateFacetValues(updatedValues));\r\n                        }\r\n                    }\r\n\r\n                    return forkJoin(updateOperations);\r\n                }),\r\n                switchMap(() => this.dataService.facet.getAllFacets().single$),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.detailForm.markAsPristine();\r\n                    this.changeDetector.markForCheck();\r\n                    this.notificationService.success(_('common.notify-update-success'), { entity: 'Facet' });\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-update-error'), {\r\n                        entity: 'Facet',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    deleteFacetValue(facetValueId: string | undefined, index: number) {\r\n        if (!facetValueId) {\r\n            // deleting a newly-added (not persisted) FacetValue\r\n            const valuesFormArray = this.detailForm.get('values') as FormArray | null;\r\n            if (valuesFormArray) {\r\n                valuesFormArray.removeAt(index);\r\n            }\r\n            this.values.splice(index, 1);\r\n            return;\r\n        }\r\n        this.showModalAndDelete(facetValueId)\r\n            .pipe(\r\n                switchMap(response => {\r\n                    if (response.result === DeletionResult.DELETED) {\r\n                        return [true];\r\n                    } else {\r\n                        return this.showModalAndDelete(facetValueId, response.message || '').pipe(\r\n                            map(r => r.result === DeletionResult.DELETED),\r\n                        );\r\n                    }\r\n                }),\r\n                switchMap(deleted => (deleted ? this.dataService.facet.getFacet(this.id).single$ : [])),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-delete-success'), {\r\n                        entity: 'FacetValue',\r\n                    });\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-delete-error'), {\r\n                        entity: 'FacetValue',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    private showModalAndDelete(facetValueId: string, message?: string) {\r\n        return this.modalService\r\n            .dialog({\r\n                title: _('catalog.confirm-delete-facet-value'),\r\n                body: message,\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('common.delete'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(result =>\r\n                    result ? this.dataService.facet.deleteFacetValues([facetValueId], !!message) : EMPTY,\r\n                ),\r\n                map(result => result.deleteFacetValues[0]),\r\n            );\r\n    }\r\n\r\n    /**\r\n     * Sets the values of the form on changes to the facet or current language.\r\n     */\r\n    protected setFormValues(facet: FacetWithValues.Fragment, languageCode: LanguageCode) {\r\n        const currentTranslation = findTranslation(facet, languageCode);\r\n\r\n        this.detailForm.patchValue({\r\n            facet: {\r\n                code: facet.code,\r\n                visible: !facet.isPrivate,\r\n                name: currentTranslation?.name ?? '',\r\n            },\r\n        });\r\n\r\n        if (this.customFields.length) {\r\n            const customFieldsGroup = this.detailForm.get(['facet', 'customFields']) as FormGroup;\r\n\r\n            for (const fieldDef of this.customFields) {\r\n                const key = fieldDef.name;\r\n                const value =\r\n                    fieldDef.type === 'localeString'\r\n                        ? (currentTranslation as any).customFields[key]\r\n                        : (facet as any).customFields[key];\r\n                const control = customFieldsGroup.get(key);\r\n                if (control) {\r\n                    control.patchValue(value);\r\n                }\r\n            }\r\n        }\r\n\r\n        const currentValuesFormArray = this.detailForm.get('values') as FormArray;\r\n        this.values = [...facet.values];\r\n        facet.values.forEach((value, i) => {\r\n            const valueTranslation = findTranslation(value, languageCode);\r\n            const group = {\r\n                id: value.id,\r\n                code: value.code,\r\n                name: valueTranslation ? valueTranslation.name : '',\r\n            };\r\n            const valueControl = currentValuesFormArray.at(i);\r\n            if (valueControl) {\r\n                valueControl.setValue(group);\r\n            } else {\r\n                currentValuesFormArray.insert(i, this.formBuilder.group(group));\r\n            }\r\n            if (this.customValueFields.length) {\r\n                let customValueFieldsGroup = this.detailForm.get(['values', i, 'customFields']) as FormGroup;\r\n                if (!customValueFieldsGroup) {\r\n                    customValueFieldsGroup = new FormGroup({});\r\n                    (this.detailForm.get(['values', i]) as FormGroup).addControl(\r\n                        'customFields',\r\n                        customValueFieldsGroup,\r\n                    );\r\n                }\r\n\r\n                if (customValueFieldsGroup) {\r\n                    for (const fieldDef of this.customValueFields) {\r\n                        const key = fieldDef.name;\r\n                        const fieldValue =\r\n                            fieldDef.type === 'localeString'\r\n                                ? (valueTranslation as any).customFields[key]\r\n                                : (value as any).customFields[key];\r\n                        const control = customValueFieldsGroup.get(key);\r\n                        if (control) {\r\n                            control.setValue(fieldValue);\r\n                        } else {\r\n                            customValueFieldsGroup.addControl(key, new FormControl(fieldValue));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Given a facet and the value of the detailForm, this method creates an updated copy of the facet which\r\n     * can then be persisted to the API.\r\n     */\r\n    private getUpdatedFacet(\r\n        facet: FacetWithValues.Fragment,\r\n        facetFormGroup: FormGroup,\r\n        languageCode: LanguageCode,\r\n    ): CreateFacetInput | UpdateFacetInput {\r\n        const input = createUpdatedTranslatable({\r\n            translatable: facet,\r\n            updatedFields: facetFormGroup.value,\r\n            customFieldConfig: this.customFields,\r\n            languageCode,\r\n            defaultTranslation: {\r\n                languageCode,\r\n                name: facet.name || '',\r\n            },\r\n        });\r\n        input.isPrivate = !facetFormGroup.value.visible;\r\n        return input;\r\n    }\r\n\r\n    /**\r\n     * Given an array of facet values and the values from the detailForm, this method creates an new array\r\n     * which can be persisted to the API.\r\n     */\r\n    private getUpdatedFacetValues(\r\n        facet: FacetWithValues.Fragment,\r\n        valuesFormArray: FormArray,\r\n        languageCode: LanguageCode,\r\n    ): UpdateFacetValueInput[] {\r\n        const dirtyValues = facet.values.filter((v, i) => {\r\n            const formRow = valuesFormArray.get(i.toString());\r\n            return formRow && formRow.dirty && formRow.value.id;\r\n        });\r\n        const dirtyValueValues = valuesFormArray.controls\r\n            .filter(c => c.dirty && c.value.id)\r\n            .map(c => c.value);\r\n\r\n        if (dirtyValues.length !== dirtyValueValues.length) {\r\n            throw new Error(_(`error.facet-value-form-values-do-not-match`));\r\n        }\r\n        return dirtyValues\r\n            .map((value, i) => {\r\n                return createUpdatedTranslatable({\r\n                    translatable: value,\r\n                    updatedFields: dirtyValueValues[i],\r\n                    customFieldConfig: this.customValueFields,\r\n                    languageCode,\r\n                    defaultTranslation: {\r\n                        languageCode,\r\n                        name: '',\r\n                    },\r\n                });\r\n            })\r\n            .filter(notNullOrUndefined);\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <vdr-language-selector\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"contentLanguage$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"facet-list\"></vdr-action-bar-items>\r\n        <a class=\"btn btn-primary\"\r\n           *vdrIfPermissions=\"['CreateCatalog', 'CreateFacet']\"\r\n           [routerLink]=\"['./create']\">\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            {{ 'catalog.create-new-facet' | translate }}\r\n        </a>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-data-table\r\n    [items]=\"items$ | async\"\r\n    [itemsPerPage]=\"itemsPerPage$ | async\"\r\n    [totalItems]=\"totalItems$ | async\"\r\n    [currentPage]=\"currentPage$ | async\"\r\n    (pageChange)=\"setPageNumber($event)\"\r\n    (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n>\r\n    <vdr-dt-column>{{ 'common.code' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'common.name' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column [expand]=\"true\">{{ 'catalog.values' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'catalog.visibility' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <ng-template let-facet=\"item\">\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">{{ facet.code }}</td>\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">{{ facet.name }}</td>\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-facet-value-chip\r\n                *ngFor=\"let value of facet.values | slice: 0:displayLimit[facet.id] || 3\"\r\n                [facetValue]=\"value\"\r\n                [removable]=\"false\"\r\n                [displayFacetName]=\"false\"\r\n            ></vdr-facet-value-chip>\r\n            <button\r\n                class=\"btn btn-sm btn-secondary btn-icon\"\r\n                *ngIf=\"facet.values.length > initialLimit\"\r\n                (click)=\"toggleDisplayLimit(facet)\"\r\n            >\r\n                <ng-container *ngIf=\"(displayLimit[facet.id] || 0) < facet.values.length; else collapse\">\r\n                    <clr-icon shape=\"plus\"></clr-icon>\r\n                    {{ facet.values.length - initialLimit }}\r\n                </ng-container>\r\n                <ng-template #collapse>\r\n                    <clr-icon shape=\"minus\"></clr-icon>\r\n                </ng-template>\r\n            </button>\r\n        </td>\r\n        <td class=\"left align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-chip>\r\n                <ng-container *ngIf=\"!facet.isPrivate; else private\">{{ 'catalog.public' | translate }}</ng-container>\r\n                <ng-template #private>{{ 'catalog.private' | translate }}</ng-template>\r\n            </vdr-chip>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-table-row-action\r\n                iconShape=\"edit\"\r\n                [label]=\"'common.edit' | translate\"\r\n                [linkTo]=\"['./', facet.id]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.private]=\"facet.isPrivate\">\r\n            <vdr-dropdown>\r\n                <button type=\"button\" class=\"btn btn-link btn-sm\" vdrDropdownTrigger>\r\n                    {{ 'common.actions' | translate }}\r\n                    <clr-icon shape=\"caret down\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button\r\n                        type=\"button\"\r\n                        class=\"delete-button\"\r\n                        (click)=\"deleteFacet(facet.id)\"\r\n                        [disabled]=\"!(['DeleteCatalog', 'DeleteFacet'] | hasPermission)\"\r\n                        vdrDropdownItem\r\n                    >\r\n                        <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                        {{ 'common.delete' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport { BaseListComponent, LanguageCode, ServerConfigService } from '@vendure/admin-ui/core';\r\nimport { DeletionResult, GetFacetList } from '@vendure/admin-ui/core';\r\nimport { NotificationService } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\nimport { ModalService } from '@vendure/admin-ui/core';\r\nimport { EMPTY, Observable } from 'rxjs';\r\nimport { map, switchMap, tap } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'vdr-facet-list',\r\n    templateUrl: './facet-list.component.html',\r\n    styleUrls: ['./facet-list.component.scss'],\r\n})\r\nexport class FacetListComponent\r\n    extends BaseListComponent<GetFacetList.Query, GetFacetList.Items>\r\n    implements OnInit {\r\n    availableLanguages$: Observable<LanguageCode[]>;\r\n    contentLanguage$: Observable<LanguageCode>;\r\n    readonly initialLimit = 3;\r\n    displayLimit: { [id: string]: number } = {};\r\n    constructor(\r\n        private dataService: DataService,\r\n        private modalService: ModalService,\r\n        private notificationService: NotificationService,\r\n        private serverConfigService: ServerConfigService,\r\n        router: Router,\r\n        route: ActivatedRoute,\r\n    ) {\r\n        super(router, route);\r\n        super.setQueryFn(\r\n            (...args: any[]) => this.dataService.facet.getFacets(...args).refetchOnChannelChange(),\r\n            data => data.facets,\r\n        );\r\n    }\r\n\r\n    ngOnInit() {\r\n        super.ngOnInit();\r\n        this.availableLanguages$ = this.serverConfigService.getAvailableLanguages();\r\n        this.contentLanguage$ = this.dataService.client\r\n            .uiState()\r\n            .mapStream(({ uiState }) => uiState.contentLanguage)\r\n            .pipe(tap(() => this.refresh()));\r\n    }\r\n\r\n    toggleDisplayLimit(facet: GetFacetList.Items) {\r\n        if (this.displayLimit[facet.id] === facet.values.length) {\r\n            this.displayLimit[facet.id] = this.initialLimit;\r\n        } else {\r\n            this.displayLimit[facet.id] = facet.values.length;\r\n        }\r\n    }\r\n\r\n    deleteFacet(facetValueId: string) {\r\n        this.showModalAndDelete(facetValueId)\r\n            .pipe(\r\n                switchMap(response => {\r\n                    if (response.result === DeletionResult.DELETED) {\r\n                        return [true];\r\n                    } else {\r\n                        return this.showModalAndDelete(facetValueId, response.message || '').pipe(\r\n                            map(r => r.result === DeletionResult.DELETED),\r\n                        );\r\n                    }\r\n                }),\r\n                // Refresh the cached facets to reflect the changes\r\n                switchMap(() => this.dataService.facet.getAllFacets().single$),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-delete-success'), {\r\n                        entity: 'FacetValue',\r\n                    });\r\n                    this.refresh();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-delete-error'), {\r\n                        entity: 'FacetValue',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    setLanguage(code: LanguageCode) {\r\n        this.dataService.client.setContentLanguage(code).subscribe();\r\n    }\r\n\r\n    private showModalAndDelete(facetId: string, message?: string) {\r\n        return this.modalService\r\n            .dialog({\r\n                title: _('catalog.confirm-delete-facet'),\r\n                body: message,\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('common.delete'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(res => (res ? this.dataService.facet.deleteFacet(facetId, !!message) : EMPTY)),\r\n                map(res => res.deleteFacet),\r\n            );\r\n    }\r\n}\r\n","import { OuterSubscriber } from '../OuterSubscriber';\nimport { subscribeToResult } from '../util/subscribeToResult';\nexport function withLatestFrom(...args) {\n    return (source) => {\n        let project;\n        if (typeof args[args.length - 1] === 'function') {\n            project = args.pop();\n        }\n        const observables = args;\n        return source.lift(new WithLatestFromOperator(observables, project));\n    };\n}\nclass WithLatestFromOperator {\n    constructor(observables, project) {\n        this.observables = observables;\n        this.project = project;\n    }\n    call(subscriber, source) {\n        return source.subscribe(new WithLatestFromSubscriber(subscriber, this.observables, this.project));\n    }\n}\nclass WithLatestFromSubscriber extends OuterSubscriber {\n    constructor(destination, observables, project) {\n        super(destination);\n        this.observables = observables;\n        this.project = project;\n        this.toRespond = [];\n        const len = observables.length;\n        this.values = new Array(len);\n        for (let i = 0; i < len; i++) {\n            this.toRespond.push(i);\n        }\n        for (let i = 0; i < len; i++) {\n            let observable = observables[i];\n            this.add(subscribeToResult(this, observable, undefined, i));\n        }\n    }\n    notifyNext(_outerValue, innerValue, outerIndex) {\n        this.values[outerIndex] = innerValue;\n        const toRespond = this.toRespond;\n        if (toRespond.length > 0) {\n            const found = toRespond.indexOf(outerIndex);\n            if (found !== -1) {\n                toRespond.splice(found, 1);\n            }\n        }\n    }\n    notifyComplete() {\n    }\n    _next(value) {\n        if (this.toRespond.length === 0) {\n            const args = [value, ...this.values];\n            if (this.project) {\n                this._tryProject(args);\n            }\n            else {\n                this.destination.next(args);\n            }\n        }\n    }\n    _tryProject(args) {\n        let result;\n        try {\n            result = this.project.apply(this, args);\n        }\n        catch (err) {\n            this.destination.error(err);\n            return;\n        }\n        this.destination.next(result);\n    }\n}\n//# sourceMappingURL=withLatestFrom.js.map","/**\r\n * @description\r\n * Like String.prototype.replace(), but replaces the last instance\r\n * rather than the first.\r\n */\r\nexport function replaceLast(target: string | undefined | null, search: string, replace: string): string {\r\n    if (!target) {\r\n        return '';\r\n    }\r\n    const lastIndex = target.lastIndexOf(search);\r\n    if (lastIndex === -1) {\r\n        return target;\r\n    }\r\n    const head = target.substr(0, lastIndex);\r\n    const tail = target.substr(lastIndex).replace(search, replace);\r\n    return head + tail;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport {\r\n    CreateProductInput,\r\n    CreateProductVariantInput,\r\n    DataService,\r\n    DeletionResult,\r\n    FacetWithValues,\r\n    findTranslation,\r\n    LanguageCode,\r\n    ProductWithVariants,\r\n    UpdateProductInput,\r\n    UpdateProductMutation,\r\n    UpdateProductOptionInput,\r\n    UpdateProductVariantInput,\r\n    UpdateProductVariantsMutation,\r\n} from '@vendure/admin-ui/core';\r\nimport { normalizeString } from '@vendure/common/lib/normalize-string';\r\nimport { notNullOrUndefined } from '@vendure/common/lib/shared-utils';\r\nimport { forkJoin, Observable, of, throwError } from 'rxjs';\r\nimport { map, mergeMap, shareReplay, switchMap } from 'rxjs/operators';\r\n\r\nimport { CreateProductVariantsConfig } from '../../components/generate-product-variants/generate-product-variants.component';\r\n\r\nimport { replaceLast } from './replace-last';\r\n\r\n/**\r\n * Handles the logic for making the API calls to perform CRUD operations on a Product and its related\r\n * entities. This logic was extracted out of the component because it became too large and hard to follow.\r\n */\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class ProductDetailService {\r\n    constructor(private dataService: DataService) {}\r\n\r\n    getFacets(): Observable<FacetWithValues.Fragment[]> {\r\n        return this.dataService.facet.getAllFacets().mapSingle(data => data.facets.items);\r\n    }\r\n\r\n    getTaxCategories() {\r\n        return this.dataService.settings\r\n            .getTaxCategories()\r\n            .mapSingle(data => data.taxCategories)\r\n            .pipe(shareReplay(1));\r\n    }\r\n\r\n    createProductWithVariants(\r\n        input: CreateProductInput,\r\n        createVariantsConfig: CreateProductVariantsConfig,\r\n        languageCode: LanguageCode,\r\n    ) {\r\n        const createProduct$ = this.dataService.product.createProduct(input);\r\n        const nonEmptyOptionGroups = createVariantsConfig.groups.filter(g => 0 < g.values.length);\r\n        const createOptionGroups$ = this.createProductOptionGroups(nonEmptyOptionGroups, languageCode);\r\n\r\n        return forkJoin(createProduct$, createOptionGroups$).pipe(\r\n            mergeMap(([{ createProduct }, optionGroups]) => {\r\n                const addOptionsToProduct$ = optionGroups.length\r\n                    ? forkJoin(\r\n                          optionGroups.map(optionGroup => {\r\n                              return this.dataService.product.addOptionGroupToProduct({\r\n                                  productId: createProduct.id,\r\n                                  optionGroupId: optionGroup.id,\r\n                              });\r\n                          }),\r\n                      )\r\n                    : of([]);\r\n                return addOptionsToProduct$.pipe(\r\n                    map(() => {\r\n                        return { createProduct, optionGroups };\r\n                    }),\r\n                );\r\n            }),\r\n            mergeMap(({ createProduct, optionGroups }) => {\r\n                const variants = createVariantsConfig.variants.map(v => {\r\n                    const optionIds = optionGroups.length\r\n                        ? v.optionValues.map((optionName, index) => {\r\n                              const option = optionGroups[index].options.find(o => o.name === optionName);\r\n                              if (!option) {\r\n                                  throw new Error(\r\n                                      `Could not find a matching ProductOption \"${optionName}\" when creating variant`,\r\n                                  );\r\n                              }\r\n                              return option.id;\r\n                          })\r\n                        : [];\r\n                    return {\r\n                        ...v,\r\n                        optionIds,\r\n                    };\r\n                });\r\n                const options = optionGroups.map(og => og.options).reduce((flat, o) => [...flat, ...o], []);\r\n                return this.createProductVariants(createProduct, variants, options, languageCode);\r\n            }),\r\n        );\r\n    }\r\n\r\n    createProductOptionGroups(groups: Array<{ name: string; values: string[] }>, languageCode: LanguageCode) {\r\n        return groups.length\r\n            ? forkJoin(\r\n                  groups.map(c => {\r\n                      return this.dataService.product\r\n                          .createProductOptionGroups({\r\n                              code: normalizeString(c.name, '-'),\r\n                              translations: [{ languageCode, name: c.name }],\r\n                              options: c.values.map(v => ({\r\n                                  code: normalizeString(v, '-'),\r\n                                  translations: [{ languageCode, name: v }],\r\n                              })),\r\n                          })\r\n                          .pipe(map(data => data.createProductOptionGroup));\r\n                  }),\r\n              )\r\n            : of([]);\r\n    }\r\n\r\n    createProductVariants(\r\n        product: { name: string; id: string },\r\n        variantData: Array<{ price: number; sku: string; stock: number; optionIds: string[] }>,\r\n        options: Array<{ id: string; name: string }>,\r\n        languageCode: LanguageCode,\r\n    ) {\r\n        const variants: CreateProductVariantInput[] = variantData.map(v => {\r\n            const name = options.length\r\n                ? `${product.name} ${v.optionIds\r\n                      .map(id => options.find(o => o.id === id))\r\n                      .filter(notNullOrUndefined)\r\n                      .map(o => o.name)\r\n                      .join(' ')}`\r\n                : product.name;\r\n            return {\r\n                productId: product.id,\r\n                price: v.price,\r\n                sku: v.sku,\r\n                stockOnHand: v.stock,\r\n                translations: [\r\n                    {\r\n                        languageCode,\r\n                        name,\r\n                    },\r\n                ],\r\n                optionIds: v.optionIds,\r\n            };\r\n        });\r\n        return this.dataService.product.createProductVariants(variants).pipe(\r\n            map(({ createProductVariants }) => ({\r\n                createProductVariants,\r\n                productId: product.id,\r\n            })),\r\n        );\r\n    }\r\n\r\n    updateProduct(updateOptions: {\r\n        product: ProductWithVariants.Fragment;\r\n        languageCode: LanguageCode;\r\n        autoUpdate: boolean;\r\n        productInput?: UpdateProductInput;\r\n        variantsInput?: UpdateProductVariantInput[];\r\n    }) {\r\n        const { product, languageCode, autoUpdate, productInput, variantsInput } = updateOptions;\r\n        const updateOperations: Array<Observable<UpdateProductMutation | UpdateProductVariantsMutation>> = [];\r\n        const updateVariantsInput = variantsInput || [];\r\n        if (productInput) {\r\n            updateOperations.push(this.dataService.product.updateProduct(productInput));\r\n\r\n            const productOldName = findTranslation(product, languageCode)?.name;\r\n            const productNewName = findTranslation(productInput, languageCode)?.name;\r\n            if (productOldName && productNewName && productOldName !== productNewName && autoUpdate) {\r\n                for (const variant of product.variants) {\r\n                    const currentVariantName = findTranslation(variant, languageCode)?.name || '';\r\n                    let variantInput: UpdateProductVariantInput;\r\n                    const existingVariantInput = updateVariantsInput.find(i => i.id === variant.id);\r\n                    if (existingVariantInput) {\r\n                        variantInput = existingVariantInput;\r\n                    } else {\r\n                        variantInput = {\r\n                            id: variant.id,\r\n                            translations: [{ languageCode, name: currentVariantName }],\r\n                        };\r\n                        updateVariantsInput.push(variantInput);\r\n                    }\r\n                    const variantTranslation = findTranslation(variantInput, languageCode);\r\n                    if (variantTranslation) {\r\n                        variantTranslation.name = replaceLast(\r\n                            variantTranslation.name,\r\n                            productOldName,\r\n                            productNewName,\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (updateVariantsInput.length) {\r\n            updateOperations.push(this.dataService.product.updateProductVariants(updateVariantsInput));\r\n        }\r\n        return forkJoin(updateOperations);\r\n    }\r\n\r\n    updateProductOption(\r\n        input: UpdateProductOptionInput & { autoUpdate: boolean },\r\n        product: ProductWithVariants.Fragment,\r\n        languageCode: LanguageCode,\r\n    ) {\r\n        let updateProductVariantNames$: Observable<any> = of([]);\r\n        if (input.autoUpdate) {\r\n            // Update any ProductVariants' names which include the option name\r\n            let oldOptionName: string | undefined;\r\n            const newOptionName = findTranslation(input, languageCode)?.name;\r\n            if (!newOptionName) {\r\n                updateProductVariantNames$ = of([]);\r\n            }\r\n            const variantsToUpdate: UpdateProductVariantInput[] = [];\r\n            for (const variant of product.variants) {\r\n                if (variant.options.map(o => o.id).includes(input.id)) {\r\n                    if (!oldOptionName) {\r\n                        oldOptionName = findTranslation(\r\n                            variant.options.find(o => o.id === input.id),\r\n                            languageCode,\r\n                        )?.name;\r\n                    }\r\n                    const variantName = findTranslation(variant, languageCode)?.name || '';\r\n                    if (oldOptionName && newOptionName && variantName.includes(oldOptionName)) {\r\n                        variantsToUpdate.push({\r\n                            id: variant.id,\r\n                            translations: [\r\n                                {\r\n                                    languageCode,\r\n                                    name: replaceLast(variantName, oldOptionName, newOptionName),\r\n                                },\r\n                            ],\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            if (variantsToUpdate.length) {\r\n                updateProductVariantNames$ = this.dataService.product.updateProductVariants(variantsToUpdate);\r\n            }\r\n        }\r\n        return this.dataService.product\r\n            .updateProductOption(input)\r\n            .pipe(mergeMap(() => updateProductVariantNames$));\r\n    }\r\n\r\n    deleteProductVariant(id: string, productId: string) {\r\n        return this.dataService.product.deleteProductVariant(id).pipe(\r\n            switchMap(result => {\r\n                if (result.deleteProductVariant.result === DeletionResult.DELETED) {\r\n                    return this.dataService.product.getProduct(productId).single$;\r\n                } else {\r\n                    return throwError(result.deleteProductVariant.message);\r\n                }\r\n            }),\r\n        );\r\n    }\r\n}\r\n","<ng-template vdrDialogTitle>{{ 'catalog.add-facets' | translate }}</ng-template>\r\n\r\n<vdr-facet-value-selector\r\n    [facets]=\"facets\"\r\n    (selectedValuesChange)=\"selectedValues = $event\"\r\n></vdr-facet-value-selector>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button\r\n        type=\"submit\"\r\n        (click)=\"selectValues()\"\r\n        [disabled]=\"selectedValues.length === 0\"\r\n        class=\"btn btn-primary\"\r\n    >\r\n        {{ 'catalog.add-facets' | translate }}\r\n    </button>\r\n</ng-template>\r\n","import {\r\n    AfterViewInit,\r\n    ChangeDetectionStrategy,\r\n    ChangeDetectorRef,\r\n    Component,\r\n    ViewChild,\r\n} from '@angular/core';\r\nimport { Dialog, FacetValue, FacetValueSelectorComponent, FacetWithValues } from '@vendure/admin-ui/core';\r\n\r\n@Component({\r\n    selector: 'vdr-apply-facet-dialog',\r\n    templateUrl: './apply-facet-dialog.component.html',\r\n    styleUrls: ['./apply-facet-dialog.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ApplyFacetDialogComponent implements Dialog<FacetValue[]>, AfterViewInit {\r\n    @ViewChild(FacetValueSelectorComponent) private selector: FacetValueSelectorComponent;\r\n    resolveWith: (result?: FacetValue[]) => void;\r\n    selectedValues: FacetValue[] = [];\r\n    // Provided by caller\r\n    facets: FacetWithValues.Fragment[];\r\n\r\n    constructor(private changeDetector: ChangeDetectorRef) {}\r\n\r\n    ngAfterViewInit() {\r\n        setTimeout(() => this.selector.focus(), 0);\r\n    }\r\n\r\n    selectValues() {\r\n        this.resolveWith(this.selectedValues);\r\n    }\r\n\r\n    cancel() {\r\n        this.resolveWith();\r\n    }\r\n}\r\n","<ng-template vdrDialogTitle>\r\n    <ng-container *ngIf=\"isProductVariantMode; else productModeTitle\">{{\r\n        'catalog.assign-variants-to-channel' | translate\r\n    }}</ng-container>\r\n    <ng-template #productModeTitle>{{ 'catalog.assign-products-to-channel' | translate }}</ng-template>\r\n</ng-template>\r\n\r\n<div class=\"flex\">\r\n    <clr-input-container>\r\n        <label>{{ 'common.channel' | translate }}</label>\r\n        <vdr-channel-assignment-control\r\n            clrInput\r\n            [multiple]=\"false\"\r\n            [includeDefaultChannel]=\"false\"\r\n            [disableChannelIds]=\"currentChannelIds\"\r\n            [formControl]=\"selectedChannelIdControl\"\r\n        ></vdr-channel-assignment-control>\r\n    </clr-input-container>\r\n    <div class=\"flex-spacer\"></div>\r\n    <clr-input-container>\r\n        <label>{{ 'catalog.price-conversion-factor' | translate }}</label>\r\n        <input clrInput type=\"number\" min=\"0\" max=\"99999\" [formControl]=\"priceFactorControl\" />\r\n    </clr-input-container>\r\n</div>\r\n\r\n<div class=\"channel-price-preview\">\r\n    <label class=\"clr-control-label\">{{ 'catalog.channel-price-preview' | translate }}</label>\r\n    <table class=\"table\">\r\n        <thead>\r\n            <tr>\r\n                <th>{{ 'common.name' | translate }}</th>\r\n                <th>\r\n                    {{\r\n                        'catalog.price-in-channel'\r\n                            | translate: { channel: currentChannel?.code | channelCodeToLabel | translate }\r\n                    }}\r\n                </th>\r\n                <th>\r\n                    <ng-template [ngIf]=\"selectedChannel\" [ngIfElse]=\"noSelection\">\r\n                        {{ 'catalog.price-in-channel' | translate: { channel: selectedChannel?.code } }}\r\n                    </ng-template>\r\n                    <ng-template #noSelection>\r\n                        {{ 'catalog.no-channel-selected' | translate }}\r\n                    </ng-template>\r\n                </th>\r\n            </tr>\r\n        </thead>\r\n        <tbody>\r\n            <tr *ngFor=\"let row of variantsPreview$ | async\">\r\n                <td>{{ row.name }}</td>\r\n                <td>{{ row.price | localeCurrency: currentChannel?.currencyCode }}</td>\r\n                <td>\r\n                    <ng-template [ngIf]=\"selectedChannel\" [ngIfElse]=\"noChannelSelected\">\r\n                        {{ row.pricePreview | localeCurrency: selectedChannel?.currencyCode }}\r\n                    </ng-template>\r\n                    <ng-template #noChannelSelected> - </ng-template>\r\n                </td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n</div>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button type=\"submit\" (click)=\"assign()\" [disabled]=\"!selectedChannel\" class=\"btn btn-primary\">\r\n        <ng-template [ngIf]=\"selectedChannel\" [ngIfElse]=\"noSelection\">\r\n            {{ 'catalog.assign-to-named-channel' | translate: { channelCode: selectedChannel?.code } }}\r\n        </ng-template>\r\n        <ng-template #noSelection>\r\n            {{ 'catalog.no-channel-selected' | translate }}\r\n        </ng-template>\r\n    </button>\r\n</ng-template>\r\n","import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';\r\nimport { FormControl } from '@angular/forms';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport { GetChannels, ProductVariantFragment } from '@vendure/admin-ui/core';\r\nimport { NotificationService } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\nimport { Dialog } from '@vendure/admin-ui/core';\r\nimport { combineLatest, from, Observable } from 'rxjs';\r\nimport { map, startWith, switchMap } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'vdr-assign-products-to-channel-dialog',\r\n    templateUrl: './assign-products-to-channel-dialog.component.html',\r\n    styleUrls: ['./assign-products-to-channel-dialog.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class AssignProductsToChannelDialogComponent implements OnInit, Dialog<any> {\r\n    selectedChannel: GetChannels.Channels | null | undefined;\r\n    currentChannel: GetChannels.Channels;\r\n    availableChannels: GetChannels.Channels[];\r\n    resolveWith: (result?: any) => void;\r\n    variantsPreview$: Observable<Array<{ id: string; name: string; price: number; pricePreview: number }>>;\r\n    priceFactorControl = new FormControl(1);\r\n    selectedChannelIdControl = new FormControl();\r\n\r\n    // assigned by ModalService.fromComponent() call\r\n    productIds: string[];\r\n    productVariantIds: string[] | undefined;\r\n    currentChannelIds: string[];\r\n\r\n    get isProductVariantMode(): boolean {\r\n        return this.productVariantIds != null;\r\n    }\r\n\r\n    constructor(private dataService: DataService, private notificationService: NotificationService) {}\r\n\r\n    ngOnInit() {\r\n        const activeChannelId$ = this.dataService.client\r\n            .userStatus()\r\n            .mapSingle(({ userStatus }) => userStatus.activeChannelId);\r\n        const allChannels$ = this.dataService.settings.getChannels().mapSingle(data => data.channels);\r\n\r\n        combineLatest(activeChannelId$, allChannels$).subscribe(([activeChannelId, channels]) => {\r\n            // tslint:disable-next-line:no-non-null-assertion\r\n            this.currentChannel = channels.find(c => c.id === activeChannelId)!;\r\n            this.availableChannels = channels;\r\n        });\r\n\r\n        this.selectedChannelIdControl.valueChanges.subscribe(ids => {\r\n            this.selectChannel(ids);\r\n        });\r\n\r\n        this.variantsPreview$ = combineLatest(\r\n            from(this.getTopVariants(10)),\r\n            this.priceFactorControl.valueChanges.pipe(startWith(1)),\r\n        ).pipe(\r\n            map(([variants, factor]) => {\r\n                return variants.map(v => ({\r\n                    id: v.id,\r\n                    name: v.name,\r\n                    price: v.price,\r\n                    pricePreview: v.price * +factor,\r\n                }));\r\n            }),\r\n        );\r\n    }\r\n\r\n    selectChannel(channelIds: string[]) {\r\n        this.selectedChannel = this.availableChannels.find(c => c.id === channelIds[0]);\r\n    }\r\n\r\n    assign() {\r\n        const selectedChannel = this.selectedChannel;\r\n        if (selectedChannel) {\r\n            if (!this.isProductVariantMode) {\r\n                this.dataService.product\r\n                    .assignProductsToChannel({\r\n                        channelId: selectedChannel.id,\r\n                        productIds: this.productIds,\r\n                        priceFactor: +this.priceFactorControl.value,\r\n                    })\r\n                    .subscribe(() => {\r\n                        this.notificationService.success(_('catalog.assign-product-to-channel-success'), {\r\n                            channel: selectedChannel.code,\r\n                        });\r\n                        this.resolveWith(true);\r\n                    });\r\n            } else if (this.productVariantIds) {\r\n                this.dataService.product\r\n                    .assignVariantsToChannel({\r\n                        channelId: selectedChannel.id,\r\n                        productVariantIds: this.productVariantIds,\r\n                        priceFactor: +this.priceFactorControl.value,\r\n                    })\r\n                    .subscribe(() => {\r\n                        this.notificationService.success(_('catalog.assign-variant-to-channel-success'), {\r\n                            channel: selectedChannel.code,\r\n                        });\r\n                        this.resolveWith(true);\r\n                    });\r\n            }\r\n        }\r\n    }\r\n\r\n    cancel() {\r\n        this.resolveWith();\r\n    }\r\n\r\n    private async getTopVariants(take: number): Promise<ProductVariantFragment[]> {\r\n        const variants: ProductVariantFragment[] = [];\r\n\r\n        for (let i = 0; i < this.productIds.length && variants.length < take; i++) {\r\n            const productVariants = await this.dataService.product\r\n                .getProduct(this.productIds[i])\r\n                .mapSingle(({ product }) => {\r\n                    const _variants = product ? product.variants : [];\r\n                    return _variants.filter(v =>\r\n                        this.isProductVariantMode ? this.productVariantIds?.includes(v.id) : true,\r\n                    );\r\n                })\r\n                .toPromise();\r\n            variants.push(...(productVariants || []));\r\n        }\r\n        return variants.slice(0, take);\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left>\r\n        <div class=\"flex clr-flex-row\">\r\n            <vdr-entity-info [entity]=\"entity$ | async\"></vdr-entity-info>\r\n            <clr-toggle-wrapper *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\">\r\n                <input\r\n                    type=\"checkbox\"\r\n                    clrToggle\r\n                    name=\"enabled\"\r\n                    [formControl]=\"detailForm.get(['product', 'enabled'])\"\r\n                />\r\n                <label>{{ 'common.enabled' | translate }}</label>\r\n            </clr-toggle-wrapper>\r\n        </div>\r\n        <vdr-language-selector\r\n            [disabled]=\"isNew$ | async\"\r\n            [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n            [currentLanguageCode]=\"languageCode$ | async\"\r\n            (languageCodeChange)=\"setLanguage($event)\"\r\n        ></vdr-language-selector>\r\n    </vdr-ab-left>\r\n\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"product-detail\"></vdr-action-bar-items>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            *ngIf=\"isNew$ | async; else updateButton\"\r\n            (click)=\"create()\"\r\n            [disabled]=\"detailForm.invalid || detailForm.pristine || !variantsToCreateAreValid()\"\r\n        >\r\n            {{ 'common.create' | translate }}\r\n        </button>\r\n        <ng-template #updateButton>\r\n            <button\r\n                *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\"\r\n                class=\"btn btn-primary\"\r\n                (click)=\"save()\"\r\n                [disabled]=\"\r\n                    (detailForm.invalid || detailForm.pristine) && !assetsChanged() && !variantAssetsChanged()\r\n                \"\r\n            >\r\n                {{ 'common.update' | translate }}\r\n            </button>\r\n        </ng-template>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<form\r\n    class=\"form\"\r\n    [formGroup]=\"detailForm\"\r\n    *ngIf=\"product$ | async as product\"\r\n>\r\n    <button type=\"submit\" hidden x-data=\"prevents enter key from triggering other buttons\"></button>\r\n    <clr-tabs>\r\n        <clr-tab>\r\n            <button clrTabLink (click)=\"navigateToTab('details')\">\r\n                {{ 'catalog.product-details' | translate }}\r\n            </button>\r\n            <clr-tab-content *clrIfActive=\"(activeTab$ | async) === 'details'\">\r\n                <div class=\"clr-row\">\r\n                    <div class=\"clr-col\">\r\n                        <section class=\"form-block\" formGroupName=\"product\">\r\n                            <ng-container *vdrIfMultichannel>\r\n                                <vdr-form-item\r\n                                    [label]=\"'common.channels' | translate\"\r\n                                    *vdrIfDefaultChannelActive\r\n                                >\r\n                                    <div class=\"flex channel-assignment\">\r\n                                        <ng-container *ngFor=\"let channel of productChannels$ | async\">\r\n                                            <vdr-chip\r\n                                                *ngIf=\"!isDefaultChannel(channel.code)\"\r\n                                                icon=\"times-circle\"\r\n                                                (iconClick)=\"removeFromChannel(channel.id)\"\r\n                                            >\r\n                                                <vdr-channel-badge\r\n                                                    [channelCode]=\"channel.code\"\r\n                                                ></vdr-channel-badge>\r\n                                                {{ channel.code | channelCodeToLabel }}\r\n                                            </vdr-chip>\r\n                                        </ng-container>\r\n                                        <button class=\"btn btn-sm\" (click)=\"assignToChannel()\">\r\n                                            <clr-icon shape=\"layers\"></clr-icon>\r\n                                            {{ 'catalog.assign-to-channel' | translate }}\r\n                                        </button>\r\n                                    </div>\r\n                                </vdr-form-item>\r\n                            </ng-container>\r\n                            <vdr-form-field [label]=\"'catalog.product-name' | translate\" for=\"name\">\r\n                                <input\r\n                                    id=\"name\"\r\n                                    type=\"text\"\r\n                                    formControlName=\"name\"\r\n                                    [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                    (input)=\"updateSlug($event.target.value)\"\r\n                                />\r\n                            </vdr-form-field>\r\n                            <div\r\n                                class=\"auto-rename-wrapper\"\r\n                                [class.visible]=\"\r\n                                    (isNew$ | async) === false && detailForm.get(['product', 'name'])?.dirty\r\n                                \"\r\n                            >\r\n                                <clr-checkbox-wrapper>\r\n                                    <input\r\n                                        clrCheckbox\r\n                                        type=\"checkbox\"\r\n                                        id=\"auto-update\"\r\n                                        formControlName=\"autoUpdateVariantNames\"\r\n                                    />\r\n                                    <label>{{\r\n                                        'catalog.auto-update-product-variant-name' | translate\r\n                                    }}</label>\r\n                                </clr-checkbox-wrapper>\r\n                            </div>\r\n                            <vdr-form-field\r\n                                [label]=\"'catalog.slug' | translate\"\r\n                                for=\"slug\"\r\n                                [errors]=\"{ pattern: 'catalog.slug-pattern-error' | translate }\"\r\n                            >\r\n                                <input\r\n                                    id=\"slug\"\r\n                                    type=\"text\"\r\n                                    formControlName=\"slug\"\r\n                                    [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                    pattern=\"[a-z0-9_-]+\"\r\n                                />\r\n                            </vdr-form-field>\r\n                            <vdr-rich-text-editor\r\n                                formControlName=\"description\"\r\n                                [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                [label]=\"'common.description' | translate\"\r\n                            ></vdr-rich-text-editor>\r\n\r\n                            <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n                                <label>{{ 'common.custom-fields' | translate }}</label>\r\n                                <ng-container *ngFor=\"let customField of customFields\">\r\n                                    <vdr-custom-field-control\r\n                                        *ngIf=\"customFieldIsSet(customField.name)\"\r\n                                        entityName=\"Product\"\r\n                                        [customFieldsFormGroup]=\"detailForm.get(['product', 'customFields'])\"\r\n                                        [customField]=\"customField\"\r\n                                        [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                                    ></vdr-custom-field-control>\r\n                                </ng-container>\r\n                            </section>\r\n\r\n                            <div class=\"facets\">\r\n                                <vdr-facet-value-chip\r\n                                    *ngFor=\"let facetValue of facetValues$ | async\"\r\n                                    [facetValue]=\"facetValue\"\r\n                                    [removable]=\"['UpdateCatalog', 'UpdateProduct'] | hasPermission\"\r\n                                    (remove)=\"removeProductFacetValue(facetValue.id)\"\r\n                                ></vdr-facet-value-chip>\r\n                                <button\r\n                                    class=\"btn btn-sm btn-secondary\"\r\n                                    *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\"\r\n                                    (click)=\"selectProductFacetValue()\"\r\n                                >\r\n                                    <clr-icon shape=\"plus\"></clr-icon>\r\n                                    {{ 'catalog.add-facets' | translate }}\r\n                                </button>\r\n                            </div>\r\n                        </section>\r\n                    </div>\r\n                    <div class=\"clr-col-md-auto\">\r\n                        <vdr-product-assets\r\n                            [assets]=\"assetChanges.assets || product.assets\"\r\n                            [featuredAsset]=\"assetChanges.featuredAsset || product.featuredAsset\"\r\n                            (change)=\"assetChanges = $event\"\r\n                        ></vdr-product-assets>\r\n                    </div>\r\n                </div>\r\n\r\n                <div *ngIf=\"isNew$ | async\">\r\n                    <h4>{{ 'catalog.product-variants' | translate }}</h4>\r\n                    <vdr-generate-product-variants\r\n                        (variantsChange)=\"createVariantsConfig = $event\"\r\n                    ></vdr-generate-product-variants>\r\n                </div>\r\n            </clr-tab-content>\r\n        </clr-tab>\r\n        <clr-tab *ngIf=\"!(isNew$ | async)\">\r\n            <button clrTabLink (click)=\"navigateToTab('variants')\">\r\n                {{ 'catalog.product-variants' | translate }}\r\n            </button>\r\n            <clr-tab-content *clrIfActive=\"(activeTab$ | async) === 'variants'\">\r\n                <section class=\"form-block\">\r\n                    <div class=\"view-mode\">\r\n                        <div class=\"btn-group\">\r\n                            <button\r\n                                class=\"btn btn-secondary-outline\"\r\n                                (click)=\"variantDisplayMode = 'card'\"\r\n                                [class.btn-primary]=\"variantDisplayMode === 'card'\"\r\n                            >\r\n                                <clr-icon shape=\"list\"></clr-icon>\r\n                                {{ 'catalog.display-variant-cards' | translate }}\r\n                            </button>\r\n                            <button\r\n                                class=\"btn\"\r\n                                (click)=\"variantDisplayMode = 'table'\"\r\n                                [class.btn-primary]=\"variantDisplayMode === 'table'\"\r\n                            >\r\n                                <clr-icon shape=\"table\"></clr-icon>\r\n                                {{ 'catalog.display-variant-table' | translate }}\r\n                            </button>\r\n                        </div>\r\n                        <div class=\"variant-filter\">\r\n                            <input\r\n                                [formControl]=\"filterInput\"\r\n                                [placeholder]=\"'catalog.filter-by-name-or-sku' | translate\"\r\n                            />\r\n                            <button class=\"icon-button\" (click)=\"filterInput.setValue('')\">\r\n                                <clr-icon shape=\"times\"></clr-icon>\r\n                            </button>\r\n                        </div>\r\n                        <div class=\"flex-spacer\"></div>\r\n                        <a\r\n                            *vdrIfPermissions=\"['UpdateCatalog', 'UpdateProduct']\"\r\n                            [routerLink]=\"['./', 'manage-variants']\"\r\n                            class=\"btn btn-secondary edit-variants-btn\"\r\n                        >\r\n                            <clr-icon shape=\"add-text\"></clr-icon>\r\n                            {{ 'catalog.manage-variants' | translate }}\r\n                        </a>\r\n                    </div>\r\n\r\n                    <vdr-product-variants-table\r\n                        *ngIf=\"variantDisplayMode === 'table'\"\r\n                        [variants]=\"variants$ | async\"\r\n                        [optionGroups]=\"product.optionGroups\"\r\n                        [channelPriceIncludesTax]=\"channelPriceIncludesTax$ | async\"\r\n                        [productVariantsFormArray]=\"detailForm.get('variants')\"\r\n                        [pendingAssetChanges]=\"variantAssetChanges\"\r\n                    ></vdr-product-variants-table>\r\n                    <vdr-product-variants-list\r\n                        *ngIf=\"variantDisplayMode === 'card'\"\r\n                        [variants]=\"variants$ | async\"\r\n                        [channelPriceIncludesTax]=\"channelPriceIncludesTax$ | async\"\r\n                        [facets]=\"facets$ | async\"\r\n                        [optionGroups]=\"product.optionGroups\"\r\n                        [productVariantsFormArray]=\"detailForm.get('variants')\"\r\n                        [taxCategories]=\"taxCategories$ | async\"\r\n                        [customFields]=\"customVariantFields\"\r\n                        [customOptionFields]=\"customOptionFields\"\r\n                        [activeLanguage]=\"languageCode$ | async\"\r\n                        [pendingAssetChanges]=\"variantAssetChanges\"\r\n                        (assignToChannel)=\"assignVariantToChannel($event)\"\r\n                        (removeFromChannel)=\"removeVariantFromChannel($event)\"\r\n                        (assetChange)=\"variantAssetChange($event)\"\r\n                        (updateProductOption)=\"updateProductOption($event)\"\r\n                        (selectionChange)=\"selectedVariantIds = $event\"\r\n                        (selectFacetValueClick)=\"selectVariantFacetValue($event)\"\r\n                    ></vdr-product-variants-list>\r\n                </section>\r\n            </clr-tab-content>\r\n        </clr-tab>\r\n    </clr-tabs>\r\n</form>\r\n","import { Location } from '@angular/common';\r\nimport { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnDestroy, OnInit } from '@angular/core';\r\nimport { FormArray, FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    Asset,\r\n    BaseDetailComponent,\r\n    CreateProductInput,\r\n    createUpdatedTranslatable,\r\n    CustomFieldConfig,\r\n    DataService,\r\n    FacetWithValues,\r\n    findTranslation,\r\n    flattenFacetValues,\r\n    GlobalFlag,\r\n    LanguageCode,\r\n    ModalService,\r\n    NotificationService,\r\n    ProductWithVariants,\r\n    ServerConfigService,\r\n    TaxCategory,\r\n    UpdateProductInput,\r\n    UpdateProductMutation,\r\n    UpdateProductOptionInput,\r\n    UpdateProductVariantInput,\r\n    UpdateProductVariantsMutation,\r\n} from '@vendure/admin-ui/core';\r\nimport { normalizeString } from '@vendure/common/lib/normalize-string';\r\nimport { DEFAULT_CHANNEL_CODE } from '@vendure/common/lib/shared-constants';\r\nimport { notNullOrUndefined } from '@vendure/common/lib/shared-utils';\r\nimport { unique } from '@vendure/common/lib/unique';\r\nimport { combineLatest, EMPTY, merge, Observable } from 'rxjs';\r\nimport {\r\n    debounceTime,\r\n    distinctUntilChanged,\r\n    map,\r\n    mergeMap,\r\n    shareReplay,\r\n    startWith,\r\n    switchMap,\r\n    take,\r\n    takeUntil,\r\n    withLatestFrom,\r\n} from 'rxjs/operators';\r\n\r\nimport { ProductDetailService } from '../../providers/product-detail/product-detail.service';\r\nimport { ApplyFacetDialogComponent } from '../apply-facet-dialog/apply-facet-dialog.component';\r\nimport { AssignProductsToChannelDialogComponent } from '../assign-products-to-channel-dialog/assign-products-to-channel-dialog.component';\r\nimport { CreateProductVariantsConfig } from '../generate-product-variants/generate-product-variants.component';\r\nimport { VariantAssetChange } from '../product-variants-list/product-variants-list.component';\r\n\r\nexport type TabName = 'details' | 'variants';\r\nexport interface VariantFormValue {\r\n    id: string;\r\n    enabled: boolean;\r\n    sku: string;\r\n    name: string;\r\n    price: number;\r\n    priceWithTax: number;\r\n    taxCategoryId: string;\r\n    stockOnHand: number;\r\n    useGlobalOutOfStockThreshold: boolean;\r\n    outOfStockThreshold: number;\r\n    trackInventory: GlobalFlag;\r\n    facetValueIds: string[];\r\n    customFields?: any;\r\n}\r\n\r\nexport interface SelectedAssets {\r\n    assets?: Asset[];\r\n    featuredAsset?: Asset;\r\n}\r\n\r\n@Component({\r\n    selector: 'vdr-product-detail',\r\n    templateUrl: './product-detail.component.html',\r\n    styleUrls: ['./product-detail.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ProductDetailComponent\r\n    extends BaseDetailComponent<ProductWithVariants.Fragment>\r\n    implements OnInit, OnDestroy {\r\n    activeTab$: Observable<TabName>;\r\n    product$: Observable<ProductWithVariants.Fragment>;\r\n    variants$: Observable<ProductWithVariants.Variants[]>;\r\n    taxCategories$: Observable<TaxCategory.Fragment[]>;\r\n    customFields: CustomFieldConfig[];\r\n    customVariantFields: CustomFieldConfig[];\r\n    customOptionGroupFields: CustomFieldConfig[];\r\n    customOptionFields: CustomFieldConfig[];\r\n    detailForm: FormGroup;\r\n    filterInput = new FormControl('');\r\n    assetChanges: SelectedAssets = {};\r\n    variantAssetChanges: { [variantId: string]: SelectedAssets } = {};\r\n    productChannels$: Observable<ProductWithVariants.Channels[]>;\r\n    facetValues$: Observable<ProductWithVariants.FacetValues[]>;\r\n    facets$: Observable<FacetWithValues.Fragment[]>;\r\n    selectedVariantIds: string[] = [];\r\n    variantDisplayMode: 'card' | 'table' = 'card';\r\n    createVariantsConfig: CreateProductVariantsConfig = { groups: [], variants: [] };\r\n    channelPriceIncludesTax$: Observable<boolean>;\r\n\r\n    constructor(\r\n        route: ActivatedRoute,\r\n        router: Router,\r\n        serverConfigService: ServerConfigService,\r\n        private productDetailService: ProductDetailService,\r\n        private formBuilder: FormBuilder,\r\n        private modalService: ModalService,\r\n        private notificationService: NotificationService,\r\n        protected dataService: DataService,\r\n        private location: Location,\r\n        private changeDetector: ChangeDetectorRef,\r\n    ) {\r\n        super(route, router, serverConfigService, dataService);\r\n        this.customFields = this.getCustomFieldConfig('Product');\r\n        this.customVariantFields = this.getCustomFieldConfig('ProductVariant');\r\n        this.customOptionGroupFields = this.getCustomFieldConfig('ProductOptionGroup');\r\n        this.customOptionFields = this.getCustomFieldConfig('ProductOption');\r\n        this.detailForm = this.formBuilder.group({\r\n            product: this.formBuilder.group({\r\n                enabled: true,\r\n                name: ['', Validators.required],\r\n                autoUpdateVariantNames: true,\r\n                slug: '',\r\n                description: '',\r\n                facetValueIds: [[]],\r\n                customFields: this.formBuilder.group(\r\n                    this.customFields.reduce((hash, field) => ({ ...hash, [field.name]: '' }), {}),\r\n                ),\r\n            }),\r\n            variants: this.formBuilder.array([]),\r\n        });\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.init();\r\n        this.product$ = this.entity$;\r\n        const variants$ = this.product$.pipe(map(product => product.variants));\r\n        const filterTerm$ = this.filterInput.valueChanges.pipe(\r\n            startWith(''),\r\n            debounceTime(50),\r\n            shareReplay(),\r\n        );\r\n        this.variants$ = combineLatest(variants$, filterTerm$).pipe(\r\n            map(([variants, term]) => {\r\n                return term\r\n                    ? variants.filter(v => {\r\n                          const lcTerm = term.toLocaleLowerCase();\r\n                          return (\r\n                              v.name.toLocaleLowerCase().includes(lcTerm) ||\r\n                              v.sku.toLocaleLowerCase().includes(lcTerm)\r\n                          );\r\n                      })\r\n                    : variants;\r\n            }),\r\n        );\r\n        this.taxCategories$ = this.productDetailService.getTaxCategories().pipe(takeUntil(this.destroy$));\r\n        this.activeTab$ = this.route.paramMap.pipe(map(qpm => qpm.get('tab') as any));\r\n\r\n        // FacetValues are provided initially by the nested array of the\r\n        // Product entity, but once a fetch to get all Facets is made (as when\r\n        // opening the FacetValue selector modal), then these additional values\r\n        // are concatenated onto the initial array.\r\n        this.facets$ = this.productDetailService.getFacets();\r\n        const productFacetValues$ = this.product$.pipe(map(product => product.facetValues));\r\n        const allFacetValues$ = this.facets$.pipe(map(flattenFacetValues));\r\n        const productGroup = this.getProductFormGroup();\r\n\r\n        const formFacetValueIdChanges$ = productGroup.valueChanges.pipe(\r\n            map(val => val.facetValueIds as string[]),\r\n            distinctUntilChanged(),\r\n        );\r\n        const formChangeFacetValues$ = combineLatest(\r\n            formFacetValueIdChanges$,\r\n            productFacetValues$,\r\n            allFacetValues$,\r\n        ).pipe(\r\n            map(([ids, productFacetValues, allFacetValues]) => {\r\n                const combined = [...productFacetValues, ...allFacetValues];\r\n                return ids.map(id => combined.find(fv => fv.id === id)).filter(notNullOrUndefined);\r\n            }),\r\n        );\r\n\r\n        this.facetValues$ = merge(productFacetValues$, formChangeFacetValues$);\r\n        this.productChannels$ = this.product$.pipe(map(p => p.channels));\r\n        this.channelPriceIncludesTax$ = this.dataService.settings\r\n            .getActiveChannel('cache-first')\r\n            .refetchOnChannelChange()\r\n            .mapStream(data => data.activeChannel.pricesIncludeTax)\r\n            .pipe(shareReplay(1));\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        this.destroy();\r\n    }\r\n\r\n    navigateToTab(tabName: TabName) {\r\n        this.location.replaceState(\r\n            this.router\r\n                .createUrlTree(['./', { ...this.route.snapshot.params, tab: tabName }], {\r\n                    queryParamsHandling: 'merge',\r\n                    relativeTo: this.route,\r\n                })\r\n                .toString(),\r\n        );\r\n    }\r\n\r\n    isDefaultChannel(channelCode: string): boolean {\r\n        return channelCode === DEFAULT_CHANNEL_CODE;\r\n    }\r\n\r\n    assignToChannel() {\r\n        this.productChannels$\r\n            .pipe(\r\n                take(1),\r\n                switchMap(channels => {\r\n                    return this.modalService.fromComponent(AssignProductsToChannelDialogComponent, {\r\n                        size: 'lg',\r\n                        locals: {\r\n                            productIds: [this.id],\r\n                            currentChannelIds: channels.map(c => c.id),\r\n                        },\r\n                    });\r\n                }),\r\n            )\r\n            .subscribe();\r\n    }\r\n\r\n    removeFromChannel(channelId: string) {\r\n        this.modalService\r\n            .dialog({\r\n                title: _('catalog.remove-product-from-channel'),\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('catalog.remove-from-channel'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(response =>\r\n                    response\r\n                        ? this.dataService.product.removeProductsFromChannel({\r\n                              channelId,\r\n                              productIds: [this.id],\r\n                          })\r\n                        : EMPTY,\r\n                ),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('catalog.notify-remove-product-from-channel-success'));\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('catalog.notify-remove-product-from-channel-error'));\r\n                },\r\n            );\r\n    }\r\n\r\n    assignVariantToChannel(variant: ProductWithVariants.Variants) {\r\n        return this.modalService\r\n            .fromComponent(AssignProductsToChannelDialogComponent, {\r\n                size: 'lg',\r\n                locals: {\r\n                    productIds: [this.id],\r\n                    productVariantIds: [variant.id],\r\n                    currentChannelIds: variant.channels.map(c => c.id),\r\n                },\r\n            })\r\n            .subscribe();\r\n    }\r\n\r\n    removeVariantFromChannel({\r\n        channelId,\r\n        variant,\r\n    }: {\r\n        channelId: string;\r\n        variant: ProductWithVariants.Variants;\r\n    }) {\r\n        this.modalService\r\n            .dialog({\r\n                title: _('catalog.remove-product-variant-from-channel'),\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('catalog.remove-from-channel'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(response =>\r\n                    response\r\n                        ? this.dataService.product.removeVariantsFromChannel({\r\n                              channelId,\r\n                              productVariantIds: [variant.id],\r\n                          })\r\n                        : EMPTY,\r\n                ),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('catalog.notify-remove-variant-from-channel-success'));\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('catalog.notify-remove-variant-from-channel-error'));\r\n                },\r\n            );\r\n    }\r\n\r\n    customFieldIsSet(name: string): boolean {\r\n        return !!this.detailForm.get(['product', 'customFields', name]);\r\n    }\r\n\r\n    assetsChanged(): boolean {\r\n        return !!Object.values(this.assetChanges).length;\r\n    }\r\n\r\n    variantAssetsChanged(): boolean {\r\n        return !!Object.keys(this.variantAssetChanges).length;\r\n    }\r\n\r\n    variantAssetChange(event: VariantAssetChange) {\r\n        this.variantAssetChanges[event.variantId] = event;\r\n    }\r\n\r\n    /**\r\n     * If creating a new product, automatically generate the slug based on the product name.\r\n     */\r\n    updateSlug(nameValue: string) {\r\n        combineLatest(this.entity$, this.languageCode$)\r\n            .pipe(take(1))\r\n            .subscribe(([entity, languageCode]) => {\r\n                const slugControl = this.detailForm.get(['product', 'slug']);\r\n                const currentTranslation = findTranslation(entity, languageCode);\r\n                const currentSlugIsEmpty = !currentTranslation || !currentTranslation.slug;\r\n                if (slugControl && slugControl.pristine && currentSlugIsEmpty) {\r\n                    slugControl.setValue(normalizeString(`${nameValue}`, '-'));\r\n                }\r\n            });\r\n    }\r\n\r\n    selectProductFacetValue() {\r\n        this.displayFacetValueModal().subscribe(facetValueIds => {\r\n            if (facetValueIds) {\r\n                const productGroup = this.getProductFormGroup();\r\n                const currentFacetValueIds = productGroup.value.facetValueIds;\r\n                productGroup.patchValue({\r\n                    facetValueIds: unique([...currentFacetValueIds, ...facetValueIds]),\r\n                });\r\n                productGroup.markAsDirty();\r\n            }\r\n        });\r\n    }\r\n\r\n    updateProductOption(input: UpdateProductOptionInput & { autoUpdate: boolean }) {\r\n        combineLatest(this.product$, this.languageCode$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([product, languageCode]) =>\r\n                    this.productDetailService.updateProductOption(input, product, languageCode),\r\n                ),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-update-success'), {\r\n                        entity: 'ProductOption',\r\n                    });\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-update-error'), {\r\n                        entity: 'ProductOption',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    removeProductFacetValue(facetValueId: string) {\r\n        const productGroup = this.getProductFormGroup();\r\n        const currentFacetValueIds = productGroup.value.facetValueIds;\r\n        productGroup.patchValue({\r\n            facetValueIds: currentFacetValueIds.filter(id => id !== facetValueId),\r\n        });\r\n        productGroup.markAsDirty();\r\n    }\r\n\r\n    /**\r\n     * Opens a dialog to select FacetValues to apply to the select ProductVariants.\r\n     */\r\n    selectVariantFacetValue(selectedVariantIds: string[]) {\r\n        this.displayFacetValueModal()\r\n            .pipe(withLatestFrom(this.variants$))\r\n            .subscribe(([facetValueIds, variants]) => {\r\n                if (facetValueIds) {\r\n                    for (const variantId of selectedVariantIds) {\r\n                        const index = variants.findIndex(v => v.id === variantId);\r\n                        const variant = variants[index];\r\n                        const existingFacetValueIds = variant ? variant.facetValues.map(fv => fv.id) : [];\r\n                        const variantFormGroup = this.detailForm.get(['variants', index]);\r\n                        if (variantFormGroup) {\r\n                            variantFormGroup.patchValue({\r\n                                facetValueIds: unique([...existingFacetValueIds, ...facetValueIds]),\r\n                            });\r\n                            variantFormGroup.markAsDirty();\r\n                        }\r\n                    }\r\n                    this.changeDetector.markForCheck();\r\n                }\r\n            });\r\n    }\r\n\r\n    variantsToCreateAreValid(): boolean {\r\n        return (\r\n            0 < this.createVariantsConfig.variants.length &&\r\n            this.createVariantsConfig.variants.every(v => {\r\n                return v.sku !== '';\r\n            })\r\n        );\r\n    }\r\n\r\n    private displayFacetValueModal(): Observable<string[] | undefined> {\r\n        return this.productDetailService.getFacets().pipe(\r\n            mergeMap(facets =>\r\n                this.modalService.fromComponent(ApplyFacetDialogComponent, {\r\n                    size: 'md',\r\n                    closable: true,\r\n                    locals: { facets },\r\n                }),\r\n            ),\r\n            map(facetValues => facetValues && facetValues.map(v => v.id)),\r\n        );\r\n    }\r\n\r\n    create() {\r\n        const productGroup = this.getProductFormGroup();\r\n        if (!productGroup.dirty) {\r\n            return;\r\n        }\r\n        combineLatest(this.product$, this.languageCode$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([product, languageCode]) => {\r\n                    const newProduct = this.getUpdatedProduct(\r\n                        product,\r\n                        productGroup as FormGroup,\r\n                        languageCode,\r\n                    ) as CreateProductInput;\r\n                    return this.productDetailService.createProductWithVariants(\r\n                        newProduct,\r\n                        this.createVariantsConfig,\r\n                        languageCode,\r\n                    );\r\n                }),\r\n            )\r\n            .subscribe(\r\n                ({ createProductVariants, productId }) => {\r\n                    this.notificationService.success(_('common.notify-create-success'), {\r\n                        entity: 'Product',\r\n                    });\r\n                    this.assetChanges = {};\r\n                    this.variantAssetChanges = {};\r\n                    this.detailForm.markAsPristine();\r\n                    this.router.navigate(['../', productId], { relativeTo: this.route });\r\n                },\r\n                err => {\r\n                    // tslint:disable-next-line:no-console\r\n                    console.error(err);\r\n                    this.notificationService.error(_('common.notify-create-error'), {\r\n                        entity: 'Product',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    save() {\r\n        combineLatest(this.product$, this.languageCode$, this.channelPriceIncludesTax$)\r\n            .pipe(\r\n                take(1),\r\n                mergeMap(([product, languageCode, priceIncludesTax]) => {\r\n                    const productGroup = this.getProductFormGroup();\r\n                    let productInput: UpdateProductInput | undefined;\r\n                    let variantsInput: UpdateProductVariantInput[] | undefined;\r\n\r\n                    if (productGroup.dirty || this.assetsChanged()) {\r\n                        productInput = this.getUpdatedProduct(\r\n                            product,\r\n                            productGroup as FormGroup,\r\n                            languageCode,\r\n                        ) as UpdateProductInput;\r\n                    }\r\n                    const variantsArray = this.detailForm.get('variants');\r\n                    if ((variantsArray && variantsArray.dirty) || this.variantAssetsChanged()) {\r\n                        variantsInput = this.getUpdatedProductVariants(\r\n                            product,\r\n                            variantsArray as FormArray,\r\n                            languageCode,\r\n                            priceIncludesTax,\r\n                        );\r\n                    }\r\n\r\n                    return this.productDetailService.updateProduct({\r\n                        product,\r\n                        languageCode,\r\n                        autoUpdate:\r\n                            this.detailForm.get(['product', 'autoUpdateVariantNames'])?.value ?? false,\r\n                        productInput,\r\n                        variantsInput,\r\n                    });\r\n                }),\r\n            )\r\n            .subscribe(\r\n                result => {\r\n                    this.updateSlugAfterSave(result);\r\n                    this.detailForm.markAsPristine();\r\n                    this.assetChanges = {};\r\n                    this.variantAssetChanges = {};\r\n                    this.notificationService.success(_('common.notify-update-success'), {\r\n                        entity: 'Product',\r\n                    });\r\n                    this.changeDetector.markForCheck();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-update-error'), {\r\n                        entity: 'Product',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    canDeactivate(): boolean {\r\n        return super.canDeactivate() && !this.assetChanges.assets && !this.assetChanges.featuredAsset;\r\n    }\r\n\r\n    /**\r\n     * Sets the values of the form on changes to the product or current language.\r\n     */\r\n    protected setFormValues(product: ProductWithVariants.Fragment, languageCode: LanguageCode) {\r\n        const currentTranslation = findTranslation(product, languageCode);\r\n        this.detailForm.patchValue({\r\n            product: {\r\n                enabled: product.enabled,\r\n                name: currentTranslation ? currentTranslation.name : '',\r\n                slug: currentTranslation ? currentTranslation.slug : '',\r\n                description: currentTranslation ? currentTranslation.description : '',\r\n                facetValueIds: product.facetValues.map(fv => fv.id),\r\n            },\r\n        });\r\n\r\n        if (this.customFields.length) {\r\n            const customFieldsGroup = this.detailForm.get(['product', 'customFields']) as FormGroup;\r\n            const cfCurrentTranslation =\r\n                (currentTranslation && (currentTranslation as any).customFields) || {};\r\n            const cfProduct = (product as any).customFields || {};\r\n\r\n            for (const fieldDef of this.customFields) {\r\n                const key = fieldDef.name;\r\n                const value = fieldDef.type === 'localeString' ? cfCurrentTranslation[key] : cfProduct[key];\r\n                const control = customFieldsGroup.get(key);\r\n                if (control) {\r\n                    control.patchValue(value);\r\n                }\r\n            }\r\n        }\r\n\r\n        const variantsFormArray = this.detailForm.get('variants') as FormArray;\r\n        product.variants.forEach((variant, i) => {\r\n            const variantTranslation = findTranslation(variant, languageCode);\r\n            const facetValueIds = variant.facetValues.map(fv => fv.id);\r\n            const group: VariantFormValue = {\r\n                id: variant.id,\r\n                enabled: variant.enabled,\r\n                sku: variant.sku,\r\n                name: variantTranslation ? variantTranslation.name : '',\r\n                price: variant.price,\r\n                priceWithTax: variant.priceWithTax,\r\n                taxCategoryId: variant.taxCategory.id,\r\n                stockOnHand: variant.stockOnHand,\r\n                useGlobalOutOfStockThreshold: variant.useGlobalOutOfStockThreshold,\r\n                outOfStockThreshold: variant.outOfStockThreshold,\r\n                trackInventory: variant.trackInventory,\r\n                facetValueIds,\r\n            };\r\n\r\n            let variantFormGroup = variantsFormArray.at(i) as FormGroup | undefined;\r\n            if (variantFormGroup) {\r\n                variantFormGroup.patchValue(group);\r\n            } else {\r\n                variantFormGroup = this.formBuilder.group({\r\n                    ...group,\r\n                    facetValueIds: this.formBuilder.control(facetValueIds),\r\n                });\r\n                variantsFormArray.insert(i, variantFormGroup);\r\n            }\r\n            if (this.customVariantFields.length) {\r\n                let customFieldsGroup = variantFormGroup.get(['customFields']) as FormGroup | undefined;\r\n\r\n                if (!customFieldsGroup) {\r\n                    customFieldsGroup = this.formBuilder.group(\r\n                        this.customVariantFields.reduce((hash, field) => ({ ...hash, [field.name]: '' }), {}),\r\n                    );\r\n                    variantFormGroup.addControl('customFields', customFieldsGroup);\r\n                }\r\n\r\n                for (const fieldDef of this.customVariantFields) {\r\n                    const key = fieldDef.name;\r\n                    const value =\r\n                        fieldDef.type === 'localeString'\r\n                            ? (variantTranslation as any).customFields[key]\r\n                            : (variant as any).customFields[key];\r\n                    const control = customFieldsGroup.get(key);\r\n                    if (control) {\r\n                        control.patchValue(value);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Given a product and the value of the detailForm, this method creates an updated copy of the product which\r\n     * can then be persisted to the API.\r\n     */\r\n    private getUpdatedProduct(\r\n        product: ProductWithVariants.Fragment,\r\n        productFormGroup: FormGroup,\r\n        languageCode: LanguageCode,\r\n    ): UpdateProductInput | CreateProductInput {\r\n        const updatedProduct = createUpdatedTranslatable({\r\n            translatable: product,\r\n            updatedFields: productFormGroup.value,\r\n            customFieldConfig: this.customFields,\r\n            languageCode,\r\n            defaultTranslation: {\r\n                languageCode,\r\n                name: product.name || '',\r\n                slug: product.slug || '',\r\n                description: product.description || '',\r\n            },\r\n        });\r\n        return {\r\n            ...updatedProduct,\r\n            assetIds: this.assetChanges.assets?.map(a => a.id),\r\n            featuredAssetId: this.assetChanges.featuredAsset?.id,\r\n            facetValueIds: productFormGroup.value.facetValueIds,\r\n        } as UpdateProductInput | CreateProductInput;\r\n    }\r\n\r\n    /**\r\n     * Given an array of product variants and the values from the detailForm, this method creates an new array\r\n     * which can be persisted to the API.\r\n     */\r\n    private getUpdatedProductVariants(\r\n        product: ProductWithVariants.Fragment,\r\n        variantsFormArray: FormArray,\r\n        languageCode: LanguageCode,\r\n        priceIncludesTax: boolean,\r\n    ): UpdateProductVariantInput[] {\r\n        const dirtyVariants = product.variants.filter((v, i) => {\r\n            const formRow = variantsFormArray.get(i.toString());\r\n            return formRow && formRow.dirty;\r\n        });\r\n        const dirtyVariantValues = variantsFormArray.controls.filter(c => c.dirty).map(c => c.value);\r\n\r\n        if (dirtyVariants.length !== dirtyVariantValues.length) {\r\n            throw new Error(_(`error.product-variant-form-values-do-not-match`));\r\n        }\r\n        return dirtyVariants\r\n            .map((variant, i) => {\r\n                const formValue: VariantFormValue = dirtyVariantValues[i];\r\n                const result: UpdateProductVariantInput = createUpdatedTranslatable({\r\n                    translatable: variant,\r\n                    updatedFields: formValue,\r\n                    customFieldConfig: this.customVariantFields,\r\n                    languageCode,\r\n                    defaultTranslation: {\r\n                        languageCode,\r\n                        name: '',\r\n                    },\r\n                });\r\n                result.taxCategoryId = formValue.taxCategoryId;\r\n                result.facetValueIds = formValue.facetValueIds;\r\n                result.price = priceIncludesTax ? formValue.priceWithTax : formValue.price;\r\n                const assetChanges = this.variantAssetChanges[variant.id];\r\n                if (assetChanges) {\r\n                    result.featuredAssetId = assetChanges.featuredAsset?.id;\r\n                    result.assetIds = assetChanges.assets?.map(a => a.id);\r\n                }\r\n                return result;\r\n            })\r\n            .filter(notNullOrUndefined);\r\n    }\r\n\r\n    private getProductFormGroup(): FormGroup {\r\n        return this.detailForm.get('product') as FormGroup;\r\n    }\r\n\r\n    /**\r\n     * The server may alter the slug value in order to normalize and ensure uniqueness upon saving.\r\n     */\r\n    private updateSlugAfterSave(results: Array<UpdateProductMutation | UpdateProductVariantsMutation>) {\r\n        const firstResult = results[0];\r\n        const slugControl = this.detailForm.get(['product', 'slug']);\r\n\r\n        function isUpdateMutation(input: any): input is UpdateProductMutation {\r\n            return input.hasOwnProperty('updateProduct');\r\n        }\r\n\r\n        if (slugControl && isUpdateMutation(firstResult)) {\r\n            slugControl.setValue(firstResult.updateProduct.slug, { emitEvent: false });\r\n        }\r\n    }\r\n}\r\n","<ng-select\r\n    [addTag]=\"addTagFn\"\r\n    [placeholder]=\"'catalog.search-product-name-or-code' | translate\"\r\n    [items]=\"facetValueResults\"\r\n    [searchFn]=\"filterFacetResults\"\r\n    [hideSelected]=\"true\"\r\n    [multiple]=\"true\"\r\n    [markFirst]=\"false\"\r\n    (change)=\"onSelectChange($event)\"\r\n    #selectComponent\r\n>\r\n    <ng-template ng-header-tmp>\r\n        <div\r\n            class=\"search-header\"\r\n            *ngIf=\"selectComponent.searchTerm\"\r\n            [class.selected]=\"isSearchHeaderSelected()\"\r\n            (click)=\"selectComponent.selectTag()\"\r\n        >\r\n            {{ 'catalog.search-for-term' | translate }}: {{ selectComponent.searchTerm }}\r\n        </div>\r\n    </ng-template>\r\n    <ng-template ng-label-tmp let-item=\"item\" let-clear=\"clear\">\r\n        <ng-container *ngIf=\"item.facetValue\">\r\n            <vdr-facet-value-chip\r\n                [facetValue]=\"item.facetValue\"\r\n                [removable]=\"true\"\r\n                (remove)=\"clear(item)\"\r\n            ></vdr-facet-value-chip>\r\n        </ng-container>\r\n        <ng-container *ngIf=\"!item.facetValue\">\r\n            <vdr-chip [icon]=\"'times'\" (iconClick)=\"clear(item)\">\"{{ item.label }}\"</vdr-chip>\r\n        </ng-container>\r\n    </ng-template>\r\n    <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\" let-search=\"searchTerm\">\r\n        <ng-container *ngIf=\"item.facetValue\">\r\n            <vdr-facet-value-chip [facetValue]=\"item.facetValue\" [removable]=\"false\"></vdr-facet-value-chip>\r\n        </ng-container>\r\n    </ng-template>\r\n</ng-select>\r\n","import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';\r\nimport { NgSelectComponent, SELECTION_MODEL_FACTORY } from '@ng-select/ng-select';\r\nimport { SearchProducts, SingleSearchSelectionModelFactory } from '@vendure/admin-ui/core';\r\nimport { notNullOrUndefined } from '@vendure/common/lib/shared-utils';\r\n\r\n@Component({\r\n    selector: 'vdr-product-search-input',\r\n    templateUrl: './product-search-input.component.html',\r\n    styleUrls: ['./product-search-input.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n    providers: [{ provide: SELECTION_MODEL_FACTORY, useValue: SingleSearchSelectionModelFactory }],\r\n})\r\nexport class ProductSearchInputComponent {\r\n    @Input() facetValueResults: SearchProducts.FacetValues[];\r\n    @Output() searchTermChange = new EventEmitter<string>();\r\n    @Output() facetValueChange = new EventEmitter<string[]>();\r\n    @ViewChild('selectComponent', { static: true }) private selectComponent: NgSelectComponent;\r\n    private lastTerm = '';\r\n    private lastFacetValueIds: string[] = [];\r\n\r\n    setSearchTerm(term: string | null) {\r\n        if (term) {\r\n            this.selectComponent.select({ label: term, value: { label: term } });\r\n        } else {\r\n            const currentTerm = this.selectComponent.selectedItems.find(i => !this.isFacetValueItem(i.value));\r\n            if (currentTerm) {\r\n                this.selectComponent.unselect(currentTerm);\r\n            }\r\n        }\r\n    }\r\n\r\n    setFacetValues(ids: string[]) {\r\n        const items = this.selectComponent.items;\r\n\r\n        this.selectComponent.selectedItems.forEach(item => {\r\n            if (this.isFacetValueItem(item.value) && !ids.includes(item.value.facetValue.id)) {\r\n                this.selectComponent.unselect(item);\r\n            }\r\n        });\r\n\r\n        ids.map(id => {\r\n            return items.find(item => this.isFacetValueItem(item) && item.facetValue.id === id);\r\n        })\r\n            .filter(notNullOrUndefined)\r\n            .forEach(item => {\r\n                const isSelected = this.selectComponent.selectedItems.find(i => {\r\n                    const val = i.value;\r\n                    if (this.isFacetValueItem(val)) {\r\n                        return val.facetValue.id === item.facetValue.id;\r\n                    }\r\n                    return false;\r\n                });\r\n                if (!isSelected) {\r\n                    this.selectComponent.select({ label: '', value: item });\r\n                }\r\n            });\r\n    }\r\n\r\n    filterFacetResults = (term: string, item: SearchProducts.FacetValues | { label: string }) => {\r\n        if (!this.isFacetValueItem(item)) {\r\n            return false;\r\n        }\r\n        return (\r\n            item.facetValue.name.toLowerCase().startsWith(term.toLowerCase()) ||\r\n            item.facetValue.facet.name.toLowerCase().startsWith(term.toLowerCase())\r\n        );\r\n    };\r\n\r\n    onSelectChange(selectedItems: Array<SearchProducts.FacetValues | { label: string }>) {\r\n        if (!Array.isArray(selectedItems)) {\r\n            selectedItems = [selectedItems];\r\n        }\r\n        const searchTermItem = selectedItems.find(item => !this.isFacetValueItem(item)) as\r\n            | { label: string }\r\n            | undefined;\r\n        const searchTerm = searchTermItem ? searchTermItem.label : '';\r\n\r\n        const facetValueIds = selectedItems.filter(this.isFacetValueItem).map(i => i.facetValue.id);\r\n\r\n        if (searchTerm !== this.lastTerm) {\r\n            this.searchTermChange.emit(searchTerm);\r\n            this.lastTerm = searchTerm;\r\n        }\r\n        if (this.lastFacetValueIds.join(',') !== facetValueIds.join(',')) {\r\n            this.facetValueChange.emit(facetValueIds);\r\n            this.lastFacetValueIds = facetValueIds;\r\n        }\r\n    }\r\n\r\n    addTagFn(item: any) {\r\n        return { label: item };\r\n    }\r\n\r\n    isSearchHeaderSelected(): boolean {\r\n        return this.selectComponent.itemsList.markedIndex === -1;\r\n    }\r\n\r\n    private isFacetValueItem = (input: unknown): input is SearchProducts.FacetValues => {\r\n        return typeof input === 'object' && !!input && input.hasOwnProperty('facetValue');\r\n    };\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-left [grow]=\"true\">\r\n        <div class=\"search-form\">\r\n            <vdr-product-search-input\r\n                #productSearchInputComponent\r\n                [facetValueResults]=\"facetValues$ | async\"\r\n                (searchTermChange)=\"setSearchTerm($event)\"\r\n                (facetValueChange)=\"setFacetValueIds($event)\"\r\n            ></vdr-product-search-input>\r\n            <vdr-dropdown class=\"search-settings-menu mr3\">\r\n                <button type=\"button\" class=\"icon-button\" vdrDropdownTrigger>\r\n                    <clr-icon shape=\"cog\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        (click)=\"rebuildSearchIndex()\"\r\n                        [disabled]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n                    >\r\n                        {{ 'catalog.rebuild-search-index' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </div>\r\n        <div class=\"flex wrap\">\r\n            <clr-checkbox-wrapper class=\"mt2\">\r\n                <input type=\"checkbox\" clrCheckbox [(ngModel)]=\"groupByProduct\"/>\r\n                <label>{{ 'catalog.group-by-product' | translate }}</label>\r\n            </clr-checkbox-wrapper>\r\n            <vdr-language-selector\r\n                [availableLanguageCodes]=\"availableLanguages$ | async\"\r\n                [currentLanguageCode]=\"contentLanguage$ | async\"\r\n                (languageCodeChange)=\"setLanguage($event)\"\r\n            ></vdr-language-selector>\r\n        </div>\r\n    </vdr-ab-left>\r\n    <vdr-ab-right>\r\n        <vdr-action-bar-items locationId=\"product-list\"></vdr-action-bar-items>\r\n        <a class=\"btn btn-primary\" [routerLink]=\"['./create']\" *vdrIfPermissions=\"['CreateCatalog', 'CreateProduct']\">\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            <span class=\"full-label\">{{ 'catalog.create-new-product' | translate }}</span>\r\n        </a>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<vdr-data-table\r\n    [items]=\"items$ | async\"\r\n    [itemsPerPage]=\"itemsPerPage$ | async\"\r\n    [totalItems]=\"totalItems$ | async\"\r\n    [currentPage]=\"currentPage$ | async\"\r\n    (pageChange)=\"setPageNumber($event)\"\r\n    (itemsPerPageChange)=\"setItemsPerPage($event)\"\r\n>\r\n    <ng-template let-result=\"item\">\r\n        <td class=\"left align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <div class=\"image-placeholder\">\r\n                <img\r\n                    *ngIf=\"\r\n                        groupByProduct\r\n                            ? result.productAsset\r\n                            : result.productVariantAsset || result.productAsset as asset;\r\n                        else imagePlaceholder\r\n                    \"\r\n                    [src]=\"asset | assetPreview:'tiny'\"\r\n                />\r\n                <ng-template #imagePlaceholder>\r\n                    <div class=\"placeholder\">\r\n                        <clr-icon shape=\"image\" size=\"48\"></clr-icon>\r\n                    </div>\r\n                </ng-template>\r\n            </div>\r\n        </td>\r\n        <td class=\"left align-middle\" [class.disabled]=\"!result.enabled\">\r\n            {{ groupByProduct ? result.productName : result.productVariantName }}\r\n        </td>\r\n        <td class=\"align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <vdr-chip *ngIf=\"!result.enabled\">{{ 'common.disabled' | translate }}</vdr-chip>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <vdr-table-row-action\r\n                iconShape=\"edit\"\r\n                [label]=\"'common.edit' | translate\"\r\n                [linkTo]=\"['./', result.productId]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n        <td class=\"right align-middle\" [class.disabled]=\"!result.enabled\">\r\n            <vdr-dropdown>\r\n                <button type=\"button\" class=\"btn btn-link btn-sm\" vdrDropdownTrigger>\r\n                    {{ 'common.actions' | translate }}\r\n                    <clr-icon shape=\"caret down\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button\r\n                        type=\"button\"\r\n                        class=\"delete-button\"\r\n                        (click)=\"deleteProduct(result.productId)\"\r\n                        [disabled]=\"!(['DeleteCatalog', 'DeleteProduct'] | hasPermission)\"\r\n                        vdrDropdownItem\r\n                    >\r\n                        <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                        {{ 'common.delete' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n","import { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    BaseListComponent,\r\n    DataService,\r\n    JobQueueService,\r\n    JobState,\r\n    LanguageCode,\r\n    LogicalOperator,\r\n    ModalService,\r\n    NotificationService,\r\n    SearchInput,\r\n    SearchProducts,\r\n    ServerConfigService,\r\n} from '@vendure/admin-ui/core';\r\nimport { EMPTY, Observable, of } from 'rxjs';\r\nimport {\r\n    delay,\r\n    distinctUntilChanged,\r\n    map,\r\n    shareReplay,\r\n    switchMap,\r\n    take,\r\n    takeUntil,\r\n    tap,\r\n    withLatestFrom,\r\n} from 'rxjs/operators';\r\n\r\nimport { ProductSearchInputComponent } from '../product-search-input/product-search-input.component';\r\n\r\n@Component({\r\n    selector: 'vdr-products-list',\r\n    templateUrl: './product-list.component.html',\r\n    styleUrls: ['./product-list.component.scss'],\r\n})\r\nexport class ProductListComponent\r\n    extends BaseListComponent<SearchProducts.Query, SearchProducts.Items, SearchProducts.Variables>\r\n    implements OnInit {\r\n    searchTerm = '';\r\n    facetValueIds: string[] = [];\r\n    groupByProduct = true;\r\n    facetValues$: Observable<SearchProducts.FacetValues[]>;\r\n    availableLanguages$: Observable<LanguageCode[]>;\r\n    contentLanguage$: Observable<LanguageCode>;\r\n    @ViewChild('productSearchInputComponent', { static: true })\r\n    private productSearchInput: ProductSearchInputComponent;\r\n    constructor(\r\n        private dataService: DataService,\r\n        private modalService: ModalService,\r\n        private notificationService: NotificationService,\r\n        private jobQueueService: JobQueueService,\r\n        private serverConfigService: ServerConfigService,\r\n        router: Router,\r\n        route: ActivatedRoute,\r\n    ) {\r\n        super(router, route);\r\n        super.setQueryFn(\r\n            (...args: any[]) =>\r\n                this.dataService.product.searchProducts(this.searchTerm, ...args).refetchOnChannelChange(),\r\n            data => data.search,\r\n            // tslint:disable-next-line:no-shadowed-variable\r\n            (skip, take) => ({\r\n                input: {\r\n                    skip,\r\n                    take,\r\n                    term: this.searchTerm,\r\n                    facetValueIds: this.facetValueIds,\r\n                    facetValueOperator: LogicalOperator.AND,\r\n                    groupByProduct: this.groupByProduct,\r\n                } as SearchInput,\r\n            }),\r\n        );\r\n    }\r\n\r\n    ngOnInit() {\r\n        super.ngOnInit();\r\n        this.facetValues$ = this.result$.pipe(map(data => data.search.facetValues));\r\n        // this.facetValues$ = of([]);\r\n        this.route.queryParamMap\r\n            .pipe(\r\n                map(qpm => qpm.get('q')),\r\n                takeUntil(this.destroy$),\r\n            )\r\n            .subscribe(term => {\r\n                this.productSearchInput.setSearchTerm(term);\r\n            });\r\n\r\n        const fvids$ = this.route.queryParamMap.pipe(map(qpm => qpm.getAll('fvids')));\r\n\r\n        fvids$.pipe(takeUntil(this.destroy$)).subscribe(ids => {\r\n            this.productSearchInput.setFacetValues(ids);\r\n        });\r\n\r\n        this.facetValues$.pipe(take(1), delay(100), withLatestFrom(fvids$)).subscribe(([__, ids]) => {\r\n            this.productSearchInput.setFacetValues(ids);\r\n        });\r\n        this.availableLanguages$ = this.serverConfigService.getAvailableLanguages();\r\n        this.contentLanguage$ = this.dataService.client\r\n            .uiState()\r\n            .mapStream(({ uiState }) => uiState.contentLanguage)\r\n            .pipe(tap(() => this.refresh()));\r\n    }\r\n\r\n    setSearchTerm(term: string) {\r\n        this.searchTerm = term;\r\n        this.setQueryParam({ q: term || null, page: 1 });\r\n        this.refresh();\r\n    }\r\n\r\n    setFacetValueIds(ids: string[]) {\r\n        this.facetValueIds = ids;\r\n        this.setQueryParam({ fvids: ids, page: 1 });\r\n        this.refresh();\r\n    }\r\n\r\n    rebuildSearchIndex() {\r\n        this.dataService.product.reindex().subscribe(({ reindex }) => {\r\n            this.notificationService.info(_('catalog.reindexing'));\r\n            this.jobQueueService.addJob(reindex.id, job => {\r\n                if (job.state === JobState.COMPLETED) {\r\n                    const time = new Intl.NumberFormat().format(job.duration || 0);\r\n                    this.notificationService.success(_('catalog.reindex-successful'), {\r\n                        count: job.result.indexedItemCount,\r\n                        time,\r\n                    });\r\n                    this.refresh();\r\n                } else {\r\n                    this.notificationService.error(_('catalog.reindex-error'));\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    deleteProduct(productId: string) {\r\n        this.modalService\r\n            .dialog({\r\n                title: _('catalog.confirm-delete-product'),\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('common.delete'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(response => (response ? this.dataService.product.deleteProduct(productId) : EMPTY)),\r\n                // Short delay to allow the product to be removed from the search index before\r\n                // refreshing.\r\n                delay(500),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-delete-success'), {\r\n                        entity: 'Product',\r\n                    });\r\n                    this.refresh();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-delete-error'), {\r\n                        entity: 'Product',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    setLanguage(code: LanguageCode) {\r\n        this.dataService.client.setContentLanguage(code).subscribe();\r\n    }\r\n}\r\n","<ng-template vdrDialogTitle>\r\n    {{ 'catalog.confirm-deletion-of-unused-variants-title' | translate }}\r\n</ng-template>\r\n{{ 'catalog.confirm-deletion-of-unused-variants-body' | translate }}\r\n<ul>\r\n    <li *ngFor=\"let variant of variants\">{{ variant.name }} ({{ variant.sku }})</li>\r\n</ul>\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button type=\"submit\" (click)=\"confirm()\" class=\"btn btn-primary\">\r\n        {{ 'common.confirm' | translate }}\r\n    </button>\r\n</ng-template>\r\n","import { ChangeDetectionStrategy, Component } from '@angular/core';\r\nimport { Dialog, GetProductVariantOptions } from '@vendure/admin-ui/core';\r\n\r\n@Component({\r\n    selector: 'vdr-confirm-variant-deletion-dialog',\r\n    templateUrl: './confirm-variant-deletion-dialog.component.html',\r\n    styleUrls: ['./confirm-variant-deletion-dialog.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ConfirmVariantDeletionDialogComponent implements Dialog<boolean> {\r\n    resolveWith: (result?: boolean) => void;\r\n    variants: GetProductVariantOptions.Variants[] = [];\r\n\r\n    confirm() {\r\n        this.resolveWith(true);\r\n    }\r\n\r\n    cancel() {\r\n        this.resolveWith();\r\n    }\r\n}\r\n","<div class=\"input-wrapper\" [class.focus]=\"isFocussed\" (click)=\"textArea.focus()\">\r\n    <div class=\"chips\" *ngIf=\"0 < options.length\">\r\n        <vdr-chip\r\n            *ngFor=\"let option of options; last as isLast\"\r\n            [icon]=\"option.locked ? 'lock' : 'times'\"\r\n            [class.selected]=\"isLast && lastSelected\"\r\n            [class.locked]=\"option.locked\"\r\n            [colorFrom]=\"groupName\"\r\n            (iconClick)=\"removeOption(option)\"\r\n        >\r\n            {{ option.name }}\r\n        </vdr-chip>\r\n    </div>\r\n    <textarea\r\n        #textArea\r\n        (keyup)=\"handleKey($event)\"\r\n        (focus)=\"isFocussed = true\"\r\n        (blur)=\"handleBlur()\"\r\n        [(ngModel)]=\"input\"\r\n        [disabled]=\"disabled\"\r\n    ></textarea>\r\n</div>\r\n","import {\r\n    ChangeDetectionStrategy,\r\n    ChangeDetectorRef,\r\n    Component,\r\n    ElementRef,\r\n    forwardRef,\r\n    Input,\r\n    Provider,\r\n    ViewChild,\r\n} from '@angular/core';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\nimport { unique } from '@vendure/common/lib/unique';\r\n\r\nexport const OPTION_VALUE_INPUT_VALUE_ACCESSOR: Provider = {\r\n    provide: NG_VALUE_ACCESSOR,\r\n    useExisting: forwardRef(() => OptionValueInputComponent),\r\n    multi: true,\r\n};\r\n\r\n@Component({\r\n    selector: 'vdr-option-value-input',\r\n    templateUrl: './option-value-input.component.html',\r\n    styleUrls: ['./option-value-input.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.Default,\r\n    providers: [OPTION_VALUE_INPUT_VALUE_ACCESSOR],\r\n})\r\nexport class OptionValueInputComponent implements ControlValueAccessor {\r\n    @Input() groupName = '';\r\n    @ViewChild('textArea', { static: true }) textArea: ElementRef<HTMLTextAreaElement>;\r\n    options: Array<{ name: string; locked: boolean }>;\r\n    disabled = false;\r\n    input = '';\r\n    isFocussed = false;\r\n    lastSelected = false;\r\n    onChangeFn: (value: any) => void;\r\n    onTouchFn: (value: any) => void;\r\n\r\n    constructor(private changeDetector: ChangeDetectorRef) {}\r\n\r\n    registerOnChange(fn: any): void {\r\n        this.onChangeFn = fn;\r\n    }\r\n\r\n    registerOnTouched(fn: any): void {\r\n        this.onTouchFn = fn;\r\n    }\r\n\r\n    setDisabledState(isDisabled: boolean): void {\r\n        this.disabled = isDisabled;\r\n        this.changeDetector.markForCheck();\r\n    }\r\n\r\n    writeValue(obj: any): void {\r\n        this.options = obj || [];\r\n    }\r\n\r\n    focus() {\r\n        this.textArea.nativeElement.focus();\r\n    }\r\n\r\n    removeOption(option: { name: string; locked: boolean }) {\r\n        if (!option.locked) {\r\n            this.options = this.options.filter(o => o.name !== option.name);\r\n            this.onChangeFn(this.options);\r\n        }\r\n    }\r\n\r\n    handleKey(event: KeyboardEvent) {\r\n        switch (event.key) {\r\n            case ',':\r\n            case 'Enter':\r\n                this.addOptionValue();\r\n                event.preventDefault();\r\n                break;\r\n            case 'Backspace':\r\n                if (this.lastSelected) {\r\n                    this.removeLastOption();\r\n                    this.lastSelected = false;\r\n                } else if (this.input === '') {\r\n                    this.lastSelected = true;\r\n                }\r\n                break;\r\n            default:\r\n                this.lastSelected = false;\r\n        }\r\n    }\r\n\r\n    handleBlur() {\r\n        this.isFocussed = false;\r\n        this.addOptionValue();\r\n    }\r\n\r\n    private addOptionValue() {\r\n        this.options = unique([...this.options, ...this.parseInputIntoOptions(this.input)]);\r\n        this.input = '';\r\n        this.onChangeFn(this.options);\r\n    }\r\n\r\n    private parseInputIntoOptions(input: string): Array<{ name: string; locked: boolean }> {\r\n        return input\r\n            .split(/[,\\n]/)\r\n            .map(s => s.trim())\r\n            .filter(s => s !== '')\r\n            .map(s => ({ name: s, locked: false }));\r\n    }\r\n\r\n    private removeLastOption() {\r\n        if (!this.options[this.options.length - 1].locked) {\r\n            this.options = this.options.slice(0, this.options.length - 1);\r\n        }\r\n    }\r\n}\r\n","<vdr-action-bar>\r\n    <vdr-ab-right>\r\n        <button\r\n            class=\"btn btn-primary\"\r\n            (click)=\"save()\"\r\n            [disabled]=\"!formValueChanged || getVariantsToAdd().length === 0\"\r\n        >\r\n            {{ 'common.add-new-variants' | translate: { count: getVariantsToAdd().length } }}\r\n        </button>\r\n    </vdr-ab-right>\r\n</vdr-action-bar>\r\n\r\n<div *ngFor=\"let group of optionGroups\" class=\"option-groups\">\r\n    <div class=\"name\">\r\n        <label>{{ 'catalog.option' | translate }}</label>\r\n        <input clrInput [(ngModel)]=\"group.name\" name=\"name\" [readonly]=\"!group.isNew\" />\r\n    </div>\r\n    <div class=\"values\">\r\n        <label>{{ 'catalog.option-values' | translate }}</label>\r\n        <vdr-option-value-input\r\n            #optionValueInputComponent\r\n            [(ngModel)]=\"group.values\"\r\n            (ngModelChange)=\"generateVariants()\"\r\n            [groupName]=\"group.name\"\r\n            [disabled]=\"group.name === ''\"\r\n        ></vdr-option-value-input>\r\n    </div>\r\n</div>\r\n<button\r\n    class=\"btn btn-primary-outline btn-sm\"\r\n    (click)=\"addOption()\"\r\n>\r\n    <clr-icon shape=\"plus\"></clr-icon>\r\n    {{ 'catalog.add-option' | translate }}\r\n</button>\r\n\r\n<div class=\"variants-preview\">\r\n    <table class=\"table\">\r\n        <thead>\r\n            <tr>\r\n                <th>{{ 'common.create' | translate }}</th>\r\n                <th>{{ 'catalog.variant' | translate }}</th>\r\n                <th>{{ 'catalog.sku' | translate }}</th>\r\n                <th>{{ 'catalog.price' | translate }}</th>\r\n                <th>{{ 'catalog.stock-on-hand' | translate }}</th>\r\n                <th></th>\r\n            </tr>\r\n        </thead>\r\n        <tr *ngFor=\"let variant of generatedVariants\" [class.disabled]=\"!variant.enabled || variant.existing\">\r\n            <td>\r\n                <input\r\n                    type=\"checkbox\"\r\n                    *ngIf=\"!variant.existing\"\r\n                    [(ngModel)]=\"variant.enabled\"\r\n                    name=\"enabled\"\r\n                    clrCheckbox\r\n                    (ngModelChange)=\"formValueChanged = true\"\r\n                />\r\n            </td>\r\n            <td>\r\n                {{ getVariantName(variant) | translate }}\r\n            </td>\r\n            <td>\r\n                <clr-input-container *ngIf=\"!variant.existing\">\r\n                    <input\r\n                        clrInput\r\n                        type=\"text\"\r\n                        [(ngModel)]=\"variant.sku\"\r\n                        [placeholder]=\"'catalog.sku' | translate\"\r\n                        name=\"sku\"\r\n                        required\r\n                        (ngModelChange)=\"onFormChanged(variant)\"\r\n                    />\r\n                </clr-input-container>\r\n                <span *ngIf=\"variant.existing\">{{ variant.sku }}</span>\r\n            </td>\r\n            <td>\r\n                <clr-input-container *ngIf=\"!variant.existing\">\r\n                    <vdr-currency-input\r\n                        clrInput\r\n                        [(ngModel)]=\"variant.price\"\r\n                        name=\"price\"\r\n                        [currencyCode]=\"currencyCode\"\r\n                        (ngModelChange)=\"onFormChanged(variant)\"\r\n                    ></vdr-currency-input>\r\n                </clr-input-container>\r\n                <span *ngIf=\"variant.existing\">{{ variant.price | localeCurrency: currencyCode }}</span>\r\n            </td>\r\n            <td>\r\n                <clr-input-container *ngIf=\"!variant.existing\">\r\n                    <input\r\n                        clrInput\r\n                        type=\"number\"\r\n                        [(ngModel)]=\"variant.stock\"\r\n                        name=\"stock\"\r\n                        min=\"0\"\r\n                        step=\"1\"\r\n                        (ngModelChange)=\"onFormChanged(variant)\"\r\n                    />\r\n                </clr-input-container>\r\n                <span *ngIf=\"variant.existing\">{{ variant.stock }}</span>\r\n            </td>\r\n            <td>\r\n                <vdr-dropdown *ngIf=\"variant.productVariantId as productVariantId\">\r\n                    <button class=\"icon-button\" vdrDropdownTrigger>\r\n                        <clr-icon shape=\"ellipsis-vertical\"></clr-icon>\r\n                    </button>\r\n                    <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                        <button\r\n                            type=\"button\"\r\n                            class=\"delete-button\"\r\n                            (click)=\"deleteVariant(productVariantId)\"\r\n                            vdrDropdownItem\r\n                        >\r\n                            <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                            {{ 'common.delete' | translate }}\r\n                        </button>\r\n                    </vdr-dropdown-menu>\r\n                </vdr-dropdown>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    CreateProductOptionGroup,\r\n    CreateProductOptionInput,\r\n    CurrencyCode,\r\n    DataService,\r\n    DeactivateAware,\r\n    getDefaultUiLanguage,\r\n    GetProductVariantOptions,\r\n    LanguageCode,\r\n    ModalService,\r\n    NotificationService,\r\n    ProductOptionGroupWithOptionsFragment,\r\n} from '@vendure/admin-ui/core';\r\nimport { normalizeString } from '@vendure/common/lib/normalize-string';\r\nimport { pick } from '@vendure/common/lib/pick';\r\nimport { generateAllCombinations, notNullOrUndefined } from '@vendure/common/lib/shared-utils';\r\nimport { unique } from '@vendure/common/lib/unique';\r\nimport { EMPTY, forkJoin, Observable, of } from 'rxjs';\r\nimport { filter, map, mergeMap, switchMap } from 'rxjs/operators';\r\n\r\nimport { ProductDetailService } from '../../providers/product-detail/product-detail.service';\r\nimport { ConfirmVariantDeletionDialogComponent } from '../confirm-variant-deletion-dialog/confirm-variant-deletion-dialog.component';\r\n\r\nexport class GeneratedVariant {\r\n    isDefault: boolean;\r\n    options: Array<{ name: string; id?: string }>;\r\n    productVariantId?: string;\r\n    enabled: boolean;\r\n    existing: boolean;\r\n    sku: string;\r\n    price: number;\r\n    stock: number;\r\n\r\n    constructor(config: Partial<GeneratedVariant>) {\r\n        for (const key of Object.keys(config)) {\r\n            this[key] = config[key];\r\n        }\r\n    }\r\n}\r\n\r\n@Component({\r\n    selector: 'vdr-product-variants-editor',\r\n    templateUrl: './product-variants-editor.component.html',\r\n    styleUrls: ['./product-variants-editor.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.Default,\r\n})\r\nexport class ProductVariantsEditorComponent implements OnInit, DeactivateAware {\r\n    formValueChanged = false;\r\n    generatedVariants: GeneratedVariant[] = [];\r\n    optionGroups: Array<{\r\n        id?: string;\r\n        isNew: boolean;\r\n        name: string;\r\n        values: Array<{\r\n            id?: string;\r\n            name: string;\r\n            locked: boolean;\r\n        }>;\r\n    }>;\r\n    product: GetProductVariantOptions.Product;\r\n    currencyCode: CurrencyCode;\r\n    private languageCode: LanguageCode;\r\n\r\n    constructor(\r\n        private route: ActivatedRoute,\r\n        private dataService: DataService,\r\n        private productDetailService: ProductDetailService,\r\n        private notificationService: NotificationService,\r\n        private modalService: ModalService,\r\n    ) {}\r\n\r\n    ngOnInit() {\r\n        this.initOptionsAndVariants();\r\n        this.languageCode =\r\n            (this.route.snapshot.paramMap.get('lang') as LanguageCode) || getDefaultUiLanguage();\r\n        this.dataService.settings.getActiveChannel().single$.subscribe(data => {\r\n            this.currencyCode = data.activeChannel.currencyCode;\r\n        });\r\n    }\r\n\r\n    onFormChanged(variantInfo: GeneratedVariant) {\r\n        this.formValueChanged = true;\r\n        variantInfo.enabled = true;\r\n    }\r\n\r\n    canDeactivate(): boolean {\r\n        return !this.formValueChanged;\r\n    }\r\n\r\n    getVariantsToAdd() {\r\n        return this.generatedVariants.filter(v => !v.existing && v.enabled);\r\n    }\r\n\r\n    getVariantName(variant: GeneratedVariant) {\r\n        return variant.options.length === 0\r\n            ? _('catalog.default-variant')\r\n            : variant.options.map(o => o.name).join(' ');\r\n    }\r\n\r\n    addOption() {\r\n        this.optionGroups.push({\r\n            isNew: true,\r\n            name: '',\r\n            values: [],\r\n        });\r\n    }\r\n\r\n    generateVariants() {\r\n        const groups = this.optionGroups.map(g => g.values);\r\n        const previousVariants = this.generatedVariants;\r\n        const generatedVariantFactory = (\r\n            isDefault: boolean,\r\n            options: GeneratedVariant['options'],\r\n            existingVariant?: GetProductVariantOptions.Variants,\r\n            prototypeVariant?: GetProductVariantOptions.Variants,\r\n        ): GeneratedVariant => {\r\n            const prototype = this.getVariantPrototype(options, previousVariants);\r\n            return new GeneratedVariant({\r\n                enabled: true,\r\n                existing: !!existingVariant,\r\n                productVariantId: existingVariant?.id,\r\n                isDefault,\r\n                options,\r\n                price: existingVariant?.price ?? prototypeVariant?.price ?? prototype.price,\r\n                sku: existingVariant?.sku ?? prototypeVariant?.sku ?? prototype.sku,\r\n                stock: existingVariant?.stockOnHand ?? prototypeVariant?.stockOnHand ?? prototype.stock,\r\n            });\r\n        };\r\n        this.generatedVariants = groups.length\r\n            ? generateAllCombinations(groups).map(options => {\r\n                  const existingVariant = this.product.variants.find(v =>\r\n                      this.optionsAreEqual(v.options, options),\r\n                  );\r\n                  const prototypeVariant = this.product.variants.find(v =>\r\n                      this.optionsAreSubset(v.options, options),\r\n                  );\r\n                  return generatedVariantFactory(false, options, existingVariant, prototypeVariant);\r\n              })\r\n            : [generatedVariantFactory(true, [], this.product.variants[0])];\r\n    }\r\n\r\n    /**\r\n     * Returns one of the existing variants to base the newly-generated variant's\r\n     * details off.\r\n     */\r\n    private getVariantPrototype(\r\n        options: GeneratedVariant['options'],\r\n        previousVariants: GeneratedVariant[],\r\n    ): Pick<GeneratedVariant, 'sku' | 'price' | 'stock'> {\r\n        const variantsWithSimilarOptions = previousVariants.filter(v =>\r\n            options.map(o => o.name).filter(name => v.options.map(o => o.name).includes(name)),\r\n        );\r\n        if (variantsWithSimilarOptions.length) {\r\n            return pick(previousVariants[0], ['sku', 'price', 'stock']);\r\n        }\r\n        return {\r\n            sku: '',\r\n            price: 0,\r\n            stock: 0,\r\n        };\r\n    }\r\n\r\n    deleteVariant(id: string) {\r\n        this.modalService\r\n            .dialog({\r\n                title: _('catalog.confirm-delete-product-variant'),\r\n                buttons: [\r\n                    { type: 'secondary', label: _('common.cancel') },\r\n                    { type: 'danger', label: _('common.delete'), returnValue: true },\r\n                ],\r\n            })\r\n            .pipe(\r\n                switchMap(response =>\r\n                    response ? this.productDetailService.deleteProductVariant(id, this.product.id) : EMPTY,\r\n                ),\r\n                switchMap(() => this.reFetchProduct(null)),\r\n            )\r\n            .subscribe(\r\n                () => {\r\n                    this.notificationService.success(_('common.notify-delete-success'), {\r\n                        entity: 'ProductVariant',\r\n                    });\r\n                    this.initOptionsAndVariants();\r\n                },\r\n                err => {\r\n                    this.notificationService.error(_('common.notify-delete-error'), {\r\n                        entity: 'ProductVariant',\r\n                    });\r\n                },\r\n            );\r\n    }\r\n\r\n    save() {\r\n        const newOptionGroups = this.optionGroups\r\n            .filter(og => og.isNew)\r\n            .map(og => ({\r\n                name: og.name,\r\n                values: [],\r\n            }));\r\n\r\n        this.checkUniqueSkus()\r\n            .pipe(\r\n                mergeMap(() => this.confirmDeletionOfObsoleteVariants()),\r\n                mergeMap(() =>\r\n                    this.productDetailService.createProductOptionGroups(newOptionGroups, this.languageCode),\r\n                ),\r\n                mergeMap(createdOptionGroups => this.addOptionGroupsToProduct(createdOptionGroups)),\r\n                mergeMap(createdOptionGroups => this.addNewOptionsToGroups(createdOptionGroups)),\r\n                mergeMap(groupsIds => this.fetchOptionGroups(groupsIds)),\r\n                mergeMap(groups => this.createNewProductVariants(groups)),\r\n                mergeMap(res => this.deleteObsoleteVariants(res.createProductVariants)),\r\n                mergeMap(variants => this.reFetchProduct(variants)),\r\n            )\r\n            .subscribe({\r\n                next: variants => {\r\n                    this.formValueChanged = false;\r\n                    this.notificationService.success(_('catalog.created-new-variants-success'), {\r\n                        count: variants.length,\r\n                    });\r\n                    this.initOptionsAndVariants();\r\n                },\r\n            });\r\n    }\r\n\r\n    private checkUniqueSkus() {\r\n        const withDuplicateSkus = this.generatedVariants.filter((variant, index) => {\r\n            return this.generatedVariants.find(gv => gv.sku.trim() === variant.sku.trim() && gv !== variant);\r\n        });\r\n        if (withDuplicateSkus.length) {\r\n            return this.modalService\r\n                .dialog({\r\n                    title: _('catalog.duplicate-sku-warning'),\r\n                    body: unique(withDuplicateSkus.map(v => `${v.sku}`)).join(', '),\r\n                    buttons: [{ label: _('common.close'), returnValue: false, type: 'primary' }],\r\n                })\r\n                .pipe(mergeMap(res => EMPTY));\r\n        } else {\r\n            return of(true);\r\n        }\r\n    }\r\n\r\n    private confirmDeletionOfObsoleteVariants(): Observable<boolean> {\r\n        const obsoleteVariants = this.getObsoleteVariants();\r\n        if (obsoleteVariants.length) {\r\n            return this.modalService\r\n                .fromComponent(ConfirmVariantDeletionDialogComponent, {\r\n                    locals: {\r\n                        variants: obsoleteVariants,\r\n                    },\r\n                })\r\n                .pipe(\r\n                    mergeMap(res => {\r\n                        return res === true ? of(true) : EMPTY;\r\n                    }),\r\n                );\r\n        } else {\r\n            return of(true);\r\n        }\r\n    }\r\n\r\n    private getObsoleteVariants() {\r\n        return this.product.variants.filter(\r\n            variant => !this.generatedVariants.find(gv => gv.productVariantId === variant.id),\r\n        );\r\n    }\r\n\r\n    private hasOnlyDefaultVariant(product: GetProductVariantOptions.Product): boolean {\r\n        return product.variants.length === 1 && product.optionGroups.length === 0;\r\n    }\r\n\r\n    private addOptionGroupsToProduct(\r\n        createdOptionGroups: CreateProductOptionGroup.CreateProductOptionGroup[],\r\n    ): Observable<CreateProductOptionGroup.CreateProductOptionGroup[]> {\r\n        if (createdOptionGroups.length) {\r\n            return forkJoin(\r\n                createdOptionGroups.map(optionGroup => {\r\n                    return this.dataService.product.addOptionGroupToProduct({\r\n                        productId: this.product.id,\r\n                        optionGroupId: optionGroup.id,\r\n                    });\r\n                }),\r\n            ).pipe(map(() => createdOptionGroups));\r\n        } else {\r\n            return of([]);\r\n        }\r\n    }\r\n\r\n    private addNewOptionsToGroups(\r\n        createdOptionGroups: CreateProductOptionGroup.CreateProductOptionGroup[],\r\n    ): Observable<string[]> {\r\n        const newOptions: CreateProductOptionInput[] = this.optionGroups\r\n            .map(og => {\r\n                const createdGroup = createdOptionGroups.find(cog => cog.name === og.name);\r\n                const productOptionGroupId = createdGroup ? createdGroup.id : og.id;\r\n                if (!productOptionGroupId) {\r\n                    throw new Error('Could not get a productOptionGroupId');\r\n                }\r\n                return og.values\r\n                    .filter(v => !v.locked)\r\n                    .map(v => ({\r\n                        productOptionGroupId,\r\n                        code: normalizeString(v.name, '-'),\r\n                        translations: [{ name: v.name, languageCode: this.languageCode }],\r\n                    }));\r\n            })\r\n            .reduce((flat, options) => [...flat, ...options], []);\r\n\r\n        const allGroupIds = [\r\n            ...createdOptionGroups.map(g => g.id),\r\n            ...this.optionGroups.map(g => g.id).filter(notNullOrUndefined),\r\n        ];\r\n\r\n        if (newOptions.length) {\r\n            return forkJoin(newOptions.map(input => this.dataService.product.addOptionToGroup(input))).pipe(\r\n                map(() => allGroupIds),\r\n            );\r\n        } else {\r\n            return of(allGroupIds);\r\n        }\r\n    }\r\n\r\n    private fetchOptionGroups(groupsIds: string[]): Observable<ProductOptionGroupWithOptionsFragment[]> {\r\n        return forkJoin(\r\n            groupsIds.map(id =>\r\n                this.dataService.product\r\n                    .getProductOptionGroup(id)\r\n                    .mapSingle(data => data.productOptionGroup)\r\n                    .pipe(filter(notNullOrUndefined)),\r\n            ),\r\n        );\r\n    }\r\n\r\n    private createNewProductVariants(groups: ProductOptionGroupWithOptionsFragment[]) {\r\n        const options = groups\r\n            .filter(notNullOrUndefined)\r\n            .map(og => og.options)\r\n            .reduce((flat, o) => [...flat, ...o], []);\r\n        const variants = this.generatedVariants\r\n            .filter(v => v.enabled && !v.existing)\r\n            .map(v => ({\r\n                price: v.price,\r\n                sku: v.sku,\r\n                stock: v.stock,\r\n                optionIds: v.options\r\n                    .map(name => options.find(o => o.name === name.name))\r\n                    .filter(notNullOrUndefined)\r\n                    .map(o => o.id),\r\n            }));\r\n        return this.productDetailService.createProductVariants(\r\n            this.product,\r\n            variants,\r\n            options,\r\n            this.languageCode,\r\n        );\r\n    }\r\n\r\n    private deleteObsoleteVariants<T>(input: T): Observable<T> {\r\n        const obsoleteVariants = this.getObsoleteVariants();\r\n        if (obsoleteVariants.length) {\r\n            const deleteOperations = obsoleteVariants.map(v =>\r\n                this.dataService.product.deleteProductVariant(v.id).pipe(map(() => input)),\r\n            );\r\n            return forkJoin(...deleteOperations);\r\n        } else {\r\n            return of(input);\r\n        }\r\n    }\r\n\r\n    private reFetchProduct<T>(input: T): Observable<T> {\r\n        // Re-fetch the Product to force an update to the view.\r\n        const id = this.route.snapshot.paramMap.get('id');\r\n        if (id) {\r\n            return this.dataService.product.getProduct(id).single$.pipe(map(() => input));\r\n        } else {\r\n            return of(input);\r\n        }\r\n    }\r\n\r\n    initOptionsAndVariants() {\r\n        this.dataService.product\r\n            // tslint:disable-next-line:no-non-null-assertion\r\n            .getProductVariantsOptions(this.route.snapshot.paramMap.get('id')!)\r\n            // tslint:disable-next-line:no-non-null-assertion\r\n            .mapSingle(({ product }) => product!)\r\n            .subscribe(p => {\r\n                this.product = p;\r\n                this.optionGroups = p.optionGroups.map(og => {\r\n                    return {\r\n                        id: og.id,\r\n                        isNew: false,\r\n                        name: og.name,\r\n                        values: og.options.map(o => ({\r\n                            id: o.id,\r\n                            name: o.name,\r\n                            locked: true,\r\n                        })),\r\n                    };\r\n                });\r\n                this.generateVariants();\r\n            });\r\n    }\r\n\r\n    private optionsAreEqual(a: Array<{ name: string }>, b: Array<{ name: string }>): boolean {\r\n        return this.toOptionString(a) === this.toOptionString(b);\r\n    }\r\n\r\n    private optionsAreSubset(a: Array<{ name: string }>, b: Array<{ name: string }>): boolean {\r\n        return this.toOptionString(b).includes(this.toOptionString(a));\r\n    }\r\n\r\n    private toOptionString(o: Array<{ name: string }>): string {\r\n        return o\r\n            .map(x => x.name)\r\n            .sort()\r\n            .join('|');\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { Asset, AssetType, BaseEntityResolver } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class AssetResolver extends BaseEntityResolver<Asset.Fragment> {\r\n    constructor(router: Router, dataService: DataService) {\r\n        super(\r\n            router,\r\n            {\r\n                __typename: 'Asset' as const,\r\n                id: '',\r\n                createdAt: '',\r\n                updatedAt: '',\r\n                name: '',\r\n                type: AssetType.IMAGE,\r\n                fileSize: 0,\r\n                mimeType: '',\r\n                width: 0,\r\n                height: 0,\r\n                source: '',\r\n                preview: '',\r\n                focalPoint: null,\r\n            },\r\n            id => dataService.product.getAsset(id).mapStream(data => data.asset),\r\n        );\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { BaseEntityResolver } from '@vendure/admin-ui/core';\r\nimport { Collection, ProductWithVariants } from '@vendure/admin-ui/core';\r\nimport { getDefaultUiLanguage } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class CollectionResolver extends BaseEntityResolver<Collection.Fragment> {\r\n    constructor(router: Router, dataService: DataService) {\r\n        super(\r\n            router,\r\n            {\r\n                __typename: 'Collection' as 'Collection',\r\n                id: '',\r\n                createdAt: '',\r\n                updatedAt: '',\r\n                languageCode: getDefaultUiLanguage(),\r\n                name: '',\r\n                slug: '',\r\n                isPrivate: false,\r\n                description: '',\r\n                featuredAsset: null,\r\n                assets: [],\r\n                translations: [],\r\n                filters: [],\r\n                parent: {} as any,\r\n                children: null,\r\n            },\r\n            id => dataService.collection.getCollection(id).mapStream(data => data.collection),\r\n        );\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { BaseEntityResolver } from '@vendure/admin-ui/core';\r\nimport { FacetWithValues } from '@vendure/admin-ui/core';\r\nimport { getDefaultUiLanguage } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class FacetResolver extends BaseEntityResolver<FacetWithValues.Fragment> {\r\n    constructor(router: Router, dataService: DataService) {\r\n        super(\r\n            router,\r\n            {\r\n                __typename: 'Facet' as 'Facet',\r\n                id: '',\r\n                createdAt: '',\r\n                updatedAt: '',\r\n                isPrivate: false,\r\n                languageCode: getDefaultUiLanguage(),\r\n                name: '',\r\n                code: '',\r\n                translations: [],\r\n                values: [],\r\n            },\r\n            (id) => dataService.facet.getFacet(id).mapStream((data) => data.facet),\r\n        );\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { BaseEntityResolver } from '@vendure/admin-ui/core';\r\nimport { ProductWithVariants } from '@vendure/admin-ui/core';\r\nimport { getDefaultUiLanguage } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class ProductResolver extends BaseEntityResolver<ProductWithVariants.Fragment> {\r\n    constructor(dataService: DataService, router: Router) {\r\n        super(\r\n            router,\r\n            {\r\n                __typename: 'Product' as 'Product',\r\n                id: '',\r\n                createdAt: '',\r\n                updatedAt: '',\r\n                enabled: true,\r\n                languageCode: getDefaultUiLanguage(),\r\n                name: '',\r\n                slug: '',\r\n                featuredAsset: null,\r\n                assets: [],\r\n                description: '',\r\n                translations: [],\r\n                optionGroups: [],\r\n                facetValues: [],\r\n                variants: [],\r\n                channels: [],\r\n            },\r\n            (id) =>\r\n                dataService.product\r\n                    .getProduct(id)\r\n                    .refetchOnChannelChange()\r\n                    .mapStream((data) => data.product),\r\n        );\r\n    }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { BaseEntityResolver } from '@vendure/admin-ui/core';\r\nimport { GetProductVariantOptions } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\n\r\n@Injectable({\r\n    providedIn: 'root',\r\n})\r\nexport class ProductVariantsResolver extends BaseEntityResolver<GetProductVariantOptions.Product> {\r\n    constructor(router: Router, dataService: DataService) {\r\n        super(\r\n            router,\r\n            {\r\n                __typename: 'Product' as 'Product',\r\n                id: '',\r\n                createdAt: '',\r\n                updatedAt: '',\r\n                name: '',\r\n                optionGroups: [],\r\n                variants: [],\r\n            },\r\n            id => dataService.product.getProductVariantsOptions(id).mapStream(data => data.product),\r\n        );\r\n    }\r\n}\r\n","import { Route } from '@angular/router';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    Asset,\r\n    CanDeactivateDetailGuard,\r\n    Collection,\r\n    createResolveData,\r\n    detailBreadcrumb,\r\n    FacetWithValues,\r\n    ProductWithVariants,\r\n} from '@vendure/admin-ui/core';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { AssetDetailComponent } from './components/asset-detail/asset-detail.component';\r\nimport { AssetListComponent } from './components/asset-list/asset-list.component';\r\nimport { CollectionDetailComponent } from './components/collection-detail/collection-detail.component';\r\nimport { CollectionListComponent } from './components/collection-list/collection-list.component';\r\nimport { FacetDetailComponent } from './components/facet-detail/facet-detail.component';\r\nimport { FacetListComponent } from './components/facet-list/facet-list.component';\r\nimport { ProductDetailComponent } from './components/product-detail/product-detail.component';\r\nimport { ProductListComponent } from './components/product-list/product-list.component';\r\nimport { ProductVariantsEditorComponent } from './components/product-variants-editor/product-variants-editor.component';\r\nimport { AssetResolver } from './providers/routing/asset-resolver';\r\nimport { CollectionResolver } from './providers/routing/collection-resolver';\r\nimport { FacetResolver } from './providers/routing/facet-resolver';\r\nimport { ProductResolver } from './providers/routing/product-resolver';\r\nimport { ProductVariantsResolver } from './providers/routing/product-variants-resolver';\r\n\r\nexport const catalogRoutes: Route[] = [\r\n    {\r\n        path: 'products',\r\n        component: ProductListComponent,\r\n        data: {\r\n            breadcrumb: _('breadcrumb.products'),\r\n        },\r\n    },\r\n    {\r\n        path: 'products/:id',\r\n        component: ProductDetailComponent,\r\n        resolve: createResolveData(ProductResolver),\r\n        canDeactivate: [CanDeactivateDetailGuard],\r\n        data: {\r\n            breadcrumb: productBreadcrumb,\r\n        },\r\n    },\r\n    {\r\n        path: 'products/:id/manage-variants',\r\n        component: ProductVariantsEditorComponent,\r\n        resolve: createResolveData(ProductVariantsResolver),\r\n        canDeactivate: [CanDeactivateDetailGuard],\r\n        data: {\r\n            breadcrumb: productVariantEditorBreadcrumb,\r\n        },\r\n    },\r\n    {\r\n        path: 'facets',\r\n        component: FacetListComponent,\r\n        data: {\r\n            breadcrumb: _('breadcrumb.facets'),\r\n        },\r\n    },\r\n    {\r\n        path: 'facets/:id',\r\n        component: FacetDetailComponent,\r\n        resolve: createResolveData(FacetResolver),\r\n        canDeactivate: [CanDeactivateDetailGuard],\r\n        data: {\r\n            breadcrumb: facetBreadcrumb,\r\n        },\r\n    },\r\n    {\r\n        path: 'collections',\r\n        component: CollectionListComponent,\r\n        data: {\r\n            breadcrumb: _('breadcrumb.collections'),\r\n        },\r\n    },\r\n    {\r\n        path: 'collections/:id',\r\n        component: CollectionDetailComponent,\r\n        resolve: createResolveData(CollectionResolver),\r\n        canDeactivate: [CanDeactivateDetailGuard],\r\n        data: {\r\n            breadcrumb: collectionBreadcrumb,\r\n        },\r\n    },\r\n    {\r\n        path: 'assets',\r\n        component: AssetListComponent,\r\n        data: {\r\n            breadcrumb: _('breadcrumb.assets'),\r\n        },\r\n    },\r\n    {\r\n        path: 'assets/:id',\r\n        component: AssetDetailComponent,\r\n        resolve: createResolveData(AssetResolver),\r\n        data: {\r\n            breadcrumb: assetBreadcrumb,\r\n        },\r\n    },\r\n];\r\n\r\nexport function productBreadcrumb(data: any, params: any) {\r\n    return detailBreadcrumb<ProductWithVariants.Fragment>({\r\n        entity: data.entity,\r\n        id: params.id,\r\n        breadcrumbKey: 'breadcrumb.products',\r\n        getName: product => product.name,\r\n        route: 'products',\r\n    });\r\n}\r\n\r\nexport function productVariantEditorBreadcrumb(data: any, params: any) {\r\n    return data.entity.pipe(\r\n        map((entity: any) => {\r\n            return [\r\n                {\r\n                    label: _('breadcrumb.products'),\r\n                    link: ['../', 'products'],\r\n                },\r\n                {\r\n                    label: `${entity.name}`,\r\n                    link: ['../', 'products', params.id, { tab: 'variants' }],\r\n                },\r\n                {\r\n                    label: _('breadcrumb.manage-variants'),\r\n                    link: ['manage-variants'],\r\n                },\r\n            ];\r\n        }),\r\n    );\r\n}\r\n\r\nexport function facetBreadcrumb(data: any, params: any) {\r\n    return detailBreadcrumb<FacetWithValues.Fragment>({\r\n        entity: data.entity,\r\n        id: params.id,\r\n        breadcrumbKey: 'breadcrumb.facets',\r\n        getName: facet => facet.name,\r\n        route: 'facets',\r\n    });\r\n}\r\n\r\nexport function collectionBreadcrumb(data: any, params: any) {\r\n    return detailBreadcrumb<Collection.Fragment>({\r\n        entity: data.entity,\r\n        id: params.id,\r\n        breadcrumbKey: 'breadcrumb.collections',\r\n        getName: collection => collection.name,\r\n        route: 'collections',\r\n    });\r\n}\r\n\r\nexport function assetBreadcrumb(data: any, params: any) {\r\n    return detailBreadcrumb<Asset.Fragment>({\r\n        entity: data.entity,\r\n        id: params.id,\r\n        breadcrumbKey: 'breadcrumb.assets',\r\n        getName: asset => asset.name,\r\n        route: 'assets',\r\n    });\r\n}\r\n","<div\r\n    cdkDropList\r\n    class=\"tree-node\"\r\n    #dropList\r\n    [cdkDropListData]=\"collectionTree\"\r\n    [cdkDropListDisabled]=\"!(hasUpdatePermission$ | async)\"\r\n    (cdkDropListDropped)=\"drop($event)\"\r\n>\r\n    <div\r\n        class=\"collection\"\r\n        [class.private]=\"collection.isPrivate\"\r\n        *ngFor=\"let collection of collectionTree.children; index as i; trackBy: trackByFn\"\r\n        cdkDrag\r\n        [cdkDragData]=\"collection\"\r\n    >\r\n        <div\r\n            class=\"collection-detail\"\r\n            [ngClass]=\"'depth-' + depth\"\r\n            [class.active]=\"collection.id === activeCollectionId\"\r\n        >\r\n            <div class=\"name\">\r\n                <button\r\n                    class=\"icon-button folder-button\"\r\n                    [disabled]=\"expandAll\"\r\n                    *ngIf=\"collection.children?.length; else folderSpacer\"\r\n                    (click)=\"collection.expanded = !collection.expanded\"\r\n                >\r\n                    <clr-icon shape=\"folder\" *ngIf=\"!collection.expanded && !expandAll\"></clr-icon>\r\n                    <clr-icon shape=\"folder-open\" *ngIf=\"collection.expanded || expandAll\"></clr-icon>\r\n                </button>\r\n                <ng-template #folderSpacer>\r\n                    <div class=\"folder-button-spacer\"></div>\r\n                </ng-template>\r\n                {{ collection.name }}\r\n            </div>\r\n            <div class=\"flex-spacer\"></div>\r\n            <vdr-chip *ngIf=\"collection.isPrivate\">{{ 'catalog.private' | translate }}</vdr-chip>\r\n            <a\r\n                class=\"btn btn-link btn-sm\"\r\n                [routerLink]=\"['./', { contents: collection.id }]\"\r\n                queryParamsHandling=\"preserve\"\r\n            >\r\n                <clr-icon shape=\"view-list\"></clr-icon>\r\n                {{ 'catalog.view-contents' | translate }}\r\n            </a>\r\n            <a class=\"btn btn-link btn-sm\" [routerLink]=\"['/catalog/collections/', collection.id]\">\r\n                <clr-icon shape=\"edit\"></clr-icon>\r\n                {{ 'common.edit' | translate }}\r\n            </a>\r\n            <div class=\"drag-handle\" cdkDragHandle *vdrIfPermissions=\"['UpdateCatalog', 'UpdateCollection']\">\r\n                <clr-icon shape=\"drag-handle\" size=\"24\"></clr-icon>\r\n            </div>\r\n            <vdr-dropdown>\r\n                <button class=\"icon-button\" vdrDropdownTrigger>\r\n                    <clr-icon shape=\"ellipsis-vertical\"></clr-icon>\r\n                </button>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <a\r\n                        class=\"dropdown-item\"\r\n                        [routerLink]=\"['./', 'create', { parentId: collection.id }]\"\r\n                        *vdrIfPermissions=\"['CreateCatalog', 'CreateCollection']\"\r\n                    >\r\n                        <clr-icon shape=\"plus\"></clr-icon>\r\n                        {{ 'catalog.create-new-collection' | translate }}\r\n                    </a>\r\n                    <div class=\"dropdown-divider\"></div>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        [disabled]=\"i === 0 || !(hasUpdatePermission$ | async)\"\r\n                        (click)=\"moveUp(collection, i)\"\r\n                    >\r\n                        <clr-icon shape=\"caret up\"></clr-icon>\r\n                        {{ 'catalog.move-up' | translate }}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        [disabled]=\"\r\n                            i === collectionTree.children.length - 1 || !(hasUpdatePermission$ | async)\r\n                        \"\r\n                        (click)=\"moveDown(collection, i)\"\r\n                    >\r\n                        <clr-icon shape=\"caret down\"></clr-icon>\r\n                        {{ 'catalog.move-down' | translate }}\r\n                    </button>\r\n                    <h4 class=\"dropdown-header\">{{ 'catalog.move-to' | translate }}</h4>\r\n                    <button\r\n                        type=\"button\"\r\n                        vdrDropdownItem\r\n                        *ngFor=\"let item of getMoveListItems(collection)\"\r\n                        (click)=\"move(collection, item.id)\"\r\n                        [disabled]=\"!(hasUpdatePermission$ | async)\"\r\n                    >\r\n                        <clr-icon shape=\"child-arrow\"></clr-icon>\r\n                        {{ item.path }}\r\n                    </button>\r\n                    <div class=\"dropdown-divider\"></div>\r\n                    <button\r\n                        class=\"button\"\r\n                        vdrDropdownItem\r\n                        (click)=\"delete(collection.id)\"\r\n                        [disabled]=\"!(hasDeletePermission$ | async)\"\r\n                    >\r\n                        <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                        {{ 'common.delete' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </div>\r\n        <vdr-collection-tree-node\r\n            *ngIf=\"collection.expanded || expandAll\"\r\n            [expandAll]=\"expandAll\"\r\n            [collectionTree]=\"collection\"\r\n            [activeCollectionId]=\"activeCollectionId\"\r\n        ></vdr-collection-tree-node>\r\n    </div>\r\n</div>\r\n","import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\nimport {\r\n    ChangeDetectionStrategy,\r\n    Component,\r\n    Input,\r\n    OnChanges,\r\n    OnInit,\r\n    Optional,\r\n    SimpleChanges,\r\n    SkipSelf,\r\n} from '@angular/core';\r\nimport { DataService, Permission } from '@vendure/admin-ui/core';\r\nimport { Observable } from 'rxjs';\r\nimport { map, shareReplay } from 'rxjs/operators';\r\n\r\nimport { RootNode, TreeNode } from './array-to-tree';\r\nimport { CollectionPartial, CollectionTreeComponent } from './collection-tree.component';\r\n\r\n@Component({\r\n    selector: 'vdr-collection-tree-node',\r\n    templateUrl: './collection-tree-node.component.html',\r\n    styleUrls: ['./collection-tree-node.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class CollectionTreeNodeComponent implements OnInit, OnChanges {\r\n    depth = 0;\r\n    parentName: string;\r\n    @Input() collectionTree: TreeNode<CollectionPartial>;\r\n    @Input() activeCollectionId: string;\r\n    @Input() expandAll = false;\r\n    hasUpdatePermission$: Observable<boolean>;\r\n    hasDeletePermission$: Observable<boolean>;\r\n\r\n    constructor(\r\n        @SkipSelf() @Optional() private parent: CollectionTreeNodeComponent,\r\n        private root: CollectionTreeComponent,\r\n        private dataService: DataService,\r\n    ) {\r\n        if (parent) {\r\n            this.depth = parent.depth + 1;\r\n        }\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.parentName = this.collectionTree.name || '<root>';\r\n        const permissions$ = this.dataService.client\r\n            .userStatus()\r\n            .mapStream(data => data.userStatus.permissions)\r\n            .pipe(shareReplay(1));\r\n        this.hasUpdatePermission$ = permissions$.pipe(\r\n            map(\r\n                perms =>\r\n                    perms.includes(Permission.UpdateCatalog) || perms.includes(Permission.UpdateCollection),\r\n            ),\r\n        );\r\n        this.hasDeletePermission$ = permissions$.pipe(\r\n            map(\r\n                perms =>\r\n                    perms.includes(Permission.DeleteCatalog) || perms.includes(Permission.DeleteCollection),\r\n            ),\r\n        );\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        const expandAllChange = changes['expandAll'];\r\n        if (expandAllChange) {\r\n            if (expandAllChange.previousValue === true && expandAllChange.currentValue === false) {\r\n                this.collectionTree.children.forEach(c => (c.expanded = false));\r\n            }\r\n        }\r\n    }\r\n\r\n    trackByFn(index: number, item: CollectionPartial) {\r\n        return item.id;\r\n    }\r\n\r\n    getMoveListItems(collection: CollectionPartial): Array<{ path: string; id: string }> {\r\n        const visit = (\r\n            node: TreeNode<any>,\r\n            parentPath: string[],\r\n            output: Array<{ path: string; id: string }>,\r\n        ) => {\r\n            if (node.id !== collection.id) {\r\n                const path = parentPath.concat(node.name);\r\n                const parentId = collection.parent && collection.parent.id;\r\n                if (node.id !== parentId) {\r\n                    output.push({ path: path.slice(1).join(' / ') || 'root', id: node.id });\r\n                }\r\n                node.children.forEach(child => visit(child, path, output));\r\n            }\r\n            return output;\r\n        };\r\n        return visit(this.root.collectionTree, [], []);\r\n    }\r\n\r\n    move(collection: CollectionPartial, parentId: string) {\r\n        this.root.onMove({\r\n            index: 0,\r\n            parentId,\r\n            collectionId: collection.id,\r\n        });\r\n    }\r\n\r\n    moveUp(collection: CollectionPartial, currentIndex: number) {\r\n        if (!collection.parent) {\r\n            return;\r\n        }\r\n        this.root.onMove({\r\n            index: currentIndex - 1,\r\n            parentId: collection.parent.id,\r\n            collectionId: collection.id,\r\n        });\r\n    }\r\n\r\n    moveDown(collection: CollectionPartial, currentIndex: number) {\r\n        if (!collection.parent) {\r\n            return;\r\n        }\r\n        this.root.onMove({\r\n            index: currentIndex + 1,\r\n            parentId: collection.parent.id,\r\n            collectionId: collection.id,\r\n        });\r\n    }\r\n\r\n    drop(event: CdkDragDrop<CollectionPartial | RootNode<CollectionPartial>>) {\r\n        moveItemInArray(this.collectionTree.children, event.previousIndex, event.currentIndex);\r\n        this.root.onDrop(event);\r\n    }\r\n\r\n    delete(id: string) {\r\n        this.root.onDelete(id);\r\n    }\r\n}\r\n","<div *ngFor=\"let group of optionGroups\" class=\"option-groups\">\r\n    <div class=\"name\">\r\n        <label>{{ 'catalog.option' | translate }}</label>\r\n        <input\r\n            placeholder=\"e.g. Size\"\r\n            clrInput\r\n            [(ngModel)]=\"group.name\"\r\n            name=\"name\"\r\n            required\r\n            (keydown.enter)=\"handleEnter($event, optionValueInputComponent)\"\r\n        />\r\n    </div>\r\n    <div class=\"values\">\r\n        <label>{{ 'catalog.option-values' | translate }}</label>\r\n        <vdr-option-value-input\r\n            #optionValueInputComponent\r\n            [(ngModel)]=\"group.values\"\r\n            (ngModelChange)=\"generateVariants()\"\r\n            [groupName]=\"group.name\"\r\n            [disabled]=\"group.name === ''\"\r\n        ></vdr-option-value-input>\r\n    </div>\r\n    <div class=\"remove-group\">\r\n        <button\r\n            class=\"btn btn-icon btn-warning-outline\"\r\n            [title]=\"'catalog.remove-option' | translate\"\r\n            (click)=\"removeOption(group.name)\"\r\n        >\r\n            <clr-icon shape=\"trash\"></clr-icon>\r\n        </button>\r\n    </div>\r\n</div>\r\n<button class=\"btn btn-primary-outline btn-sm\" (click)=\"addOption()\">\r\n    <clr-icon shape=\"plus\"></clr-icon>\r\n    {{ 'catalog.add-option' | translate }}\r\n</button>\r\n\r\n<div class=\"variants-preview\">\r\n    <table class=\"table\">\r\n        <thead>\r\n            <tr>\r\n                <th *ngIf=\"1 < variants.length\">{{ 'common.create' | translate }}</th>\r\n                <th *ngIf=\"1 < variants.length\">{{ 'catalog.variant' | translate }}</th>\r\n                <th>{{ 'catalog.sku' | translate }}</th>\r\n                <th>{{ 'catalog.price' | translate }}</th>\r\n                <th>{{ 'catalog.stock-on-hand' | translate }}</th>\r\n            </tr>\r\n        </thead>\r\n        <tr\r\n            *ngFor=\"let variant of variants; trackBy: trackByFn\"\r\n            [class.disabled]=\"!variantFormValues[variant.id].enabled\"\r\n        >\r\n            <td *ngIf=\"1 < variants.length\">\r\n                <input\r\n                    type=\"checkbox\"\r\n                    (change)=\"onFormChange()\"\r\n                    [(ngModel)]=\"variantFormValues[variant.id].enabled\"\r\n                    clrCheckbox\r\n                />\r\n            </td>\r\n            <td *ngIf=\"1 < variants.length\">\r\n                {{ variant.values.join(' ') }}\r\n            </td>\r\n            <td>\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"text\"\r\n                        (change)=\"onFormChange()\"\r\n                        [(ngModel)]=\"variantFormValues[variant.id].sku\"\r\n                        [placeholder]=\"'catalog.sku' | translate\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n            <td>\r\n                <clr-input-container>\r\n                    <vdr-currency-input\r\n                        clrInput\r\n                        [(ngModel)]=\"variantFormValues[variant.id].price\"\r\n                        (ngModelChange)=\"onFormChange()\"\r\n                        [currencyCode]=\"currencyCode\"\r\n                    ></vdr-currency-input>\r\n                </clr-input-container>\r\n            </td>\r\n            <td>\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"number\"\r\n                        [(ngModel)]=\"variantFormValues[variant.id].stock\"\r\n                        (change)=\"onFormChange()\"\r\n                        min=\"0\"\r\n                        step=\"1\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n","import { Component, EventEmitter, OnInit, Output } from '@angular/core';\r\nimport { generateAllCombinations } from '@vendure/common/lib/shared-utils';\r\n\r\nimport { CurrencyCode } from '@vendure/admin-ui/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\nimport { OptionValueInputComponent } from '../option-value-input/option-value-input.component';\r\n\r\nconst DEFAULT_VARIANT_CODE = '__DEFAULT_VARIANT__';\r\nexport type CreateVariantValues = {\r\n    optionValues: string[];\r\n    enabled: boolean;\r\n    sku: string;\r\n    price: number;\r\n    stock: number;\r\n};\r\nexport type CreateProductVariantsConfig = {\r\n    groups: Array<{ name: string; values: string[] }>;\r\n    variants: CreateVariantValues[];\r\n};\r\n\r\n@Component({\r\n    selector: 'vdr-generate-product-variants',\r\n    templateUrl: './generate-product-variants.component.html',\r\n    styleUrls: ['./generate-product-variants.component.scss'],\r\n})\r\nexport class GenerateProductVariantsComponent implements OnInit {\r\n    @Output() variantsChange = new EventEmitter<CreateProductVariantsConfig>();\r\n    optionGroups: Array<{ name: string; values: Array<{ name: string; locked: boolean }> }> = [];\r\n    currencyCode: CurrencyCode;\r\n    variants: Array<{ id: string; values: string[] }>;\r\n    variantFormValues: { [id: string]: CreateVariantValues } = {};\r\n    constructor(private dataService: DataService) {}\r\n\r\n    ngOnInit() {\r\n        this.dataService.settings.getActiveChannel().single$.subscribe(data => {\r\n            this.currencyCode = data.activeChannel.currencyCode;\r\n        });\r\n\r\n        this.generateVariants();\r\n    }\r\n\r\n    addOption() {\r\n        this.optionGroups.push({ name: '', values: [] });\r\n    }\r\n\r\n    removeOption(name: string) {\r\n        this.optionGroups = this.optionGroups.filter(g => g.name !== name);\r\n        this.generateVariants();\r\n    }\r\n\r\n    generateVariants() {\r\n        const totalValuesCount = this.optionGroups.reduce((sum, group) => sum + group.values.length, 0);\r\n        const groups = totalValuesCount\r\n            ? this.optionGroups.map(g => g.values.map(v => v.name))\r\n            : [[DEFAULT_VARIANT_CODE]];\r\n        this.variants = generateAllCombinations(groups).map(values => ({ id: values.join('|'), values }));\r\n\r\n        this.variants.forEach(variant => {\r\n            if (!this.variantFormValues[variant.id]) {\r\n                this.variantFormValues[variant.id] = {\r\n                    optionValues: variant.values,\r\n                    enabled: true,\r\n                    price: this.copyFromDefault(variant.id, 'price', 0),\r\n                    sku: this.copyFromDefault(variant.id, 'sku', ''),\r\n                    stock: this.copyFromDefault(variant.id, 'stock', 0),\r\n                };\r\n            }\r\n        });\r\n        this.onFormChange();\r\n    }\r\n\r\n    trackByFn(index: number, variant: { name: string; values: string[] }) {\r\n        return variant.values.join('|');\r\n    }\r\n\r\n    handleEnter(event: KeyboardEvent, optionValueInputComponent: OptionValueInputComponent) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        optionValueInputComponent.focus();\r\n    }\r\n\r\n    onFormChange() {\r\n        const variantsToCreate = this.variants.map(v => this.variantFormValues[v.id]).filter(v => v.enabled);\r\n        this.variantsChange.emit({\r\n            groups: this.optionGroups.map(og => ({ name: og.name, values: og.values.map(v => v.name) })),\r\n            variants: variantsToCreate,\r\n        });\r\n    }\r\n\r\n    private copyFromDefault<T extends keyof CreateVariantValues>(\r\n        variantId: string,\r\n        prop: T,\r\n        value: CreateVariantValues[T],\r\n    ): CreateVariantValues[T] {\r\n        return variantId !== DEFAULT_VARIANT_CODE\r\n            ? this.variantFormValues[DEFAULT_VARIANT_CODE][prop]\r\n            : value;\r\n    }\r\n}\r\n","<div class=\"card\" *ngIf=\"!compact; else compactView\">\r\n    <div class=\"card-img\">\r\n        <div class=\"featured-asset\">\r\n            <img\r\n                *ngIf=\"featuredAsset\"\r\n                [src]=\"featuredAsset | assetPreview:'small'\"\r\n                (click)=\"previewAsset(featuredAsset)\"\r\n            />\r\n            <div class=\"placeholder\" *ngIf=\"!featuredAsset\" (click)=\"selectAssets()\">\r\n                <clr-icon shape=\"image\" size=\"128\"></clr-icon>\r\n                <div>{{ 'catalog.no-featured-asset' | translate }}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class=\"card-block\"><ng-container *ngTemplateOutlet=\"assetList\"></ng-container></div>\r\n    <div class=\"card-footer\" *vdrIfPermissions=\"updatePermissions\">\r\n        <button class=\"btn\" (click)=\"selectAssets()\">\r\n            <clr-icon shape=\"attachment\"></clr-icon>\r\n            {{ 'asset.add-asset' | translate }}\r\n        </button>\r\n    </div>\r\n</div>\r\n\r\n<ng-template #compactView>\r\n    <div class=\"featured-asset compact\">\r\n        <img\r\n            *ngIf=\"featuredAsset\"\r\n            [src]=\"featuredAsset | assetPreview:'thumb'\"\r\n            (click)=\"previewAsset(featuredAsset)\"\r\n        />\r\n\r\n        <div class=\"placeholder\" *ngIf=\"!featuredAsset\" (click)=\"selectAssets()\"><clr-icon shape=\"image\" size=\"150\"></clr-icon></div>\r\n    </div>\r\n    <ng-container *ngTemplateOutlet=\"assetList\"></ng-container>\r\n    <button\r\n        *vdrIfPermissions=\"updatePermissions\"\r\n        class=\"compact-select btn btn-icon btn-sm btn-block\"\r\n        [title]=\"'asset.add-asset' | translate\"\r\n        (click)=\"selectAssets()\"\r\n    >\r\n        <clr-icon shape=\"attachment\"></clr-icon>\r\n        {{ 'asset.add-asset' | translate }}\r\n    </button>\r\n</ng-template>\r\n\r\n<ng-template #assetList>\r\n    <div class=\"all-assets\" [class.compact]=\"compact\" cdkDropListGroup>\r\n        <div\r\n            *ngFor=\"let asset of assets; let index = index\"\r\n            class=\"drop-list\"\r\n            cdkDropList\r\n            cdkDropListOrientation=\"horizontal\"\r\n            [cdkDropListData]=\"index\"\r\n            [cdkDropListDisabled]=\"!(updatePermissions | hasPermission)\"\r\n            (cdkDropListDropped)=\"dropListDropped($event)\"\r\n        >\r\n            <vdr-dropdown cdkDrag>\r\n                <div\r\n                    class=\"asset-thumb\"\r\n                    vdrDropdownTrigger\r\n                    [class.featured]=\"isFeatured(asset)\"\r\n                    [title]=\"\"\r\n                    tabindex=\"0\"\r\n                >\r\n                    <img [src]=\"asset | assetPreview:'tiny'\" />\r\n                </div>\r\n                <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                    <button type=\"button\" vdrDropdownItem (click)=\"previewAsset(asset)\">\r\n                        {{ 'asset.preview' | translate }}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        [disabled]=\"isFeatured(asset) || !(updatePermissions | hasPermission)\"\r\n                        vdrDropdownItem\r\n                        (click)=\"setAsFeatured(asset)\"\r\n                    >\r\n                        {{ 'asset.set-as-featured-asset' | translate }}\r\n                    </button>\r\n                    <div class=\"dropdown-divider\"></div>\r\n                    <button\r\n                        type=\"button\"\r\n                        class=\"remove-asset\"\r\n                        vdrDropdownItem\r\n                        [disabled]=\"!(updatePermissions | hasPermission)\"\r\n                        (click)=\"removeAsset(asset)\"\r\n                    >\r\n                        {{ 'asset.remove-asset' | translate }}\r\n                    </button>\r\n                </vdr-dropdown-menu>\r\n            </vdr-dropdown>\r\n        </div>\r\n    </div>\r\n</ng-template>\r\n","import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\r\nimport { ViewportRuler } from '@angular/cdk/overlay';\r\nimport {\r\n    ChangeDetectionStrategy,\r\n    ChangeDetectorRef,\r\n    Component,\r\n    EventEmitter,\r\n    HostBinding,\r\n    Input,\r\n    Optional,\r\n    Output,\r\n} from '@angular/core';\r\nimport {\r\n    Asset,\r\n    AssetPickerDialogComponent,\r\n    AssetPreviewDialogComponent,\r\n    ModalService,\r\n    Permission,\r\n} from '@vendure/admin-ui/core';\r\nimport { unique } from '@vendure/common/lib/unique';\r\n\r\nimport { CollectionDetailComponent } from '../collection-detail/collection-detail.component';\r\n\r\nexport interface AssetChange {\r\n    assets: Asset[];\r\n    featuredAsset: Asset | undefined;\r\n}\r\n\r\n/**\r\n * A component which displays the Assets associated with a product, and allows assets to be removed and\r\n * added, and for the featured asset to be set.\r\n *\r\n * Note: rather complex code for drag drop is due to a limitation of the default CDK implementation\r\n * which is addressed by a work-around from here: https://github.com/angular/components/issues/13372#issuecomment-483998378\r\n */\r\n@Component({\r\n    selector: 'vdr-product-assets',\r\n    templateUrl: './product-assets.component.html',\r\n    styleUrls: ['./product-assets.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ProductAssetsComponent {\r\n    @Input('assets') set assetsSetter(val: Asset[]) {\r\n        // create a new non-readonly array of assets\r\n        this.assets = val.slice();\r\n    }\r\n\r\n    @Input() featuredAsset: Asset | undefined;\r\n    @HostBinding('class.compact')\r\n    @Input()\r\n    compact = false;\r\n    @Output() change = new EventEmitter<AssetChange>();\r\n\r\n    public assets: Asset[] = [];\r\n\r\n    private readonly updateCollectionPermissions = [Permission.UpdateCatalog, Permission.UpdateCollection];\r\n    private readonly updateProductPermissions = [Permission.UpdateCatalog, Permission.UpdateProduct];\r\n\r\n    get updatePermissions(): Permission[] {\r\n        if (this.collectionDetailComponent) {\r\n            return this.updateCollectionPermissions;\r\n        } else {\r\n            return this.updateProductPermissions;\r\n        }\r\n    }\r\n\r\n    constructor(\r\n        private modalService: ModalService,\r\n        private changeDetector: ChangeDetectorRef,\r\n        private viewportRuler: ViewportRuler,\r\n        @Optional() private collectionDetailComponent?: CollectionDetailComponent,\r\n    ) {}\r\n\r\n    selectAssets() {\r\n        this.modalService\r\n            .fromComponent(AssetPickerDialogComponent, {\r\n                size: 'xl',\r\n            })\r\n            .subscribe(result => {\r\n                if (result && result.length) {\r\n                    this.assets = unique(this.assets.concat(result), 'id');\r\n                    if (!this.featuredAsset) {\r\n                        this.featuredAsset = result[0];\r\n                    }\r\n                    this.emitChangeEvent(this.assets, this.featuredAsset);\r\n                    this.changeDetector.markForCheck();\r\n                }\r\n            });\r\n    }\r\n\r\n    setAsFeatured(asset: Asset) {\r\n        this.featuredAsset = asset;\r\n        this.emitChangeEvent(this.assets, asset);\r\n    }\r\n\r\n    isFeatured(asset: Asset): boolean {\r\n        return !!this.featuredAsset && this.featuredAsset.id === asset.id;\r\n    }\r\n\r\n    previewAsset(asset: Asset) {\r\n        this.modalService\r\n            .fromComponent(AssetPreviewDialogComponent, {\r\n                size: 'xl',\r\n                closable: true,\r\n                locals: { asset },\r\n            })\r\n            .subscribe();\r\n    }\r\n\r\n    removeAsset(asset: Asset) {\r\n        this.assets = this.assets.filter(a => a.id !== asset.id);\r\n        if (this.featuredAsset && this.featuredAsset.id === asset.id) {\r\n            this.featuredAsset = this.assets.length > 0 ? this.assets[0] : undefined;\r\n        }\r\n        this.emitChangeEvent(this.assets, this.featuredAsset);\r\n    }\r\n\r\n    private emitChangeEvent(assets: Asset[], featuredAsset: Asset | undefined) {\r\n        this.change.emit({\r\n            assets,\r\n            featuredAsset,\r\n        });\r\n    }\r\n\r\n    dropListDropped(event: CdkDragDrop<number>) {\r\n        moveItemInArray(this.assets, event.previousContainer.data, event.container.data);\r\n        this.emitChangeEvent(this.assets, this.featuredAsset);\r\n    }\r\n}\r\n","<ng-template vdrDialogTitle>{{ 'catalog.update-product-option' | translate }}</ng-template>\r\n<vdr-form-field [label]=\"'catalog.option-name' | translate\" for=\"name\">\r\n    <input\r\n        id=\"name\"\r\n        type=\"text\"\r\n        #nameInput=\"ngModel\"\r\n        [(ngModel)]=\"name\"\r\n        required\r\n        (input)=\"updateCode($event.target.value)\"\r\n    />\r\n</vdr-form-field>\r\n<vdr-form-field [label]=\"'common.code' | translate\" for=\"code\">\r\n    <input id=\"code\" type=\"text\" #codeInput=\"ngModel\" required [(ngModel)]=\"code\" pattern=\"[a-z0-9_-]+\" />\r\n</vdr-form-field>\r\n<clr-checkbox-wrapper>\r\n    <input type=\"checkbox\" clrCheckbox [(ngModel)]=\"updateVariantName\" />\r\n    <label>{{ 'catalog.auto-update-option-variant-name' | translate }}</label>\r\n</clr-checkbox-wrapper>\r\n<section *ngIf=\"customFields.length\">\r\n    <label>{{ 'common.custom-fields' | translate }}</label>\r\n    <ng-container *ngFor=\"let customField of customFields\">\r\n        <vdr-custom-field-control\r\n            *ngIf=\"customFieldsForm.get(customField.name)\"\r\n            entityName=\"ProductOption\"\r\n            [customFieldsFormGroup]=\"customFieldsForm\"\r\n            [customField]=\"customField\"\r\n            [readonly]=\"!(['UpdateCatalog', 'UpdateProduct'] | hasPermission)\"\r\n        ></vdr-custom-field-control>\r\n    </ng-container>\r\n</section>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button\r\n        type=\"submit\"\r\n        (click)=\"update()\"\r\n        [disabled]=\"\r\n            nameInput.invalid ||\r\n            codeInput.invalid ||\r\n            (nameInput.pristine && codeInput.pristine && customFieldsForm.pristine)\r\n        \"\r\n        class=\"btn btn-primary\"\r\n    >\r\n        {{ 'catalog.update-product-option' | translate }}\r\n    </button>\r\n</ng-template>\r\n","import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';\r\nimport { FormControl, FormGroup } from '@angular/forms';\r\nimport {\r\n    CustomFieldConfig,\r\n    LanguageCode,\r\n    ProductVariant,\r\n    UpdateProductOptionInput,\r\n} from '@vendure/admin-ui/core';\r\nimport { createUpdatedTranslatable } from '@vendure/admin-ui/core';\r\nimport { Dialog } from '@vendure/admin-ui/core';\r\nimport { normalizeString } from '@vendure/common/lib/normalize-string';\r\n\r\n@Component({\r\n    selector: 'vdr-update-product-option-dialog',\r\n    templateUrl: './update-product-option-dialog.component.html',\r\n    styleUrls: ['./update-product-option-dialog.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class UpdateProductOptionDialogComponent\r\n    implements Dialog<UpdateProductOptionInput & { autoUpdate: boolean }>, OnInit {\r\n    resolveWith: (result?: UpdateProductOptionInput & { autoUpdate: boolean }) => void;\r\n    updateVariantName = true;\r\n    // Provided by caller\r\n    productOption: ProductVariant.Options;\r\n    activeLanguage: LanguageCode;\r\n    name: string;\r\n    code: string;\r\n    customFields: CustomFieldConfig[];\r\n    codeInputTouched = false;\r\n    customFieldsForm: FormGroup;\r\n\r\n    ngOnInit(): void {\r\n        const currentTranslation = this.productOption.translations.find(\r\n            t => t.languageCode === this.activeLanguage,\r\n        );\r\n        this.name = currentTranslation?.name ?? '';\r\n        this.code = this.productOption.code;\r\n        this.customFieldsForm = new FormGroup({});\r\n        if (this.customFields) {\r\n            const cfCurrentTranslation =\r\n                (currentTranslation && (currentTranslation as any).customFields) || {};\r\n\r\n            for (const fieldDef of this.customFields) {\r\n                const key = fieldDef.name;\r\n                const value =\r\n                    fieldDef.type === 'localeString'\r\n                        ? cfCurrentTranslation[key]\r\n                        : (this.productOption as any).customFields[key];\r\n                this.customFieldsForm.addControl(fieldDef.name, new FormControl(value));\r\n            }\r\n        }\r\n    }\r\n\r\n    update() {\r\n        const result = createUpdatedTranslatable({\r\n            translatable: this.productOption,\r\n            languageCode: this.activeLanguage,\r\n            updatedFields: {\r\n                code: this.code,\r\n                name: this.name,\r\n                customFields: this.customFieldsForm.value,\r\n            },\r\n            customFieldConfig: this.customFields,\r\n            defaultTranslation: {\r\n                languageCode: this.activeLanguage,\r\n                name: '',\r\n            },\r\n        });\r\n        this.resolveWith({ ...result, autoUpdate: this.updateVariantName });\r\n    }\r\n\r\n    cancel() {\r\n        this.resolveWith();\r\n    }\r\n\r\n    updateCode(nameValue: string) {\r\n        if (!this.codeInputTouched && !this.productOption.code) {\r\n            this.code = normalizeString(nameValue, '-');\r\n        }\r\n    }\r\n}\r\n","<label class=\"clr-control-label\">{{ 'catalog.taxes' | translate }}</label>\r\n<div *ngIf=\"priceIncludesTax\" class=\"value\">\r\n    {{ 'catalog.price-includes-tax-at' | translate: { rate: taxRate$ | async } }}\r\n</div>\r\n<div *ngIf=\"!priceIncludesTax\" class=\"value\">\r\n    {{\r\n        'catalog.price-with-tax-in-default-zone'\r\n            | translate: { price: grossPrice$ | async | localeCurrency: currencyCode, rate: taxRate$ | async }\r\n    }}\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\r\nimport { DataService } from '@vendure/admin-ui/core';\r\nimport { BehaviorSubject, combineLatest, Observable, Subject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'vdr-variant-price-detail',\r\n    templateUrl: './variant-price-detail.component.html',\r\n    styleUrls: ['./variant-price-detail.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class VariantPriceDetailComponent implements OnInit, OnChanges {\r\n    @Input() priceIncludesTax: boolean;\r\n    @Input() price: number;\r\n    @Input() currencyCode: string;\r\n    @Input() taxCategoryId: string;\r\n\r\n    grossPrice$: Observable<number>;\r\n    taxRate$: Observable<number>;\r\n\r\n    private priceChange$ = new BehaviorSubject<number>(0);\r\n    private taxCategoryIdChange$ = new BehaviorSubject<string>('');\r\n\r\n    constructor(private dataService: DataService) {}\r\n\r\n    ngOnInit() {\r\n        const taxRates$ = this.dataService.settings\r\n            .getTaxRates(999, 0, 'cache-first')\r\n            .mapStream(data => data.taxRates.items);\r\n        const activeChannel$ = this.dataService.settings\r\n            .getActiveChannel('cache-first')\r\n            .refetchOnChannelChange()\r\n            .mapStream(data => data.activeChannel);\r\n\r\n        this.taxRate$ = combineLatest(activeChannel$, taxRates$, this.taxCategoryIdChange$).pipe(\r\n            map(([channel, taxRates, taxCategoryId]) => {\r\n                const defaultTaxZone = channel.defaultTaxZone;\r\n                if (!defaultTaxZone) {\r\n                    return 0;\r\n                }\r\n                const applicableRate = taxRates.find(\r\n                    taxRate => taxRate.zone.id === defaultTaxZone.id && taxRate.category.id === taxCategoryId,\r\n                );\r\n\r\n                if (!applicableRate) {\r\n                    return 0;\r\n                }\r\n                return applicableRate.value;\r\n            }),\r\n        );\r\n\r\n        this.grossPrice$ = combineLatest(this.taxRate$, this.priceChange$).pipe(\r\n            map(([taxRate, price]) => {\r\n                return Math.round(price * ((100 + taxRate) / 100));\r\n            }),\r\n        );\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges): void {\r\n        if ('price' in changes) {\r\n            this.priceChange$.next(changes.price.currentValue);\r\n        }\r\n        if ('taxCategoryId' in changes) {\r\n            this.taxCategoryIdChange$.next(changes.taxCategoryId.currentValue);\r\n        }\r\n    }\r\n}\r\n","<div class=\"variants-list\">\r\n    <div\r\n        class=\"variant-container card\"\r\n        *ngFor=\"let variant of variants | paginate: pagination; trackBy: trackById; let i = index\"\r\n        [class.disabled]=\"!formGroupMap.get(variant.id)?.get('enabled')?.value\"\r\n    >\r\n        <ng-container *ngIf=\"formGroupMap.get(variant.id) as formGroup\" [formGroup]=\"formGroup\">\r\n            <div class=\"card-block header-row\">\r\n                <div class=\"details\">\r\n                    <vdr-title-input class=\"sku\" [readonly]=\"!(updatePermission | hasPermission)\">\r\n                        <clr-input-container>\r\n                            <input\r\n                                clrInput\r\n                                type=\"text\"\r\n                                formControlName=\"sku\"\r\n                                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                [placeholder]=\"'catalog.sku' | translate\"\r\n                            />\r\n                        </clr-input-container>\r\n                    </vdr-title-input>\r\n                    <vdr-title-input class=\"name\" [readonly]=\"!(updatePermission | hasPermission)\">\r\n                        <clr-input-container>\r\n                            <input\r\n                                clrInput\r\n                                type=\"text\"\r\n                                formControlName=\"name\"\r\n                                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                [placeholder]=\"'common.name' | translate\"\r\n                            />\r\n                        </clr-input-container>\r\n                    </vdr-title-input>\r\n                </div>\r\n                <div class=\"right-controls\">\r\n                    <clr-toggle-wrapper *vdrIfPermissions=\"updatePermission\">\r\n                        <input type=\"checkbox\" clrToggle name=\"enabled\" formControlName=\"enabled\" />\r\n                        <label>{{ 'common.enabled' | translate }}</label>\r\n                    </clr-toggle-wrapper>\r\n                </div>\r\n            </div>\r\n            <div class=\"card-block\">\r\n                <div class=\"variant-body\">\r\n                    <div class=\"assets\">\r\n                        <vdr-product-assets\r\n                            [compact]=\"true\"\r\n                            [assets]=\"pendingAssetChanges[variant.id]?.assets || variant.assets\"\r\n                            [featuredAsset]=\"pendingAssetChanges[variant.id]?.featuredAsset || variant.featuredAsset\"\r\n                            (change)=\"onAssetChange(variant.id, $event)\"\r\n                        ></vdr-product-assets>\r\n                    </div>\r\n                    <div class=\"variant-form-inputs\">\r\n                        <div class=\"standard-fields\">\r\n                            <div class=\"variant-form-input-row\">\r\n                                <div class=\"tax-category\">\r\n                                    <clr-select-container\r\n                                        *vdrIfPermissions=\"updatePermission; else taxCategoryLabel\"\r\n                                    >\r\n                                        <label>{{ 'catalog.tax-category' | translate }}</label>\r\n                                        <select clrSelect name=\"options\" formControlName=\"taxCategoryId\">\r\n                                            <option\r\n                                                *ngFor=\"let taxCategory of taxCategories\"\r\n                                                [value]=\"taxCategory.id\"\r\n                                            >\r\n                                                {{ taxCategory.name }}\r\n                                            </option>\r\n                                        </select>\r\n                                    </clr-select-container>\r\n                                    <ng-template #taxCategoryLabel>\r\n                                        <label class=\"clr-control-label\">{{\r\n                                            'catalog.tax-category' | translate\r\n                                        }}</label>\r\n                                        <div class=\"tax-category-label\">\r\n                                            {{ getTaxCategoryName(formGroup) }}\r\n                                        </div>\r\n                                    </ng-template>\r\n                                </div>\r\n                                <div class=\"price\">\r\n                                    <clr-input-container>\r\n                                        <label>{{ 'catalog.price' | translate }}</label>\r\n                                        <vdr-currency-input\r\n                                            *ngIf=\"!channelPriceIncludesTax\"\r\n                                            clrInput\r\n                                            [currencyCode]=\"variant.currencyCode\"\r\n                                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                            formControlName=\"price\"\r\n                                        ></vdr-currency-input>\r\n                                        <vdr-currency-input\r\n                                            *ngIf=\"channelPriceIncludesTax\"\r\n                                            clrInput\r\n                                            [currencyCode]=\"variant.currencyCode\"\r\n                                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                            formControlName=\"priceWithTax\"\r\n                                        ></vdr-currency-input>\r\n                                    </clr-input-container>\r\n                                </div>\r\n                                <vdr-variant-price-detail\r\n                                    [price]=\"formGroup.get('price')!.value\"\r\n                                    [currencyCode]=\"variant.currencyCode\"\r\n                                    [priceIncludesTax]=\"channelPriceIncludesTax\"\r\n                                    [taxCategoryId]=\"formGroup.get('taxCategoryId')!.value\"\r\n                                ></vdr-variant-price-detail>\r\n                            </div>\r\n                            <div class=\"variant-form-input-row\">\r\n                                <clr-select-container *vdrIfPermissions=\"updatePermission\">\r\n                                    <label\r\n                                        >{{ 'catalog.track-inventory' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.track-inventory-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip>\r\n                                    </label>\r\n                                    <select clrSelect name=\"options\" formControlName=\"trackInventory\">\r\n                                        <option [value]=\"GlobalFlag.TRUE\">\r\n                                            {{ 'catalog.track-inventory-true' | translate }}\r\n                                        </option>\r\n                                        <option [value]=\"GlobalFlag.FALSE\">\r\n                                            {{ 'catalog.track-inventory-false' | translate }}\r\n                                        </option>\r\n                                        <option [value]=\"GlobalFlag.INHERIT\">\r\n                                            {{ 'catalog.track-inventory-inherit' | translate }}\r\n                                        </option>\r\n                                    </select>\r\n                                </clr-select-container>\r\n                                <clr-input-container>\r\n                                    <label\r\n                                        >{{ 'catalog.stock-on-hand' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.stock-on-hand-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <input\r\n                                        [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\"\r\n                                        clrInput\r\n                                        type=\"number\"\r\n                                        min=\"0\"\r\n                                        step=\"1\"\r\n                                        formControlName=\"stockOnHand\"\r\n                                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                        [vdrDisabled]=\"inventoryIsNotTracked(formGroup)\"\r\n                                    />\r\n                                </clr-input-container>\r\n                                <div [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\">\r\n                                    <label class=\"clr-control-label\"\r\n                                        >{{ 'catalog.stock-allocated' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.stock-allocated-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <div class=\"value\">\r\n                                        {{ variant.stockAllocated }}\r\n                                    </div>\r\n                                </div>\r\n                                <div [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\">\r\n                                    <label class=\"clr-control-label\"\r\n                                        >{{ 'catalog.stock-saleable' | translate }}\r\n                                        <vdr-help-tooltip\r\n                                            [content]=\"'catalog.stock-saleable-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <div class=\"value\">\r\n                                        {{ getSaleableStockLevel(variant) }}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div class=\"variant-form-input-row\">\r\n                                <div\r\n                                    class=\"out-of-stock-threshold-wrapper\"\r\n                                    [class.inventory-untracked]=\"inventoryIsNotTracked(formGroup)\"\r\n                                >\r\n                                    <label class=\"clr-control-label\"\r\n                                        >{{ 'catalog.out-of-stock-threshold' | translate\r\n                                        }}<vdr-help-tooltip\r\n                                            [content]=\"'catalog.out-of-stock-threshold-tooltip' | translate\"\r\n                                        ></vdr-help-tooltip\r\n                                    ></label>\r\n                                    <div class=\"flex\">\r\n                                        <clr-input-container>\r\n                                            <input\r\n                                                clrInput\r\n                                                type=\"number\"\r\n                                                [formControl]=\"formGroup.get('outOfStockThreshold')\"\r\n                                                [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                                [vdrDisabled]=\"\r\n                                                    formGroup.get('useGlobalOutOfStockThreshold')?.value !==\r\n                                                        false || inventoryIsNotTracked(formGroup)\r\n                                                \"\r\n                                            />\r\n                                        </clr-input-container>\r\n                                        <clr-toggle-wrapper>\r\n                                            <input\r\n                                                type=\"checkbox\"\r\n                                                clrToggle\r\n                                                name=\"useGlobalOutOfStockThreshold\"\r\n                                                formControlName=\"useGlobalOutOfStockThreshold\"\r\n                                                [vdrDisabled]=\"\r\n                                                    !(updatePermission | hasPermission) ||\r\n                                                    inventoryIsNotTracked(formGroup)\r\n                                                \"\r\n                                            />\r\n                                            <label\r\n                                                >{{ 'catalog.use-global-value' | translate }} ({{\r\n                                                    globalOutOfStockThreshold\r\n                                                }})</label\r\n                                            >\r\n                                        </clr-toggle-wrapper>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"custom-fields\">\r\n                            <div class=\"variant-form-input-row\">\r\n                                <section formGroupName=\"customFields\" *ngIf=\"customFields.length\">\r\n                                    <!--<label>{{ 'common.custom-fields' | translate }}</label>-->\r\n                                    <ng-container *ngFor=\"let customField of customFields\">\r\n                                        <vdr-custom-field-control\r\n                                            *ngIf=\"formGroup.get(['customFields', customField.name])\"\r\n                                            entityName=\"ProductVariant\"\r\n                                            [compact]=\"true\"\r\n                                            [customFieldsFormGroup]=\"formGroup.get('customFields')\"\r\n                                            [readonly]=\"!(updatePermission | hasPermission)\"\r\n                                            [customField]=\"customField\"\r\n                                        ></vdr-custom-field-control>\r\n                                    </ng-container>\r\n                                </section>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class=\"card-block\">\r\n                <div class=\"options-facets\">\r\n                    <vdr-entity-info [entity]=\"variant\"></vdr-entity-info>\r\n                    <div *ngIf=\"variant.options.length\">\r\n                        <div class=\"options\">\r\n                            <vdr-chip\r\n                                *ngFor=\"let option of variant.options | sort: 'groupId'\"\r\n                                [colorFrom]=\"optionGroupName(option.groupId)\"\r\n                                [invert]=\"true\"\r\n                                (iconClick)=\"editOption(option)\"\r\n                                [icon]=\"(updatePermission | hasPermission) && 'pencil'\"\r\n                            >\r\n                                <span class=\"option-group-name\">{{ optionGroupName(option.groupId) }}</span>\r\n                                {{ optionName(option) }}\r\n                            </vdr-chip>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"flex-spacer\"></div>\r\n                    <div class=\"facets\">\r\n                        <vdr-facet-value-chip\r\n                            *ngFor=\"let facetValue of existingFacetValues(variant)\"\r\n                            [facetValue]=\"facetValue\"\r\n                            [removable]=\"updatePermission | hasPermission\"\r\n                            (remove)=\"removeFacetValue(variant, facetValue.id)\"\r\n                        ></vdr-facet-value-chip>\r\n                        <vdr-facet-value-chip\r\n                            *ngFor=\"let facetValue of pendingFacetValues(variant)\"\r\n                            [facetValue]=\"facetValue\"\r\n                            [removable]=\"updatePermission | hasPermission\"\r\n                            (remove)=\"removeFacetValue(variant, facetValue.id)\"\r\n                        ></vdr-facet-value-chip>\r\n                        <button\r\n                            *vdrIfPermissions=\"updatePermission\"\r\n                            class=\"btn btn-sm btn-secondary\"\r\n                            (click)=\"selectFacetValueClick.emit([variant.id])\"\r\n                        >\r\n                            <clr-icon shape=\"plus\"></clr-icon>\r\n                            {{ 'catalog.add-facets' | translate }}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <ng-container *vdrIfMultichannel>\r\n                <div class=\"card-block\" *vdrIfDefaultChannelActive>\r\n                    <div class=\"flex channel-assignment\">\r\n                        <ng-container *ngFor=\"let channel of variant.channels\">\r\n                            <vdr-chip\r\n                                *ngIf=\"!isDefaultChannel(channel.code)\"\r\n                                icon=\"times-circle\"\r\n                                [title]=\"'catalog.remove-from-channel' | translate\"\r\n                                (iconClick)=\"\r\n                                    removeFromChannel.emit({ channelId: channel.id, variant: variant })\r\n                                \"\r\n                            >\r\n                                <vdr-channel-badge [channelCode]=\"channel.code\"></vdr-channel-badge>\r\n                                {{ channel.code | channelCodeToLabel }}\r\n                            </vdr-chip>\r\n                        </ng-container>\r\n                        <button class=\"btn btn-sm\" (click)=\"assignToChannel.emit(variant)\">\r\n                            <clr-icon shape=\"layers\"></clr-icon>\r\n                            {{ 'catalog.assign-to-channel' | translate }}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </ng-container>\r\n        </ng-container>\r\n    </div>\r\n    <div class=\"table-footer\">\r\n        <vdr-items-per-page-controls [(itemsPerPage)]=\"pagination.itemsPerPage\"></vdr-items-per-page-controls>\r\n\r\n        <vdr-pagination-controls\r\n            [currentPage]=\"pagination.currentPage\"\r\n            [itemsPerPage]=\"pagination.itemsPerPage\"\r\n            (pageChange)=\"pagination.currentPage = $event\"\r\n        ></vdr-pagination-controls>\r\n    </div>\r\n</div>\r\n","import {\r\n    ChangeDetectionStrategy,\r\n    ChangeDetectorRef,\r\n    Component,\r\n    EventEmitter,\r\n    Input,\r\n    OnChanges,\r\n    OnDestroy,\r\n    OnInit,\r\n    Output,\r\n    SimpleChanges,\r\n} from '@angular/core';\r\nimport { FormArray, FormGroup } from '@angular/forms';\r\nimport {\r\n    CustomFieldConfig,\r\n    DataService,\r\n    FacetValue,\r\n    FacetWithValues,\r\n    flattenFacetValues,\r\n    GlobalFlag,\r\n    LanguageCode,\r\n    ModalService,\r\n    Permission,\r\n    ProductOptionFragment,\r\n    ProductVariant,\r\n    ProductWithVariants,\r\n    TaxCategory,\r\n    UpdateProductOptionInput,\r\n} from '@vendure/admin-ui/core';\r\nimport { DEFAULT_CHANNEL_CODE } from '@vendure/common/lib/shared-constants';\r\nimport { notNullOrUndefined } from '@vendure/common/lib/shared-utils';\r\nimport { PaginationInstance } from 'ngx-pagination';\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\r\n\r\nimport { AssetChange } from '../product-assets/product-assets.component';\r\nimport { SelectedAssets, VariantFormValue } from '../product-detail/product-detail.component';\r\nimport { UpdateProductOptionDialogComponent } from '../update-product-option-dialog/update-product-option-dialog.component';\r\n\r\nexport interface VariantAssetChange extends AssetChange {\r\n    variantId: string;\r\n}\r\n\r\n@Component({\r\n    selector: 'vdr-product-variants-list',\r\n    templateUrl: './product-variants-list.component.html',\r\n    styleUrls: ['./product-variants-list.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ProductVariantsListComponent implements OnChanges, OnInit, OnDestroy {\r\n    @Input('productVariantsFormArray') formArray: FormArray;\r\n    @Input() variants: ProductWithVariants.Variants[];\r\n    @Input() channelPriceIncludesTax: boolean;\r\n    @Input() taxCategories: TaxCategory[];\r\n    @Input() facets: FacetWithValues.Fragment[];\r\n    @Input() optionGroups: ProductWithVariants.OptionGroups[];\r\n    @Input() customFields: CustomFieldConfig[];\r\n    @Input() customOptionFields: CustomFieldConfig[];\r\n    @Input() activeLanguage: LanguageCode;\r\n    @Input() pendingAssetChanges: { [variantId: string]: SelectedAssets };\r\n    @Output() assignToChannel = new EventEmitter<ProductWithVariants.Variants>();\r\n    @Output() removeFromChannel = new EventEmitter<{\r\n        channelId: string;\r\n        variant: ProductWithVariants.Variants;\r\n    }>();\r\n    @Output() assetChange = new EventEmitter<VariantAssetChange>();\r\n    @Output() selectionChange = new EventEmitter<string[]>();\r\n    @Output() selectFacetValueClick = new EventEmitter<string[]>();\r\n    @Output() updateProductOption = new EventEmitter<UpdateProductOptionInput & { autoUpdate: boolean }>();\r\n    selectedVariantIds: string[] = [];\r\n    pagination: PaginationInstance = {\r\n        currentPage: 1,\r\n        itemsPerPage: 10,\r\n    };\r\n    formGroupMap = new Map<string, FormGroup>();\r\n    GlobalFlag = GlobalFlag;\r\n    globalTrackInventory: boolean;\r\n    globalOutOfStockThreshold: number;\r\n    readonly updatePermission = [Permission.UpdateCatalog, Permission.UpdateProduct];\r\n    private facetValues: FacetValue.Fragment[];\r\n    private subscription: Subscription;\r\n\r\n    constructor(\r\n        private changeDetector: ChangeDetectorRef,\r\n        private modalService: ModalService,\r\n        private dataService: DataService,\r\n    ) {}\r\n\r\n    ngOnInit() {\r\n        this.dataService.settings.getGlobalSettings('cache-first').single$.subscribe(({ globalSettings }) => {\r\n            this.globalTrackInventory = globalSettings.trackInventory;\r\n            this.globalOutOfStockThreshold = globalSettings.outOfStockThreshold;\r\n            this.changeDetector.markForCheck();\r\n        });\r\n        this.subscription = this.formArray.valueChanges.subscribe(() => this.changeDetector.markForCheck());\r\n\r\n        this.subscription.add(\r\n            this.formArray.valueChanges\r\n                .pipe(\r\n                    map(value => value.length),\r\n                    debounceTime(1),\r\n                    distinctUntilChanged(),\r\n                )\r\n                .subscribe(() => {\r\n                    this.buildFormGroupMap();\r\n                }),\r\n        );\r\n\r\n        this.buildFormGroupMap();\r\n    }\r\n\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        if ('facets' in changes && !!changes['facets'].currentValue) {\r\n            this.facetValues = flattenFacetValues(this.facets);\r\n        }\r\n        if ('variants' in changes) {\r\n            if (changes['variants'].currentValue?.length !== changes['variants'].previousValue?.length) {\r\n                this.pagination.currentPage = 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        if (this.subscription) {\r\n            this.subscription.unsubscribe();\r\n        }\r\n    }\r\n\r\n    isDefaultChannel(channelCode: string): boolean {\r\n        return channelCode === DEFAULT_CHANNEL_CODE;\r\n    }\r\n\r\n    trackById(index: number, item: ProductWithVariants.Variants) {\r\n        return item.id;\r\n    }\r\n\r\n    inventoryIsNotTracked(formGroup: FormGroup): boolean {\r\n        const trackInventory = formGroup.get('trackInventory')?.value;\r\n        return (\r\n            trackInventory === GlobalFlag.FALSE ||\r\n            (trackInventory === GlobalFlag.INHERIT && this.globalTrackInventory === false)\r\n        );\r\n    }\r\n\r\n    getTaxCategoryName(group: FormGroup): string {\r\n        const control = group.get(['taxCategoryId']);\r\n        if (control && this.taxCategories) {\r\n            const match = this.taxCategories.find(t => t.id === control.value);\r\n            return match ? match.name : '';\r\n        }\r\n        return '';\r\n    }\r\n\r\n    getSaleableStockLevel(variant: ProductWithVariants.Variants) {\r\n        const effectiveOutOfStockThreshold = variant.useGlobalOutOfStockThreshold\r\n            ? this.globalOutOfStockThreshold\r\n            : variant.outOfStockThreshold;\r\n        return variant.stockOnHand - variant.stockAllocated - effectiveOutOfStockThreshold;\r\n    }\r\n\r\n    areAllSelected(): boolean {\r\n        return !!this.variants && this.selectedVariantIds.length === this.variants.length;\r\n    }\r\n\r\n    onAssetChange(variantId: string, event: AssetChange) {\r\n        this.assetChange.emit({\r\n            variantId,\r\n            ...event,\r\n        });\r\n        const index = this.variants.findIndex(v => v.id === variantId);\r\n        this.formArray.at(index).markAsDirty();\r\n    }\r\n\r\n    toggleSelectAll() {\r\n        if (this.areAllSelected()) {\r\n            this.selectedVariantIds = [];\r\n        } else {\r\n            this.selectedVariantIds = this.variants.map(v => v.id);\r\n        }\r\n        this.selectionChange.emit(this.selectedVariantIds);\r\n    }\r\n\r\n    toggleSelectVariant(variantId: string) {\r\n        const index = this.selectedVariantIds.indexOf(variantId);\r\n        if (-1 < index) {\r\n            this.selectedVariantIds.splice(index, 1);\r\n        } else {\r\n            this.selectedVariantIds.push(variantId);\r\n        }\r\n        this.selectionChange.emit(this.selectedVariantIds);\r\n    }\r\n\r\n    optionGroupName(optionGroupId: string): string | undefined {\r\n        const group = this.optionGroups.find(g => g.id === optionGroupId);\r\n        if (group) {\r\n            const translation =\r\n                group?.translations.find(t => t.languageCode === this.activeLanguage) ??\r\n                group.translations[0];\r\n            return translation.name;\r\n        }\r\n    }\r\n\r\n    optionName(option: ProductOptionFragment) {\r\n        const translation =\r\n            option.translations.find(t => t.languageCode === this.activeLanguage) ?? option.translations[0];\r\n        return translation.name;\r\n    }\r\n\r\n    pendingFacetValues(variant: ProductWithVariants.Variants) {\r\n        if (this.facets) {\r\n            const formFacetValueIds = this.getFacetValueIds(variant.id);\r\n            const variantFacetValueIds = variant.facetValues.map(fv => fv.id);\r\n            return formFacetValueIds\r\n                .filter(x => !variantFacetValueIds.includes(x))\r\n                .map(id => this.facetValues.find(fv => fv.id === id))\r\n                .filter(notNullOrUndefined);\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n\r\n    existingFacetValues(variant: ProductWithVariants.Variants) {\r\n        const formFacetValueIds = this.getFacetValueIds(variant.id);\r\n        const intersection = [...formFacetValueIds].filter(x =>\r\n            variant.facetValues.map(fv => fv.id).includes(x),\r\n        );\r\n        return intersection\r\n            .map(id => variant.facetValues.find(fv => fv.id === id))\r\n            .filter(notNullOrUndefined);\r\n    }\r\n\r\n    removeFacetValue(variant: ProductWithVariants.Variants, facetValueId: string) {\r\n        const formGroup = this.formGroupMap.get(variant.id);\r\n        if (formGroup) {\r\n            const newValue = (formGroup.value as VariantFormValue).facetValueIds.filter(\r\n                id => id !== facetValueId,\r\n            );\r\n            formGroup.patchValue({\r\n                facetValueIds: newValue,\r\n            });\r\n            formGroup.markAsDirty();\r\n        }\r\n    }\r\n\r\n    isVariantSelected(variantId: string): boolean {\r\n        return -1 < this.selectedVariantIds.indexOf(variantId);\r\n    }\r\n\r\n    editOption(option: ProductVariant.Options) {\r\n        this.modalService\r\n            .fromComponent(UpdateProductOptionDialogComponent, {\r\n                size: 'md',\r\n                locals: {\r\n                    productOption: option,\r\n                    activeLanguage: this.activeLanguage,\r\n                    customFields: this.customOptionFields,\r\n                },\r\n            })\r\n            .subscribe(result => {\r\n                if (result) {\r\n                    this.updateProductOption.emit(result);\r\n                }\r\n            });\r\n    }\r\n\r\n    private buildFormGroupMap() {\r\n        this.formGroupMap.clear();\r\n        for (const controlGroup of this.formArray.controls) {\r\n            this.formGroupMap.set(controlGroup.value.id, controlGroup as FormGroup);\r\n        }\r\n        this.changeDetector.markForCheck();\r\n    }\r\n\r\n    private getFacetValueIds(id: string): string[] {\r\n        const formValue: VariantFormValue = this.formGroupMap.get(id)?.value;\r\n        return formValue.facetValueIds;\r\n    }\r\n}\r\n","<vdr-data-table [items]=\"variants\">\r\n    <vdr-dt-column></vdr-dt-column>\r\n    <vdr-dt-column>{{ 'common.name' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'catalog.sku' | translate }}</vdr-dt-column>\r\n    <ng-container *ngFor=\"let optionGroup of optionGroups | sort: 'id'\">\r\n        <vdr-dt-column>{{ optionGroup.name }}</vdr-dt-column>\r\n    </ng-container>\r\n    <vdr-dt-column>{{ 'catalog.price' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'catalog.stock-on-hand' | translate }}</vdr-dt-column>\r\n    <vdr-dt-column>{{ 'common.enabled' | translate }}</vdr-dt-column>\r\n    <ng-template let-variant=\"item\" let-i=\"index\">\r\n        <ng-container *ngIf=\"formGroupMap.get(variant.id) as formGroup\" [formGroup]=\"formGroup\">\r\n            <td class=\"left align-middle\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                <div class=\"card-img\">\r\n                    <div class=\"featured-asset\">\r\n                        <img\r\n                            *ngIf=\"getFeaturedAsset(variant) as featuredAsset; else placeholder\"\r\n                            [src]=\"featuredAsset | assetPreview: 'tiny'\"\r\n                        />\r\n                        <ng-template #placeholder>\r\n                            <div class=\"placeholder\">\r\n                                <clr-icon shape=\"image\" size=\"48\"></clr-icon>\r\n                            </div>\r\n                        </ng-template>\r\n                    </div>\r\n                </div>\r\n            </td>\r\n            <td class=\"left align-middle\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"text\"\r\n                        formControlName=\"name\"\r\n                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        [placeholder]=\"'common.name' | translate\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n            <td class=\"left align-middle\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"text\"\r\n                        formControlName=\"sku\"\r\n                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        [placeholder]=\"'catalog.sku' | translate\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n            <ng-container *ngFor=\"let option of variant.options | sort: 'groupId'\">\r\n                <td\r\n                    class=\"left align-middle\"\r\n                    [class.disabled]=\"!formGroup.get('enabled')!.value\"\r\n                    [style.color]=\"optionGroupName(option.groupId) | stringToColor\"\r\n                >\r\n                    {{ option.name }}\r\n                </td>\r\n            </ng-container>\r\n            <td class=\"left align-middle price\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                <clr-input-container>\r\n                    <vdr-currency-input\r\n                        *ngIf=\"!channelPriceIncludesTax\"\r\n                        clrInput\r\n                        [currencyCode]=\"variant.currencyCode\"\r\n                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        formControlName=\"price\"\r\n                    ></vdr-currency-input>\r\n                    <vdr-currency-input\r\n                        *ngIf=\"channelPriceIncludesTax\"\r\n                        clrInput\r\n                        [currencyCode]=\"variant.currencyCode\"\r\n                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                        formControlName=\"priceWithTax\"\r\n                    ></vdr-currency-input>\r\n                </clr-input-container>\r\n            </td>\r\n            <td class=\"left align-middle stock\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                <clr-input-container>\r\n                    <input\r\n                        clrInput\r\n                        type=\"number\"\r\n                        min=\"0\"\r\n                        step=\"1\"\r\n                        formControlName=\"stockOnHand\"\r\n                        [readonly]=\"!(updatePermission | hasPermission)\"\r\n                    />\r\n                </clr-input-container>\r\n            </td>\r\n            <td class=\"left align-middle stock\" [class.disabled]=\"!formGroup.get('enabled')!.value\">\r\n                <clr-toggle-wrapper>\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        clrToggle\r\n                        name=\"enabled\"\r\n                        formControlName=\"enabled\"\r\n                        [vdrDisabled]=\"!(updatePermission | hasPermission)\"\r\n                    />\r\n                </clr-toggle-wrapper>\r\n            </td>\r\n        </ng-container>\r\n    </ng-template>\r\n</vdr-data-table>\r\n","import {\r\n    ChangeDetectionStrategy,\r\n    ChangeDetectorRef,\r\n    Component,\r\n    Input,\r\n    OnDestroy,\r\n    OnInit,\r\n} from '@angular/core';\r\nimport { FormArray, FormGroup } from '@angular/forms';\r\nimport { Permission, ProductWithVariants } from '@vendure/admin-ui/core';\r\nimport { Subscription } from 'rxjs';\r\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\r\n\r\nimport { SelectedAssets } from '../product-detail/product-detail.component';\r\n\r\n@Component({\r\n    selector: 'vdr-product-variants-table',\r\n    templateUrl: './product-variants-table.component.html',\r\n    styleUrls: ['./product-variants-table.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class ProductVariantsTableComponent implements OnInit, OnDestroy {\r\n    @Input('productVariantsFormArray') formArray: FormArray;\r\n    @Input() variants: ProductWithVariants.Variants[];\r\n    @Input() channelPriceIncludesTax: boolean;\r\n    @Input() optionGroups: ProductWithVariants.OptionGroups[];\r\n    @Input() pendingAssetChanges: { [variantId: string]: SelectedAssets };\r\n    formGroupMap = new Map<string, FormGroup>();\r\n    readonly updatePermission = [Permission.UpdateCatalog, Permission.UpdateProduct];\r\n    private subscription: Subscription;\r\n\r\n    constructor(private changeDetector: ChangeDetectorRef) {}\r\n\r\n    ngOnInit() {\r\n        this.subscription = this.formArray.valueChanges\r\n            .pipe(\r\n                map(value => value.length),\r\n                debounceTime(1),\r\n                distinctUntilChanged(),\r\n            )\r\n            .subscribe(() => {\r\n                this.buildFormGroupMap();\r\n            });\r\n\r\n        this.buildFormGroupMap();\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        if (this.subscription) {\r\n            this.subscription.unsubscribe();\r\n        }\r\n    }\r\n\r\n    getFeaturedAsset(variant: ProductWithVariants.Variants) {\r\n        return this.pendingAssetChanges[variant.id]?.featuredAsset || variant.featuredAsset;\r\n    }\r\n\r\n    optionGroupName(optionGroupId: string): string | undefined {\r\n        const group = this.optionGroups.find(g => g.id === optionGroupId);\r\n        return group && group.name;\r\n    }\r\n\r\n    private buildFormGroupMap() {\r\n        this.formGroupMap.clear();\r\n        for (const controlGroup of this.formArray.controls) {\r\n            this.formGroupMap.set(controlGroup.value.id, controlGroup as FormGroup);\r\n        }\r\n        this.changeDetector.markForCheck();\r\n    }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule } from '@angular/router';\r\nimport { SharedModule } from '@vendure/admin-ui/core';\r\n\r\nimport { catalogRoutes } from './catalog.routes';\r\nimport { ApplyFacetDialogComponent } from './components/apply-facet-dialog/apply-facet-dialog.component';\r\nimport { AssetDetailComponent } from './components/asset-detail/asset-detail.component';\r\nimport { AssetListComponent } from './components/asset-list/asset-list.component';\r\nimport { AssignProductsToChannelDialogComponent } from './components/assign-products-to-channel-dialog/assign-products-to-channel-dialog.component';\r\nimport { CollectionContentsComponent } from './components/collection-contents/collection-contents.component';\r\nimport { CollectionDetailComponent } from './components/collection-detail/collection-detail.component';\r\nimport { CollectionListComponent } from './components/collection-list/collection-list.component';\r\nimport { CollectionTreeNodeComponent } from './components/collection-tree/collection-tree-node.component';\r\nimport { CollectionTreeComponent } from './components/collection-tree/collection-tree.component';\r\nimport { ConfirmVariantDeletionDialogComponent } from './components/confirm-variant-deletion-dialog/confirm-variant-deletion-dialog.component';\r\nimport { FacetDetailComponent } from './components/facet-detail/facet-detail.component';\r\nimport { FacetListComponent } from './components/facet-list/facet-list.component';\r\nimport { GenerateProductVariantsComponent } from './components/generate-product-variants/generate-product-variants.component';\r\nimport { OptionValueInputComponent } from './components/option-value-input/option-value-input.component';\r\nimport { ProductAssetsComponent } from './components/product-assets/product-assets.component';\r\nimport { ProductDetailComponent } from './components/product-detail/product-detail.component';\r\nimport { ProductListComponent } from './components/product-list/product-list.component';\r\nimport { ProductSearchInputComponent } from './components/product-search-input/product-search-input.component';\r\nimport { ProductVariantsEditorComponent } from './components/product-variants-editor/product-variants-editor.component';\r\nimport { ProductVariantsListComponent } from './components/product-variants-list/product-variants-list.component';\r\nimport { ProductVariantsTableComponent } from './components/product-variants-table/product-variants-table.component';\r\nimport { UpdateProductOptionDialogComponent } from './components/update-product-option-dialog/update-product-option-dialog.component';\r\nimport { VariantPriceDetailComponent } from './components/variant-price-detail/variant-price-detail.component';\r\n\r\n@NgModule({\r\n    imports: [SharedModule, RouterModule.forChild(catalogRoutes)],\r\n    exports: [],\r\n    declarations: [\r\n        ProductListComponent,\r\n        ProductDetailComponent,\r\n        FacetListComponent,\r\n        FacetDetailComponent,\r\n        GenerateProductVariantsComponent,\r\n        ProductVariantsListComponent,\r\n        ApplyFacetDialogComponent,\r\n        AssetListComponent,\r\n        ProductAssetsComponent,\r\n        VariantPriceDetailComponent,\r\n        CollectionListComponent,\r\n        CollectionDetailComponent,\r\n        CollectionTreeComponent,\r\n        CollectionTreeNodeComponent,\r\n        CollectionContentsComponent,\r\n        ProductVariantsTableComponent,\r\n        ProductSearchInputComponent,\r\n        OptionValueInputComponent,\r\n        UpdateProductOptionDialogComponent,\r\n        ProductVariantsEditorComponent,\r\n        AssignProductsToChannelDialogComponent,\r\n        AssetDetailComponent,\r\n        ConfirmVariantDeletionDialogComponent,\r\n    ],\r\n})\r\nexport class CatalogModule {}\r\n"]}