{"version":3,"sources":["webpack:///src/lib/dashboard/src/components/dashboard-widget/dashboard-widget.component.html","webpack:///src/lib/dashboard/src/components/dashboard-widget/dashboard-widget.component.ts","webpack:///src/lib/dashboard/src/components/dashboard/dashboard.component.html","webpack:///src/lib/dashboard/src/components/dashboard/dashboard.component.ts","webpack:///src/lib/dashboard/src/dashboard.routes.ts","webpack:///src/lib/dashboard/src/widgets/latest-orders-widget/latest-orders-widget.component.html","webpack:///src/lib/dashboard/src/widgets/latest-orders-widget/latest-orders-widget.component.ts","webpack:///src/lib/dashboard/src/widgets/order-summary-widget/order-summary-widget.component.html","webpack:///src/lib/dashboard/src/widgets/order-summary-widget/order-summary-widget.component.ts","webpack:///src/lib/dashboard/src/widgets/test-widget/test-widget.component.ts","webpack:///src/lib/dashboard/src/widgets/test-widget/test-widget.component.html","webpack:///src/lib/dashboard/src/widgets/welcome-widget/welcome-widget.component.html","webpack:///src/lib/dashboard/src/widgets/welcome-widget/welcome-widget.component.ts","webpack:///src/lib/dashboard/src/default-widgets.ts","webpack:///src/lib/dashboard/src/dashboard.module.ts"],"names":["componentFactoryResolver","this","loadWidget","loadComponentResult","widgetConfig","loadComponent","Promise","componentType","componentRef","portal","createComponent","resolveComponentFactory","changeDetectorRef","markForCheck","destroy","dashboardWidgetService","localStorageService","changedDetectorRef","dataService","deletionMarker","availableWidgetIds$","client","userStatus","stream$","pipe","map","permissions","getAvailableIds","tap","ids","widgetLayout","initLayout","width","assertNever","config","supportedWidths","widget","recalculateLayout","index","row","item","id","join","getWidgetById","targetRow","getSupportedWidths","length","push","event","currentIndex","previousIndex","previousContainer","container","data","previousLayoutRow","newLayoutRow","splice","availableIds","layoutDef","savedLayoutDef","get","filter","includes","getWidgetLayout","newLayoutDef","reduce","flat","set","setTimeout","dashboardRoutes","path","component","pathMatch","latestOrders$","order","getOrders","take","active","eq","sort","orderPlacedAt","DESC","refetchOnChannelChange","mapStream","orders","items","LatestOrdersWidgetModule","selection$","date","today","Date","yesterday","setDate","getDate","BehaviorSubject","timeframe","dateRange$","distinctUntilChanged","selection","start","startOf","toDate","end","endOf","shareReplay","orderSummary$","switchMap","getOrderSummary","totalOrderCount$","res","totalItems","totalOrderValue$","total","currencyCode$","settings","getActiveChannel","activeChannel","currencyCode","OrderSummaryWidgetModule","TestWidgetComponent","TestWidgetModule","version","brand","hideVendureBranding","hideVersion","administrator$","administrator","getActiveAdministrator","activeAdministrator","WelcomeWidgetModule","DEFAULT_DASHBOARD_WIDGET_LAYOUT","DEFAULT_WIDGETS","welcome","orderSummary","title","requiresPermissions","ReadOrder","latestOrders","testWidget","Object","entries","registerWidget","getDefaultLayout","setDefaultLayout","forChild"],"mappings":"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","file":"x","sourcesContent":["<div class=\"card\">\r\n    <div class=\"card-header\">\r\n        <div class=\"title\">\r\n            <ng-container *ngIf=\"widgetConfig.title as title\">{{ title | translate }}</ng-container>\r\n        </div>\r\n        <div class=\"controls\">\r\n            <ng-content></ng-content>\r\n        </div>\r\n    </div>\r\n    <div class=\"card-block\">\r\n        <ng-template #portal></ng-template>\r\n    </div>\r\n</div>\r\n","import {\r\n    AfterViewInit,\r\n    ChangeDetectionStrategy,\r\n    Component,\r\n    ComponentFactoryResolver,\r\n    ComponentRef,\r\n    Input,\r\n    OnDestroy,\r\n    OnInit,\r\n    ViewChild,\r\n    ViewContainerRef,\r\n} from '@angular/core';\r\nimport { DashboardWidgetConfig } from '@vendure/admin-ui/core';\r\n\r\n@Component({\r\n    selector: 'vdr-dashboard-widget',\r\n    templateUrl: './dashboard-widget.component.html',\r\n    styleUrls: ['./dashboard-widget.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class DashboardWidgetComponent implements AfterViewInit, OnDestroy {\r\n    @Input() widgetConfig: DashboardWidgetConfig;\r\n\r\n    @ViewChild('portal', { read: ViewContainerRef })\r\n    private portal: ViewContainerRef;\r\n\r\n    private componentRef: ComponentRef<any>;\r\n\r\n    constructor(private componentFactoryResolver: ComponentFactoryResolver) {}\r\n\r\n    ngAfterViewInit(): void {\r\n        this.loadWidget();\r\n    }\r\n\r\n    private async loadWidget() {\r\n        const loadComponentResult = this.widgetConfig.loadComponent();\r\n        const componentType =\r\n            loadComponentResult instanceof Promise ? await loadComponentResult : loadComponentResult;\r\n        this.componentRef = this.portal.createComponent(\r\n            this.componentFactoryResolver.resolveComponentFactory(componentType),\r\n        );\r\n        this.componentRef.changeDetectorRef.markForCheck();\r\n    }\r\n\r\n    ngOnDestroy() {\r\n        if (this.componentRef) {\r\n            this.componentRef.destroy();\r\n        }\r\n    }\r\n}\r\n","<div class=\"widget-header\">\r\n    <vdr-dropdown>\r\n        <button class=\"btn btn-secondary btn-sm abcc\" vdrDropdownTrigger>\r\n            <clr-icon shape=\"plus\"></clr-icon>\r\n            {{ 'dashboard.add-widget' | translate }}\r\n        </button>\r\n        <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n            <button\r\n                class=\"button\"\r\n                vdrDropdownItem\r\n                *ngFor=\"let id of availableWidgetIds$ | async\"\r\n                (click)=\"addWidget(id)\"\r\n            >\r\n                {{ id }}\r\n            </button>\r\n        </vdr-dropdown-menu>\r\n    </vdr-dropdown>\r\n</div>\r\n<div cdkDropListGroup>\r\n    <div\r\n        class=\"clr-row dashboard-row\"\r\n        *ngFor=\"let row of widgetLayout; index as rowIndex; trackBy: trackRow\"\r\n        cdkDropList\r\n        (cdkDropListDropped)=\"drop($event)\"\r\n        cdkDropListOrientation=\"horizontal\"\r\n        [cdkDropListData]=\"{ index: rowIndex }\"\r\n    >\r\n        <div\r\n            *ngFor=\"let widget of row; trackBy: trackRowItem\"\r\n            class=\"dashboard-item\"\r\n            [ngClass]=\"getClassForWidth(widget.width)\"\r\n            cdkDrag\r\n            [cdkDragData]=\"widget\"\r\n        >\r\n            <vdr-dashboard-widget\r\n                *vdrIfPermissions=\"widget.config.requiresPermissions || null\"\r\n                [widgetConfig]=\"widget.config\"\r\n            >\r\n                <div class=\"flex\">\r\n                    <div class=\"drag-handle\" cdkDragHandle>\r\n                        <clr-icon shape=\"drag-handle\" size=\"24\"></clr-icon>\r\n                    </div>\r\n                    <vdr-dropdown>\r\n                        <button class=\"icon-button\" vdrDropdownTrigger>\r\n                            <clr-icon shape=\"ellipsis-vertical\"></clr-icon>\r\n                        </button>\r\n                        <vdr-dropdown-menu vdrPosition=\"bottom-right\">\r\n                            <h4 class=\"dropdown-header\">{{ 'dashboard.widget-resize' | translate }}</h4>\r\n                            <button\r\n                                class=\"button\"\r\n                                vdrDropdownItem\r\n                                [disabled]=\"width === widget.width\"\r\n                                *ngFor=\"let width of getSupportedWidths(widget.config)\"\r\n                                (click)=\"setWidgetWidth(widget, width)\"\r\n                            >\r\n                                {{ 'dashboard.widget-width' | translate: { width: width } }}\r\n                            </button>\r\n                            <div class=\"dropdown-divider\" role=\"separator\"></div>\r\n                            <button class=\"button\" vdrDropdownItem (click)=\"removeWidget(widget)\">\r\n                                <clr-icon shape=\"trash\" class=\"is-danger\"></clr-icon>\r\n                                {{ 'dashboard.remove-widget' | translate }}\r\n                            </button>\r\n                        </vdr-dropdown-menu>\r\n                    </vdr-dropdown>\r\n                </div>\r\n            </vdr-dashboard-widget>\r\n        </div>\r\n    </div>\r\n</div>\r\n","import { CdkDragDrop } from '@angular/cdk/drag-drop';\r\nimport { ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport {\r\n    DashboardWidgetConfig,\r\n    DashboardWidgetService,\r\n    DashboardWidgetWidth,\r\n    DataService,\r\n    LocalStorageService,\r\n    WidgetLayout,\r\n    WidgetLayoutDefinition,\r\n} from '@vendure/admin-ui/core';\r\nimport { assertNever } from '@vendure/common/lib/shared-utils';\r\nimport { Observable } from 'rxjs';\r\nimport { map, tap } from 'rxjs/operators';\r\n\r\n@Component({\r\n    selector: 'vdr-dashboard',\r\n    templateUrl: './dashboard.component.html',\r\n    styleUrls: ['./dashboard.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class DashboardComponent implements OnInit {\r\n    widgetLayout: WidgetLayout | undefined;\r\n    availableWidgetIds$: Observable<string[]>;\r\n    private readonly deletionMarker = '__delete__';\r\n\r\n    constructor(\r\n        private dashboardWidgetService: DashboardWidgetService,\r\n        private localStorageService: LocalStorageService,\r\n        private changedDetectorRef: ChangeDetectorRef,\r\n        private dataService: DataService,\r\n    ) {}\r\n\r\n    ngOnInit() {\r\n        this.availableWidgetIds$ = this.dataService.client.userStatus().stream$.pipe(\r\n            map(({ userStatus }) => userStatus.permissions),\r\n            map(permissions => this.dashboardWidgetService.getAvailableIds(permissions)),\r\n            tap(ids => (this.widgetLayout = this.initLayout(ids))),\r\n        );\r\n    }\r\n\r\n    getClassForWidth(width: DashboardWidgetWidth): string {\r\n        switch (width) {\r\n            case 3:\r\n                return `clr-col-12 clr-col-sm-6 clr-col-lg-3`;\r\n            case 4:\r\n                return `clr-col-12 clr-col-sm-6 clr-col-lg-4`;\r\n            case 6:\r\n                return `clr-col-12 clr-col-lg-6`;\r\n            case 8:\r\n                return `clr-col-12 clr-col-lg-8`;\r\n            case 12:\r\n                return `clr-col-12`;\r\n            default:\r\n                assertNever(width);\r\n        }\r\n    }\r\n\r\n    getSupportedWidths(config: DashboardWidgetConfig): DashboardWidgetWidth[] {\r\n        return config.supportedWidths || [3, 4, 6, 8, 12];\r\n    }\r\n\r\n    setWidgetWidth(widget: WidgetLayout[number][number], width: DashboardWidgetWidth) {\r\n        widget.width = width;\r\n        this.recalculateLayout();\r\n    }\r\n\r\n    trackRow(index: number, row: WidgetLayout[number]) {\r\n        const id = row.map(item => `${item.id}:${item.width}`).join('|');\r\n        return id;\r\n    }\r\n\r\n    trackRowItem(index: number, item: WidgetLayout[number][number]) {\r\n        return item.config;\r\n    }\r\n\r\n    addWidget(id: string) {\r\n        const config = this.dashboardWidgetService.getWidgetById(id);\r\n        if (config) {\r\n            const width = this.getSupportedWidths(config)[0];\r\n            const widget: WidgetLayout[number][number] = {\r\n                id,\r\n                config,\r\n                width,\r\n            };\r\n            let targetRow: WidgetLayout[number];\r\n            if (this.widgetLayout && this.widgetLayout.length) {\r\n                targetRow = this.widgetLayout[this.widgetLayout.length - 1];\r\n            } else {\r\n                targetRow = [];\r\n                this.widgetLayout?.push(targetRow);\r\n            }\r\n            targetRow.push(widget);\r\n            this.recalculateLayout();\r\n        }\r\n    }\r\n\r\n    removeWidget(widget: WidgetLayout[number][number]) {\r\n        widget.id = this.deletionMarker;\r\n        this.recalculateLayout();\r\n    }\r\n\r\n    drop(event: CdkDragDrop<{ index: number }>) {\r\n        const { currentIndex, previousIndex, previousContainer, container } = event;\r\n        if (previousIndex === currentIndex && previousContainer.data.index === container.data.index) {\r\n            // Nothing changed\r\n            return;\r\n        }\r\n        if (this.widgetLayout) {\r\n            const previousLayoutRow = this.widgetLayout[previousContainer.data.index];\r\n            const newLayoutRow = this.widgetLayout[container.data.index];\r\n\r\n            previousLayoutRow.splice(previousIndex, 1);\r\n            newLayoutRow.splice(currentIndex, 0, event.item.data);\r\n            this.recalculateLayout();\r\n        }\r\n    }\r\n\r\n    private initLayout(availableIds: string[]): WidgetLayout {\r\n        const savedLayoutDef = this.localStorageService.get('dashboardWidgetLayout');\r\n        let layoutDef: WidgetLayoutDefinition | undefined;\r\n        if (savedLayoutDef) {\r\n            // validate all the IDs from the saved layout are still available\r\n            layoutDef = savedLayoutDef.filter(item => availableIds.includes(item.id));\r\n        }\r\n        return this.dashboardWidgetService.getWidgetLayout(layoutDef);\r\n    }\r\n\r\n    private recalculateLayout() {\r\n        if (this.widgetLayout) {\r\n            const flattened = this.widgetLayout\r\n                .reduce((flat, row) => [...flat, ...row], [])\r\n                .filter(item => item.id !== this.deletionMarker);\r\n            const newLayoutDef: WidgetLayoutDefinition = flattened.map(item => ({\r\n                id: item.id,\r\n                width: item.width,\r\n            }));\r\n            this.widgetLayout = this.dashboardWidgetService.getWidgetLayout(newLayoutDef);\r\n            this.localStorageService.set('dashboardWidgetLayout', newLayoutDef);\r\n            setTimeout(() => this.changedDetectorRef.markForCheck());\r\n        }\r\n    }\r\n}\r\n","import { Routes } from '@angular/router';\r\n\r\nimport { DashboardComponent } from './components/dashboard/dashboard.component';\r\n\r\nexport const dashboardRoutes: Routes = [\r\n    {\r\n        path: '',\r\n        component: DashboardComponent,\r\n        pathMatch: 'full',\r\n    },\r\n];\r\n","<vdr-data-table [items]=\"latestOrders$ | async\">\r\n    <ng-template let-order=\"item\">\r\n        <td class=\"left align-middle\">\r\n            {{ order.code }}\r\n            <vdr-order-state-label [state]=\"order.state\"></vdr-order-state-label>\r\n        </td>\r\n        <td class=\"left align-middle\">\r\n            <vdr-customer-label [customer]=\"order.customer\"></vdr-customer-label>\r\n        </td>\r\n        <td class=\"left align-middle\">{{ order.total | localeCurrency: order.currencyCode }}</td>\r\n        <td class=\"left align-middle\">{{ order.orderPlacedAt | timeAgo }}</td>\r\n        <td class=\"right align-middle\">\r\n            <vdr-table-row-action\r\n                iconShape=\"shopping-cart\"\r\n                [label]=\"'common.open' | translate\"\r\n                [linkTo]=\"['/orders/', order.id]\"\r\n            ></vdr-table-row-action>\r\n        </td>\r\n    </ng-template>\r\n</vdr-data-table>\r\n","import { ChangeDetectionStrategy, Component, NgModule, OnInit } from '@angular/core';\r\nimport { CoreModule, DataService, GetOrderList, SharedModule, SortOrder } from '@vendure/admin-ui/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'vdr-latest-orders-widget',\r\n    templateUrl: './latest-orders-widget.component.html',\r\n    styleUrls: ['./latest-orders-widget.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class LatestOrdersWidgetComponent implements OnInit {\r\n    latestOrders$: Observable<GetOrderList.Items[]>;\r\n    constructor(private dataService: DataService) {}\r\n\r\n    ngOnInit(): void {\r\n        this.latestOrders$ = this.dataService.order\r\n            .getOrders({\r\n                take: 10,\r\n                filter: {\r\n                    active: { eq: false },\r\n                },\r\n                sort: {\r\n                    orderPlacedAt: SortOrder.DESC,\r\n                },\r\n            })\r\n            .refetchOnChannelChange()\r\n            .mapStream(data => data.orders.items);\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CoreModule, SharedModule],\r\n    declarations: [LatestOrdersWidgetComponent],\r\n})\r\nexport class LatestOrdersWidgetModule {}\r\n","<div class=\"stats\">\r\n    <div class=\"stat\">\r\n        <div class=\"stat-figure\">{{ totalOrderCount$ | async }}</div>\r\n        <div class=\"stat-label\">{{ 'dashboard.total-orders' | translate }}</div>\r\n    </div>\r\n    <div class=\"stat\">\r\n        <div class=\"stat-figure\">\r\n            {{ totalOrderValue$ | async | currency: (currencyCode$ | async) || undefined }}\r\n        </div>\r\n        <div class=\"stat-label\">{{ 'dashboard.total-order-value' | translate }}</div>\r\n    </div>\r\n</div>\r\n<div class=\"footer\">\r\n    <div class=\"btn-group btn-outline-primary btn-sm\" *ngIf=\"selection$ | async as selection\">\r\n        <button class=\"btn\" [class.btn-primary]=\"selection.date === today\" (click)=\"selection$.next({timeframe: 'day', date: today})\">\r\n            {{ 'dashboard.today' | translate }}\r\n        </button>\r\n        <button class=\"btn\" [class.btn-primary]=\"selection.date === yesterday\" (click)=\"selection$.next({timeframe: 'day', date: yesterday})\">\r\n            {{ 'dashboard.yesterday' | translate }}\r\n        </button>\r\n        <button class=\"btn\" [class.btn-primary]=\"selection.timeframe === 'week'\" (click)=\"selection$.next({timeframe: 'week'})\">\r\n            {{ 'dashboard.thisWeek' | translate }}\r\n        </button>\r\n        <button class=\"btn\" [class.btn-primary]=\"selection.timeframe === 'month'\" (click)=\"selection$.next({timeframe: 'month'})\">\r\n            {{ 'dashboard.thisMonth' | translate }}\r\n        </button>\r\n    </div>\r\n\r\n    <div class=\"date-range p5\" *ngIf=\"dateRange$ | async as range\">\r\n        {{ range.start | localeDate }} - {{ range.end | localeDate }}\r\n    </div>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, NgModule, OnInit } from '@angular/core';\r\nimport { CoreModule, DataService } from '@vendure/admin-ui/core';\r\nimport dayjs from 'dayjs';\r\nimport { BehaviorSubject, Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map, shareReplay, switchMap } from 'rxjs/operators';\r\n\r\nexport type Timeframe = 'day' | 'week' | 'month';\r\n\r\n@Component({\r\n    selector: 'vdr-order-summary-widget',\r\n    templateUrl: './order-summary-widget.component.html',\r\n    styleUrls: ['./order-summary-widget.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class OrderSummaryWidgetComponent implements OnInit {\r\n    today = new Date();\r\n    yesterday = new Date(new Date().setDate(this.today.getDate() - 1));\r\n    totalOrderCount$: Observable<number>;\r\n    totalOrderValue$: Observable<number>;\r\n    currencyCode$: Observable<string | undefined>;\r\n    selection$ = new BehaviorSubject<{ timeframe: Timeframe; date?: Date }>({\r\n        timeframe: 'day',\r\n        date: this.today,\r\n    });\r\n    dateRange$: Observable<{ start: Date; end: Date }>;\r\n\r\n    constructor(private dataService: DataService) {}\r\n\r\n    ngOnInit(): void {\r\n        this.dateRange$ = this.selection$.pipe(\r\n            distinctUntilChanged(),\r\n            map(selection => {\r\n                return {\r\n                    start: dayjs(selection.date).startOf(selection.timeframe).toDate(),\r\n                    end: dayjs(selection.date).endOf(selection.timeframe).toDate(),\r\n                };\r\n            }),\r\n            shareReplay(1),\r\n        );\r\n        const orderSummary$ = this.dateRange$.pipe(\r\n            switchMap(({ start, end }) => {\r\n                return this.dataService.order\r\n                    .getOrderSummary(start, end)\r\n                    .refetchOnChannelChange()\r\n                    .mapStream(data => data.orders);\r\n            }),\r\n            shareReplay(1),\r\n        );\r\n        this.totalOrderCount$ = orderSummary$.pipe(map(res => res.totalItems));\r\n        this.totalOrderValue$ = orderSummary$.pipe(\r\n            map(res => res.items.reduce((total, order) => total + order.total, 0) / 100),\r\n        );\r\n        this.currencyCode$ = this.dataService.settings\r\n            .getActiveChannel()\r\n            .refetchOnChannelChange()\r\n            .mapStream(data => data.activeChannel.currencyCode || undefined);\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CoreModule],\r\n    declarations: [OrderSummaryWidgetComponent],\r\n})\r\nexport class OrderSummaryWidgetModule {}\r\n","import { ChangeDetectionStrategy, Component, NgModule } from '@angular/core';\r\n\r\n@Component({\r\n    selector: 'vdr-test-widget',\r\n    templateUrl: './test-widget.component.html',\r\n    styleUrls: ['./test-widget.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class TestWidgetComponent {}\r\n\r\n@NgModule({\r\n    declarations: [TestWidgetComponent],\r\n})\r\nexport class TestWidgetModule {}\r\n","<p>This is a test widget!</p>\r\n","<div *ngIf=\"administrator$ | async as administrator\">\r\n    <h4 class=\"h4\">\r\n        Welcome, {{ administrator.firstName }} {{ administrator.lastName }}<br />\r\n        <small class=\"p5\">Last login: {{ administrator.user.lastLogin | timeAgo }}</small>\r\n    </h4>\r\n\r\n    <p class=\"p5\" *ngIf=\"!hideVendureBranding || !hideVersion\">\r\n        {{ hideVendureBranding ? '' : 'Vendure 001' }} {{ hideVersion ? '' : ('Admin UI v' + version) }}\r\n    </p>\r\n</div>\r\n<div class=\"placeholder\">\r\n    <clr-icon shape=\"line-chart\" size=\"128\"></clr-icon>\r\n</div>\r\n","import { ChangeDetectionStrategy, Component, NgModule, OnInit } from '@angular/core';\r\nimport {\r\n    Administrator,\r\n    ADMIN_UI_VERSION,\r\n    CoreModule,\r\n    DataService,\r\n    GetActiveAdministrator,\r\n    getAppConfig,\r\n} from '@vendure/admin-ui/core';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Component({\r\n    selector: 'vdr-welcome-widget',\r\n    templateUrl: './welcome-widget.component.html',\r\n    styleUrls: ['./welcome-widget.component.scss'],\r\n    changeDetection: ChangeDetectionStrategy.OnPush,\r\n})\r\nexport class WelcomeWidgetComponent implements OnInit {\r\n    version = ADMIN_UI_VERSION;\r\n    administrator$: Observable<GetActiveAdministrator.ActiveAdministrator | null>;\r\n    brand = getAppConfig().brand;\r\n    hideVendureBranding = getAppConfig().hideVendureBranding;\r\n    hideVersion = getAppConfig().hideVersion;\r\n\r\n    constructor(private dataService: DataService) {}\r\n\r\n    ngOnInit(): void {\r\n        this.administrator$ = this.dataService.administrator\r\n            .getActiveAdministrator()\r\n            .mapStream(data => data.activeAdministrator || null);\r\n    }\r\n}\r\n\r\n@NgModule({\r\n    imports: [CoreModule],\r\n    declarations: [WelcomeWidgetComponent],\r\n})\r\nexport class WelcomeWidgetModule {}\r\n","import { APP_INITIALIZER, FactoryProvider } from '@angular/core';\r\nimport { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';\r\nimport {\r\n    DashboardWidgetConfig,\r\n    DashboardWidgetService,\r\n    Permission,\r\n    WidgetLayoutDefinition,\r\n} from '@vendure/admin-ui/core';\r\n\r\nimport { LatestOrdersWidgetComponent } from './widgets/latest-orders-widget/latest-orders-widget.component';\r\nimport { OrderSummaryWidgetComponent } from './widgets/order-summary-widget/order-summary-widget.component';\r\nimport { TestWidgetComponent } from './widgets/test-widget/test-widget.component';\r\nimport { WelcomeWidgetComponent } from './widgets/welcome-widget/welcome-widget.component';\r\n\r\nexport const DEFAULT_DASHBOARD_WIDGET_LAYOUT: WidgetLayoutDefinition = [\r\n    { id: 'welcome', width: 12 },\r\n    { id: 'orderSummary', width: 6 },\r\n    { id: 'latestOrders', width: 6 },\r\n];\r\n\r\nexport const DEFAULT_WIDGETS: { [id: string]: DashboardWidgetConfig } = {\r\n    welcome: {\r\n        loadComponent: () => WelcomeWidgetComponent,\r\n    },\r\n    orderSummary: {\r\n        title: _('dashboard.orders-summary'),\r\n        loadComponent: () => OrderSummaryWidgetComponent,\r\n        requiresPermissions: [Permission.ReadOrder],\r\n    },\r\n    latestOrders: {\r\n        title: _('dashboard.latest-orders'),\r\n        loadComponent: () => LatestOrdersWidgetComponent,\r\n        supportedWidths: [6, 8, 12],\r\n        requiresPermissions: [Permission.ReadOrder],\r\n    },\r\n    testWidget: {\r\n        title: 'Test Widget',\r\n        loadComponent: () => TestWidgetComponent,\r\n    },\r\n};\r\n","import { NgModule } from '@angular/core';\r\nimport { RouterModule } from '@angular/router';\r\nimport { DashboardWidgetService, SharedModule } from '@vendure/admin-ui/core';\r\n\r\nimport { DashboardWidgetComponent } from './components/dashboard-widget/dashboard-widget.component';\r\nimport { DashboardComponent } from './components/dashboard/dashboard.component';\r\nimport { dashboardRoutes } from './dashboard.routes';\r\nimport { DEFAULT_DASHBOARD_WIDGET_LAYOUT, DEFAULT_WIDGETS } from './default-widgets';\r\n\r\n@NgModule({\r\n    imports: [SharedModule, RouterModule.forChild(dashboardRoutes)],\r\n    declarations: [DashboardComponent, DashboardWidgetComponent],\r\n})\r\nexport class DashboardModule {\r\n    constructor(dashboardWidgetService: DashboardWidgetService) {\r\n        Object.entries(DEFAULT_WIDGETS).map(([id, config]) =>\r\n            dashboardWidgetService.registerWidget(id, config),\r\n        );\r\n        if (dashboardWidgetService.getDefaultLayout().length === 0) {\r\n            dashboardWidgetService.setDefaultLayout(DEFAULT_DASHBOARD_WIDGET_LAYOUT);\r\n        }\r\n    }\r\n}\r\n"]}