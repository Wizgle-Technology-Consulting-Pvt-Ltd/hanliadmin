!function(){function e(t,n,c){return(e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var c=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(c){var r=Object.getOwnPropertyDescriptor(c,t);return r.get?r.get.call(n):r.value}})(t,n,c||t)}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,c=a(e);if(t){var i=a(this).constructor;n=Reflect.construct(c,arguments,i)}else n=c.apply(this,arguments);return r(this,n)}}function r(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?i(e):t}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var c=0,r=function(){};return{s:r,n:function(){return c>=e.length?{done:!0}:{done:!1,value:e[c++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],c=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(c=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);c=!0);}catch(l){r=!0,i=l}finally{try{c||null==o.return||o.return()}finally{if(r)throw i}}return n}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,c=new Array(t);n<t;n++)c[n]=e[n];return c}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function p(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{ymA1:function(n,r,d){"use strict";d.r(r),d.d(r,"AddManualPaymentDialogComponent",function(){return k}),d.d(r,"CancelOrderDialogComponent",function(){return W}),d.d(r,"FulfillOrderDialogComponent",function(){return U}),d.d(r,"FulfillmentCardComponent",function(){return ve}),d.d(r,"FulfillmentDetailComponent",function(){return ae}),d.d(r,"FulfillmentStateLabelComponent",function(){return Y}),d.d(r,"LineFulfillmentComponent",function(){return Ve}),d.d(r,"LineRefundsComponent",function(){return Le}),d.d(r,"ModificationDetailComponent",function(){return Ne}),d.d(r,"OrderCustomFieldsCardComponent",function(){return qe}),d.d(r,"OrderDetailComponent",function(){return _c}),d.d(r,"OrderEditorComponent",function(){return Ir}),d.d(r,"OrderEditResultType",function(){return Lc}),d.d(r,"OrderEditsPreviewDialogComponent",function(){return Ec}),d.d(r,"OrderHistoryComponent",function(){return Jn}),d.d(r,"OrderListComponent",function(){return Wr}),d.d(r,"OrderPaymentCardComponent",function(){return pc}),d.d(r,"NODE_HEIGHT",function(){return mt}),d.d(r,"OrderProcessEdgeComponent",function(){return vt}),d.d(r,"OrderProcessGraphComponent",function(){return Ot}),d.d(r,"OrderProcessNodeComponent",function(){return ht}),d.d(r,"OrderProcessGraphDialogComponent",function(){return It}),d.d(r,"OrderStateSelectDialogComponent",function(){return dt}),d.d(r,"OrderTableComponent",function(){return sn}),d.d(r,"PaymentDetailComponent",function(){return pn}),d.d(r,"PaymentStateLabelComponent",function(){return ec}),d.d(r,"RefundOrderDialogComponent",function(){return Et}),d.d(r,"RefundStateLabelComponent",function(){return nc}),d.d(r,"SettleRefundDialogComponent",function(){return Ht}),d.d(r,"SimpleItemListComponent",function(){return ee}),d.d(r,"OrderModule",function(){return $r}),d.d(r,"orderRoutes",function(){return Rr}),d.d(r,"orderBreadcrumb",function(){return Er}),d.d(r,"modifyingOrderBreadcrumb",function(){return Xr}),d.d(r,"OrderTransitionService",function(){return ut}),d.d(r,"OrderResolver",function(){return Nr});var u=d("3Pt+"),m=d("t9nd"),h=d("fXoL"),b=d("xUfP"),v=d("1XD6"),y=d("ZOsW"),C=d("Bzlx"),O=d("jHbs"),Q=d("sYmb"),I=d("ofXK"),T=d("ZFbG");function S(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.add-payment-to-order"))}function P(e,t){if(1&e){var n=h.ic();h.hc(0,"button",7),h.pc("click",function(){return h.Lc(n),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",8),h.pc("click",function(){return h.Lc(n),h.rc().submit()}),h.Vc(4),h.sc(5,"translate"),h.sc(6,"localeCurrency"),h.gc()}if(2&e){var c=h.rc();h.Qb(1),h.Wc(h.tc(2,4,"common.cancel")),h.Qb(2),h.yc("disabled",c.form.invalid||c.form.pristine),h.Qb(1),h.Yc(" ",h.tc(5,6,"order.add-payment")," (",h.uc(6,8,c.outstandingAmount,c.currencyCode),") ")}}var k=function(){function e(t){g(this,e),this.dataService=t,this.form=new u.i({method:new u.f("",u.C.required),transactionId:new u.f("",u.C.required)})}return p(e,[{key:"ngOnInit",value:function(){this.paymentMethods$=this.dataService.settings.getPaymentMethods(999).mapSingle(function(e){return e.paymentMethods.items})}},{key:"submit",value:function(){var e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();k.\u0275fac=function(e){return new(e||k)(h.bc(m.s))},k.\u0275cmp=h.Vb({type:k,selectors:[["vdr-add-manual-payment-dialog"]],decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,S,2,3,"ng-template",0),h.hc(1,"form",1),h.hc(2,"vdr-form-field",2),h.sc(3,"translate"),h.cc(4,"ng-select",3),h.sc(5,"async"),h.gc(),h.hc(6,"vdr-form-field",4),h.sc(7,"translate"),h.cc(8,"input",5),h.gc(),h.gc(),h.Tc(9,P,7,11,"ng-template",6)),2&e&&(h.Qb(1),h.yc("formGroup",t.form),h.Qb(1),h.yc("label",h.tc(3,5,"order.payment-method")),h.Qb(2),h.yc("items",h.tc(5,7,t.paymentMethods$))("addTag",!0),h.Qb(2),h.yc("label",h.tc(7,9,"order.transaction-id")))},directives:[b.a,u.E,u.q,u.j,v.a,y.a,u.p,u.h,C.a,u.b,O.a],pipes:[Q.d,I.b,T.a],styles:[".ng-select[_ngcontent-%COMP%]{min-width:100%}"],changeDetection:0});var F=d("OxKu"),M=d("8MG2"),V=d("PPsv");function x(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.cancel-order"))}function w(e,t){if(1&e){var n=h.ic();h.hc(0,"input",18),h.pc("ngModelChange",function(e){h.Lc(n);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id]=e}),h.gc()}if(2&e){var c=h.rc().$implicit,r=h.rc();h.yc("ngModel",r.lineQuantities[c.id])("max",c.quantity)}}function _(e,t){if(1&e&&h.Vc(0),2&e){var n=h.rc().$implicit;h.Wc(n.quantity)}}function L(e,t){if(1&e&&(h.hc(0,"tr",9),h.hc(1,"td",10),h.cc(2,"img",11),h.sc(3,"assetPreview"),h.gc(),h.hc(4,"td",12),h.Vc(5),h.gc(),h.hc(6,"td",13),h.Vc(7),h.gc(),h.hc(8,"td",14),h.Vc(9),h.gc(),h.hc(10,"td",14),h.Vc(11),h.sc(12,"localeCurrency"),h.gc(),h.hc(13,"td",15),h.Tc(14,w,1,2,"input",16),h.Tc(15,_,1,1,"ng-template",null,17,h.Uc),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.Ic(16),r=h.rc();h.Tb("is-cancelled",0===n.quantity),h.Qb(2),h.yc("src",h.uc(3,9,n.featuredAsset,"tiny"),h.Nc),h.Qb(3),h.Wc(n.productVariant.name),h.Qb(2),h.Wc(n.productVariant.sku),h.Qb(2),h.Wc(n.quantity),h.Qb(2),h.Xc(" ",h.uc(12,12,n.unitPriceWithTax,r.order.currencyCode)," "),h.Qb(3),h.yc("ngIf",n.quantity>0&&!r.order.active)("ngIfElse",c)}}function A(e,t){1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-selected-items")," "))}function j(e,t){1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-order")," "))}function D(e,t){if(1&e){var n=h.ic();h.hc(0,"button",19),h.pc("click",function(){return h.Lc(n),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",20),h.pc("click",function(){return h.Lc(n),h.rc().select()}),h.Tc(4,A,3,3,"ng-container",21),h.Tc(5,j,3,3,"ng-container",21),h.gc()}if(2&e){var c=h.rc();h.Qb(1),h.Wc(h.tc(2,4,"common.cancel")),h.Qb(2),h.yc("disabled",!c.reason||!c.order.active&&0===c.selectionCount),h.Qb(1),h.yc("ngIf",!c.order.active),h.Qb(1),h.yc("ngIf",c.order.active)}}var W=function(){function e(t){var n=this;g(this,e),this.i18nService=t,this.lineQuantities={},this.reasons=[Object(F.a)("order.cancel-reason-customer-request"),Object(F.a)("order.cancel-reason-not-available")],this.reasons=this.reasons.map(function(e){return n.i18nService.translate(e)})}return p(e,[{key:"selectionCount",get:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e+t},0)}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce(function(e,t){return Object.assign(Object.assign({},e),f({},t.id,0))},{})}},{key:"select",value:function(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason})}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getLineInputs",value:function(){if(!this.order.active)return Object.entries(this.lineQuantities).map(function(e){var t=s(e,2);return{orderLineId:t[0],quantity:t[1]}}).filter(function(e){return 0<e.quantity})}}]),e}();W.\u0275fac=function(e){return new(e||W)(h.bc(m.z))},W.\u0275cmp=h.Vb({type:W,selectors:[["vdr-cancel-order-dialog"]],decls:29,vars:22,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"items","addTag","ngModel","ngModelChange"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange",4,"ngIf","ngIfElse"],["nonEditable",""],["type","number","min","0",3,"ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"]],template:function(e,t){1&e&&(h.Tc(0,x,2,3,"ng-template",0),h.hc(1,"div",1),h.hc(2,"div",2),h.hc(3,"table",3),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.Tc(22,L,17,15,"tr",4),h.gc(),h.gc(),h.hc(23,"div",5),h.hc(24,"label",6),h.Vc(25),h.sc(26,"translate"),h.gc(),h.hc(27,"ng-select",7),h.pc("ngModelChange",function(e){return t.reason=e}),h.gc(),h.gc(),h.gc(),h.Tc(28,D,6,6,"ng-template",8)),2&e&&(h.Qb(8),h.Wc(h.tc(9,10,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,12,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,14,"order.quantity")),h.Qb(3),h.Wc(h.tc(18,16,"order.unit-price")),h.Qb(3),h.Wc(h.tc(21,18,"order.cancel")),h.Qb(2),h.yc("ngForOf",t.order.lines),h.Qb(3),h.Wc(h.tc(26,20,"order.cancellation-reason")),h.Qb(2),h.yc("items",t.reasons)("addTag",!0)("ngModel",t.reason))},directives:[b.a,I.n,M.u,y.a,u.p,u.s,O.a,I.o,C.a,u.v,u.b],pipes:[Q.d,V.a,T.a],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}"],changeDetection:0});var N=d("qqSn"),R=d("7xiD");function E(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.fulfill-order"))}function X(e,t){if(1&e&&(h.cc(0,"img",17),h.sc(1,"assetPreview")),2&e){var n=h.rc().$implicit;h.yc("src",h.uc(1,1,n.featuredAsset,"tiny"),h.Nc)}}function $(e,t){if(1&e){var n=h.ic();h.hc(0,"input",18),h.pc("ngModelChange",function(e){h.Lc(n);var t=h.rc().$implicit;return h.rc().fulfillmentQuantities[t.id].fulfillCount=e}),h.gc()}if(2&e){var c=h.rc().$implicit,r=h.rc();h.yc("disabled",0===r.getUnfulfilledCount(c))("ngModel",r.fulfillmentQuantities[c.id].fulfillCount)("max",r.fulfillmentQuantities[c.id].max)}}function q(e,t){if(1&e&&(h.hc(0,"tr",9),h.hc(1,"td",10),h.Tc(2,X,2,4,"img",11),h.gc(),h.hc(3,"td",12),h.Vc(4),h.gc(),h.hc(5,"td",13),h.Vc(6),h.gc(),h.hc(7,"td",14),h.Vc(8),h.gc(),h.hc(9,"td",14),h.Vc(10),h.gc(),h.hc(11,"td",15),h.Tc(12,$,1,3,"input",16),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc();h.Tb("ignore",0===c.getUnfulfilledCount(n)),h.Qb(2),h.yc("ngIf",n.featuredAsset),h.Qb(2),h.Wc(n.productVariant.name),h.Qb(2),h.Wc(n.productVariant.sku),h.Qb(2),h.Wc(c.getUnfulfilledCount(n)),h.Qb(2),h.Wc(n.productVariant.stockOnHand),h.Qb(2),h.yc("ngIf",c.fulfillmentQuantities[n.id])}}function H(e,t){if(1&e){var n=h.ic();h.hc(0,"button",19),h.pc("click",function(){return h.Lc(n),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",20),h.pc("click",function(){return h.Lc(n),h.rc().select()}),h.Vc(4),h.sc(5,"translate"),h.gc()}if(2&e){var c=h.rc();h.Qb(1),h.Wc(h.tc(2,3,"common.cancel")),h.Qb(2),h.yc("disabled",!c.canSubmit()),h.Qb(1),h.Xc(" ",h.tc(5,5,"order.create-fulfillment")," ")}}var U=function(){function e(t,n){g(this,e),this.dataService=t,this.changeDetector=n,this.fulfillmentHandlerControl=new u.f,this.fulfillmentQuantities={}}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.dataService.settings.getGlobalSettings().single$.subscribe(function(t){var n=t.globalSettings;e.fulfillmentQuantities=e.order.lines.reduce(function(t,c){var r=e.getFulfillableCount(c,n.trackInventory);return Object.assign(Object.assign({},t),f({},c.id,{fulfillCount:r,max:r}))},{}),e.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(function(e){return e.fulfillmentHandlers}).subscribe(function(t){e.fulfillmentHandlerDef=t.find(function(t){var n,c;return t.code===(null===(c=null===(n=e.order.shippingLines[0])||void 0===n?void 0:n.shippingMethod)||void 0===c?void 0:c.fulfillmentHandlerCode)})||t[0],e.fulfillmentHandler=Object(m.M)(e.fulfillmentHandlerDef),e.fulfillmentHandlerControl.patchValue(e.fulfillmentHandler),e.changeDetector.markForCheck()})}},{key:"getFulfillableCount",value:function(e,t){var n=e.productVariant,c=n.trackInventory,r=n.stockOnHand,i=c===m.w.INHERIT?t:c===m.w.TRUE,a=this.getUnfulfilledCount(e);return i?Math.min(a,r):a}},{key:"getUnfulfilledCount",value:function(e){var t=e.items.reduce(function(e,t){return e+(t.fulfillment?1:0)},0);return e.quantity-t}},{key:"canSubmit",value:function(){var e=Object.values(this.fulfillmentQuantities).reduce(function(e,t){return e+t.fulfillCount},0);return Object(m.N)(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<e}},{key:"select",value:function(){var e=Object.entries(this.fulfillmentQuantities).map(function(e){var t=s(e,2);return{orderLineId:t[0],quantity:t[1].fulfillCount}});this.resolveWith({lines:e,handler:Object(m.Z)(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();U.\u0275fac=function(e){return new(e||U)(h.bc(m.s),h.bc(h.j))},U.\u0275cmp=h.Vb({type:U,selectors:[["vdr-fulfill-order-dialog"]],decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,E,2,3,"ng-template",0),h.hc(1,"div",1),h.hc(2,"div",2),h.hc(3,"table",3),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.Tc(22,q,13,8,"tr",4),h.gc(),h.gc(),h.hc(23,"div",5),h.cc(24,"vdr-formatted-address",6),h.hc(25,"h6"),h.Vc(26),h.sc(27,"translate"),h.gc(),h.Vc(28),h.hc(29,"strong"),h.Vc(30),h.sc(31,"localeCurrency"),h.gc(),h.cc(32,"vdr-configurable-input",7),h.gc(),h.gc(),h.Tc(33,H,6,7,"ng-template",8)),2&e&&(h.Qb(8),h.Wc(h.tc(9,14,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,16,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,18,"order.unfulfilled")),h.Qb(3),h.Wc(h.tc(18,20,"catalog.stock-on-hand")),h.Qb(3),h.Wc(h.tc(21,22,"order.fulfill")),h.Qb(2),h.yc("ngForOf",t.order.lines),h.Qb(2),h.yc("address",t.order.shippingAddress),h.Qb(2),h.Wc(h.tc(27,24,"order.shipping-method")),h.Qb(2),h.Xc(" ",null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name," "),h.Qb(2),h.Wc(h.uc(31,26,t.order.shipping,t.order.currencyCode)),h.Qb(2),h.yc("operationDefinition",t.fulfillmentHandlerDef)("operation",t.fulfillmentHandler)("formControl",t.fulfillmentHandlerControl)("removable",!1))},directives:[b.a,I.n,N.a,R.a,u.p,u.g,O.a,I.o,C.a,u.v,u.b,u.s],pipes:[Q.d,T.a,V.a],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width:768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-left:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}"],changeDetection:0});var G=d("2/wi"),z=d("ocEb");function B(e,t){1&e&&h.cc(0,"clr-icon",2)}var Y=function(){function e(){g(this,e)}return p(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}}]),e}();Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275cmp=h.Vb({type:Y,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(h.hc(0,"vdr-chip",0),h.sc(1,"translate"),h.Tc(2,B,1,0,"clr-icon",1),h.Vc(3),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()),2&e&&(h.yc("title",h.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),h.Qb(2),h.yc("ngIf","Delivered"===t.state),h.Qb(1),h.Xc(" ",h.tc(4,6,h.tc(5,8,t.state)),"\n"))},directives:[G.a,I.o,M.o],pipes:[Q.d,z.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var J=d("hG4v"),Z=d("0MpJ");function K(e,t){if(1&e&&(h.hc(0,"li",2),h.hc(1,"div",3),h.Vc(2),h.gc(),h.cc(3,"clr-icon",4),h.Vc(4),h.gc()),2&e){var n=t.$implicit;h.yc("title",n.name),h.Qb(2),h.Wc(n.quantity),h.Qb(2),h.Xc(" ",n.name," ")}}var ee=function e(){g(this,e)};ee.\u0275fac=function(e){return new(e||ee)},ee.\u0275cmp=h.Vb({type:ee,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],[1,"quantity"],["shape","times","size","12"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.hc(1,"ul"),h.Tc(2,K,5,3,"li",1),h.gc(),h.gc()),2&e&&(h.Qb(2),h.yc("ngForOf",t.items))},directives:[I.n,M.o],styles:[".items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-left:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}"],changeDetection:0});var te=d("Lbhx"),ne=d("HMPB");function ce(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc();h.yc("label",h.tc(1,2,"order.tracking-code")),h.Qb(2),h.Xc(" ",null==n.fulfillment?null:n.fulfillment.trackingCode,"\n")}}function re(e,t){if(1&e&&h.cc(0,"vdr-custom-field-control",5),2&e){var n=h.rc().$implicit,c=h.rc();h.yc("readonly",!0)("compact",!0)("customField",n)("customFieldsFormGroup",c.customFieldFormGroup)}}function ie(e,t){if(1&e&&(h.fc(0),h.Tc(1,re,1,4,"vdr-custom-field-control",4),h.ec()),2&e){var n=t.$implicit,c=h.rc();h.Qb(1),h.yc("ngIf",c.customFieldFormGroup.get(n.name))}}var ae=function(){function e(t){g(this,e),this.serverConfigService=t,this.customFieldConfig=[],this.customFieldFormGroup=new u.i({})}return p(e,[{key:"ngOnInit",value:function(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}},{key:"ngOnChanges",value:function(e){this.buildCustomFieldsFormGroup()}},{key:"fulfillment",get:function(){var e=this;return this.order.fulfillments&&this.order.fulfillments.find(function(t){return t.id===e.fulfillmentId})}},{key:"items",get:function(){var e,t,n=new Map,c=null===(e=this.fulfillment)||void 0===e?void 0:e.orderItems.map(function(e){return e.id}),r=l(this.order.lines);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=l(a.items);try{for(o.s();!(i=o.n()).done;){var d=i.value;if(null==c?void 0:c.includes(d.id)){var u=n.get(a.productVariant.name);null!=u?n.set(a.productVariant.name,u+1):n.set(a.productVariant.name,1)}}}catch(f){o.e(f)}finally{o.f()}}}catch(f){r.e(f)}finally{r.f()}return Array.from(n.entries()).map(function(e){var t=s(e,2);return{name:t[0],quantity:t[1]}})}},{key:"buildCustomFieldsFormGroup",value:function(){var e,t=this.fulfillment.customFields,n=l(this.serverConfigService.getCustomFieldsFor("Fulfillment"));try{for(n.s();!(e=n.n()).done;){var c=e.value;this.customFieldFormGroup.addControl(c.name,new u.f(t[c.name]))}}catch(r){n.e(r)}finally{n.f()}}},{key:"customFieldIsObject",value:function(e){return Array.isArray(e)||Object(J.isObject)(e)}}]),e}();ae.\u0275fac=function(e){return new(e||ae)(h.bc(m.I))},ae.\u0275cmp=h.Vb({type:ae,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},features:[h.Ob],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(e,t){1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.sc(3,"localeDate"),h.gc(),h.hc(4,"vdr-labeled-data",0),h.sc(5,"translate"),h.Vc(6),h.gc(),h.Tc(7,ce,3,4,"vdr-labeled-data",1),h.hc(8,"vdr-labeled-data",0),h.sc(9,"translate"),h.cc(10,"vdr-simple-item-list",2),h.gc(),h.Tc(11,ie,2,1,"ng-container",3)),2&e&&(h.yc("label",h.tc(1,8,"common.created-at")),h.Qb(2),h.Xc(" ",h.uc(3,10,null==t.fulfillment?null:t.fulfillment.createdAt,"medium"),"\n"),h.Qb(2),h.yc("label",h.tc(5,13,"order.fulfillment-method")),h.Qb(2),h.Xc(" ",null==t.fulfillment?null:t.fulfillment.method,"\n"),h.Qb(1),h.yc("ngIf",null==t.fulfillment?null:t.fulfillment.trackingCode),h.Qb(1),h.yc("label",h.tc(9,15,"order.contents")),h.Qb(2),h.yc("items",t.items),h.Qb(1),h.yc("ngForOf",t.customFieldConfig))},directives:[Z.a,I.o,ee,I.n,te.a],pipes:[Q.d,ne.a],styles:[""],changeDetection:0});var oe=d("zzDm"),le=d("eBFp"),se=d("IKcI"),de=d("EFLa");function ue(e,t){if(1&e&&h.cc(0,"vdr-fulfillment-detail",7),2&e){var n=h.rc();h.yc("fulfillmentId",null==n.fulfillment?null:n.fulfillment.id)("order",n.order)}}var fe=function(e){return{state:e}};function ge(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"button",14),h.pc("click",function(){h.Lc(n);var e=t.ngIf;return h.rc(2).transitionState.emit(e)}),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc(),h.ec()}if(2&e){var c=t.ngIf;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.set-fulfillment-state",h.Cc(8,fe,h.tc(4,4,h.tc(5,6,c))))," ")}}function me(e,t){if(1&e&&(h.fc(0),h.cc(1,"clr-icon",18),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.ec()),2&e){var n=h.rc().$implicit;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.transition-to-state",h.Cc(8,fe,h.tc(4,4,h.tc(5,6,n))))," ")}}function pe(e,t){1&e&&(h.cc(0,"clr-icon",19),h.Vc(1),h.sc(2,"translate")),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-fulfillment")," "))}function he(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"button",15),h.pc("click",function(){h.Lc(n);var e=t.$implicit;return h.rc(2).transitionState.emit(e)}),h.Tc(2,me,6,10,"ng-container",16),h.Tc(3,pe,3,3,"ng-template",null,17,h.Uc),h.gc(),h.ec()}if(2&e){var c=t.$implicit,r=h.Ic(4);h.Qb(2),h.yc("ngIf","Cancelled"!==c)("ngIfElse",r)}}function be(e,t){if(1&e&&(h.hc(0,"div",8),h.Tc(1,ge,6,10,"ng-container",9),h.hc(2,"vdr-dropdown"),h.hc(3,"button",10),h.cc(4,"clr-icon",11),h.gc(),h.hc(5,"vdr-dropdown-menu",12),h.Tc(6,he,5,2,"ng-container",13),h.gc(),h.gc(),h.gc()),2&e){var n=h.rc();h.Qb(1),h.yc("ngIf",n.nextSuggestedState()),h.Qb(5),h.yc("ngForOf",n.nextOtherStates())}}var ve=function(){function e(){g(this,e),this.transitionState=new h.t}return p(e,[{key:"nextSuggestedState",value:function(){var e;if(this.fulfillment){var t=this.fulfillment.nextStates,n=function(e){return t.includes(e)?e:t[0]};switch(null===(e=this.fulfillment)||void 0===e?void 0:e.state){case"Pending":return n("Shipped");case"Shipped":return n("Delivered");default:return t.find(function(e){return"Cancelled"!==e})}}}},{key:"nextOtherStates",value:function(){if(!this.fulfillment)return[];var e=this.nextSuggestedState();return this.fulfillment.nextStates.filter(function(t){return t!==e})}}]),e}();function ye(e,t){1&e&&h.cc(0,"clr-icon",9)}function Ce(e,t){1&e&&h.cc(0,"clr-icon",10)}function Oe(e,t){1&e&&h.cc(0,"clr-icon",11)}function Qe(e,t){1&e&&(h.hc(0,"label",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.line-fulfillment-all")," "))}ve.\u0275fac=function(e){return new(e||ve)},ve.\u0275cmp=h.Vb({type:ve,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},decls:10,vars:6,consts:[[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.hc(1,"div",1),h.hc(2,"div"),h.Vc(3),h.sc(4,"translate"),h.gc(),h.hc(5,"div",2),h.cc(6,"vdr-fulfillment-state-label",3),h.gc(),h.gc(),h.hc(7,"div",4),h.Tc(8,ue,1,2,"vdr-fulfillment-detail",5),h.gc(),h.Tc(9,be,7,2,"div",6),h.gc()),2&e&&(h.Qb(3),h.Wc(h.tc(4,4,"order.fulfillment")),h.Qb(3),h.yc("state",null==t.fulfillment?null:t.fulfillment.state),h.Qb(2),h.yc("ngIf",!!t.fulfillment),h.Qb(1),h.yc("ngIf",null==t.fulfillment?null:t.fulfillment.nextStates.length))},directives:[Y,I.o,ae,oe.a,le.a,M.o,se.a,I.n,de.a],pipes:[Q.d,z.a],styles:[".fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Ie=function(e,t){return{total:e,count:t}};function Te(e,t){if(1&e&&(h.hc(0,"label",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var n=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.line-fulfillment-partial",h.Dc(4,Ie,n.line.quantity,n.fulfilledCount))," ")}}function Se(e,t){1&e&&(h.hc(0,"label",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.line-fulfillment-none")," "))}function Pe(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",15),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.tracking-code")),h.Qb(2),h.Xc(" ",n.fulfillment.trackingCode," ")}}var ke=function(e){return{count:e}};function Fe(e,t){if(1&e&&(h.hc(0,"div",13),h.hc(1,"div",14),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.gc(),h.hc(5,"vdr-labeled-data",15),h.sc(6,"translate"),h.Vc(7),h.sc(8,"localeDate"),h.gc(),h.hc(9,"vdr-labeled-data",15),h.sc(10,"translate"),h.Vc(11),h.gc(),h.Tc(12,Pe,3,4,"vdr-labeled-data",16),h.gc()),2&e){var n=t.$implicit;h.Qb(2),h.Zc(" ",h.tc(3,8,"order.fulfillment")," #",n.fulfillment.id," (",h.uc(4,10,"order.item-count",h.Cc(20,ke,n.count)),") "),h.Qb(3),h.yc("label",h.tc(6,13,"common.created-at")),h.Qb(2),h.Xc(" ",h.uc(8,15,n.fulfillment.createdAt,"medium")," "),h.Qb(2),h.yc("label",h.tc(10,18,"order.fulfillment-method")),h.Qb(2),h.Xc(" ",n.fulfillment.method," "),h.Qb(1),h.yc("ngIf",n.fulfillment.trackingCode)}}function Me(e,t){if(1&e&&(h.hc(0,"vdr-dropdown",1),h.hc(1,"button",2),h.Tc(2,ye,1,0,"clr-icon",3),h.Tc(3,Ce,1,0,"clr-icon",4),h.Tc(4,Oe,1,0,"clr-icon",5),h.gc(),h.hc(5,"vdr-dropdown-menu",6),h.Tc(6,Qe,3,3,"label",7),h.Tc(7,Te,3,7,"label",7),h.Tc(8,Se,3,3,"label",7),h.Tc(9,Fe,13,22,"div",8),h.gc(),h.gc()),2&e){var n=h.rc();h.Qb(2),h.yc("ngIf","full"===n.fulfillmentStatus),h.Qb(1),h.yc("ngIf","partial"===n.fulfillmentStatus),h.Qb(1),h.yc("ngIf","none"===n.fulfillmentStatus),h.Qb(2),h.yc("ngIf","full"===n.fulfillmentStatus),h.Qb(1),h.yc("ngIf","partial"===n.fulfillmentStatus),h.Qb(1),h.yc("ngIf","none"===n.fulfillmentStatus),h.Qb(1),h.yc("ngForOf",n.fulfillments)}}var Ve=function(){function e(){g(this,e),this.fulfilledCount=0,this.fulfillments=[]}return p(e,[{key:"ngOnChanges",value:function(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.items.length),this.fulfillments=this.getFulfillments(this.line))}},{key:"getDeliveredCount",value:function(e){return e.items.reduce(function(e,t){return e+(t.fulfillment?1:0)},0)}},{key:"getFulfillmentStatus",value:function(e,t){return e===t?"full":0<e&&e<t?"partial":"none"}},{key:"getFulfillments",value:function(e){var t,n={},c=l(e.items);try{for(c.s();!(t=c.n()).done;){var r=t.value;r.fulfillment&&(void 0===n[r.fulfillment.id]?n[r.fulfillment.id]=1:n[r.fulfillment.id]++)}}catch(a){c.e(a)}finally{c.f()}var i=e.items.reduce(function(e,t){return t.fulfillment?[].concat(o(e),[t.fulfillment]):e},[]);return Object.entries(n).map(function(e){var t=s(e,2),n=t[0];return{count:t[1],fulfillment:i.find(function(e){return e.id===n})}})}}]),e}();Ve.\u0275fac=function(e){return new(e||Ve)},Ve.\u0275cmp=h.Vb({type:Ve,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",orderState:"orderState"},features:[h.Ob],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(e,t){1&e&&h.Tc(0,Me,10,7,"vdr-dropdown",0),2&e&&h.yc("ngIf",t.fulfilledCount||"PartiallyDelivered"===t.orderState)},directives:[I.o,oe.a,le.a,se.a,I.n,M.o,M.u,Z.a],pipes:[Q.d,ne.a],styles:[".item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-500)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-500)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-500)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}"],changeDetection:0});var xe=d("cH1L"),we=function(e){return{count:e}};function _e(e,t){if(1&e&&(h.hc(0,"span",1),h.sc(1,"translate"),h.cc(2,"clr-icon",2),h.gc()),2&e){var n=h.rc();h.yc("title",h.uc(1,1,"order.refunded-count",h.Cc(4,we,n.getRefundedCount())))}}var Le=function(){function e(){g(this,e)}return p(e,[{key:"getRefundedCount",value:function(){var e,t,n=null!==(t=null===(e=this.payments)||void 0===e?void 0:e.reduce(function(e,t){return[].concat(o(e),o(t.refunds))},[]))&&void 0!==t?t:[];return this.line.items.filter(function(e){if(null===e.refundId&&!e.cancelled)return!1;if(e.refundId){var t=n.find(function(t){return t.id===e.refundId});return"Failed"!==(null==t?void 0:t.state)}return!1}).length}}]),e}();function Ae(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc();h.yc("label",h.tc(1,2,"order.note")),h.Qb(2),h.Wc(n.modification.note)}}function je(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.sc(3,"localeCurrency"),h.gc()),2&e){var n=t.$implicit,c=h.rc(),r=null;h.yc("label",h.tc(1,3,"order.surcharges")),h.Qb(2),h.Yc(" ",null==(r=c.getSurcharge(n.id))?null:r.description," ",h.uc(3,5,null==(r=c.getSurcharge(n.id))?null:r.priceWithTax,c.order.currencyCode),"")}}function De(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.cc(2,"vdr-simple-item-list",3),h.gc()),2&e){var n=h.rc();h.yc("label",h.tc(1,2,"order.added-items")),h.Qb(2),h.yc("items",n.getAddedItems())}}function We(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.cc(2,"vdr-simple-item-list",3),h.gc()),2&e){var n=h.rc();h.yc("label",h.tc(1,2,"order.removed-items")),h.Qb(2),h.yc("items",n.getRemovedItems())}}Le.\u0275fac=function(e){return new(e||Le)},Le.\u0275cmp=h.Vb({type:Le,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(e,t){1&e&&h.Tc(0,_e,3,6,"span",0),2&e&&h.yc("ngIf",t.getRefundedCount())},directives:[I.o,M.o,xe.b],pipes:[Q.d],styles:["[_nghost-%COMP%]{color:var(--color-error-500)}"],changeDetection:0});var Ne=function(){function e(){g(this,e),this.addedItems=new Map,this.removedItems=new Map}return p(e,[{key:"ngOnChanges",value:function(){var e=this.getModifiedLines(),t=e.added,n=e.removed;this.addedItems=t,this.removedItems=n}},{key:"getSurcharge",value:function(e){return this.order.surcharges.find(function(t){return t.id===e})}},{key:"getAddedItems",value:function(){return o(this.addedItems.entries()).map(function(e){var t=s(e,2),n=t[0],c=t[1];return{name:n.productVariant.name,quantity:c}})}},{key:"getRemovedItems",value:function(){return o(this.removedItems.entries()).map(function(e){var t=s(e,2),n=t[0],c=t[1];return{name:n.productVariant.name,quantity:c}})}},{key:"getModifiedLines",value:function(){var e,t,n,c=new Map,r=new Map,i=l(this.modification.orderItems||[]);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=this.getOrderLineAndItem(a.id);if(o){var s=o.line;if(o.item.cancelled){var d=null!==(e=r.get(s))&&void 0!==e?e:0;r.set(s,d+1)}else{var u=null!==(t=c.get(s))&&void 0!==t?t:0;c.set(s,u+1)}}}}catch(f){i.e(f)}finally{i.f()}return{added:c,removed:r}}},{key:"getOrderLineAndItem",value:function(e){var t,n=l(this.order.lines);try{for(n.s();!(t=n.n()).done;){var c=t.value,r=c.items.find(function(t){return t.id===e});if(r)return{line:c,item:r}}}catch(i){n.e(i)}finally{n.f()}}}]),e}();function Re(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",9),h.ec()),2&e){var n=t.$implicit,c=h.rc(2);h.Qb(1),h.yc("customFieldsFormGroup",c.customFieldForm)("compact",!0)("readonly",n.readonly||!c.editable)("customField",n)}}function Ee(e,t){if(1&e){var n=h.ic();h.hc(0,"button",10),h.pc("click",function(){return h.Lc(n),h.rc(2).editable=!0}),h.cc(1,"clr-icon",11),h.Vc(2),h.sc(3,"translate"),h.gc()}2&e&&(h.Qb(2),h.Xc(" ",h.tc(3,1,"common.edit")," "))}function Xe(e,t){if(1&e){var n=h.ic();h.hc(0,"button",12),h.pc("click",function(){return h.Lc(n),h.rc(2).onUpdateClick()}),h.cc(1,"clr-icon",13),h.Vc(2),h.sc(3,"translate"),h.gc()}if(2&e){var c=h.rc(2);h.yc("disabled",c.customFieldForm.pristine||c.customFieldForm.invalid),h.Qb(2),h.Xc(" ",h.tc(3,2,"common.update")," ")}}function $e(e,t){if(1&e&&(h.hc(0,"div",1),h.hc(1,"div",2),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"div",3),h.hc(5,"div",4),h.Tc(6,Re,2,4,"ng-container",5),h.gc(),h.gc(),h.hc(7,"div",6),h.Tc(8,Ee,4,3,"button",7),h.Tc(9,Xe,4,4,"button",8),h.gc(),h.gc()),2&e){var n=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,6,"common.custom-fields")," "),h.Qb(3),h.Tb("editable",n.editable),h.Qb(1),h.yc("ngForOf",n.customFieldsConfig),h.Qb(2),h.yc("ngIf",!n.editable),h.Qb(1),h.yc("ngIf",n.editable)}}Ne.\u0275fac=function(e){return new(e||Ne)},Ne.\u0275cmp=h.Vb({type:Ne,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},features:[h.Ob],decls:7,vars:8,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(e,t){1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc(),h.Tc(3,Ae,3,4,"vdr-labeled-data",1),h.Tc(4,je,4,8,"vdr-labeled-data",2),h.Tc(5,De,3,4,"vdr-labeled-data",1),h.Tc(6,We,3,4,"vdr-labeled-data",1)),2&e&&(h.yc("label",h.tc(1,6,"common.ID")),h.Qb(2),h.Wc(t.modification.id),h.Qb(1),h.yc("ngIf",t.modification.note),h.Qb(1),h.yc("ngForOf",t.modification.surcharges),h.Qb(1),h.yc("ngIf",t.getAddedItems().length),h.Qb(1),h.yc("ngIf",t.getRemovedItems().length))},directives:[Z.a,I.o,I.n,ee],pipes:[Q.d,T.a],styles:[""],changeDetection:0});var qe=function(){function e(t){g(this,e),this.formBuilder=t,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new h.t,this.editable=!1}return p(e,[{key:"ngOnInit",value:function(){this.customFieldForm=this.formBuilder.group({});var e,t=l(this.customFieldsConfig);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.customFieldForm.addControl(n.name,this.formBuilder.control(this.customFieldValues[n.name]))}}catch(c){t.e(c)}finally{t.f()}}},{key:"onUpdateClick",value:function(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}}]),e}();qe.\u0275fac=function(e){return new(e||qe)(h.bc(u.e))},qe.\u0275cmp=h.Vb({type:qe,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],[4,"ngFor","ngForOf"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],["entityName","Order",3,"customFieldsFormGroup","compact","readonly","customField"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"disabled","click"],["shape","check"]],template:function(e,t){1&e&&h.Tc(0,$e,10,8,"div",0),2&e&&h.yc("ngIf",t.customFieldsConfig.length)},directives:[I.o,I.n,te.a,M.o],pipes:[Q.d],styles:["vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}"],changeDetection:0});var He=d("XNiG"),Ue=d("EY2u"),Ge=d("LRne"),ze=d("VRyK"),Be=d("IzEk"),Ye=d("JX91"),Je=d("eIep"),Ze=d("lJxs"),Ke=d("CqXF"),et=d("JIr8"),tt=d("zx2A"),nt=function(){function e(t,n){g(this,e),this.notifier=t,this.source=n}return p(e,[{key:"call",value:function(e,t){return t.subscribe(new ct(e,this.notifier,this.source))}}]),e}(),ct=function(n){t(i,n);var r=c(i);function i(e,t,n){var c;return g(this,i),(c=r.call(this,e)).notifier=t,c.source=n,c}return p(i,[{key:"error",value:function(t){if(!this.isStopped){var n=this.errors,c=this.retries,r=this.retriesSubscription;if(c)this.errors=void 0,this.retriesSubscription=void 0;else{n=new He.a;try{c=(0,this.notifier)(n)}catch(o){return e(a(i.prototype),"error",this).call(this,o)}r=Object(tt.c)(c,new tt.a(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=c,this.retriesSubscription=r,n.next(t)}}},{key:"_unsubscribe",value:function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0}},{key:"notifyNext",value:function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)}}]),i}(tt.b),rt=d("3E0/");function it(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.select-state"))}function at(e,t){if(1&e&&(h.hc(0,"option",4),h.Vc(1),h.sc(2,"translate"),h.sc(3,"stateI18nToken"),h.gc()),2&e){var n=t.$implicit;h.yc("value",n),h.Qb(1),h.Xc(" ",h.tc(2,2,h.tc(3,4,n))," ")}}function ot(e,t){if(1&e){var n=h.ic();h.hc(0,"button",7),h.pc("click",function(){return h.Lc(n),h.rc(2).cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc()}2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"common.cancel")," "))}var lt=function(e){return{state:e}};function st(e,t){if(1&e){var n=h.ic();h.Tc(0,ot,3,3,"button",5),h.hc(1,"button",6),h.pc("click",function(){return h.Lc(n),h.rc().select()}),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()}if(2&e){var c=h.rc();h.yc("ngIf",c.cancellable),h.Qb(1),h.yc("disabled",!c.selectedState),h.Qb(1),h.Xc(" ",h.uc(3,3,"order.transition-to-state",h.Cc(10,lt,h.tc(4,6,h.tc(5,8,c.selectedState))))," ")}}var dt=function(){function e(){g(this,e),this.nextStates=[],this.message="",this.selectedState=""}return p(e,[{key:"select",value:function(){this.selectedState&&this.resolveWith(this.selectedState)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();dt.\u0275fac=function(e){return new(e||dt)},dt.\u0275cmp=h.Vb({type:dt,selectors:[["vdr-order-state-select-dialog"]],decls:8,vars:5,consts:[["vdrDialogTitle",""],["clrSelect","","name","state",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(e,t){1&e&&(h.Tc(0,it,2,3,"ng-template",0),h.hc(1,"p"),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"clr-select-container"),h.hc(5,"select",1),h.pc("ngModelChange",function(e){return t.selectedState=e}),h.Tc(6,at,4,6,"option",2),h.gc(),h.gc(),h.Tc(7,st,6,12,"ng-template",3)),2&e&&(h.Qb(2),h.Wc(h.tc(3,3,t.message)),h.Qb(3),h.yc("ngModel",t.selectedState),h.Qb(1),h.yc("ngForOf",t.nextStates))},directives:[b.a,M.B,C.a,u.A,M.A,u.p,u.s,I.n,O.a,u.u,u.D,I.o],pipes:[Q.d,z.a],styles:[""],changeDetection:0});var ut=function(){function e(t,n,c,r){g(this,e),this.dataService=t,this.modalService=n,this.notificationService=c,this.i18nService=r}return p(e,[{key:"transitionToPreModifyingState",value:function(e,t){var n=this;return this.getPreModifyingState(e).pipe(Object(Je.a)(function(c){var r={orderId:e,nextStates:t,message:n.i18nService.translate(Object(F.a)("order.unable-to-transition-to-state-try-another"),{state:c}),cancellable:!1,retry:10};return c?n.transitionToStateOrThrow(e,c).pipe(Object(et.a)(function(e){return n.manuallyTransitionToState(r)})):n.manuallyTransitionToState(r)}))}},{key:"manuallyTransitionToState",value:function(e){var t,n=this;return this.modalService.fromComponent(dt,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe(Object(Je.a)(function(t){if(t)return n.transitionToStateOrThrow(e.orderId,t);if(e.cancellable)return Ue.a;throw new Error("An order state must be selected")}),(t=function(t){return t.pipe(Object(rt.a)(2e3),Object(Be.a)(e.retry))},function(e){return e.lift(new nt(t,e))}))}},{key:"getPreModifyingState",value:function(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:m.y.ORDER_STATE_TRANSITION}},sort:{createdAt:m.L.DESC}}).mapSingle(function(e){return e.order}).pipe(Object(Ze.a)(function(e){var t=null==e?void 0:e.history.items.find(function(e){return"Modifying"===e.data.to});return t?t.data.from:void 0}))}},{key:"transitionToStateOrThrow",value:function(e,t){var n=this;return this.dataService.order.transitionToState(e,t).pipe(Object(Ze.a)(function(e){var t=e.transitionOrderToState;switch(null==t?void 0:t.__typename){case"Order":return null==t?void 0:t.state;case"OrderStateTransitionError":throw n.notificationService.error(null==t?void 0:t.transitionError),new Error(null==t?void 0:t.transitionError)}}))}}]),e}();ut.\u0275fac=function(e){return new(e||ut)(h.lc(m.s),h.lc(m.F),h.lc(m.G),h.lc(m.z))},ut.\u0275prov=h.Xb({token:ut,factory:ut.\u0275fac,providedIn:"root"});var ft=d("2Vo4"),gt=d("Kj3r"),mt=72;function pt(e,t){if(1&e&&(h.hc(0,"div",3),h.cc(1,"div",4),h.cc(2,"clr-icon",5),h.hc(3,"div",6),h.Vc(4),h.sc(5,"translate"),h.sc(6,"stateI18nToken"),h.gc(),h.gc()),2&e){var n=h.rc();h.Qb(4),h.Xc(" ",h.tc(5,1,h.tc(6,3,n.cancelledState))," ")}}var ht=function(){function e(t){g(this,e),this.elementRef=t,this.active$=new ft.a(!1),this.activeTarget$=new ft.a(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}return p(e,[{key:"ngOnChanges",value:function(e){this.isCancellable=!!this.node.to.find(function(e){return"Cancelled"===e.name}),e.active&&this.active$.next(this.active)}},{key:"getPos",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"top";this.elementRef.nativeElement.getBoundingClientRect();var c=null!==(t=null===(e=this.elementRef.nativeElement.querySelector(".node"))||void 0===e?void 0:e.getBoundingClientRect().height)&&void 0!==t?t:0;return{x:10,y:this.index*mt+("bottom"===n?c:0)}}},{key:"getStyle",value:function(){var e=this.getPos();return{"top.px":e.y,"left.px":e.x}}}]),e}();ht.\u0275fac=function(e){return new(e||ht)(h.bc(h.r))},ht.\u0275cmp=h.Vb({type:ht,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},features:[h.Ob],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.sc(1,"async"),h.hc(2,"div",1),h.sc(3,"async"),h.Vc(4),h.sc(5,"translate"),h.sc(6,"stateI18nToken"),h.gc(),h.Tc(7,pt,7,5,"div",2),h.gc()),2&e&&(h.Tb("active",h.tc(1,7,t.active$)),h.yc("ngStyle",t.getStyle()),h.Qb(2),h.Tb("active-target",h.tc(3,9,t.activeTarget$)),h.Qb(2),h.Xc(" ",h.tc(5,11,h.tc(6,13,t.node.name))," "),h.Qb(3),h.yc("ngIf",t.isCancellable))},directives:[I.p,I.o,M.o],pipes:[I.b,Q.d,z.a],styles:["[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-left:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-left:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}"],changeDetection:0});var bt=d("vkgz"),vt=function(){function e(){g(this,e)}return p(e,[{key:"ngOnInit",value:function(){var e=this;this.active$=this.from.active$.asObservable().pipe(Object(bt.a)(function(t){return e.to.activeTarget$.next(t)}))}},{key:"getStyle",value:function(){var e=this.from.index<this.to.index?"down":"up",t=this.from.getPos("down"===e?"bottom":"top"),n=this.to.getPos("down"===e?"top":"bottom"),c=Math.abs(t.x-n.x),r=Math.abs(t.y-n.y),i=Math.sqrt(Math.pow(c,2)+Math.pow(r,2));return Object.assign({"top.px":t.y,"left.px":t.x+("down"===e?10:40)+12*this.index,"height.px":i,"width.px":1},"up"===e?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}}]),e}();function yt(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"vdr-order-process-node",1),h.pc("mouseenter",function(){h.Lc(n);var e=t.$implicit;return h.rc().onMouseOver(e.name)})("mouseleave",function(){return h.Lc(n),h.rc().onMouseOut()}),h.sc(2,"async"),h.gc(),h.ec()}if(2&e){var c=t.$implicit,r=t.index,i=h.rc();h.Qb(1),h.yc("node",c)("index",r)("active",h.tc(2,3,i.activeState$)===c.name)}}function Ct(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-order-process-edge",2),h.ec()),2&e){var n=t.$implicit;h.Qb(1),h.yc("from",n.from)("to",n.to)("index",n.index)}}vt.\u0275fac=function(e){return new(e||vt)},vt.\u0275cmp=h.Vb({type:vt,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.sc(1,"async"),h.cc(2,"clr-icon",1),h.gc()),2&e&&(h.Tb("active",h.tc(1,5,t.active$)),h.yc("ngStyle",t.getStyle()),h.Rb("data-from",t.from.node.name)("data-to",t.to.node.name))},directives:[I.p,M.o],pipes:[I.b],styles:[".edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}"],changeDetection:0});var Ot=function(){function e(t){g(this,e),this.changeDetector=t,this.setActiveState$=new ft.a(void 0),this.nodes=[],this.edges=[]}return p(e,[{key:"outerHeight",get:function(){return this.nodes.length*mt}},{key:"ngOnInit",value:function(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe(Object(gt.a)(150))}},{key:"ngOnChanges",value:function(e){this.populateNodes()}},{key:"ngAfterViewInit",value:function(){var e=this;setTimeout(function(){return e.populateEdges()})}},{key:"onMouseOver",value:function(e){this.setActiveState$.next(e)}},{key:"onMouseOut",value:function(){this.setActiveState$.next(this.initialState)}},{key:"getNodeFor",value:function(e){if(this.nodeComponents)return this.nodeComponents.find(function(t){return t.node.name===e})}},{key:"populateNodes",value:function(){var e,t,n,c=this,r=new Map,i=l(this.states);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.set(a.name,{name:a.name,to:[]})}}catch(g){i.e(g)}finally{i.f()}var d,u=l(r.entries());try{var f=function(){var n,i=s(d.value,2),a=i[0],o=i[1],u=l(null!==(t=null===(e=c.states.find(function(e){return e.name===a}))||void 0===e?void 0:e.to)&&void 0!==t?t:[]);try{for(u.s();!(n=u.n()).done;){var f=n.value,m=r.get(f);m&&o.to.push(m)}}catch(g){u.e(g)}finally{u.f()}};for(u.s();!(d=u.n()).done;)f()}catch(g){u.e(g)}finally{u.f()}this.nodes=o(r.values()).filter(function(e){return"Cancelled"!==e.name})}},{key:"populateEdges",value:function(){var e,t=l(this.nodes);try{for(t.s();!(e=t.n()).done;){var n,c=e.value,r=this.getNodeFor(c.name),i=0,a=l(c.to);try{for(a.s();!(n=a.n()).done;){var s=n.value,d=this.getNodeFor(s.name);r&&d&&r!==d&&(this.edges.push({to:d,from:r,index:i}),i++)}}catch(u){a.e(u)}finally{a.f()}}}catch(u){t.e(u)}finally{t.f()}this.edges=o(this.edges),this.changeDetector.markForCheck()}}]),e}();function Qt(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.order-state-diagram"))}Ot.\u0275fac=function(e){return new(e||Ot)(h.bc(h.j))},Ot.\u0275cmp=h.Vb({type:Ot,selectors:[["vdr-order-process-graph"]],viewQuery:function(e,t){var n;(1&e&&h.ad(ht,1),2&e)&&(h.Hc(n=h.qc())&&(t.nodeComponents=n))},hostVars:2,hostBindings:function(e,t){2&e&&h.Qc("height",t.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},features:[h.Ob],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"node","index","active","mouseenter","mouseleave"],[3,"from","to","index"]],template:function(e,t){1&e&&(h.Tc(0,yt,3,5,"ng-container",0),h.Tc(1,Ct,2,3,"ng-container",0)),2&e&&(h.yc("ngForOf",t.nodes),h.Qb(1),h.yc("ngForOf",t.edges))},directives:[I.n,ht,vt],pipes:[I.b],styles:["[_nghost-%COMP%]{display:block;border:1px #ff69b4;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}"],changeDetection:0});var It=function(){function e(t){g(this,e),this.serverConfigService=t,this.states=[]}return p(e,[{key:"ngOnInit",value:function(){this.states=this.serverConfigService.getOrderProcessStates()}}]),e}();It.\u0275fac=function(e){return new(e||It)(h.bc(m.I))},It.\u0275cmp=h.Vb({type:It,selectors:[["vdr-order-process-graph-dialog"]],decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(e,t){1&e&&(h.Tc(0,Qt,2,3,"ng-template",0),h.cc(1,"vdr-order-process-graph",1)),2&e&&(h.Qb(1),h.yc("states",t.states)("initialState",t.activeState))},directives:[b.a,Ot],pipes:[Q.d],styles:[""],changeDetection:0});var Tt=d("hmHg");function St(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.refund-and-cancel-order"))}function Pt(e,t){if(1&e&&(h.hc(0,"div",36),h.Vc(1),h.hc(2,"div",37),h.Vc(3),h.sc(4,"currency"),h.sc(5,"number"),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc(3).$implicit,r=h.rc();h.Qb(1),h.Xc(" ",n.description," "),h.Qb(2),h.Xc(" ",h.uc(4,2,h.uc(5,5,n.amount/100/c.quantity,"1.0-2"),r.order.currencyCode)," ")}}function kt(e,t){if(1&e&&(h.hc(0,"vdr-dropdown"),h.hc(1,"div",32),h.hc(2,"button",33),h.cc(3,"clr-icon",34),h.gc(),h.gc(),h.hc(4,"vdr-dropdown-menu"),h.Tc(5,Pt,6,8,"div",35),h.gc(),h.gc()),2&e){var n=h.rc().ngIf;h.Qb(5),h.yc("ngForOf",n)}}function Ft(e,t){if(1&e&&(h.fc(0),h.Tc(1,kt,6,1,"vdr-dropdown",26),h.ec()),2&e){var n=t.ngIf;h.Qb(1),h.yc("ngIf",n.length)}}function Mt(e,t){if(1&e){var n=h.ic();h.hc(0,"input",38),h.pc("ngModelChange",function(e){h.Lc(n);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id].quantity=e})("input",function(){h.Lc(n);var e=h.rc().$implicit,t=h.rc();return t.handleZeroQuantity(t.lineQuantities[e.id])}),h.gc()}if(2&e){var c=h.rc().$implicit,r=h.rc();h.yc("ngModel",r.lineQuantities[c.id].quantity)("max",c.quantity)}}function Vt(e,t){if(1&e){var n=h.ic();h.hc(0,"input",39),h.pc("ngModelChange",function(e){h.Lc(n);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id].refund=e}),h.gc()}if(2&e){var c=h.rc().$implicit,r=h.rc();h.yc("disabled",0===r.lineQuantities[c.id].quantity)("ngModel",r.lineQuantities[c.id].refund)}}function xt(e,t){if(1&e){var n=h.ic();h.hc(0,"input",39),h.pc("ngModelChange",function(e){h.Lc(n);var t=h.rc().$implicit;return h.rc().lineQuantities[t.id].cancel=e}),h.gc()}if(2&e){var c=h.rc().$implicit,r=h.rc();h.yc("disabled",0===r.lineQuantities[c.id].quantity)("ngModel",r.lineQuantities[c.id].cancel)}}function wt(e,t){if(1&e&&(h.hc(0,"tr",18),h.hc(1,"td",19),h.cc(2,"img",20),h.sc(3,"assetPreview"),h.gc(),h.hc(4,"td",21),h.Vc(5),h.gc(),h.hc(6,"td",22),h.Vc(7),h.gc(),h.hc(8,"td",23),h.Vc(9),h.cc(10,"vdr-line-refunds",24),h.gc(),h.hc(11,"td",23),h.Vc(12),h.sc(13,"localeCurrency"),h.gc(),h.hc(14,"td",23),h.hc(15,"div",25),h.Vc(16),h.sc(17,"localeCurrency"),h.Tc(18,Ft,2,1,"ng-container",26),h.gc(),h.gc(),h.hc(19,"td",27),h.Tc(20,Mt,1,2,"input",28),h.gc(),h.hc(21,"td",29),h.hc(22,"div",30),h.Tc(23,Vt,1,2,"input",31),h.gc(),h.gc(),h.hc(24,"td",29),h.hc(25,"div",30),h.Tc(26,xt,1,2,"input",31),h.gc(),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc();h.Qb(2),h.yc("src",h.uc(3,12,n.featuredAsset,"tiny"),h.Nc),h.Qb(3),h.Wc(n.productVariant.name),h.Qb(2),h.Wc(n.productVariant.sku),h.Qb(2),h.Xc(" ",n.quantity," "),h.Qb(1),h.yc("line",n)("payments",c.order.payments),h.Qb(2),h.Xc(" ",h.uc(13,15,n.unitPriceWithTax,c.order.currencyCode)," "),h.Qb(4),h.Xc(" ",h.uc(17,18,n.proratedUnitPriceWithTax,c.order.currencyCode)," "),h.Qb(2),h.yc("ngIf",n.discounts),h.Qb(2),h.yc("ngIf",c.lineCanBeRefundedOrCancelled(n)),h.Qb(3),h.yc("ngIf",c.lineCanBeRefundedOrCancelled(n)),h.Qb(3),h.yc("ngIf",c.lineCanBeRefundedOrCancelled(n))}}function _t(e,t){if(1&e&&(h.hc(0,"option",40),h.Vc(1),h.sc(2,"localeCurrency"),h.gc()),2&e){var n=t.$implicit,c=h.rc();h.yc("ngValue",n)("disabled","Settled"!==n.state),h.Qb(1),h.Zc(" #",n.id," ",n.method,": ",h.uc(2,5,n.amount,c.order.currencyCode)," ")}}var Lt=function(e,t){return{min:e,max:t}};function At(e,t){if(1&e&&(h.hc(0,"div",41),h.Vc(1),h.sc(2,"translate"),h.sc(3,"currency"),h.sc(4,"localeCurrency"),h.gc()),2&e){var n=h.rc();h.Qb(1),h.Xc(" ",h.uc(2,1,"order.refund-total-error",h.Dc(10,Lt,h.uc(3,4,0,n.order.currencyCode),h.uc(4,7,n.settledPaymentsTotal,n.order.currencyCode)))," ")}}function jt(e,t){1&e&&(h.hc(0,"div",42),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.refund-total-warning")," "))}var Dt=function(e){return{amount:e}};function Wt(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.sc(3,"localeCurrency"),h.ec()),2&e){var n=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.refund-with-amount",h.Cc(7,Dt,h.uc(3,4,n.refundTotal,n.order.currencyCode)))," ")}}function Nt(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Xc(" ",h.tc(1,1,"order.cancel-selected-items")," ")}function Rt(e,t){if(1&e){var n=h.ic();h.hc(0,"button",43),h.pc("click",function(){return h.Lc(n),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",44),h.pc("click",function(){return h.Lc(n),h.rc().select()}),h.Tc(4,Wt,4,9,"ng-container",45),h.Tc(5,Nt,2,3,"ng-template",null,46,h.Uc),h.gc()}if(2&e){var c=h.Ic(6),r=h.rc();h.Qb(1),h.Wc(h.tc(2,4,"common.cancel")),h.Qb(2),h.yc("disabled",!r.canSubmit()),h.Qb(1),h.yc("ngIf",r.isRefunding())("ngIfElse",c)}}var Et=function(){function e(t){var n=this;g(this,e),this.i18nService=t,this.lineQuantities={},this.refundShipping=!1,this.adjustment=0,this.reasons=[Object(F.a)("order.refund-reason-customer-request"),Object(F.a)("order.refund-reason-not-available")],this.reasons=this.reasons.map(function(e){return n.i18nService.translate(e)})}return p(e,[{key:"refundTotal",get:function(){var e=this;return this.order.lines.reduce(function(t,n){var c=e.lineQuantities[n.id],r=c.refund&&c.quantity||0;return t+n.proratedUnitPriceWithTax*r},0)+(this.refundShipping?this.order.shippingWithTax:0)+this.adjustment}},{key:"settledPaymentsTotal",get:function(){return this.settledPayments.map(function(e){return e.amount-Object(J.summate)(e.refunds.filter(function(e){return"Failed"!==e.state}),"total")}).reduce(function(e,t){return e+t},0)}},{key:"lineCanBeRefundedOrCancelled",value:function(e){var t,n,c=null!==(n=null===(t=this.order.payments)||void 0===t?void 0:t.reduce(function(e,t){return[].concat(o(e),o(t.refunds))},[]))&&void 0!==n?n:[];return 0<e.items.filter(function(e){if(e.cancelled)return!1;if(null==e.refundId)return!0;var t=c.find(function(t){return t.id===e.refundId});return"Failed"===(null==t?void 0:t.state)}).length}},{key:"ngOnInit",value:function(){this.lineQuantities=this.order.lines.reduce(function(e,t){return Object.assign(Object.assign({},e),f({},t.id,{quantity:0,refund:!1,cancel:!1}))},{}),this.settledPayments=(this.order.payments||[]).filter(function(e){return"Settled"===e.state}),this.settledPayments.length&&(this.selectedPayment=this.settledPayments[0])}},{key:"handleZeroQuantity",value:function(e){0===(null==e?void 0:e.quantity)&&(e.cancel=!1,e.refund=!1)}},{key:"isRefunding",value:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e||0<t.quantity&&t.refund},!1)}},{key:"isCancelling",value:function(){return Object.values(this.lineQuantities).reduce(function(e,t){return e||0<t.quantity&&t.cancel},!1)}},{key:"canSubmit",value:function(){return this.isRefunding()?!!(this.selectedPayment&&this.reason&&0<this.refundTotal&&this.refundTotal<=this.settledPaymentsTotal):!!this.isCancelling()&&!!this.reason}},{key:"select",value:function(){var e=this.selectedPayment;if(e){var t=this.getOrderLineInput(function(e){return e.refund}),n=this.getOrderLineInput(function(e){return e.cancel});this.resolveWith({refund:{lines:t,reason:this.reason,shipping:this.refundShipping?this.order.shippingWithTax:0,adjustment:this.adjustment,paymentId:e.id},cancel:{lines:n,orderId:this.order.id,reason:this.reason}})}}},{key:"cancel",value:function(){this.resolveWith()}},{key:"getOrderLineInput",value:function(e){return Object.entries(this.lineQuantities).filter(function(t){var n=s(t,2),c=(n[0],n[1]);return 0<c.quantity&&e(c)}).map(function(e){var t=s(e,2);return{orderLineId:t[0],quantity:t[1].quantity}})}}]),e}();function Xt(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.settle-refund"))}function $t(e,t){if(1&e){var n=h.ic();h.hc(0,"button",4),h.pc("click",function(){return h.Lc(n),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",5),h.pc("click",function(){return h.Lc(n),h.rc().submit()}),h.Vc(4),h.sc(5,"translate"),h.gc()}if(2&e){var c=h.rc();h.Qb(1),h.Wc(h.tc(2,3,"common.cancel")),h.Qb(2),h.yc("disabled",!c.transactionId),h.Qb(1),h.Xc(" ",h.tc(5,5,"order.settle-refund")," ")}}Et.\u0275fac=function(e){return new(e||Et)(h.bc(m.z))},Et.\u0275cmp=h.Vb({type:Et,selectors:[["vdr-refund-order-dialog"]],decls:69,vars:74,consts:[["vdrDialogTitle",""],[1,"refund-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",4,"ngFor","ngForOf"],[1,"refund-details","mt4"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"disabled","items","placeholder","addTag","ngModel","ngModelChange"],["clrSelect","","name","options",3,"ngModel","disabled","ngModelChange"],[3,"ngValue","disabled",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"ngModel","disabled","ngModelChange"],["clrInput","",3,"disabled","currencyCode","ngModel","ngModelChange"],[1,"totals"],[1,"order-total"],[1,"refund-total"],["class","refund-total-error",4,"ngIf"],["class","refund-total-warning",4,"ngIf"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[3,"line","payments"],[1,"prorated-wrapper"],[4,"ngIf"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","max","ngModelChange","input",4,"ngIf"],[1,"align-middle"],[1,"cancel-checkbox-wrapper"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],["type","number","min","0",3,"ngModel","max","ngModelChange","input"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange"],[3,"ngValue","disabled"],[1,"refund-total-error"],[1,"refund-total-warning"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf","ngIfElse"],["cancelling",""]],template:function(e,t){1&e&&(h.Tc(0,St,2,3,"ng-template",0),h.hc(1,"div",1),h.hc(2,"div",2),h.hc(3,"table",3),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.hc(22,"th"),h.Vc(23),h.sc(24,"translate"),h.gc(),h.hc(25,"th"),h.Vc(26),h.sc(27,"translate"),h.gc(),h.hc(28,"th"),h.Vc(29),h.sc(30,"translate"),h.gc(),h.gc(),h.gc(),h.Tc(31,wt,27,21,"tr",4),h.gc(),h.gc(),h.hc(32,"div",5),h.hc(33,"div"),h.hc(34,"label",6),h.Vc(35),h.sc(36,"translate"),h.gc(),h.hc(37,"ng-select",7),h.pc("ngModelChange",function(e){return t.reason=e}),h.sc(38,"translate"),h.gc(),h.gc(),h.hc(39,"div"),h.hc(40,"clr-select-container"),h.hc(41,"label"),h.Vc(42),h.sc(43,"translate"),h.gc(),h.hc(44,"select",8),h.pc("ngModelChange",function(e){return t.selectedPayment=e}),h.Tc(45,_t,3,8,"option",9),h.gc(),h.gc(),h.hc(46,"clr-checkbox-wrapper"),h.hc(47,"input",10),h.pc("ngModelChange",function(e){return t.refundShipping=e}),h.gc(),h.hc(48,"label"),h.Vc(49),h.sc(50,"translate"),h.sc(51,"localeCurrency"),h.gc(),h.gc(),h.hc(52,"clr-input-container"),h.hc(53,"label"),h.Vc(54),h.sc(55,"translate"),h.gc(),h.hc(56,"vdr-currency-input",11),h.pc("ngModelChange",function(e){return t.adjustment=e}),h.gc(),h.gc(),h.hc(57,"div",12),h.hc(58,"div",13),h.Vc(59),h.sc(60,"translate"),h.sc(61,"localeCurrency"),h.gc(),h.hc(62,"div",14),h.Vc(63),h.sc(64,"translate"),h.sc(65,"localeCurrency"),h.gc(),h.Tc(66,At,5,13,"div",15),h.Tc(67,jt,3,3,"div",16),h.gc(),h.gc(),h.gc(),h.gc(),h.Tc(68,Rt,7,6,"ng-template",17)),2&e&&(h.Qb(8),h.Wc(h.tc(9,35,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,37,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,39,"order.quantity")),h.Qb(3),h.Wc(h.tc(18,41,"order.unit-price")),h.Qb(3),h.Wc(h.tc(21,43,"order.prorated-unit-price")),h.Qb(3),h.Wc(h.tc(24,45,"order.quantity")),h.Qb(3),h.Wc(h.tc(27,47,"order.refund")),h.Qb(3),h.Wc(h.tc(30,49,"order.cancel")),h.Qb(2),h.yc("ngForOf",t.order.lines),h.Qb(4),h.Wc(h.tc(36,51,"order.refund-cancellation-reason")),h.Qb(2),h.yc("disabled",!t.isRefunding()&&!t.isCancelling())("items",t.reasons)("placeholder",h.tc(38,53,"order.refund-cancellation-reason-required"))("addTag",!0)("ngModel",t.reason),h.Qb(5),h.Wc(h.tc(43,55,"order.payment-to-refund")),h.Qb(2),h.yc("ngModel",t.selectedPayment)("disabled",!t.isRefunding()),h.Qb(1),h.yc("ngForOf",t.settledPayments),h.Qb(2),h.yc("ngModel",t.refundShipping)("disabled",!t.isRefunding()),h.Qb(2),h.Yc(" ",h.tc(50,57,"order.refund-shipping")," (",h.uc(51,59,t.order.shippingWithTax,t.order.currencyCode),") "),h.Qb(5),h.Wc(h.tc(55,62,"order.refund-adjustment")),h.Qb(2),h.yc("disabled",!t.isRefunding())("currencyCode",t.order.currencyCode)("ngModel",t.adjustment),h.Qb(1),h.Tb("disabled",!t.isRefunding()),h.Qb(2),h.Yc(" ",h.tc(60,64,"order.payment-amount"),": ",h.uc(61,66,t.selectedPayment.amount,t.order.currencyCode)," "),h.Qb(4),h.Yc(" ",h.tc(64,69,"order.refund-total"),": ",h.uc(65,71,t.refundTotal,t.order.currencyCode)," "),h.Qb(3),h.yc("ngIf",t.refundTotal<0||t.settledPaymentsTotal<t.refundTotal),h.Qb(1),h.yc("ngIf",t.selectedPayment.amount<t.refundTotal))},directives:[b.a,I.n,M.u,y.a,u.p,u.s,M.B,C.a,u.A,M.A,M.k,u.a,M.i,M.t,Tt.a,M.s,I.o,O.a,Le,oe.a,le.a,M.o,se.a,u.v,u.b,u.u,u.D],pipes:[Q.d,T.a,V.a,I.d,I.f],styles:["[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.totals[_ngcontent-%COMP%]{margin-top:48px}.totals[_ngcontent-%COMP%]   .refund-total[_ngcontent-%COMP%]{font-size:18px}.totals[_ngcontent-%COMP%]   .refund-total-error[_ngcontent-%COMP%]{color:var(--color-error-500)}.totals[_ngcontent-%COMP%]   .refund-total-warning[_ngcontent-%COMP%]{color:var(--color-warning-600);max-width:250px}.totals.disabled[_ngcontent-%COMP%]{color:var(--color-grey-300)}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0});var qt=function(e){return{method:e}},Ht=function(){function e(){g(this,e),this.transactionId=""}return p(e,[{key:"submit",value:function(){this.resolveWith(this.transactionId)}},{key:"cancel",value:function(){this.resolveWith()}}]),e}();Ht.\u0275fac=function(e){return new(e||Ht)},Ht.\u0275cmp=h.Vb({type:Ht,selectors:[["vdr-settle-refund-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModel","ngModelChange"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,Xt,2,3,"ng-template",0),h.hc(1,"p",1),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"clr-input-container"),h.hc(5,"label"),h.Vc(6),h.sc(7,"translate"),h.gc(),h.hc(8,"input",2),h.pc("ngModelChange",function(e){return t.transactionId=e}),h.gc(),h.gc(),h.Tc(9,$t,6,7,"ng-template",3)),2&e&&(h.Qb(2),h.Xc(" ",h.uc(3,3,"order.settle-refund-manual-instructions",h.Cc(8,qt,t.refund.method)),"\n"),h.Qb(4),h.Wc(h.tc(7,6,"order.transaction-id")),h.Qb(2),h.yc("ngModel",t.transactionId))},directives:[b.a,M.t,M.u,C.a,u.b,M.s,u.p,u.s,O.a],pipes:[Q.d],styles:["[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}"],changeDetection:0});var Ut=d("tyNb"),Gt=d("uEVm"),zt=d("iszU"),Bt=d("R2pz"),Yt=d("nqNv");function Jt(e,t){if(1&e&&(h.cc(0,"img",23),h.sc(1,"assetPreview")),2&e){var n=h.rc().$implicit;h.yc("src",h.uc(1,1,n.featuredAsset,"tiny"),h.Nc)}}function Zt(e,t){if(1&e&&(h.hc(0,"div",26),h.hc(1,"a",27),h.Vc(2),h.gc(),h.hc(3,"div",28),h.Vc(4),h.sc(5,"localeCurrency"),h.hc(6,"div",8),h.sc(7,"translate"),h.Vc(8),h.sc(9,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc(4);h.Qb(1),h.yc("routerLink",c.getPromotionLink(n)),h.Qb(1),h.Wc(n.description),h.Qb(2),h.Xc(" ",h.uc(5,5,n.amountWithTax,c.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(7,8,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(9,10,n.amount,c.order.currencyCode)," ")}}function Kt(e,t){if(1&e&&(h.hc(0,"vdr-dropdown"),h.hc(1,"div",24),h.Vc(2),h.sc(3,"translate"),h.gc(),h.hc(4,"vdr-dropdown-menu"),h.Tc(5,Zt,10,13,"div",25),h.gc(),h.gc()),2&e){var n=h.rc().ngIf;h.Qb(2),h.Xc(" ",h.tc(3,2,"order.promotions-applied")," "),h.Qb(3),h.yc("ngForOf",n)}}function en(e,t){if(1&e&&(h.fc(0),h.Tc(1,Kt,6,4,"vdr-dropdown",22),h.ec()),2&e){var n=t.ngIf;h.Qb(1),h.yc("ngIf",n.length)}}function tn(e,t){if(1&e&&(h.hc(0,"div",32),h.cc(1,"vdr-custom-field-control",33),h.gc()),2&e){var n=t.$implicit;h.Qb(1),h.yc("compact",!0)("readonly",!0)("customField",n.config)("customFieldsFormGroup",n.formGroup)}}function nn(e,t){if(1&e&&(h.hc(0,"tr"),h.hc(1,"td",29),h.hc(2,"div",30),h.Tc(3,tn,2,4,"div",31),h.gc(),h.gc(),h.gc()),2&e){var n=h.rc().ngIf;h.Qb(3),h.yc("ngForOf",n)}}function cn(e,t){if(1&e&&(h.fc(0),h.Tc(1,nn,4,1,"tr",22),h.ec()),2&e){var n=t.ngIf;h.Qb(1),h.yc("ngIf",n.length)}}function rn(e,t){if(1&e&&(h.fc(0),h.hc(1,"tr",12),h.hc(2,"td",13),h.Tc(3,Jt,2,4,"img",14),h.gc(),h.hc(4,"td",15),h.Vc(5),h.gc(),h.hc(6,"td",16),h.Vc(7),h.gc(),h.hc(8,"td",17),h.Vc(9),h.sc(10,"localeCurrency"),h.hc(11,"div",8),h.sc(12,"translate"),h.Vc(13),h.sc(14,"localeCurrency"),h.gc(),h.gc(),h.hc(15,"td",18),h.Vc(16),h.cc(17,"vdr-line-refunds",19),h.cc(18,"vdr-line-fulfillment",20),h.gc(),h.hc(19,"td",21),h.Vc(20),h.sc(21,"localeCurrency"),h.hc(22,"div",8),h.sc(23,"translate"),h.Vc(24),h.sc(25,"localeCurrency"),h.gc(),h.Tc(26,en,2,1,"ng-container",22),h.gc(),h.gc(),h.Tc(27,cn,2,1,"ng-container",22),h.ec()),2&e){var n=t.$implicit,c=h.rc();h.Qb(1),h.Tb("is-cancelled",0===n.quantity),h.Qb(2),h.yc("ngIf",n.featuredAsset),h.Qb(2),h.Wc(n.productVariant.name),h.Qb(2),h.Wc(n.productVariant.sku),h.Qb(2),h.Xc(" ",h.uc(10,18,n.unitPriceWithTax,c.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(12,21,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(14,23,n.unitPrice,c.order.currencyCode)," "),h.Qb(3),h.Xc(" ",n.quantity," "),h.Qb(1),h.yc("line",n)("payments",c.order.payments),h.Qb(1),h.yc("line",n)("orderState",c.order.state),h.Qb(2),h.Xc(" ",h.uc(21,26,n.linePriceWithTax,c.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(23,29,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(25,31,n.linePrice,c.order.currencyCode)," "),h.Qb(2),h.yc("ngIf",c.getLineDiscounts(n)),h.Qb(1),h.yc("ngIf",c.customFieldsForLine[n.id])}}function an(e,t){if(1&e&&(h.hc(0,"tr",34),h.hc(1,"td",35),h.Vc(2),h.gc(),h.hc(3,"td",16),h.Vc(4),h.gc(),h.cc(5,"td",36),h.hc(6,"td",21),h.Vc(7),h.sc(8,"localeCurrency"),h.hc(9,"div",8),h.sc(10,"translate"),h.Vc(11),h.sc(12,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc();h.Qb(2),h.Wc(n.description),h.Qb(2),h.Wc(n.sku),h.Qb(3),h.Xc(" ",h.uc(8,5,n.priceWithTax,c.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(10,8,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(12,10,n.price,c.order.currencyCode)," ")}}function on(e,t){if(1&e&&(h.hc(0,"vdr-chip"),h.Vc(1),h.gc()),2&e){var n=t.ngIf;h.Qb(1),h.Wc(n)}}function ln(e,t){if(1&e&&(h.hc(0,"tr",37),h.hc(1,"td",38),h.hc(2,"a",39),h.Vc(3),h.gc(),h.Tc(4,on,2,1,"vdr-chip",22),h.gc(),h.hc(5,"td",7),h.Vc(6),h.sc(7,"localeCurrency"),h.hc(8,"div",8),h.sc(9,"translate"),h.Vc(10),h.sc(11,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc();h.Qb(2),h.yc("routerLink",c.getPromotionLink(n)),h.Qb(1),h.Wc(n.description),h.Qb(1),h.yc("ngIf",c.getCouponCodeForAdjustment(c.order,n)),h.Qb(2),h.Xc(" ",h.uc(7,6,n.amountWithTax,c.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(9,9,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(11,11,n.amount,c.order.currencyCode)," ")}}var sn=function(){function e(){g(this,e),this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}return p(e,[{key:"visibleOrderLineCustomFields",get:function(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}},{key:"showElided",get:function(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}},{key:"ngOnInit",value:function(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}},{key:"toggleOrderLineCustomFields",value:function(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}},{key:"getLineDiscounts",value:function(e){return e.discounts.filter(function(e){return e.type===m.c.PROMOTION})}},{key:"getLineCustomFields",value:function(){var e,t=this,n=new u.i({}),c=l(this.order.lines);try{var r=function(){var c=e.value,r=t.orderLineCustomFields.map(function(e){var t=c.customFields[e.name];return n.addControl(e.name,new u.f(t)),{config:e,formGroup:n,value:t}}).filter(function(e){return!!t.orderLineCustomFieldsVisible||null!=e.value});t.customFieldsForLine[c.id]=r};for(c.s();!(e=c.n()).done;)r()}catch(i){c.e(i)}finally{c.f()}}},{key:"getPromotionLink",value:function(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}},{key:"getCouponCodeForAdjustment",value:function(e,t){var n=t.adjustmentSource.split(":")[1],c=e.promotions.find(function(e){return e.id===n});if(c)return c.couponCode||void 0}}]),e}();sn.\u0275fac=function(e){return new(e||sn)},sn.\u0275cmp=h.Vb({type:sn,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields"},decls:61,vars:61,consts:[[1,"order-table","table"],[4,"ngFor","ngForOf"],["class","surcharge",4,"ngFor","ngForOf"],["class","order-adjustment",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"left","clr-align-middle"],["colspan","4"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["colspan","3"],[1,"total"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],[3,"line","payments"],[3,"line","orderState"],[1,"align-middle","total"],[4,"ngIf"],[3,"src"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"],["colspan","6",1,"custom-fields-row"],[1,"order-line-custom-fields"],["class","custom-field",4,"ngFor","ngForOf"],[1,"custom-field"],[3,"compact","readonly","customField","customFieldsFormGroup"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],["colspan","2",1,"align-middle"],[1,"order-adjustment"],["colspan","5",1,"left","clr-align-middle"],[3,"routerLink"]],template:function(e,t){1&e&&(h.hc(0,"table",0),h.hc(1,"thead"),h.hc(2,"tr"),h.cc(3,"th"),h.hc(4,"th"),h.Vc(5),h.sc(6,"translate"),h.gc(),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.gc(),h.gc(),h.hc(19,"tbody"),h.Tc(20,rn,28,34,"ng-container",1),h.Tc(21,an,13,13,"tr",2),h.Tc(22,ln,12,14,"tr",3),h.hc(23,"tr",4),h.hc(24,"td",5),h.Vc(25),h.sc(26,"translate"),h.gc(),h.cc(27,"td",6),h.hc(28,"td",7),h.Vc(29),h.sc(30,"localeCurrency"),h.hc(31,"div",8),h.sc(32,"translate"),h.Vc(33),h.sc(34,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.hc(35,"tr",9),h.hc(36,"td",5),h.Vc(37),h.sc(38,"translate"),h.gc(),h.hc(39,"td",7),h.Vc(40),h.gc(),h.cc(41,"td",10),h.hc(42,"td",7),h.Vc(43),h.sc(44,"localeCurrency"),h.hc(45,"div",8),h.sc(46,"translate"),h.Vc(47),h.sc(48,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.hc(49,"tr",11),h.hc(50,"td",5),h.Vc(51),h.sc(52,"translate"),h.gc(),h.cc(53,"td",6),h.hc(54,"td",7),h.Vc(55),h.sc(56,"localeCurrency"),h.hc(57,"div",8),h.sc(58,"translate"),h.Vc(59),h.sc(60,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc()),2&e&&(h.Qb(5),h.Wc(h.tc(6,21,"order.product-name")),h.Qb(3),h.Wc(h.tc(9,23,"order.product-sku")),h.Qb(3),h.Wc(h.tc(12,25,"order.unit-price")),h.Qb(3),h.Wc(h.tc(15,27,"order.quantity")),h.Qb(3),h.Wc(h.tc(18,29,"order.total")),h.Qb(3),h.yc("ngForOf",t.order.lines),h.Qb(1),h.yc("ngForOf",t.order.surcharges),h.Qb(1),h.yc("ngForOf",t.order.discounts),h.Qb(3),h.Wc(h.tc(26,31,"order.sub-total")),h.Qb(4),h.Xc(" ",h.uc(30,33,t.order.subTotalWithTax,t.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(32,36,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(34,38,t.order.subTotal,t.order.currencyCode)," "),h.Qb(4),h.Wc(h.tc(38,41,"order.shipping")),h.Qb(3),h.Wc(null==t.order.shippingLines[0]||null==t.order.shippingLines[0].shippingMethod?null:t.order.shippingLines[0].shippingMethod.name),h.Qb(3),h.Xc(" ",h.uc(44,43,t.order.shippingWithTax,t.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(46,46,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(48,48,t.order.shipping,t.order.currencyCode)," "),h.Qb(4),h.Wc(h.tc(52,51,"order.total")),h.Qb(4),h.Xc(" ",h.uc(56,53,t.order.totalWithTax,t.order.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(58,56,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(60,58,t.order.total,t.order.currencyCode)," "))},directives:[I.n,I.o,Le,Ve,oe.a,le.a,se.a,Ut.h,te.a,G.a],pipes:[Q.d,T.a,V.a],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-left:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}"],changeDetection:0});var dn=d("yW18"),un=d("u1bq"),fn=d("2zLM");function gn(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc();h.yc("label",h.tc(1,2,"order.error-message")),h.Qb(2),h.Xc(" ",n.payment.errorMessage,"\n")}}function mn(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc();h.yc("label",h.tc(1,2,"order.transaction-id")),h.Qb(2),h.Xc(" ",n.payment.transactionId,"\n")}}var pn=function e(){g(this,e)};pn.\u0275fac=function(e){return new(e||pn)},pn.\u0275cmp=h.Vb({type:pn,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(e,t){1&e&&(h.hc(0,"vdr-labeled-data",0),h.sc(1,"translate"),h.Vc(2),h.gc(),h.hc(3,"vdr-labeled-data",0),h.sc(4,"translate"),h.Vc(5),h.sc(6,"localeCurrency"),h.gc(),h.Tc(7,gn,3,4,"vdr-labeled-data",1),h.Tc(8,mn,3,4,"vdr-labeled-data",1),h.hc(9,"vdr-labeled-data",0),h.sc(10,"translate"),h.cc(11,"vdr-object-tree",2),h.gc()),2&e&&(h.yc("label",h.tc(1,8,"order.payment-method")),h.Qb(2),h.Xc(" ",t.payment.method,"\n"),h.Qb(1),h.yc("label",h.tc(4,10,"order.amount")),h.Qb(2),h.Xc(" ",h.uc(6,12,t.payment.amount,t.currencyCode),"\n"),h.Qb(2),h.yc("ngIf",t.payment.errorMessage),h.Qb(1),h.yc("ngIf",t.payment.transactionId),h.Qb(1),h.yc("label",h.tc(10,15,"order.payment-metadata")),h.Qb(2),h.yc("value",t.payment.metadata))},directives:[Z.a,I.o,fn.a],pipes:[Q.d,T.a],styles:[""],changeDetection:0});var hn=d("V0to");function bn(e,t){1&e&&(h.hc(0,"span",12),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.note-only-visible-to-administrators")," "))}function vn(e,t){1&e&&(h.hc(0,"span",13),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.note-visible-to-customer")," "))}function yn(e,t){1&e&&(h.hc(0,"div",11),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.history-order-fulfilled")," "))}function Cn(e,t){1&e&&(h.hc(0,"div",11),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.history-order-cancelled")," "))}var On=function(e,t){return{from:e,to:t}};function Qn(e,t){if(1&e&&(h.Vc(0),h.sc(1,"translate")),2&e){var n=h.rc(2).$implicit;h.Xc(" ",h.uc(1,1,"order.history-order-transition",h.Dc(4,On,n.data.from,n.data.to))," ")}}function In(e,t){if(1&e&&(h.fc(0),h.Tc(1,yn,3,3,"div",17),h.Tc(2,Cn,3,3,"div",17),h.Tc(3,Qn,2,7,"ng-template",18),h.ec()),2&e){var n=h.rc().$implicit;h.Qb(1),h.yc("ngIf","Delivered"===n.data.to),h.Qb(1),h.yc("ngIf","Cancelled"===n.data.to),h.Qb(1),h.yc("ngIf","Cancelled"!==n.data.to&&"Delivered"!==n.data.to)}}function Tn(e,t){1&e&&(h.hc(0,"vdr-chip",23),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"order.modification-settled")))}function Sn(e,t){1&e&&(h.hc(0,"vdr-chip",24),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"order.modification-not-settled")))}function Pn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.hc(3,"strong"),h.Vc(4),h.sc(5,"localeCurrency"),h.gc(),h.Tc(6,Tn,3,3,"vdr-chip",20),h.Tc(7,Sn,3,3,"vdr-chip",21),h.hc(8,"vdr-history-entry-detail"),h.cc(9,"vdr-modification-detail",22),h.gc(),h.ec()),2&e){var n=t.ngIf,c=h.rc(3);h.Qb(1),h.Xc(" ",h.tc(2,6,"order.modify-order-price-difference"),": "),h.Qb(3),h.Wc(h.uc(5,8,n.priceChange,c.order.currencyCode)),h.Qb(2),h.yc("ngIf",n.isSettled),h.Qb(1),h.yc("ngIf",!n.isSettled),h.Qb(2),h.yc("order",c.order)("modification",n)}}function kn(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Tc(4,Pn,10,11,"ng-container",19),h.ec()),2&e){var n=h.rc().$implicit,c=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,2,"order.history-order-modified")," "),h.Qb(2),h.yc("ngIf",c.getModification(n.data.modificationId))}}function Fn(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.cc(1,"vdr-payment-detail",27),h.gc()),2&e){var n=t.ngIf,c=h.rc(4);h.Qb(1),h.yc("payment",n)("currencyCode",c.order.currencyCode)}}function Mn(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Vc(4),h.sc(5,"translate"),h.Tc(6,Fn,2,2,"vdr-history-entry-detail",19),h.ec()),2&e){var n,c=h.rc(2).$implicit,r=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,4,"order.history-payment-settled")," "),h.Qb(2),h.Yc(" ",h.tc(5,6,"order.transaction-id"),": ",null==(n=r.getPayment(c))?null:n.transactionId," "),h.Qb(2),h.yc("ngIf",r.getPayment(c))}}var Vn=function(e,t,n){return{from:e,to:t,id:n}};function xn(e,t){if(1&e&&(h.Vc(0),h.sc(1,"translate")),2&e){var n,c=h.rc(2).$implicit,r=h.rc();h.Xc(" ",h.uc(1,1,"order.history-payment-transition",h.Ec(4,Vn,c.data.from,c.data.to,null==(n=r.getPayment(c))?null:n.transactionId))," ")}}function wn(e,t){if(1&e&&(h.fc(0),h.Tc(1,Mn,7,8,"ng-container",25),h.Tc(2,xn,2,8,"ng-template",null,26,h.Uc),h.ec()),2&e){var n=h.Ic(3),c=h.rc().$implicit;h.Qb(1),h.yc("ngIf","Settled"===c.data.to)("ngIfElse",n)}}function _n(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e){var n=h.rc().$implicit;h.Qb(1),h.Xc(" ",h.uc(2,1,"order.history-refund-transition",h.Ec(4,Vn,n.data.from,n.data.to,n.data.refundId))," ")}}function Ln(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.hc(1,"vdr-labeled-data",28),h.sc(2,"translate"),h.Vc(3),h.gc(),h.hc(4,"vdr-labeled-data",28),h.sc(5,"translate"),h.cc(6,"vdr-simple-item-list",29),h.gc(),h.gc()),2&e){var n=t.ngIf,c=h.rc(2).$implicit;h.Qb(1),h.yc("label",h.tc(2,4,"order.cancellation-reason")),h.Qb(2),h.Xc(" ",c.data.reason," "),h.Qb(1),h.yc("label",h.tc(5,6,"order.contents")),h.Qb(2),h.yc("items",n)}}var An=function(e){return{count:e}};function jn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.Tc(3,Ln,7,8,"vdr-history-entry-detail",19),h.ec()),2&e){var n=h.rc().$implicit,c=h.rc();h.Qb(1),h.Xc(" ",h.uc(2,2,"order.history-items-cancelled",h.Cc(5,An,n.data.orderItemIds.length))," "),h.Qb(2),h.yc("ngIf",c.getCancelledItems(n))}}function Dn(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.cc(1,"vdr-fulfillment-detail",30),h.gc()),2&e){var n=t.ngIf,c=h.rc(3);h.Qb(1),h.yc("fulfillmentId",n.id)("order",c.order)}}function Wn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.Tc(3,Dn,2,2,"vdr-history-entry-detail",19),h.ec()),2&e){var n=h.rc().$implicit,c=h.rc();h.Qb(1),h.Xc(" ",h.tc(2,2,"order.history-fulfillment-created")," "),h.Qb(2),h.yc("ngIf",c.getFulfillment(n))}}function Nn(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Vc(4),h.sc(5,"translate"),h.ec()),2&e){var n,c=h.rc(2).$implicit,r=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,3,"order.history-fulfillment-delivered")," "),h.Qb(2),h.Yc(" ",h.tc(5,5,"order.tracking-code"),": ",null==(n=r.getFulfillment(c))?null:n.trackingCode," ")}}function Rn(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",11),h.Vc(2),h.sc(3,"translate"),h.gc(),h.Vc(4),h.sc(5,"translate"),h.ec()),2&e){var n,c=h.rc(2).$implicit,r=h.rc();h.Qb(2),h.Xc(" ",h.tc(3,3,"order.history-fulfillment-shipped")," "),h.Qb(2),h.Yc(" ",h.tc(5,5,"order.tracking-code"),": ",null==(n=r.getFulfillment(c))?null:n.trackingCode," ")}}function En(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e){var n=h.rc(2).$implicit;h.Qb(1),h.Xc(" ",h.uc(2,1,"order.history-fulfillment-transition",h.Dc(4,On,n.data.from,n.data.to))," ")}}function Xn(e,t){if(1&e&&(h.hc(0,"vdr-history-entry-detail"),h.cc(1,"vdr-fulfillment-detail",30),h.gc()),2&e){var n=t.ngIf,c=h.rc(3);h.Qb(1),h.yc("fulfillmentId",n.id)("order",c.order)}}function $n(e,t){if(1&e&&(h.fc(0),h.Tc(1,Nn,6,7,"ng-container",19),h.Tc(2,Rn,6,7,"ng-container",19),h.Tc(3,En,3,7,"ng-container",19),h.Tc(4,Xn,2,2,"vdr-history-entry-detail",19),h.ec()),2&e){var n=h.rc().$implicit,c=h.rc();h.Qb(1),h.yc("ngIf","Delivered"===n.data.to),h.Qb(1),h.yc("ngIf","Shipped"===n.data.to),h.Qb(1),h.yc("ngIf","Delivered"!==n.data.to&&"Shipped"!==n.data.to),h.Qb(1),h.yc("ngIf",c.getFulfillment(n))}}function qn(e,t){1&e&&(h.hc(0,"span",43),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"common.public")))}function Hn(e,t){1&e&&(h.hc(0,"span",44),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"common.private")))}function Un(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"div",31),h.hc(2,"div",32),h.Tc(3,qn,3,3,"span",33),h.Tc(4,Hn,3,3,"span",34),h.Vc(5),h.gc(),h.cc(6,"div",35),h.hc(7,"vdr-dropdown"),h.hc(8,"button",36),h.cc(9,"clr-icon",37),h.gc(),h.hc(10,"vdr-dropdown-menu",38),h.hc(11,"button",39),h.pc("click",function(){h.Lc(n);var e=h.rc().$implicit;return h.rc().updateNote.emit(e)}),h.sc(12,"hasPermission"),h.cc(13,"clr-icon",40),h.Vc(14),h.sc(15,"translate"),h.gc(),h.cc(16,"div",41),h.hc(17,"button",39),h.pc("click",function(){h.Lc(n);var e=h.rc().$implicit;return h.rc().deleteNote.emit(e)}),h.sc(18,"hasPermission"),h.cc(19,"clr-icon",42),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.gc(),h.ec()}if(2&e){var c=h.rc().$implicit;h.Qb(3),h.yc("ngIf",c.isPublic),h.Qb(1),h.yc("ngIf",!c.isPublic),h.Qb(1),h.Xc(" ",c.data.note," "),h.Qb(6),h.yc("disabled",!h.tc(12,7,"UpdateOrder")),h.Qb(3),h.Xc(" ",h.tc(15,9,"common.edit")," "),h.Qb(3),h.yc("disabled",!h.tc(18,11,"UpdateOrder")),h.Qb(3),h.Xc(" ",h.tc(21,13,"common.delete")," ")}}var Gn=function(e){return["/marketing","promotions",e]};function zn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.hc(3,"vdr-chip"),h.hc(4,"a",45),h.Vc(5),h.gc(),h.gc(),h.ec()),2&e){var n=h.rc().$implicit;h.Qb(1),h.Xc(" ",h.tc(2,3,"order.history-coupon-code-applied"),": "),h.Qb(3),h.yc("routerLink",h.Cc(5,Gn,n.data.promotionId)),h.Qb(1),h.Wc(n.data.couponCode)}}function Bn(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.hc(3,"vdr-chip"),h.hc(4,"span",46),h.Vc(5),h.gc(),h.gc(),h.ec()),2&e){var n=h.rc().$implicit;h.Qb(1),h.Xc(" ",h.tc(2,2,"order.history-coupon-code-removed"),": "),h.Qb(4),h.Wc(n.data.couponCode)}}function Yn(e,t){if(1&e){var n=h.ic();h.hc(0,"vdr-timeline-entry",14),h.pc("expandClick",function(){h.Lc(n);var e=h.rc();return e.expanded=!e.expanded}),h.fc(1,15),h.Tc(2,In,4,3,"ng-container",16),h.Tc(3,kn,5,4,"ng-container",16),h.Tc(4,wn,4,2,"ng-container",16),h.Tc(5,_n,3,8,"ng-container",16),h.Tc(6,jn,4,7,"ng-container",16),h.Tc(7,Wn,4,4,"ng-container",16),h.Tc(8,$n,5,4,"ng-container",16),h.Tc(9,Un,22,15,"ng-container",16),h.Tc(10,zn,6,7,"ng-container",16),h.Tc(11,Bn,6,4,"ng-container",16),h.ec(),h.gc()}if(2&e){var c=t.$implicit,r=h.rc();h.yc("displayType",r.getDisplayType(c))("iconShape",r.getTimelineIcon(c))("createdAt",c.createdAt)("name",r.getName(c))("featured",r.isFeatured(c))("collapsed",!r.expanded&&!r.isFeatured(c)),h.Qb(1),h.yc("ngSwitch",c.type),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_STATE_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_MODIFIED),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_PAYMENT_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_REFUND_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_CANCELLATION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_FULFILLMENT),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_FULFILLMENT_TRANSITION),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_NOTE),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_COUPON_APPLIED),h.Qb(1),h.yc("ngSwitchCase",r.type.ORDER_COUPON_REMOVED)}}var Jn=function(){function e(){g(this,e),this.addNote=new h.t,this.updateNote=new h.t,this.deleteNote=new h.t,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=m.y}return p(e,[{key:"getDisplayType",value:function(e){if(e.type===m.y.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return"success";if("Cancelled"===e.data.to)return"error"}return e.type===m.y.ORDER_FULFILLMENT_TRANSITION&&"Delivered"===e.data.to?"success":e.type!==m.y.ORDER_PAYMENT_TRANSITION||"Declined"!==e.data.to&&"Cancelled"!==e.data.to?e.type===m.y.ORDER_CANCELLATION?"error":e.type===m.y.ORDER_REFUND_TRANSITION?"warning":"default":"error"}},{key:"getTimelineIcon",value:function(e){if(e.type===m.y.ORDER_STATE_TRANSITION){if("Delivered"===e.data.to)return["success-standard","is-solid"];if("Cancelled"===e.data.to)return"ban"}if(e.type===m.y.ORDER_PAYMENT_TRANSITION&&"Settled"===e.data.to)return"credit-card";if(e.type===m.y.ORDER_NOTE)return"note";if(e.type===m.y.ORDER_MODIFIED)return"pencil";if(e.type===m.y.ORDER_FULFILLMENT_TRANSITION){if("Shipped"===e.data.to)return"truck";if("Delivered"===e.data.to)return"truck"}}},{key:"isFeatured",value:function(e){switch(e.type){case m.y.ORDER_STATE_TRANSITION:return"Delivered"===e.data.to||"Cancelled"===e.data.to||"Settled"===e.data.to;case m.y.ORDER_PAYMENT_TRANSITION:return"Settled"===e.data.to||"Cancelled"===e.data.to;case m.y.ORDER_FULFILLMENT_TRANSITION:return"Delivered"===e.data.to||"Shipped"===e.data.to;case m.y.ORDER_NOTE:case m.y.ORDER_MODIFIED:return!0;default:return!1}}},{key:"getFulfillment",value:function(e){if((e.type===m.y.ORDER_FULFILLMENT||e.type===m.y.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(function(t){return t.id===e.data.fulfillmentId})}},{key:"getPayment",value:function(e){if(e.type===m.y.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(function(t){return t.id===e.data.paymentId})}},{key:"getCancelledItems",value:function(e){var t,n=new Map,c=e.data.orderItemIds,r=l(this.order.lines);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=l(a.items);try{for(o.s();!(i=o.n()).done;){var d=i.value;if(c.includes(d.id)){var u=n.get(a.productVariant.name);null!=u?n.set(a.productVariant.name,u+1):n.set(a.productVariant.name,1)}}}catch(f){o.e(f)}finally{o.f()}}}catch(f){r.e(f)}finally{r.f()}return Array.from(n.entries()).map(function(e){var t=s(e,2);return{name:t[0],quantity:t[1]}})}},{key:"getModification",value:function(e){return this.order.modifications.find(function(t){return t.id===e})}},{key:"getName",value:function(e){var t=e.administrator;if(t)return"".concat(t.firstName," ").concat(t.lastName);var n=this.order.customer;return n?"".concat(n.firstName," ").concat(n.lastName):""}},{key:"addNoteToOrder",value:function(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}}]),e}();Jn.\u0275fac=function(e){return new(e||Jn)},Jn.\u0275cmp=h.Vb({type:Jn,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},decls:23,vars:24,consts:[[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured"],[1,"note-entry"],["name","note",1,"note",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick",4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"displayType","iconShape","createdAt","name","featured","collapsed","expandClick"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","title",4,"ngIf"],[3,"ngIf"],[4,"ngIf"],["colorType","success",4,"ngIf"],["colorType","error",4,"ngIf"],[3,"order","modification"],["colorType","success"],["colorType","error"],[4,"ngIf","ngIfElse"],["regularPaymentTransition",""],[3,"payment","currencyCode"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["vdrDropdownItem","",1,"button",3,"disabled","click"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"]],template:function(e,t){1&e&&(h.hc(0,"h4"),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"div",0),h.hc(4,"vdr-timeline-entry",1),h.hc(5,"div",2),h.hc(6,"textarea",3),h.pc("ngModelChange",function(e){return t.note=e}),h.gc(),h.hc(7,"button",4),h.pc("click",function(){return t.addNoteToOrder()}),h.Vc(8),h.sc(9,"translate"),h.gc(),h.gc(),h.hc(10,"div",5),h.hc(11,"clr-checkbox-wrapper"),h.hc(12,"input",6),h.pc("ngModelChange",function(e){return t.noteIsPrivate=e}),h.gc(),h.hc(13,"label"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.gc(),h.Tc(16,bn,3,3,"span",7),h.Tc(17,vn,3,3,"span",8),h.gc(),h.gc(),h.Tc(18,Yn,12,17,"vdr-timeline-entry",9),h.hc(19,"vdr-timeline-entry",10),h.hc(20,"div",11),h.Vc(21),h.sc(22,"translate"),h.gc(),h.gc(),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,16,"order.order-history")),h.Qb(2),h.Tb("expanded",t.expanded),h.Qb(1),h.yc("featured",!0),h.Qb(2),h.yc("ngModel",t.note),h.Qb(1),h.yc("disabled",!t.note),h.Qb(1),h.Xc(" ",h.tc(9,18,"common.add-note")," "),h.Qb(4),h.yc("ngModel",t.noteIsPrivate),h.Qb(2),h.Wc(h.tc(15,20,"order.note-is-private")),h.Qb(2),h.yc("ngIf",t.noteIsPrivate),h.Qb(1),h.yc("ngIf",!t.noteIsPrivate),h.Qb(1),h.yc("ngForOf",t.history),h.Qb(1),h.yc("isLast",!0)("createdAt",t.order.createdAt)("featured",!0),h.Qb(2),h.Xc(" ",h.tc(22,22,"order.history-order-created")," "))},directives:[dn.a,C.a,u.b,u.p,u.s,M.k,u.a,M.i,M.u,I.o,I.n,I.q,I.r,un.a,Ne,G.a,pn,Z.a,ee,ae,oe.a,le.a,M.o,se.a,de.a,Ut.h],pipes:[Q.d,T.a,hn.a],styles:["[_nghost-%COMP%]{margin-top:48px;display:block}.entry-list[_ngcontent-%COMP%]{margin-top:24px;margin-left:24px;margin-right:12px}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-500)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-right:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-500)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-500)}"],changeDetection:0});var Zn=d("dBS1");function Kn(e,t){1&e&&h.cc(0,"clr-icon",2)}var ec=function(){function e(){g(this,e)}return p(e,[{key:"chipColorType",get:function(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}}]),e}();function tc(e,t){1&e&&h.cc(0,"clr-icon",2)}ec.\u0275fac=function(e){return new(e||ec)},ec.\u0275cmp=h.Vb({type:ec,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(h.hc(0,"vdr-chip",0),h.sc(1,"translate"),h.Tc(2,Kn,1,0,"clr-icon",1),h.Vc(3),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()),2&e&&(h.yc("title",h.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),h.Qb(2),h.yc("ngIf","Settled"===t.state),h.Qb(1),h.Xc(" ",h.tc(4,6,h.tc(5,8,t.state)),"\n"))},directives:[G.a,I.o,M.o],pipes:[Q.d,z.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var nc=function(){function e(){g(this,e)}return p(e,[{key:"chipColorType",get:function(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}}]),e}();function cc(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.ec()),2&e){var n=h.rc();h.Qb(1),h.Xc("#",n.payment.transactionId,"")}}function rc(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",11),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.transaction-id")),h.Qb(2),h.Xc(" ",n.transactionId," ")}}function ic(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",11),h.sc(1,"translate"),h.Vc(2),h.gc()),2&e){var n=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.refund-reason")),h.Qb(2),h.Xc(" ",n.reason," ")}}function ac(e,t){if(1&e&&(h.hc(0,"vdr-labeled-data",11),h.sc(1,"translate"),h.cc(2,"vdr-object-tree",13),h.gc()),2&e){var n=h.rc().$implicit;h.yc("label",h.tc(1,2,"order.refund-metadata")),h.Qb(2),h.yc("value",n.metadata)}}function oc(e,t){if(1&e){var n=h.ic();h.hc(0,"div",14),h.hc(1,"button",15),h.pc("click",function(){h.Lc(n);var e=h.rc().$implicit;return h.rc().settleRefund.emit(e)}),h.Vc(2),h.sc(3,"translate"),h.gc(),h.gc()}2&e&&(h.Qb(2),h.Xc(" ",h.tc(3,1,"order.settle-refund")," "))}function lc(e,t){if(1&e&&(h.fc(0),h.hc(1,"div",1),h.cc(2,"clr-icon",9),h.Vc(3),h.sc(4,"translate"),h.cc(5,"div",10),h.cc(6,"vdr-refund-state-label",4),h.gc(),h.hc(7,"div",5),h.hc(8,"vdr-labeled-data",11),h.sc(9,"translate"),h.Vc(10),h.sc(11,"localeDate"),h.gc(),h.hc(12,"vdr-labeled-data",11),h.sc(13,"translate"),h.Vc(14),h.sc(15,"localeCurrency"),h.gc(),h.Tc(16,rc,3,4,"vdr-labeled-data",12),h.Tc(17,ic,3,4,"vdr-labeled-data",12),h.Tc(18,ac,3,4,"vdr-labeled-data",12),h.gc(),h.Tc(19,oc,4,3,"div",8),h.ec()),2&e){var n=t.$implicit,c=h.rc();h.Qb(3),h.Yc(" ",h.tc(4,11,"order.refund")," #",n.id," "),h.Qb(3),h.yc("state",n.state),h.Qb(2),h.yc("label",h.tc(9,13,"common.created-at")),h.Qb(2),h.Xc(" ",h.uc(11,15,n.createdAt,"medium")," "),h.Qb(2),h.yc("label",h.tc(13,18,"order.refund-total")),h.Qb(2),h.Xc(" ",h.uc(15,20,n.total,c.currencyCode)," "),h.Qb(2),h.yc("ngIf",n.transactionId),h.Qb(1),h.yc("ngIf",n.reason),h.Qb(1),h.yc("ngIf",c.refundHasMetadata(n)),h.Qb(1),h.yc("ngIf","Pending"===n.state)}}function sc(e,t){if(1&e){var n=h.ic();h.hc(0,"button",15),h.pc("click",function(){h.Lc(n);var e=h.rc(2);return e.settlePayment.emit(e.payment)}),h.Vc(1),h.sc(2,"translate"),h.gc()}2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.settle-payment")," "))}nc.\u0275fac=function(e){return new(e||nc)},nc.\u0275cmp=h.Vb({type:nc,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(e,t){1&e&&(h.hc(0,"vdr-chip",0),h.sc(1,"translate"),h.Tc(2,tc,1,0,"clr-icon",1),h.Vc(3),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()),2&e&&(h.yc("title",h.tc(1,4,"order.payment-state"))("colorType",t.chipColorType),h.Qb(2),h.yc("ngIf","Settled"===t.state),h.Qb(1),h.Xc(" ",h.tc(4,6,h.tc(5,8,t.state)),"\n"))},directives:[G.a,I.o,M.o],pipes:[Q.d,z.a],styles:["[_nghost-%COMP%]{font-size:14px}"],changeDetection:0});var dc=function(e){return{state:e}};function uc(e,t){if(1&e&&(h.fc(0),h.cc(1,"clr-icon",23),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.ec()),2&e){var n=h.rc().$implicit;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.transition-to-state",h.Cc(8,dc,h.tc(4,4,h.tc(5,6,n))))," ")}}function fc(e,t){1&e&&(h.cc(0,"clr-icon",24),h.Vc(1),h.sc(2,"translate")),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.cancel-payment")," "))}function gc(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"button",20),h.pc("click",function(){h.Lc(n);var e=t.$implicit,c=h.rc(2);return c.transitionPaymentState.emit({payment:c.payment,state:e})}),h.Tc(2,uc,6,10,"ng-container",21),h.Tc(3,fc,3,3,"ng-template",null,22,h.Uc),h.gc(),h.ec()}if(2&e){var c=t.$implicit,r=h.Ic(4);h.Qb(2),h.yc("ngIf","Cancelled"!==c)("ngIfElse",r)}}function mc(e,t){if(1&e&&(h.hc(0,"div",14),h.Tc(1,sc,3,3,"button",16),h.hc(2,"vdr-dropdown"),h.hc(3,"button",17),h.cc(4,"clr-icon",18),h.gc(),h.hc(5,"vdr-dropdown-menu",19),h.Tc(6,gc,5,2,"ng-container",7),h.gc(),h.gc(),h.gc()),2&e){var n=h.rc();h.Qb(1),h.yc("ngIf",n.payment.nextStates.includes("Settled")),h.Qb(5),h.yc("ngForOf",n.nextOtherStates())}}var pc=function(){function e(){g(this,e),this.settlePayment=new h.t,this.transitionPaymentState=new h.t,this.settleRefund=new h.t}return p(e,[{key:"refundHasMetadata",value:function(e){return!!e&&Object.keys(e.metadata).length>0}},{key:"nextOtherStates",value:function(){return this.payment?this.payment.nextStates.filter(function(e){return"Settled"!==e}):[]}}]),e}();function hc(e,t){if(1&e){var n=h.ic();h.hc(0,"button",16),h.pc("click",function(){h.Lc(n);var e=h.rc().ngIf;return h.rc().addManualPayment(e)}),h.Vc(1),h.sc(2,"translate"),h.sc(3,"localeCurrency"),h.gc()}if(2&e){var c=h.rc().ngIf,r=h.rc();h.Qb(1),h.Yc(" ",h.tc(2,2,"order.add-payment-to-order")," (",h.uc(3,4,r.outstandingPaymentAmount(c),c.currencyCode),") ")}}function bc(e,t){if(1&e){var n=h.ic();h.hc(0,"button",16),h.pc("click",function(){return h.Lc(n),h.rc(2).transitionToState("ArrangingAdditionalPayment")}),h.Vc(1),h.sc(2,"translate"),h.gc()}2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.arrange-additional-payment")," "))}function vc(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"button",14),h.pc("click",function(){return h.Lc(n),h.rc(2).transitionToModifying()}),h.cc(2,"clr-icon",17),h.Vc(3),h.sc(4,"translate"),h.gc(),h.cc(5,"div",13),h.ec()}2&e&&(h.Qb(3),h.Xc(" ",h.tc(4,1,"order.modify-order")," "))}function yc(e,t){1&e&&(h.fc(0),h.Vc(1),h.sc(2,"translate"),h.ec()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.refund-and-cancel-order")," "))}function Cc(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Xc(" ",h.tc(1,1,"order.cancel-order")," ")}function Oc(e,t){if(1&e){var n=h.ic();h.hc(0,"button",14),h.pc("click",function(){h.Lc(n);var e=h.rc().ngIf;return h.rc().cancelOrRefund(e)}),h.cc(1,"clr-icon",18),h.Tc(2,yc,3,3,"ng-container",19),h.Tc(3,Cc,2,3,"ng-template",null,20,h.Uc),h.gc()}if(2&e){var c=h.Ic(4),r=h.rc().ngIf,i=h.rc();h.Qb(2),h.yc("ngIf",i.orderHasSettledPayments(r))("ngIfElse",c)}}pc.\u0275fac=function(e){return new(e||pc)},pc.\u0275cmp=h.Vb({type:pc,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},decls:12,vars:9,consts:[[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],[4,"ngIf","ngIfElse"],["cancel",""],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(e,t){1&e&&(h.hc(0,"div",0),h.hc(1,"div",1),h.hc(2,"div"),h.Vc(3),h.sc(4,"translate"),h.Tc(5,cc,2,1,"ng-container",2),h.gc(),h.hc(6,"div",3),h.cc(7,"vdr-payment-state-label",4),h.gc(),h.gc(),h.hc(8,"div",5),h.cc(9,"vdr-payment-detail",6),h.gc(),h.Tc(10,lc,20,23,"ng-container",7),h.Tc(11,mc,7,2,"div",8),h.gc()),2&e&&(h.Qb(3),h.Xc(" ",h.tc(4,7,"order.payment")," "),h.Qb(2),h.yc("ngIf",t.payment.transactionId),h.Qb(2),h.yc("state",t.payment.state),h.Qb(2),h.yc("payment",t.payment)("currencyCode",t.currencyCode),h.Qb(1),h.yc("ngForOf",t.payment.refunds),h.Qb(1),h.yc("ngIf",t.payment.nextStates.length))},directives:[I.o,ec,pn,I.n,M.o,xe.b,nc,Z.a,fn.a,oe.a,le.a,se.a,de.a],pipes:[Q.d,ne.a,T.a,z.a],styles:[".payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.refund-icon[_ngcontent-%COMP%]{margin-right:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}"],changeDetection:0});var Qc=function(e){return{state:e}};function Ic(e,t){if(1&e){var n=h.ic();h.hc(0,"button",14),h.pc("click",function(){h.Lc(n);var e=t.$implicit;return h.rc(3).transitionToState(e)}),h.cc(1,"clr-icon",22),h.Vc(2),h.sc(3,"translate"),h.sc(4,"translate"),h.sc(5,"stateI18nToken"),h.gc()}if(2&e){var c=t.$implicit;h.Qb(2),h.Xc(" ",h.uc(3,1,"order.transition-to-state",h.Cc(8,Qc,h.tc(4,4,h.tc(5,6,c))))," ")}}function Tc(e,t){if(1&e&&(h.fc(0),h.cc(1,"div",13),h.Tc(2,Ic,6,10,"button",21),h.sc(3,"async"),h.ec()),2&e){var n=h.rc(2);h.Qb(2),h.yc("ngForOf",h.tc(3,1,n.nextStates$))}}function Sc(e,t){if(1&e){var n=h.ic();h.hc(0,"vdr-action-bar"),h.hc(1,"vdr-ab-left"),h.hc(2,"div",1),h.cc(3,"vdr-entity-info",2),h.sc(4,"async"),h.hc(5,"vdr-order-state-label",3),h.hc(6,"button",4),h.pc("click",function(){return h.Lc(n),h.rc().openStateDiagram()}),h.sc(7,"translate"),h.cc(8,"clr-icon",5),h.gc(),h.gc(),h.gc(),h.gc(),h.hc(9,"vdr-ab-right"),h.cc(10,"vdr-action-bar-items",6),h.Tc(11,hc,4,7,"button",7),h.Tc(12,bc,3,3,"button",7),h.hc(13,"button",8),h.pc("click",function(){return h.Lc(n),h.rc().fulfillOrder()}),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"vdr-dropdown"),h.hc(17,"button",9),h.cc(18,"clr-icon",10),h.gc(),h.hc(19,"vdr-dropdown-menu",11),h.Tc(20,vc,6,3,"ng-container",0),h.Tc(21,Oc,5,2,"button",12),h.Tc(22,Tc,4,3,"ng-container",0),h.sc(23,"async"),h.cc(24,"div",13),h.hc(25,"button",14),h.pc("click",function(){h.Lc(n);var e=t.ngIf;return h.rc().manuallyTransitionToState(e)}),h.cc(26,"clr-icon",15),h.Vc(27),h.sc(28,"translate"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc()}if(2&e){var c,r=t.ngIf,i=h.rc();h.Qb(3),h.yc("entity",h.tc(4,11,i.entity$)),h.Qb(2),h.yc("state",r.state),h.Qb(1),h.yc("title",h.tc(7,13,"order.order-state-diagram")),h.Qb(5),h.yc("ngIf","ArrangingAdditionalPayment"===r.state&&(i.hasUnsettledModifications(r)||0<i.outstandingPaymentAmount(r))),h.Qb(1),h.yc("ngIf","ArrangingAdditionalPayment"!==r.state&&0<i.outstandingPaymentAmount(r)),h.Qb(1),h.yc("disabled",!i.canAddFulfillment(r)),h.Qb(1),h.Xc(" ",h.tc(15,15,"order.fulfill-order")," "),h.Qb(6),h.yc("ngIf",r.nextStates.includes("Modifying")),h.Qb(1),h.yc("ngIf",r.nextStates.includes("Cancelled")),h.Qb(1),h.yc("ngIf",null==(c=h.tc(23,17,i.nextStates$))?null:c.length),h.Qb(5),h.Xc(" ",h.tc(28,19,"order.manually-transition-to-state")," ")}}function Pc(e,t){if(1&e&&(h.hc(0,"tr"),h.hc(1,"td"),h.Vc(2),h.gc(),h.hc(3,"td"),h.Vc(4),h.sc(5,"percent"),h.gc(),h.hc(6,"td"),h.Vc(7),h.sc(8,"localeCurrency"),h.gc(),h.hc(9,"td"),h.Vc(10),h.sc(11,"localeCurrency"),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc().ngIf;h.Qb(2),h.Wc(n.description),h.Qb(2),h.Wc(h.tc(5,4,n.taxRate/100)),h.Qb(3),h.Wc(h.uc(8,6,n.taxBase,c.currencyCode)),h.Qb(3),h.Wc(h.uc(11,9,n.taxTotal,c.currencyCode))}}function kc(e,t){1&e&&(h.hc(0,"h6"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.shipping-address")," "))}function Fc(e,t){1&e&&(h.hc(0,"h6"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.billing-address")," "))}function Mc(e,t){if(1&e){var n=h.ic();h.hc(0,"vdr-order-payment-card",38),h.pc("settlePayment",function(e){return h.Lc(n),h.rc(3).settlePayment(e)})("transitionPaymentState",function(e){return h.Lc(n),h.rc(3).transitionPaymentState(e)})("settleRefund",function(e){return h.Lc(n),h.rc(3).settleRefund(e)}),h.gc()}if(2&e){var c=t.$implicit,r=h.rc(2).ngIf;h.yc("currencyCode",r.currencyCode)("payment",c)}}function Vc(e,t){if(1&e&&(h.fc(0),h.Tc(1,Mc,1,2,"vdr-order-payment-card",37),h.ec()),2&e){var n=h.rc().ngIf;h.Qb(1),h.yc("ngForOf",n.payments)}}function xc(e,t){if(1&e){var n=h.ic();h.fc(0),h.hc(1,"vdr-fulfillment-card",39),h.pc("transitionState",function(e){h.Lc(n);var c=t.$implicit;return h.rc(2).transitionFulfillment(c.id,e)}),h.gc(),h.ec()}if(2&e){var c=t.$implicit,r=h.rc().ngIf;h.Qb(1),h.yc("fulfillment",c)("order",r)}}function wc(e,t){if(1&e){var n=h.ic();h.hc(0,"div"),h.hc(1,"div",23),h.hc(2,"div",24),h.cc(3,"vdr-order-table",25),h.hc(4,"h4"),h.Vc(5),h.sc(6,"translate"),h.gc(),h.hc(7,"table",26),h.hc(8,"thead"),h.hc(9,"tr"),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.hc(19,"th"),h.Vc(20),h.sc(21,"translate"),h.gc(),h.gc(),h.gc(),h.hc(22,"tbody"),h.Tc(23,Pc,12,12,"tr",27),h.gc(),h.gc(),h.hc(24,"vdr-order-history",28),h.pc("addNote",function(e){return h.Lc(n),h.rc().addNote(e)})("updateNote",function(e){return h.Lc(n),h.rc().updateNote(e)})("deleteNote",function(e){return h.Lc(n),h.rc().deleteNote(e)}),h.sc(25,"async"),h.gc(),h.gc(),h.hc(26,"div",29),h.hc(27,"vdr-order-custom-fields-card",30),h.pc("updateClick",function(e){return h.Lc(n),h.rc().updateCustomFields(e)}),h.gc(),h.hc(28,"div",31),h.hc(29,"div",32),h.Vc(30),h.sc(31,"translate"),h.gc(),h.hc(32,"div",33),h.hc(33,"div",34),h.cc(34,"vdr-customer-label",35),h.Tc(35,kc,3,3,"h6",0),h.cc(36,"vdr-formatted-address",36),h.Tc(37,Fc,3,3,"h6",0),h.cc(38,"vdr-formatted-address",36),h.gc(),h.gc(),h.gc(),h.Tc(39,Vc,2,1,"ng-container",0),h.Tc(40,xc,2,2,"ng-container",27),h.gc(),h.gc(),h.gc()}if(2&e){var c=t.ngIf,r=h.rc();h.Qb(3),h.yc("order",c)("orderLineCustomFields",r.orderLineCustomFields),h.Qb(2),h.Wc(h.tc(6,20,"order.tax-summary")),h.Qb(6),h.Wc(h.tc(12,22,"common.description")),h.Qb(3),h.Wc(h.tc(15,24,"order.tax-rate")),h.Qb(3),h.Wc(h.tc(18,26,"order.tax-base")),h.Qb(3),h.Wc(h.tc(21,28,"order.tax-total")),h.Qb(3),h.yc("ngForOf",c.taxSummary),h.Qb(1),h.yc("order",c)("history",h.tc(25,30,r.history$)),h.Qb(3),h.yc("customFieldsConfig",r.customFields)("customFieldValues",c.customFields),h.Qb(3),h.Xc(" ",h.tc(31,32,"order.customer")," "),h.Qb(4),h.yc("customer",c.customer),h.Qb(1),h.yc("ngIf",r.getOrderAddressLines(c.shippingAddress).length),h.Qb(1),h.yc("address",c.shippingAddress),h.Qb(1),h.yc("ngIf",r.getOrderAddressLines(c.billingAddress).length),h.Qb(1),h.yc("address",c.billingAddress),h.Qb(1),h.yc("ngIf",c.payments&&c.payments.length),h.Qb(1),h.yc("ngForOf",c.fulfillments)}}var _c=function(e){t(r,e);var n=c(r);function r(e,t,c,i,a,o,l,s){var d;return g(this,r),(d=n.call(this,t,e,c,a)).changeDetector=i,d.dataService=a,d.notificationService=o,d.modalService=l,d.orderTransitionService=s,d.detailForm=new u.i({}),d.fetchHistory=new He.a,d.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"],d}return p(r,[{key:"ngOnInit",value:function(){var e=this;this.init(),this.entity$.pipe(Object(Be.a)(1)).subscribe(function(t){"Modifying"===t.state&&e.router.navigate(["./","modify"],{relativeTo:e.route})}),this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.history$=this.fetchHistory.pipe(Object(Ye.a)(null),Object(Je.a)(function(){return e.dataService.order.getOrderHistory(e.id,{sort:{createdAt:m.L.DESC}}).mapStream(function(e){var t;return null===(t=e.order)||void 0===t?void 0:t.history.items})})),this.nextStates$=this.entity$.pipe(Object(Ze.a)(function(t){return e.defaultStates.includes(t.state)?t.nextStates.filter(function(t){return!e.defaultStates.includes(t)}):t.nextStates}))}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"openStateDiagram",value:function(){var e=this;this.entity$.pipe(Object(Be.a)(1),Object(Je.a)(function(t){return e.modalService.fromComponent(It,{closable:!0,locals:{activeState:t.state}})})).subscribe()}},{key:"transitionToState",value:function(e){var t=this;this.dataService.order.transitionToState(this.id,e).subscribe(function(n){var c=n.transitionOrderToState;switch(null==c?void 0:c.__typename){case"Order":t.notificationService.success(Object(F.a)("order.transitioned-to-state-success"),{state:e}),t.fetchHistory.next();break;case"OrderStateTransitionError":t.notificationService.error(c.transitionError)}})}},{key:"manuallyTransitionToState",value:function(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:Object(F.a)("order.manually-transition-to-state-message"),retry:0}).subscribe()}},{key:"transitionToModifying",value:function(){var e=this;this.dataService.order.transitionToState(this.id,"Modifying").subscribe(function(t){var n=t.transitionOrderToState;switch(null==n?void 0:n.__typename){case"Order":e.router.navigate(["./modify"],{relativeTo:e.route});break;case"OrderStateTransitionError":e.notificationService.error(n.transitionError)}})}},{key:"updateCustomFields",value:function(e){var t=this;this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe(function(){t.notificationService.success(Object(F.a)("common.notify-update-success"),{entity:"Order"})})}},{key:"getOrderAddressLines",value:function(e){return e?Object.values(e).filter(function(e){return"OrderAddress"!==e}).filter(function(e){return!!e}):[]}},{key:"settlePayment",value:function(e){var t=this;this.dataService.order.settlePayment(e.id).subscribe(function(e){var n=e.settlePayment;switch(n.__typename){case"Payment":"Settled"===n.state?t.notificationService.success(Object(F.a)("order.settle-payment-success")):t.notificationService.error(Object(F.a)("order.settle-payment-error")),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":t.notificationService.error(n.message)}})}},{key:"transitionPaymentState",value:function(e){var t=this,n=e.payment,c=e.state;this.dataService.order.transitionPaymentToState(n.id,c).subscribe(function(e){var n=e.transitionPaymentToState;switch(n.__typename){case"Payment":t.notificationService.success(Object(F.a)("order.transitioned-payment-to-state-success"),{state:c}),t.dataService.order.getOrder(t.id).single$.subscribe(),t.fetchHistory.next();break;case"PaymentStateTransitionError":t.notificationService.error(n.message)}})}},{key:"canAddFulfillment",value:function(e){return!e.lines.reduce(function(e,t){return[].concat(o(e),o(t.items))},[]).every(function(e){return!!e.fulfillment})&&!this.hasUnsettledModifications(e)&&0===this.outstandingPaymentAmount(e)&&(e.nextStates.includes("Shipped")||e.nextStates.includes("PartiallyShipped")||e.nextStates.includes("Delivered"))}},{key:"hasUnsettledModifications",value:function(e){return 0<e.modifications.filter(function(e){return!e.isSettled}).length}},{key:"getOutstandingModificationAmount",value:function(e){return Object(J.summate)(e.modifications.filter(function(e){return!e.isSettled}),"priceChange")}},{key:"outstandingPaymentAmount",value:function(e){var t,n,c,r,i=0,a=l(null!==(n=null===(t=e.payments)||void 0===t?void 0:t.filter(function(e){return"Cancelled"!==e.state&&"Declined"!==e.state&&"Error"!==e.state}))&&void 0!==n?n:[]);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=null!==(c=o.refunds.filter(function(e){return"Failed"!==e.state}))&&void 0!==c?c:[],d=Object(J.summate)(s,"total");i+=o.amount-d}}catch(u){a.e(u)}finally{a.f()}return e.totalWithTax-i}},{key:"addManualPayment",value:function(e){var t=this;this.modalService.fromComponent(k,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(e),currencyCode:e.currencyCode}}).pipe(Object(Je.a)(function(e){return e?t.dataService.order.addManualPaymentToOrder({orderId:t.id,transactionId:e.transactionId,method:e.method,metadata:e.metadata||{}}):Ue.a}),Object(Je.a)(function(n){var c=n.addManualPaymentToOrder;switch(c.__typename){case"Order":return t.notificationService.success(Object(F.a)("order.add-payment-to-order-success")),t.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates);case"ManualPaymentStateError":return t.notificationService.error(c.message),Ue.a;default:return Ue.a}})).subscribe(function(e){e&&t.refetchOrder({result:e})})}},{key:"fulfillOrder",value:function(){var e=this;this.entity$.pipe(Object(Be.a)(1),Object(Je.a)(function(t){return e.modalService.fromComponent(U,{size:"xl",locals:{order:t}})}),Object(Je.a)(function(t){return t?e.dataService.order.createFulfillment(t):Object(Ge.a)(void 0)}),Object(Je.a)(function(t){return e.refetchOrder(t).pipe(Object(Ke.a)(t))})).subscribe(function(t){if(t){var n=t.addFulfillmentToOrder;switch(n.__typename){case"Fulfillment":e.notificationService.success(Object(F.a)("order.create-fulfillment-success"));break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":e.notificationService.error(n.message);break;case"FulfillmentStateTransitionError":e.notificationService.error(n.transitionError);break;case"CreateFulfillmentError":e.notificationService.error(n.fulfillmentHandlerError);break;case void 0:e.notificationService.error(JSON.stringify(n));break;default:Object(J.assertNever)(n)}}})}},{key:"transitionFulfillment",value:function(e,t){var n=this;this.dataService.order.transitionFulfillmentToState(e,t).pipe(Object(Je.a)(function(e){return n.refetchOrder(e)})).subscribe(function(){n.notificationService.success(Object(F.a)("order.successfully-updated-fulfillment"))})}},{key:"cancelOrRefund",value:function(e){var t=this.orderHasSettledPayments(e);"PaymentAuthorized"!==e.state&&!0!==e.active&&t?this.refundOrder(e):this.cancelOrder(e)}},{key:"settleRefund",value:function(e){var t=this;this.modalService.fromComponent(Ht,{size:"md",locals:{refund:e}}).pipe(Object(Je.a)(function(n){return n?t.dataService.order.settleRefund({transactionId:n,id:e.id},t.id):Object(Ge.a)(void 0)})).subscribe(function(e){e&&t.notificationService.success(Object(F.a)("order.settle-refund-success"))})}},{key:"addNote",value:function(e){var t=this,n=e.note,c=e.isPublic;this.dataService.order.addNoteToOrder({id:this.id,note:n,isPublic:c}).pipe(Object(Je.a)(function(e){return t.refetchOrder(e)})).subscribe(function(e){t.notificationService.success(Object(F.a)("common.notify-create-success"),{entity:"Note"})})}},{key:"updateNote",value:function(e){var t=this;this.modalService.fromComponent(m.u,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe(Object(Je.a)(function(n){return n?t.dataService.order.updateOrderNote({noteId:e.id,isPublic:!n.isPrivate,note:n.note}):Ue.a})).subscribe(function(e){t.fetchHistory.next(),t.notificationService.success(Object(F.a)("common.notify-update-success"),{entity:"Note"})})}},{key:"deleteNote",value:function(e){var t=this;return this.modalService.dialog({title:Object(F.a)("common.confirm-delete-note"),body:e.data.note,buttons:[{type:"secondary",label:Object(F.a)("common.cancel")},{type:"danger",label:Object(F.a)("common.delete"),returnValue:!0}]}).pipe(Object(Je.a)(function(n){return n?t.dataService.order.deleteOrderNote(e.id):Ue.a})).subscribe(function(){t.fetchHistory.next(),t.notificationService.success(Object(F.a)("common.notify-delete-success"),{entity:"Note"})})}},{key:"orderHasSettledPayments",value:function(e){var t;return!!(null===(t=e.payments)||void 0===t?void 0:t.find(function(e){return"Settled"===e.state}))}},{key:"cancelOrder",value:function(e){var t=this;this.modalService.fromComponent(W,{size:"xl",locals:{order:e}}).pipe(Object(Je.a)(function(e){return e?t.dataService.order.cancelOrder(e):Object(Ge.a)(void 0)}),Object(Je.a)(function(e){return t.refetchOrder(e)})).subscribe(function(e){e&&t.notificationService.success(Object(F.a)("order.cancelled-order-success"))})}},{key:"refundOrder",value:function(e){var t=this;this.modalService.fromComponent(Et,{size:"xl",locals:{order:e}}).pipe(Object(Je.a)(function(e){var n;if(!e)return Object(Ge.a)(void 0);var c=[];return e.refund.lines.length&&c.push(t.dataService.order.refundOrder(e.refund).pipe(Object(Ze.a)(function(e){return e.refundOrder}))),(null===(n=e.cancel.lines)||void 0===n?void 0:n.length)&&c.push(t.dataService.order.cancelOrder(e.cancel).pipe(Object(Ze.a)(function(e){return e.cancelOrder}))),Object(ze.a).apply(void 0,c)})).subscribe(function(e){if(e)switch(e.__typename){case"Order":t.refetchOrder(e).subscribe(),t.notificationService.success(Object(F.a)("order.cancelled-order-success"));break;case"Refund":t.refetchOrder(e).subscribe(),"Failed"===e.state?t.notificationService.error(Object(F.a)("order.refund-order-failed")):t.notificationService.success(Object(F.a)("order.refund-order-success"));break;case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"CancelActiveOrderError":case"EmptyOrderLineSelectionError":case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":t.notificationService.error(e.message)}})}},{key:"refetchOrder",value:function(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:Object(Ge.a)(void 0)}},{key:"setFormValues",value:function(e){}}]),r}(m.l);_c.\u0275fac=function(e){return new(e||_c)(h.bc(Ut.e),h.bc(Ut.a),h.bc(m.I),h.bc(h.j),h.bc(m.s),h.bc(m.G),h.bc(m.F),h.bc(ut))},_c.\u0275cmp=h.Vb({type:_c,selectors:[["vdr-order-detail"]],features:[h.Nb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"icon-button",3,"title","click"],["shape","list"],["locationId","order-detail"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",1,"btn",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"btn","btn-primary",3,"click"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["cancelOnly",""],["type","button","class","btn","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[1,"clr-row"],[1,"clr-col-lg-8"],[3,"order","orderLineCustomFields"],[1,"table"],[4,"ngFor","ngForOf"],[3,"order","history","addNote","updateNote","deleteNote"],[1,"clr-col-lg-4","order-cards"],[3,"customFieldsConfig","customFieldValues","updateClick"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text"],[3,"customer"],[3,"address"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund"],[3,"fulfillment","order","transitionState"]],template:function(e,t){1&e&&(h.Tc(0,Sc,29,21,"vdr-action-bar",0),h.sc(1,"async"),h.Tc(2,wc,41,34,"div",0),h.sc(3,"async")),2&e&&(h.yc("ngIf",h.tc(1,2,t.entity$)),h.Qb(2),h.yc("ngIf",h.tc(3,4,t.entity$)))},directives:[I.o,Gt.a,Gt.b,zt.a,Bt.a,M.o,Gt.c,Yt.a,oe.a,le.a,se.a,de.a,I.n,sn,Jn,qe,Zn.a,N.a,pc,ve],pipes:[I.b,Q.d,T.a,z.a,I.v],styles:[".shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}"],changeDetection:0});var Lc,Ac=d("1G5W"),jc=d("UXun");function Dc(e,t){1&e&&(h.Vc(0),h.sc(1,"translate")),2&e&&h.Wc(h.tc(1,1,"order.confirm-modifications"))}function Wc(e,t){if(1&e&&(h.hc(0,"option",9),h.Vc(1),h.sc(2,"localeCurrency"),h.gc()),2&e){var n=t.$implicit,c=h.rc(2);h.yc("ngValue",n),h.Qb(1),h.Zc(" #",n.id," ",n.method,": ",h.uc(2,4,n.amount,c.order.currencyCode)," ")}}function Nc(e,t){if(1&e){var n=h.ic();h.hc(0,"div"),h.hc(1,"clr-select-container"),h.hc(2,"label"),h.Vc(3),h.sc(4,"translate"),h.gc(),h.hc(5,"select",5),h.pc("ngModelChange",function(e){return h.Lc(n),h.rc().selectedPayment=e}),h.Tc(6,Wc,3,7,"option",6),h.gc(),h.gc(),h.hc(7,"label",7),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"textarea",8),h.pc("ngModelChange",function(e){return h.Lc(n),h.rc().refundNote=e}),h.gc(),h.gc()}if(2&e){var c=h.rc();h.Qb(3),h.Wc(h.tc(4,5,"order.payment-to-refund")),h.Qb(2),h.yc("ngModel",c.selectedPayment),h.Qb(1),h.yc("ngForOf",c.order.payments),h.Qb(2),h.Wc(h.tc(9,7,"order.refund-cancellation-reason")),h.Qb(2),h.yc("ngModel",c.refundNote)}}function Rc(e,t){if(1&e){var n=h.ic();h.hc(0,"button",10),h.pc("click",function(){return h.Lc(n),h.rc().cancel()}),h.Vc(1),h.sc(2,"translate"),h.gc(),h.hc(3,"button",11),h.pc("click",function(){return h.Lc(n),h.rc().submit()}),h.Vc(4),h.sc(5,"translate"),h.gc()}if(2&e){var c=h.rc();h.Qb(1),h.Wc(h.tc(2,3,"common.cancel")),h.Qb(2),h.yc("disabled",c.priceDifference<0&&!c.selectedPayment),h.Qb(1),h.Xc(" ",h.tc(5,5,"common.confirm")," ")}}!function(e){e[e.Refund=0]="Refund",e[e.Payment=1]="Payment",e[e.PriceUnchanged=2]="PriceUnchanged",e[e.Cancel=3]="Cancel"}(Lc||(Lc={}));var Ec=function(){function e(){g(this,e)}return p(e,[{key:"priceDifference",get:function(){return this.order.totalWithTax-this.originalTotalWithTax}},{key:"ngOnInit",value:function(){this.refundNote=this.modifyOrderInput.note||""}},{key:"cancel",value:function(){this.resolveWith({result:Lc.Cancel})}},{key:"submit",value:function(){0<this.priceDifference?this.resolveWith({result:Lc.Payment}):this.priceDifference<0?this.resolveWith({result:Lc.Refund,refundPaymentId:this.selectedPayment.id,refundNote:this.refundNote}):this.resolveWith({result:Lc.PriceUnchanged})}}]),e}();Ec.\u0275fac=function(e){return new(e||Ec)},Ec.\u0275cmp=h.Vb({type:Ec,selectors:[["vdr-order-edits-preview-dialog"]],decls:10,vars:10,consts:[["vdrDialogTitle",""],[3,"order","orderLineCustomFields"],[1,"h4"],[4,"ngIf"],["vdrDialogButtons",""],["clrSelect","","name","options",3,"ngModel","ngModelChange"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"clr-control-label"],["name","refundNote","clrTextarea","","required","",3,"ngModel","ngModelChange"],[3,"ngValue"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(h.Tc(0,Dc,2,3,"ng-template",0),h.cc(1,"vdr-order-table",1),h.hc(2,"h4",2),h.Vc(3),h.sc(4,"translate"),h.hc(5,"strong"),h.Vc(6),h.sc(7,"localeCurrency"),h.gc(),h.gc(),h.Tc(8,Nc,11,9,"div",3),h.Tc(9,Rc,6,7,"ng-template",4)),2&e&&(h.Qb(1),h.yc("order",t.order)("orderLineCustomFields",t.orderLineCustomFields),h.Qb(2),h.Xc(" ",h.tc(4,5,"order.modify-order-price-difference"),": "),h.Qb(3),h.Wc(h.uc(7,7,t.priceDifference,t.order.currencyCode)),h.Qb(2),h.yc("ngIf",t.priceDifference<0))},directives:[b.a,sn,I.o,O.a,M.B,M.u,C.a,u.A,M.A,u.p,u.s,I.n,u.b,M.H,u.z,u.u,u.D],pipes:[Q.d,T.a],styles:[""],changeDetection:0});var Xc=d("c+KD"),$c=d("VhYM"),qc=d("4ALk");function Hc(e,t){if(1&e){var n=h.ic();h.hc(0,"vdr-action-bar"),h.hc(1,"vdr-ab-left"),h.hc(2,"div",1),h.cc(3,"vdr-entity-info",2),h.sc(4,"async"),h.cc(5,"vdr-order-state-label",3),h.gc(),h.gc(),h.hc(6,"vdr-ab-right"),h.hc(7,"button",4),h.pc("click",function(){h.Lc(n);var e=t.ngIf;return h.rc().transitionToPriorState(e)}),h.Vc(8),h.sc(9,"translate"),h.gc(),h.gc(),h.gc()}if(2&e){var c=t.ngIf,r=h.rc();h.Qb(3),h.yc("entity",h.tc(4,3,r.entity$)),h.Qb(2),h.yc("state",c.state),h.Qb(3),h.Xc(" ",h.tc(9,5,"order.cancel-modification")," ")}}function Uc(e,t){1&e&&(h.hc(0,"th"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Wc(h.tc(2,1,"common.custom-fields")))}function Gc(e,t){if(1&e&&(h.cc(0,"img",41),h.sc(1,"assetPreview")),2&e){var n=h.rc().$implicit;h.yc("src",h.uc(1,1,n.featuredAsset,"tiny"),h.Nc)}}var zc=function(e){return[e]};function Bc(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",44),h.ec()),2&e){var n=t.$implicit,c=h.rc(2).index,r=h.rc(2);h.Qb(1),h.yc("customField",n)("customFieldsFormGroup",r.orderLineCustomFieldsFormArray.get(h.Cc(3,zc,c)))("compact",!0)}}function Yc(e,t){if(1&e&&(h.hc(0,"td",42),h.Tc(1,Bc,2,5,"ng-container",43),h.gc()),2&e){var n=h.rc(3);h.Qb(1),h.yc("ngForOf",n.orderLineCustomFields)}}function Jc(e,t){if(1&e){var n=h.ic();h.hc(0,"tr",29),h.hc(1,"td",30),h.Tc(2,Gc,2,4,"img",31),h.gc(),h.hc(3,"td",32),h.Vc(4),h.gc(),h.hc(5,"td",33),h.Vc(6),h.gc(),h.hc(7,"td",34),h.Vc(8),h.sc(9,"localeCurrency"),h.hc(10,"div",16),h.sc(11,"translate"),h.Vc(12),h.sc(13,"localeCurrency"),h.gc(),h.gc(),h.hc(14,"td",35),h.hc(15,"input",36),h.pc("input",function(e){h.Lc(n);var c=t.$implicit;return h.rc(2).updateLineQuantity(c,e.target.value)}),h.gc(),h.cc(16,"vdr-line-refunds",37),h.cc(17,"vdr-line-fulfillment",38),h.gc(),h.Tc(18,Yc,2,1,"td",39),h.hc(19,"td",40),h.Vc(20),h.sc(21,"localeCurrency"),h.hc(22,"div",16),h.sc(23,"translate"),h.Vc(24),h.sc(25,"localeCurrency"),h.gc(),h.gc(),h.gc()}if(2&e){var c=t.$implicit,r=h.rc().ngIf,i=h.rc();h.Tb("is-cancelled",0===c.quantity)("modified",i.isLineModified(c)),h.Qb(2),h.yc("ngIf",c.featuredAsset),h.Qb(2),h.Wc(c.productVariant.name),h.Qb(2),h.Wc(c.productVariant.sku),h.Qb(2),h.Xc(" ",h.uc(9,19,c.unitPriceWithTax,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(11,22,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(13,24,c.unitPrice,r.currencyCode)," "),h.Qb(3),h.yc("value",c.quantity),h.Qb(1),h.yc("line",c)("payments",r.payments),h.Qb(1),h.yc("line",c)("orderState",r.state),h.Qb(1),h.yc("ngIf",i.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(21,27,c.linePriceWithTax,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(23,30,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(25,32,c.linePrice,r.currencyCode)," ")}}function Zc(e,t){if(1&e&&(h.cc(0,"img",41),h.sc(1,"assetPreview")),2&e){var n=h.rc().$implicit;h.yc("src",h.uc(1,1,n.productAsset,"tiny"),h.Nc)}}function Kc(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",44),h.ec()),2&e){var n=t.$implicit,c=h.rc(2).index,r=h.rc(2);h.Qb(1),h.yc("customField",n)("customFieldsFormGroup",r.addItemCustomFieldsFormArray.get(h.Cc(3,zc,c)))("compact",!0)}}function er(e,t){if(1&e&&(h.hc(0,"td",42),h.Tc(1,Kc,2,5,"ng-container",43),h.gc()),2&e){var n=h.rc(3);h.Qb(1),h.yc("ngForOf",n.orderLineCustomFields)}}function tr(e,t){if(1&e){var n=h.ic();h.hc(0,"tr",45),h.hc(1,"td",30),h.Tc(2,Zc,2,4,"img",31),h.gc(),h.hc(3,"td",32),h.Vc(4),h.gc(),h.hc(5,"td",33),h.Vc(6),h.gc(),h.hc(7,"td",34),h.Vc(8),h.sc(9,"localeCurrency"),h.hc(10,"div",16),h.sc(11,"translate"),h.Vc(12),h.sc(13,"localeCurrency"),h.gc(),h.gc(),h.hc(14,"td",35),h.hc(15,"input",36),h.pc("input",function(e){h.Lc(n);var c=t.$implicit;return h.rc(2).updateAddedItemQuantity(c,e.target.value)}),h.gc(),h.hc(16,"button",46),h.pc("click",function(){h.Lc(n);var e=t.index;return h.rc(2).removeAddedItem(e)}),h.cc(17,"clr-icon",47),h.gc(),h.gc(),h.Tc(18,er,2,1,"td",39),h.hc(19,"td",40),h.Vc(20),h.sc(21,"currency"),h.hc(22,"div",16),h.sc(23,"translate"),h.Vc(24),h.sc(25,"currency"),h.gc(),h.gc(),h.gc()}if(2&e){var c=t.$implicit,r=h.rc().ngIf,i=h.rc();h.Qb(2),h.yc("ngIf",c.productAsset),h.Qb(2),h.Wc(c.productVariantName),h.Qb(2),h.Wc(c.sku),h.Qb(2),h.Xc(" ",h.uc(9,11,c.priceWithTax,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(11,14,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(13,16,c.price,r.currencyCode)," "),h.Qb(3),h.yc("value",c.quantity),h.Qb(3),h.yc("ngIf",i.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(21,19,c.priceWithTax*c.quantity/100,r.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(23,22,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(25,24,c.price*c.quantity/100,r.currencyCode)," ")}}function nr(e,t){1&e&&h.cc(0,"td")}function cr(e,t){if(1&e&&(h.hc(0,"tr",48),h.hc(1,"td",49),h.Vc(2),h.gc(),h.hc(3,"td",33),h.Vc(4),h.gc(),h.cc(5,"td",50),h.cc(6,"td"),h.Tc(7,nr,1,0,"td",0),h.hc(8,"td",40),h.Vc(9),h.sc(10,"localeCurrency"),h.hc(11,"div",16),h.sc(12,"translate"),h.Vc(13),h.sc(14,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var n=t.$implicit,c=h.rc().ngIf,r=h.rc();h.Qb(2),h.Wc(n.description),h.Qb(2),h.Wc(n.sku),h.Qb(3),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(10,6,n.priceWithTax,c.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(12,9,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(14,11,n.price,c.currencyCode)," ")}}function rr(e,t){1&e&&h.cc(0,"td")}function ir(e,t){if(1&e&&(h.fc(0),h.Vc(1),h.sc(2,"localeCurrency"),h.hc(3,"div",16),h.sc(4,"translate"),h.Vc(5),h.sc(6,"localeCurrency"),h.gc(),h.ec()),2&e){var n=t.ngIf,c=h.rc(2).ngIf;h.Qb(1),h.Xc(" ",h.uc(2,3,n.priceWithTax,c.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(4,6,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(6,8,n.price,c.currencyCode)," ")}}function ar(e,t){if(1&e){var n=h.ic();h.hc(0,"tr",51),h.hc(1,"td",49),h.Vc(2),h.hc(3,"button",46),h.pc("click",function(){h.Lc(n);var e=t.index;return h.rc(2).removeSurcharge(e)}),h.cc(4,"clr-icon",47),h.gc(),h.gc(),h.hc(5,"td",33),h.Vc(6),h.gc(),h.cc(7,"td",50),h.cc(8,"td"),h.Tc(9,rr,1,0,"td",0),h.hc(10,"td",40),h.Tc(11,ir,7,11,"ng-container",0),h.gc(),h.gc()}if(2&e){var c=t.$implicit,r=h.rc(2);h.Qb(2),h.Xc(" ",c.description," "),h.Qb(4),h.Wc(c.sku),h.Qb(3),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.yc("ngIf",r.getSurchargePrices(c))}}function or(e,t){1&e&&h.cc(0,"td")}function lr(e,t){if(1&e&&(h.cc(0,"img",58),h.sc(1,"assetPreview")),2&e){var n=t.ngIf;h.yc("src",h.uc(1,1,n,"tiny"),h.Nc)}}function sr(e,t){if(1&e&&(h.hc(0,"div",55),h.Tc(1,lr,2,4,"img",56),h.hc(2,"div"),h.hc(3,"strong",57),h.Vc(4),h.gc(),h.hc(5,"small"),h.Vc(6),h.gc(),h.hc(7,"div"),h.Vc(8),h.sc(9,"localeCurrency"),h.gc(),h.gc(),h.gc()),2&e){var n=h.rc(2).ngIf,c=h.rc();h.Qb(1),h.yc("ngIf",c.addItemSelectedVariant.productAsset),h.Qb(3),h.Wc(c.addItemSelectedVariant.productVariantName),h.Qb(2),h.Wc(c.addItemSelectedVariant.sku),h.Qb(2),h.Xc(" ",h.uc(9,4,c.getSelectedItemPrice(c.addItemSelectedVariant),n.currencyCode)," ")}}function dr(e,t){if(1&e&&(h.fc(0),h.cc(1,"vdr-custom-field-control",59),h.ec()),2&e){var n=t.$implicit,c=h.rc(3);h.Qb(1),h.yc("readonly",!c.addItemSelectedVariant)("customField",n)("customFieldsFormGroup",c.addItemCustomFieldsForm)("compact",!0)}}function ur(e,t){if(1&e){var n=h.ic();h.hc(0,"clr-accordion-content"),h.hc(1,"vdr-product-selector",52),h.pc("productSelected",function(e){return h.Lc(n),h.rc(2).addItemSelectedVariant=e}),h.gc(),h.Tc(2,sr,10,7,"div",53),h.Tc(3,dr,2,4,"ng-container",43),h.hc(4,"button",54),h.pc("click",function(){h.Lc(n);var e=h.rc(2);return e.addItemToOrder(e.addItemSelectedVariant)}),h.Vc(5),h.sc(6,"translate"),h.gc(),h.gc()}if(2&e){var c=h.rc(2);h.Qb(2),h.yc("ngIf",c.addItemSelectedVariant),h.Qb(1),h.yc("ngForOf",c.orderLineCustomFields),h.Qb(1),h.yc("disabled",!c.addItemSelectedVariant||c.addItemCustomFieldsForm.invalid),h.Qb(1),h.Xc(" ",h.tc(6,4,"order.add-item-to-order")," ")}}var fr=function(e){return{rate:e}};function gr(e,t){if(1&e){var n=h.ic();h.hc(0,"clr-accordion-content"),h.hc(1,"form",60),h.pc("submit",function(){h.Lc(n);var e=h.rc(2);return e.addSurcharge(e.surchargeForm.value)}),h.hc(2,"vdr-form-field",61),h.sc(3,"translate"),h.cc(4,"input",62),h.gc(),h.hc(5,"vdr-form-field",63),h.sc(6,"translate"),h.cc(7,"input",64),h.gc(),h.hc(8,"vdr-form-field",65),h.sc(9,"translate"),h.cc(10,"vdr-currency-input",66),h.gc(),h.hc(11,"vdr-form-field",67),h.sc(12,"translate"),h.cc(13,"input",68),h.gc(),h.hc(14,"vdr-form-field",69),h.sc(15,"translate"),h.hc(16,"vdr-affixed-input",70),h.cc(17,"input",71),h.gc(),h.gc(),h.hc(18,"vdr-form-field",72),h.sc(19,"translate"),h.cc(20,"input",73),h.gc(),h.hc(21,"button",74),h.Vc(22),h.sc(23,"translate"),h.gc(),h.gc(),h.gc()}if(2&e){var c,r=h.rc().ngIf,i=h.rc(),a=null;h.Qb(1),h.yc("formGroup",i.surchargeForm),h.Qb(1),h.yc("label",h.tc(3,10,"common.description")),h.Qb(3),h.yc("label",h.tc(6,12,"order.product-sku")),h.Qb(3),h.yc("label",h.tc(9,14,"common.price")),h.Qb(2),h.yc("currencyCode",r.currencyCode),h.Qb(1),h.yc("label",h.uc(12,16,"catalog.price-includes-tax-at",h.Cc(25,fr,null==(c=i.surchargeForm.get("taxRate"))?null:c.value))),h.Qb(3),h.yc("label",h.tc(15,19,"order.tax-rate")),h.Qb(4),h.yc("label",h.tc(19,21,"order.tax-description")),h.Qb(3),h.yc("disabled",i.surchargeForm.invalid||i.surchargeForm.pristine||0===(null==(a=i.surchargeForm.get("price"))?null:a.value)),h.Qb(1),h.Xc(" ",h.tc(23,23,"order.add-surcharge")," ")}}function mr(e,t){if(1&e&&(h.hc(0,"clr-accordion-content"),h.cc(1,"vdr-address-form",75),h.sc(2,"async"),h.gc()),2&e){var n=h.rc(2);h.Qb(1),h.yc("formGroup",n.shippingAddressForm)("availableCountries",h.tc(2,3,n.availableCountries$))("customFields",n.addressCustomFields)}}function pr(e,t){if(1&e&&(h.hc(0,"clr-accordion-content"),h.cc(1,"vdr-address-form",75),h.sc(2,"async"),h.gc()),2&e){var n=h.rc(2);h.Qb(1),h.yc("formGroup",n.billingAddressForm)("availableCountries",h.tc(2,3,n.availableCountries$))("customFields",n.addressCustomFields)}}var hr=function(e){return{count:e}};function br(e,t){if(1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var n=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.modification-adding-items",h.Cc(4,hr,null==n.modifyOrderInput.addItems?null:n.modifyOrderInput.addItems.length))," ")}}function vr(e,t){if(1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var n=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.modification-adjusting-lines",h.Cc(4,hr,null==n.modifyOrderInput.adjustOrderLines?null:n.modifyOrderInput.adjustOrderLines.length))," ")}}function yr(e,t){if(1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e){var n=h.rc(2);h.Qb(1),h.Xc(" ",h.uc(2,1,"order.modification-adding-surcharges",h.Cc(4,hr,null==n.modifyOrderInput.surcharges?null:n.modifyOrderInput.surcharges.length))," ")}}function Cr(e,t){1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.modification-updating-shipping-address")," "))}function Or(e,t){1&e&&(h.hc(0,"li"),h.Vc(1),h.sc(2,"translate"),h.gc()),2&e&&(h.Qb(1),h.Xc(" ",h.tc(2,1,"order.modification-updating-billing-address")," "))}function Qr(e,t){if(1&e){var n=h.ic();h.hc(0,"div"),h.hc(1,"div",5),h.hc(2,"div",6),h.hc(3,"table",7),h.hc(4,"thead"),h.hc(5,"tr"),h.cc(6,"th"),h.hc(7,"th"),h.Vc(8),h.sc(9,"translate"),h.gc(),h.hc(10,"th"),h.Vc(11),h.sc(12,"translate"),h.gc(),h.hc(13,"th"),h.Vc(14),h.sc(15,"translate"),h.gc(),h.hc(16,"th"),h.Vc(17),h.sc(18,"translate"),h.gc(),h.Tc(19,Uc,3,3,"th",0),h.hc(20,"th"),h.Vc(21),h.sc(22,"translate"),h.gc(),h.gc(),h.gc(),h.hc(23,"tbody"),h.Tc(24,Jc,26,35,"tr",8),h.Tc(25,tr,26,27,"tr",9),h.Tc(26,cr,15,14,"tr",10),h.Tc(27,ar,12,4,"tr",11),h.hc(28,"tr",12),h.hc(29,"td",13),h.Vc(30),h.sc(31,"translate"),h.gc(),h.hc(32,"td",14),h.Vc(33),h.gc(),h.cc(34,"td",15),h.Tc(35,or,1,0,"td",0),h.hc(36,"td",14),h.Vc(37),h.sc(38,"localeCurrency"),h.hc(39,"div",16),h.sc(40,"translate"),h.Vc(41),h.sc(42,"localeCurrency"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc(),h.hc(43,"h4",17),h.Vc(44),h.sc(45,"translate"),h.gc(),h.hc(46,"clr-accordion"),h.hc(47,"clr-accordion-panel"),h.hc(48,"clr-accordion-title"),h.Vc(49),h.sc(50,"translate"),h.gc(),h.Tc(51,ur,7,6,"clr-accordion-content",18),h.gc(),h.hc(52,"clr-accordion-panel"),h.hc(53,"clr-accordion-title"),h.Vc(54),h.sc(55,"translate"),h.gc(),h.Tc(56,gr,24,27,"clr-accordion-content",18),h.gc(),h.hc(57,"clr-accordion-panel"),h.hc(58,"clr-accordion-title"),h.Vc(59),h.sc(60,"translate"),h.gc(),h.Tc(61,mr,3,5,"clr-accordion-content",18),h.gc(),h.hc(62,"clr-accordion-panel"),h.hc(63,"clr-accordion-title"),h.Vc(64),h.sc(65,"translate"),h.gc(),h.Tc(66,pr,3,5,"clr-accordion-content",18),h.gc(),h.gc(),h.gc(),h.hc(67,"div",19),h.hc(68,"div",20),h.hc(69,"div",21),h.Vc(70),h.sc(71,"translate"),h.gc(),h.hc(72,"div",22),h.hc(73,"ul"),h.Tc(74,br,3,6,"li",0),h.Tc(75,vr,3,6,"li",0),h.Tc(76,yr,3,6,"li",0),h.Tc(77,Cr,3,3,"li",0),h.Tc(78,Or,3,3,"li",0),h.gc(),h.gc(),h.hc(79,"div",22),h.hc(80,"label",23),h.Vc(81),h.sc(82,"translate"),h.gc(),h.hc(83,"textarea",24),h.pc("ngModelChange",function(e){return h.Lc(n),h.rc().note=e}),h.gc(),h.hc(84,"clr-checkbox-wrapper",25),h.hc(85,"input",26),h.pc("ngModelChange",function(e){return h.Lc(n),h.rc().recalculateShipping=e}),h.gc(),h.hc(86,"label"),h.Vc(87),h.sc(88,"translate"),h.gc(),h.gc(),h.gc(),h.hc(89,"div",27),h.hc(90,"button",28),h.pc("click",function(){h.Lc(n);var e=t.ngIf;return h.rc().previewAndModify(e)}),h.Vc(91),h.sc(92,"translate"),h.gc(),h.gc(),h.gc(),h.gc(),h.gc(),h.gc()}if(2&e){var c=t.ngIf,r=h.rc();h.Qb(8),h.Wc(h.tc(9,34,"order.product-name")),h.Qb(3),h.Wc(h.tc(12,36,"order.product-sku")),h.Qb(3),h.Wc(h.tc(15,38,"order.unit-price")),h.Qb(3),h.Wc(h.tc(18,40,"order.quantity")),h.Qb(2),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.Wc(h.tc(22,42,"order.total")),h.Qb(3),h.yc("ngForOf",c.lines),h.Qb(1),h.yc("ngForOf",r.addedLines)("ngForTrackBy",r.trackByProductVariantId),h.Qb(1),h.yc("ngForOf",c.surcharges),h.Qb(1),h.yc("ngForOf",r.modifyOrderInput.surcharges),h.Qb(3),h.Wc(h.tc(31,44,"order.shipping")),h.Qb(3),h.Wc(null==c.shippingLines[0]||null==c.shippingLines[0].shippingMethod?null:c.shippingLines[0].shippingMethod.name),h.Qb(2),h.yc("ngIf",r.orderLineCustomFields.length),h.Qb(2),h.Xc(" ",h.uc(38,46,c.shippingWithTax,c.currencyCode)," "),h.Qb(2),h.yc("title",h.tc(40,49,"order.net-price")),h.Qb(2),h.Xc(" ",h.uc(42,51,c.shipping,c.currencyCode)," "),h.Qb(3),h.Wc(h.tc(45,54,"order.modifications")),h.Qb(5),h.Wc(h.tc(50,56,"order.add-item-to-order")),h.Qb(5),h.Wc(h.tc(55,58,"order.add-surcharge")),h.Qb(5),h.Wc(h.tc(60,60,"order.edit-shipping-address")),h.Qb(5),h.Wc(h.tc(65,62,"order.edit-billing-address")),h.Qb(6),h.Xc(" ",h.tc(71,64,"order.modification-summary")," "),h.Qb(4),h.yc("ngIf",null==r.modifyOrderInput.addItems?null:r.modifyOrderInput.addItems.length),h.Qb(1),h.yc("ngIf",null==r.modifyOrderInput.adjustOrderLines?null:r.modifyOrderInput.adjustOrderLines.length),h.Qb(1),h.yc("ngIf",null==r.modifyOrderInput.surcharges?null:r.modifyOrderInput.surcharges.length),h.Qb(1),h.yc("ngIf",r.shippingAddressForm.dirty),h.Qb(1),h.yc("ngIf",r.billingAddressForm.dirty),h.Qb(3),h.Wc(h.tc(82,66,"order.note")),h.Qb(2),h.yc("ngModel",r.note),h.Qb(2),h.yc("ngModel",r.recalculateShipping),h.Qb(2),h.Wc(h.tc(88,68,"order.modification-recalculate-shipping")),h.Qb(3),h.yc("disabled",!r.canPreviewChanges()),h.Qb(1),h.Xc(" ",h.tc(92,70,"order.preview-changes")," ")}}var Ir=function(e){t(r,e);var n=c(r);function r(e,t,c,i,a,o,l,s){var d;return g(this,r),(d=n.call(this,t,e,c,a)).changeDetector=i,d.dataService=a,d.notificationService=o,d.modalService=l,d.orderTransitionService=s,d.detailForm=new u.i({}),d.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",updateShippingAddress:{},updateBillingAddress:{}},d.note="",d.recalculateShipping=!0,d.addedVariants=new Map,d}return p(r,[{key:"addedLines",get:function(){var e=this,t=function(e){return"SinglePrice"===e.__typename?e.value:0};return(this.modifyOrderInput.addItems||[]).map(function(n){var c=e.addedVariants.get(n.productVariantId);if(c)return Object.assign(Object.assign({},c),{price:t(c.price),priceWithTax:t(c.priceWithTax),quantity:n.quantity})}).filter(J.notNullOrUndefined)}},{key:"ngOnInit",value:function(){var e=this;this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe(Object(Ac.a)(this.destroy$)).subscribe(function(t){var n,c,r,i,a,o,s,d,f,g,m,p,h,b,v,y,C,O;e.surchargeForm=new u.i({description:new u.f("",u.C.required),sku:new u.f(""),price:new u.f(0,u.C.required),priceIncludesTax:new u.f(!0),taxRate:new u.f(0),taxDescription:new u.f("")}),e.shippingAddressForm||(e.shippingAddressForm=new u.i({fullName:new u.f(null===(n=t.shippingAddress)||void 0===n?void 0:n.fullName),company:new u.f(null===(c=t.shippingAddress)||void 0===c?void 0:c.company),streetLine1:new u.f(null===(r=t.shippingAddress)||void 0===r?void 0:r.streetLine1),streetLine2:new u.f(null===(i=t.shippingAddress)||void 0===i?void 0:i.streetLine2),city:new u.f(null===(a=t.shippingAddress)||void 0===a?void 0:a.city),province:new u.f(null===(o=t.shippingAddress)||void 0===o?void 0:o.province),postalCode:new u.f(null===(s=t.shippingAddress)||void 0===s?void 0:s.postalCode),countryCode:new u.f(null===(d=t.shippingAddress)||void 0===d?void 0:d.countryCode),phoneNumber:new u.f(null===(f=t.shippingAddress)||void 0===f?void 0:f.phoneNumber)})),e.billingAddressForm||(e.billingAddressForm=new u.i({fullName:new u.f(null===(g=t.billingAddress)||void 0===g?void 0:g.fullName),company:new u.f(null===(m=t.billingAddress)||void 0===m?void 0:m.company),streetLine1:new u.f(null===(p=t.billingAddress)||void 0===p?void 0:p.streetLine1),streetLine2:new u.f(null===(h=t.billingAddress)||void 0===h?void 0:h.streetLine2),city:new u.f(null===(b=t.billingAddress)||void 0===b?void 0:b.city),province:new u.f(null===(v=t.billingAddress)||void 0===v?void 0:v.province),postalCode:new u.f(null===(y=t.billingAddress)||void 0===y?void 0:y.postalCode),countryCode:new u.f(null===(C=t.billingAddress)||void 0===C?void 0:C.countryCode),phoneNumber:new u.f(null===(O=t.billingAddress)||void 0===O?void 0:O.phoneNumber)})),e.orderLineCustomFieldsFormArray=new u.c([]);var Q,I=l(t.lines);try{var T=function(){var t,n=Q.value,c=new u.i({}),r=l(e.orderLineCustomFields);try{for(r.s();!(t=r.n()).done;){var i=t.value.name;c.addControl(i,new u.f(n.customFields[i]))}}catch(a){r.e(a)}finally{r.f()}c.valueChanges.pipe(Object(Ac.a)(e.destroy$)).subscribe(function(t){var c=e.modifyOrderInput.adjustOrderLines.find(function(e){return e.orderLineId===n.id});c||(c={orderLineId:n.id,quantity:n.quantity},e.modifyOrderInput.adjustOrderLines.push(c)),e.orderLineCustomFields.length&&(c.customFields=t)}),e.orderLineCustomFieldsFormArray.push(c)};for(I.s();!(Q=I.n()).done;)T()}catch(S){I.e(S)}finally{I.f()}}),this.addItemCustomFieldsFormArray=new u.c([]),this.addItemCustomFieldsForm=new u.i({});var t,n=l(this.orderLineCustomFields);try{for(n.s();!(t=n.n()).done;){var c=t.value;this.addItemCustomFieldsForm.addControl(c.name,new u.f)}}catch(r){n.e(r)}finally{n.f()}this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(function(e){return e.countries.items}).pipe(Object(jc.a)(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:m.L.DESC},filter:{type:{eq:m.y.ORDER_STATE_TRANSITION}}}).single$.subscribe(function(t){var n=t.order;e.previousState=null==n?void 0:n.history.items[0].data.from})}},{key:"ngOnDestroy",value:function(){this.destroy()}},{key:"transitionToPriorState",value:function(e){var t=this;this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe(function(e){t.router.navigate([".."],{relativeTo:t.route})})}},{key:"canPreviewChanges",value:function(){var e=this.modifyOrderInput,t=e.addItems,n=e.adjustOrderLines,c=e.surcharges;return!!(null==t?void 0:t.length)||!!(null==c?void 0:c.length)||!!(null==n?void 0:n.length)||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid}},{key:"isLineModified",value:function(e){var t;return!!(null===(t=this.modifyOrderInput.adjustOrderLines)||void 0===t?void 0:t.find(function(t){return t.orderLineId===e.id&&t.quantity!==e.quantity}))}},{key:"updateLineQuantity",value:function(e,t){var n=this.modifyOrderInput.adjustOrderLines,c=null==n?void 0:n.find(function(t){return t.orderLineId===e.id});c&&+t===e.quantity&&(null==n||n.splice(null==n?void 0:n.indexOf(c),1)),c||(c={orderLineId:e.id,quantity:+t},null==n||n.push(c)),c.quantity=+t}},{key:"updateAddedItemQuantity",value:function(e,t){var n,c=null===(n=this.modifyOrderInput.addItems)||void 0===n?void 0:n.find(function(t){return t.productVariantId===e.productVariantId});c&&(c.quantity=+t)}},{key:"trackByProductVariantId",value:function(e,t){return t.productVariantId}},{key:"getSelectedItemPrice",value:function(e){switch(null==e?void 0:e.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}},{key:"addItemToOrder",value:function(e){var t,n,c=this;if(e){var r=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0,i=null===(t=this.modifyOrderInput.addItems)||void 0===t?void 0:t.find(function(t){return c.isMatchingAddItemRow(t,e,r)});if(i?i.quantity++:(i={productVariantId:e.productVariantId,quantity:1},r&&(i.customFields=r),null===(n=this.modifyOrderInput.addItems)||void 0===n||n.push(i)),r){for(var a=new u.i({}),o=0,l=Object.entries(r);o<l.length;o++){var d=s(l[o],2),f=d[0],g=d[1];a.addControl(f,new u.f(g))}this.addItemCustomFieldsFormArray.push(a),a.valueChanges.pipe(Object(Ac.a)(this.destroy$)).subscribe(function(e){i&&(i.customFields=e)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}}},{key:"isMatchingAddItemRow",value:function(e,t,n){return e.productVariantId===t.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(n)}},{key:"removeAddedItem",value:function(e){this.modifyOrderInput.addItems.splice(e,1),-1<e&&this.addItemCustomFieldsFormArray.removeAt(e)}},{key:"getSurchargePrices",value:function(e){var t=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:t}}},{key:"addSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}},{key:"removeSurcharge",value:function(e){var t;null===(t=this.modifyOrderInput.surcharges)||void 0===t||t.splice(e,1)}},{key:"previewAndModify",value:function(e){var t,n=this,c=Object.assign(Object.assign(Object.assign(Object.assign({},this.modifyOrderInput),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,note:null!==(t=this.note)&&void 0!==t?t:"",options:{recalculateShipping:this.recalculateShipping}}),r=e.totalWithTax;this.dataService.order.modifyOrder(c).pipe(Object(Je.a)(function(e){var t=e.modifyOrder;switch(t.__typename){case"Order":return n.modalService.fromComponent(Ec,{size:"xl",closable:!1,locals:{originalTotalWithTax:r,order:t,orderLineCustomFields:n.orderLineCustomFields,modifyOrderInput:c}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":return n.notificationService.error(t.message),Object(Ge.a)(!1);case null:case void 0:return Object(Ge.a)(!1);default:Object(J.assertNever)(t)}}),Object(Je.a)(function(t){if(t&&t.result!==Lc.Cancel){var i=Object.assign(Object.assign({},c),{dryRun:!1});return t.result===Lc.Refund&&(i.refund={paymentId:t.refundPaymentId,reason:t.refundNote}),n.dataService.order.modifyOrder(i).pipe(Object(Je.a)(function(t){var c=t.modifyOrder;if("Order"===c.__typename){var i=0<c.totalWithTax-r?"ArrangingAdditionalPayment":n.previousState;return n.dataService.order.transitionToState(e.id,i).pipe(Object(Ke.a)(!0))}return n.notificationService.error(c.message),Ue.a}))}return n.dataService.order.getOrder(n.id).mapSingle(function(){return!1})})).subscribe(function(e){e&&n.router.navigate(["../"],{relativeTo:n.route})})}},{key:"setFormValues",value:function(e,t){}}]),r}(m.l);Ir.\u0275fac=function(e){return new(e||Ir)(h.bc(Ut.e),h.bc(Ut.a),h.bc(m.I),h.bc(h.j),h.bc(m.s),h.bc(m.G),h.bc(m.F),h.bc(ut))},Ir.\u0275cmp=h.Vb({type:Ir,selectors:[["vdr-order-editor"]],features:[h.Nb],decls:4,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"entity"],[3,"state"],[1,"btn","btn-secondary",3,"click"],[1,"clr-row"],[1,"clr-col-lg-8"],[1,"order-table","table"],["class","order-line",3,"is-cancelled","modified",4,"ngFor","ngForOf"],["class","modified",4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],["class","surcharge modified",4,"ngFor","ngForOf"],[1,"shipping"],[1,"left","clr-align-middle"],[1,"clr-align-middle"],["colspan","3"],[1,"net-price",3,"title"],[1,"mb2"],[4,"clrIfExpanded"],[1,"clr-col-lg-4","order-cards"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"clr-control-label"],["name","note","clrTextarea","","required","",3,"ngModel","ngModelChange"],[1,""],["type","checkbox","clrCheckbox","",3,"ngModel","ngModelChange"],[1,"card-footer"],[1,"btn","btn-primary",3,"disabled","click"],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","unit-price"],[1,"align-middle","quantity"],["type","number","min","0",3,"value","input"],[3,"line","payments"],[3,"line","orderState"],["class","order-line-custom-field align-middle",4,"ngIf"],[1,"align-middle","total"],[3,"src"],[1,"order-line-custom-field","align-middle"],[4,"ngFor","ngForOf"],["entityName","OrderLine",3,"customField","customFieldsFormGroup","compact"],[1,"modified"],[1,"icon-button",3,"click"],["shape","trash"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle"],[1,"surcharge","modified"],[1,"mb4",3,"productSelected"],["class","flex mb4",4,"ngIf"],[1,"btn","btn-secondary",3,"disabled","click"],[1,"flex","mb4"],["class","mr4",3,"src",4,"ngIf"],[1,"mr4"],[1,"mr4",3,"src"],["entityName","OrderLine",3,"readonly","customField","customFieldsFormGroup","compact"],[3,"formGroup","submit"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary",3,"disabled"],[3,"formGroup","availableCountries","customFields"]],template:function(e,t){1&e&&(h.Tc(0,Hc,10,7,"vdr-action-bar",0),h.sc(1,"async"),h.Tc(2,Qr,93,72,"div",0),h.sc(3,"async")),2&e&&(h.yc("ngIf",h.tc(1,2,t.entity$)),h.Qb(2),h.yc("ngIf",h.tc(3,4,t.entity$)))},directives:[I.o,Gt.a,Gt.b,zt.a,Bt.a,Gt.c,I.n,M.l,M.b,M.O,M.d,M.N,M.e,M.Q,M.q,M.u,C.a,u.b,M.H,u.z,u.p,u.s,M.k,u.a,M.i,Le,Ve,te.a,M.o,M.c,Xc.a,u.E,u.q,u.j,v.a,u.h,Tt.a,$c.a,u.v,qc.a],pipes:[I.b,Q.d,T.a,V.a,I.d],styles:[".order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-right:18px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%], .order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{-webkit-text-decoration:underline dotted var(--color-text-200);text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}"],changeDetection:0});var Tr=d("/uUt"),Sr=d("pLZG"),Pr=d("tBhK"),kr=d("CotX"),Fr=d("r2d8"),Mr=d("ef/U"),Vr=d("uHMJ");function xr(e,t){if(1&e){var n=h.ic();h.hc(0,"button",18),h.pc("click",function(){h.Lc(n);var e=t.$implicit;return h.rc(2).selectFilterPreset(e.name)}),h.Vc(1),h.sc(2,"translate"),h.gc()}if(2&e){var c=t.$implicit,r=h.rc().ngIf;h.Tb("btn-primary",r===c.name),h.Qb(1),h.Xc(" ",h.tc(2,3,c.label)," ")}}function wr(e,t){if(1&e){var n=h.ic();h.hc(0,"div",16),h.Tc(1,xr,3,5,"button",17),h.hc(2,"button",18),h.pc("click",function(){return h.Lc(n),h.rc().selectFilterPreset("custom")}),h.Vc(3),h.sc(4,"translate"),h.cc(5,"clr-icon",19),h.gc(),h.gc()}if(2&e){var c=t.ngIf,r=h.rc();h.Qb(1),h.yc("ngForOf",r.filterPresets),h.Qb(1),h.Tb("btn-primary","custom"===c),h.Qb(1),h.Xc(" ",h.tc(4,4,"order.filter-custom")," ")}}function _r(e,t){if(1&e&&(h.Vc(0),h.sc(1,"translate"),h.sc(2,"stateI18nToken")),2&e){var n=t.item;h.Wc(h.tc(1,1,h.tc(2,3,n)))}}function Lr(e,t){if(1&e&&(h.hc(0,"span",20),h.Vc(1),h.sc(2,"translate"),h.sc(3,"stateI18nToken"),h.gc(),h.hc(4,"span",21),h.pc("click",function(){var e=t.item;return(0,t.clear)(e)}),h.Vc(5,"\xd7"),h.gc()),2&e){var n=t.item;h.Qb(1),h.Xc(" ",h.tc(2,1,h.tc(3,3,n)),"")}}var Ar=function(e){return["./",e,"modify"]},jr=function(e){return["./",e]};function Dr(e,t){if(1&e&&(h.hc(0,"td",22),h.Vc(1),h.gc(),h.hc(2,"td",22),h.cc(3,"vdr-customer-label",23),h.gc(),h.hc(4,"td",22),h.cc(5,"vdr-order-state-label",24),h.gc(),h.hc(6,"td",22),h.Vc(7),h.sc(8,"localeCurrency"),h.gc(),h.hc(9,"td",22),h.Vc(10),h.sc(11,"timeAgo"),h.gc(),h.hc(12,"td",22),h.Vc(13),h.sc(14,"localeDate"),h.gc(),h.hc(15,"td",22),h.Vc(16),h.gc(),h.hc(17,"td",25),h.cc(18,"vdr-table-row-action",26),h.sc(19,"translate"),h.gc()),2&e){var n=t.item,c=h.rc();h.Qb(1),h.Wc(n.code),h.Qb(2),h.yc("customer",n.customer),h.Qb(2),h.yc("state",n.state),h.Qb(2),h.Wc(h.uc(8,9,n.total,n.currencyCode)),h.Qb(3),h.Wc(h.tc(11,12,n.updatedAt)),h.Qb(3),h.Wc(h.uc(14,14,n.orderPlacedAt,"medium")),h.Qb(3),h.Wc(c.getShippingNames(n)),h.Qb(2),h.yc("label",h.tc(19,17,"common.open"))("linkTo","Modifying"===n.state?h.Cc(19,Ar,n.id):h.Cc(21,jr,n.id))}}var Wr=function(n){t(o,n);var r=c(o);function o(t,n,c,l,s){var d,f;g(this,o),(f=r.call(this,l,s)).serverConfigService=t,f.dataService=n,f.localStorageService=c,f.searchOrderCodeControl=new u.f(""),f.searchLastNameControl=new u.f(""),f.orderStates=f.serverConfigService.getOrderProcessStates().map(function(e){return e.name}),f.filterPresets=[{name:"open",label:Object(F.a)("order.filter-preset-open"),config:{active:!1,states:f.orderStates.filter(function(e){return"Delivered"!==e&&"Cancelled"!==e&&"Shipped"!==e})}},{name:"shipped",label:Object(F.a)("order.filter-preset-shipped"),config:{active:!1,states:["Shipped"]}},{name:"completed",label:Object(F.a)("order.filter-preset-completed"),config:{active:!1,states:["Delivered","Cancelled"]}},{name:"active",label:Object(F.a)("order.filter-preset-active"),config:{active:!0}}],e((d=i(f),a(o.prototype)),"setQueryFn",d).call(d,function(e,t){return f.dataService.order.getOrders({take:e,skip:t}).refetchOnChannelChange()},function(e){return e.orders},function(e,t){return f.createQueryOptions(e,t,f.searchOrderCodeControl.value,f.searchLastNameControl.value,f.route.snapshot.queryParamMap.get("filter")||"open")});var m=f.localStorageService.get("orderListLastCustomFilters");return m&&f.setQueryParam(m,{replaceUrl:!0}),f}return p(o,[{key:"ngOnInit",value:function(){var t,n=this;e(a(o.prototype),"ngOnInit",this).call(this),this.activePreset$=this.route.queryParamMap.pipe(Object(Ze.a)(function(e){return e.get("filter")||"open"}),Object(Tr.a)());var c=Object(ze.a)(this.searchOrderCodeControl.valueChanges,this.searchLastNameControl.valueChanges).pipe(Object(Sr.a)(function(e){return 2<e.length||0===e.length}),Object(gt.a)(250));Object(ze.a)(c,this.route.queryParamMap).pipe(Object(Ac.a)(this.destroy$)).subscribe(function(e){n.refresh()});var r=this.route.snapshot.queryParamMap;this.customFilterForm=new u.i({states:new u.f(null!==(t=r.getAll("states"))&&void 0!==t?t:[]),placedAtStart:new u.f(r.get("placedAtStart")),placedAtEnd:new u.f(r.get("placedAtEnd"))})}},{key:"selectFilterPreset",value:function(e){var t,n=null!==(t=this.localStorageService.get("orderListLastCustomFilters"))&&void 0!==t?t:{},c="custom"===e?n:{states:void 0,placedAtStart:void 0,placedAtEnd:void 0};this.setQueryParam(Object.assign({filter:e,page:1},c),{replaceUrl:!0})}},{key:"applyCustomFilters",value:function(){var e=this.customFilterForm.value,t={states:e.states,placedAtStart:e.placedAtStart,placedAtEnd:e.placedAtEnd};this.setQueryParam(Object.assign({filter:"custom"},t)),this.customFilterForm.markAsPristine(),this.localStorageService.set("orderListLastCustomFilters",t)}},{key:"createQueryOptions",value:function(e,t,n,c,r){var i,a=this.filterPresets.find(function(e){return e.name===r}),o={};if(a)null!=a.config.active&&(o.active={eq:a.config.active}),a.config.states&&(o.state={in:a.config.states});else if("custom"===r){var l=this.route.snapshot.queryParamMap,s=null!==(i=l.getAll("states"))&&void 0!==i?i:[],d=l.get("placedAtStart"),u=l.get("placedAtEnd");s.length&&(o.state={in:s}),d&&u?o.orderPlacedAt={between:{start:d,end:u}}:d?o.orderPlacedAt={after:d}:u&&(o.orderPlacedAt={before:u})}return c&&(o.customerLastName={contains:c}),n&&(o.code={contains:n}),{options:{skip:e,take:t,filter:Object.assign({},null!=o?o:{}),sort:{updatedAt:m.L.DESC}}}}},{key:"getShippingNames",value:function(e){return e.shippingLines.length?e.shippingLines.map(function(e){return e.shippingMethod.name}).join(", "):""}}]),o}(m.n);Wr.\u0275fac=function(e){return new(e||Wr)(h.bc(m.I),h.bc(m.s),h.bc(m.D),h.bc(Ut.e),h.bc(Ut.a))},Wr.\u0275cmp=h.Vb({type:Wr,selectors:[["vdr-order-list"]],features:[h.Nb],decls:62,vars:67,consts:[[1,"search-form"],["class","btn-group btn-outline-primary",4,"ngIf"],["type","text","name","searchTerm",1,"search-input",3,"formControl","placeholder"],[1,"custom-filters"],[3,"formGroup"],[1,"flex","align-center"],["appendTo","body","formControlName","states",3,"items","addTag","multiple","placeholder","clearable","searchable"],["ng-option-tmp",""],["ng-label-tmp",""],[1,"btn","btn-secondary",3,"disabled","click"],["shape","filter"],[1,"flex"],["formControlName","placedAtStart"],["formControlName","placedAtEnd"],["locationId","order-list"],[3,"items","itemsPerPage","totalItems","currentPage","pageChange","itemsPerPageChange"],[1,"btn-group","btn-outline-primary"],["class","btn",3,"btn-primary","click",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["shape","angle down"],[1,"ng-value-label"],["aria-hidden","true",1,"ng-value-icon","right",3,"click"],[1,"left","align-middle"],[3,"customer"],[3,"state"],[1,"right","align-middle"],["iconShape","shopping-cart",3,"label","linkTo"]],template:function(e,t){1&e&&(h.hc(0,"vdr-action-bar"),h.hc(1,"vdr-ab-left"),h.hc(2,"div",0),h.Tc(3,wr,6,6,"div",1),h.sc(4,"async"),h.cc(5,"input",2),h.sc(6,"translate"),h.cc(7,"input",2),h.sc(8,"translate"),h.gc(),h.hc(9,"div",3),h.sc(10,"async"),h.hc(11,"form",4),h.hc(12,"div",5),h.hc(13,"ng-select",6),h.sc(14,"translate"),h.Tc(15,_r,3,5,"ng-template",7),h.Tc(16,Lr,6,5,"ng-template",8),h.gc(),h.hc(17,"button",9),h.pc("click",function(){return t.applyCustomFilters()}),h.Vc(18),h.sc(19,"translate"),h.cc(20,"clr-icon",10),h.gc(),h.gc(),h.hc(21,"div",11),h.hc(22,"div"),h.hc(23,"label"),h.Vc(24),h.sc(25,"translate"),h.gc(),h.cc(26,"vdr-datetime-picker",12),h.gc(),h.hc(27,"div"),h.hc(28,"label"),h.Vc(29),h.sc(30,"translate"),h.gc(),h.cc(31,"vdr-datetime-picker",13),h.gc(),h.gc(),h.gc(),h.gc(),h.gc(),h.hc(32,"vdr-ab-right"),h.cc(33,"vdr-action-bar-items",14),h.gc(),h.gc(),h.hc(34,"vdr-data-table",15),h.pc("pageChange",function(e){return t.setPageNumber(e)})("itemsPerPageChange",function(e){return t.setItemsPerPage(e)}),h.sc(35,"async"),h.sc(36,"async"),h.sc(37,"async"),h.sc(38,"async"),h.hc(39,"vdr-dt-column"),h.Vc(40),h.sc(41,"translate"),h.gc(),h.hc(42,"vdr-dt-column"),h.Vc(43),h.sc(44,"translate"),h.gc(),h.hc(45,"vdr-dt-column"),h.Vc(46),h.sc(47,"translate"),h.gc(),h.hc(48,"vdr-dt-column"),h.Vc(49),h.sc(50,"translate"),h.gc(),h.hc(51,"vdr-dt-column"),h.Vc(52),h.sc(53,"translate"),h.gc(),h.hc(54,"vdr-dt-column"),h.Vc(55),h.sc(56,"translate"),h.gc(),h.hc(57,"vdr-dt-column"),h.Vc(58),h.sc(59,"translate"),h.gc(),h.cc(60,"vdr-dt-column"),h.Tc(61,Dr,20,23,"ng-template"),h.gc()),2&e&&(h.Qb(3),h.yc("ngIf",h.tc(4,29,t.activePreset$)),h.Qb(2),h.yc("formControl",t.searchOrderCodeControl)("placeholder",h.tc(6,31,"order.search-by-order-code")),h.Qb(2),h.yc("formControl",t.searchLastNameControl)("placeholder",h.tc(8,33,"order.search-by-customer-last-name")),h.Qb(2),h.Tb("expanded","custom"===h.tc(10,35,t.activePreset$)),h.Qb(2),h.yc("formGroup",t.customFilterForm),h.Qb(2),h.yc("items",t.orderStates)("addTag",!1)("multiple",!0)("placeholder",h.tc(14,37,"state.all-orders"))("clearable",!0)("searchable",!1),h.Qb(4),h.yc("disabled",t.customFilterForm.pristine),h.Qb(1),h.Xc(" ",h.tc(19,39,"order.apply-filters")," "),h.Qb(6),h.Wc(h.tc(25,41,"order.placed-at-start")),h.Qb(5),h.Wc(h.tc(30,43,"order.placed-at-end")),h.Qb(5),h.yc("items",h.tc(35,45,t.items$))("itemsPerPage",h.tc(36,47,t.itemsPerPage$))("totalItems",h.tc(37,49,t.totalItems$))("currentPage",h.tc(38,51,t.currentPage$)),h.Qb(6),h.Wc(h.tc(41,53,"common.code")),h.Qb(3),h.Wc(h.tc(44,55,"order.customer")),h.Qb(3),h.Wc(h.tc(47,57,"order.state")),h.Qb(3),h.Wc(h.tc(50,59,"order.total")),h.Qb(3),h.Wc(h.tc(53,61,"common.updated-at")),h.Qb(3),h.Wc(h.tc(56,63,"order.placed-at")),h.Qb(3),h.Wc(h.tc(59,65,"order.shipping")))},directives:[Gt.a,Gt.b,I.o,C.a,u.b,u.p,u.g,u.E,u.q,u.j,y.a,u.h,y.d,y.e,M.o,M.u,Pr.a,Gt.c,Yt.a,kr.a,Fr.a,I.n,Zn.a,Bt.a,Mr.a],pipes:[I.b,Q.d,z.a,T.a,Vr.a,ne.a],styles:[".search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;margin-bottom:6px}@media screen and (min-width:768px){.search-form[_ngcontent-%COMP%]{flex-direction:row}}.search-input[_ngcontent-%COMP%]{margin-left:6px;margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:none}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px}ng-select[_ngcontent-%COMP%], ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}"],changeDetection:0});var Nr=function(e){t(r,e);var n=c(r);function r(e,t){return g(this,r),n.call(this,e,{__typename:"Order",id:"",code:"",createdAt:"",updatedAt:"",total:0},function(e){return t.order.getOrder(e).mapStream(function(e){return e.order})})}return r}(m.m);Nr.\u0275fac=function(e){return new(e||Nr)(h.lc(Ut.e),h.lc(m.s))},Nr.\u0275prov=h.Xb({token:Nr,factory:Nr.\u0275fac,providedIn:"root"});var Rr=[{path:"",component:Wr,data:{breadcrumb:Object(F.a)("breadcrumb.orders")}},{path:":id",component:_c,resolve:Object(m.O)(Nr),canDeactivate:[m.o],data:{breadcrumb:Er}},{path:":id/modify",component:Ir,resolve:Object(m.O)(Nr),data:{breadcrumb:Xr}}];function Er(e,t){return Object(m.Q)({entity:e.entity,id:t.id,breadcrumbKey:"breadcrumb.orders",getName:function(e){return e.code},route:""})}function Xr(e,t){return Er(e,t).pipe(Object(Ze.a)(function(e){var t=e.slice();return t[0].link[0]="../",t[1].link[0]="../orders",t.concat({label:Object(F.a)("breadcrumb.modifying"),link:[""]})}))}var $r=function e(){g(this,e)};$r.\u0275fac=function(e){return new(e||$r)},$r.\u0275mod=h.Zb({type:$r}),$r.\u0275inj=h.Yb({imports:[[m.J,Ut.i.forChild(Rr)]]})}}])}();
//# sourceMappingURL=11-es5.48c81155db1d40643855.js.map